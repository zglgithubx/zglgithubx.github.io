<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>KMPç®—æ³•</title>
    <url>/posts/35921.html</url>
    <content><![CDATA[<h3 id="you-lai" id="ç”±æ¥">ç”±æ¥</h3>
<p>Knuth-Morris-Pratt å­—ç¬¦ä¸²æŸ¥æ‰¾ç®—æ³•ï¼Œç®€ç§°ä¸º â€œKMPç®—æ³•â€ï¼Œå¸¸ç”¨äºåœ¨ä¸€ä¸ªæ–‡æœ¬ä¸²Så†…æŸ¥æ‰¾ä¸€ä¸ªæ¨¡å¼ä¸²P çš„å‡ºç°ä½ç½®ï¼Œè¿™ä¸ªç®—æ³•ç”±Donald Knuthã€Vaughan Prattã€James H. Morrisä¸‰äººäº1977å¹´è”åˆå‘è¡¨ï¼Œæ•…å–è¿™3äººçš„å§“æ°å‘½åæ­¤ç®—æ³•ã€‚</p>
<span id="more"></span>
<h3 id="kmp-suan-fa-shi-shi-yao" id="KMPç®—æ³•æ˜¯ä»€ä¹ˆ">KMPç®—æ³•æ˜¯ä»€ä¹ˆ</h3>
<p>KMPç®—æ³•ä¸»è¦åº”ç”¨äºå­—ç¬¦ä¸²çš„å¿«é€ŸåŒ¹é…ã€‚</p>
<p>æ¯”å¦‚åœ¨ç»™å®šå­—ç¬¦ä¸²ä¸­ï¼Œè®©ä½ æ‰¾ä¸€ä¸ªç›®æ ‡å­ä¸²ï¼Œå¸¸è§„çš„è§£æ³•å°±æ˜¯æš´åŠ›åŒ¹é…ï¼Œç”¨åŒå±‚forå¾ªç¯åˆ†åˆ«éå†ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(m*n)ã€‚è€ŒKMPç®—æ³•å¯ä»¥è®©è¿™ä¸ªåŒ¹é…è¿‡ç¨‹é™åˆ°æ—¶é—´å¤æ‚åº¦ä¸ºO(m+n)ã€‚</p>
<h3 id="kmp-suan-fa-wei-shi-yao-na-yao-kuai" id="KMPç®—æ³•ä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«">KMPç®—æ³•ä¸ºä»€ä¹ˆé‚£ä¹ˆå¿«</h3>
<h4 id="ju-ge" id="ä¸¾ä¸ªğŸŒ°">ä¸¾ä¸ªğŸŒ°</h4>
<p>åœ¨æ–‡æœ¬ä¸²ï¼ˆaabaabaafï¼‰ä¸­ï¼Œæ‰¾åˆ°ç¬¬ä¸€æ¬¡åŒ¹é…åˆ°æ¨¡å¼ä¸²ï¼ˆaabaafï¼‰çš„ç´¢å¼•ã€‚</p>
<p>KMPç®—æ³•åŒ¹é…çš„è¿‡ç¨‹ï¼š</p>
<p>â‘ å’Œå¸¸è§„è§£æ³•ä¸€æ ·ï¼Œä»æ–‡æœ¬ä¸²é¦–å­—ç¬¦å’Œæ¨¡å¼ä¸²çš„é¦–å­—ç¬¦å¼€å§‹ï¼Œä¸€ ä¸€è¿›è¡Œæ¯”è¾ƒ</p>
<p>â‘¡å½“é‡åˆ°ä¸åŒ¹é…çš„æ—¶å€™ï¼Œå¦‚ä¸‹å›¾</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171018117.png" alt="image-20211017101822955" /></p>
<p>æ¨¡å¼ä¸²ä¼šä»bçš„ä½ç½®å¼€å§‹åŒ¹é…ï¼Œæ–‡æœ¬ä¸²åŒ¹é…çš„ä½ç½®ä¸å˜</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171106451.png" alt="image-20211017110657407" /></p>
<p>åˆ°è¿™é‡Œï¼Œè‚¯å®šä¼šæœ‰ç–‘é—®ï¼šä¼šä»€ä¹ˆä»bå¼€å§‹ï¼Ÿ</p>
<p>ä¸‹é¢çš„æ¦‚å¿µéƒ½æ˜¯æ¨¡å¼ä¸²çš„ã€‚</p>
<p>è¿™é‡Œä¼šæåˆ°å‡ ä¸ªæ¦‚å¿µï¼šå‰ç¼€ã€åç¼€å’Œ æœ€å¤§å…¬å…±å­—ç¬¦é•¿åº¦è¡¨ï¼ˆå‰ç¼€è¡¨ï¼‰</p>
<ul>
<li>
<p>å‰ç¼€ï¼šé™¤äº†æœ«å°¾å­—ç¬¦ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦</p>
</li>
<li>
<p>åç¼€ï¼šé™¤äº†é¦–å­—ç¬¦ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦</p>
</li>
<li>
<p>æœ€å¤§å…¬å…±å­—ç¬¦é•¿åº¦è¡¨ï¼šæ¯ä¸ªå­ä¸²ä¸­æœ€é•¿ç›¸åŒçš„å‰åç¼€å­—ç¬¦é•¿åº¦</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>æ¨¡å¼ä¸²çš„å„ä¸ªå­ä¸²</th>
<th>å‰ç¼€</th>
<th>åç¼€</th>
<th>æœ€å¤§å…¬å…±å­—ç¬¦é•¿åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>a</td>
<td>ç©º</td>
<td>ç©º</td>
<td>0</td>
</tr>
<tr>
<td>aa</td>
<td>a</td>
<td>a</td>
<td>1</td>
</tr>
<tr>
<td>aab</td>
<td>a,aa</td>
<td>b,ba</td>
<td>0</td>
</tr>
<tr>
<td>aaba</td>
<td>a,aa,aab</td>
<td>a,ba,aba</td>
<td>1</td>
</tr>
<tr>
<td>aabaa</td>
<td>a,aa,aab,aaba</td>
<td>a,aa,baa,abaa</td>
<td>2</td>
</tr>
<tr>
<td>aabaaf</td>
<td>a,aa,aab,aabaa</td>
<td>f,af,aaf,baaf,abaaf</td>
<td>0</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>ä¸ºä»€ä¹ˆæœ‰æœ€å¤§å…¬å…±å­—ç¬¦é•¿åº¦è¡¨ï¼Ÿ</p>
<p>è¿™ä¸ªè¡¨ï¼Œå¯ä»¥åœ¨ä½ åŒ¹é…å¤±è´¥æ—¶ï¼Œè·³è·ƒå¼çš„åŒ¹é…ï¼Œé¿å…é‡å¤å·²ç»åŒ¹é…ç›¸åŒçš„å­—ç¬¦ã€‚</p>
<p>â‘¢ç›´åˆ°å°†æ–‡æœ¬ä¸²åŒ¹é…å®Œ</p>
<h4 id="ju-ge-wan-zheng-de" id="ä¸¾ä¸ªå®Œæ•´çš„ğŸŒ°">ä¸¾ä¸ªå®Œæ•´çš„ğŸŒ°</h4>
<p>æ–‡æœ¬ä¸²ï¼šBBC ABCDAB ABCDABCDABDE</p>
<p>æ¨¡å¼ä¸²ï¼šABCDABD</p>
<p>å‰ç¼€è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>A</th>
<th>B</th>
<th>D</th>
</tr>
</thead>
<tbody>
<tr>
<td>æœ€å¤§å‰ç¼€åç¼€å…¬å…±å…ƒç´ é•¿åº¦</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>è¿™ä¸ªä¾‹å­å’±ä»¬å°±æ ¹æ®è¿™ä¸ªå‰ç¼€è¡¨å»è·³è·ƒå¼çš„åŒ¹é…ï¼ˆè¡¨ä¸­çš„æ•°å€¼ä»£è¡¨è·³è·ƒåˆ°æ¨¡å¼ä¸²ç´¢å¼•ï¼‰</p>
<p>â‘ å¼€å§‹åŒ¹é…</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171151156.png" alt="img" /></p>
<p>â‘¡ å› ä¸ºæ¨¡å¼ä¸²ä¸­çš„å­—ç¬¦Aè·Ÿæ–‡æœ¬ä¸²ä¸­çš„å­—ç¬¦Bã€Bã€Cã€ç©ºæ ¼ä¸€å¼€å§‹å°±ä¸åŒ¹é…ï¼Œæ‰€ä»¥ä¸å¿…è€ƒè™‘ç»“è®ºï¼Œç›´æ¥å°†æ¨¡å¼ä¸²ä¸æ–­çš„å³ç§»ä¸€ä½å³å¯ï¼Œç›´åˆ°æ¨¡å¼ä¸²ä¸­çš„å­—ç¬¦Aè·Ÿæ–‡æœ¬ä¸²çš„ç¬¬5ä¸ªå­—ç¬¦AåŒ¹é…æˆåŠŸï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171151451.png" alt="img" /></p>
<p>â‘¢ç»§ç»­å¾€ååŒ¹é…ï¼Œå½“æ¨¡å¼ä¸²æœ€åä¸€ä¸ªå­—ç¬¦Dè·Ÿæ–‡æœ¬ä¸²åŒ¹é…æ—¶å¤±é…ï¼Œæ˜¾è€Œæ˜“è§ï¼Œæ¨¡å¼ä¸²éœ€è¦å‘å³ç§»åŠ¨ã€‚ä½†å‘å³ç§»åŠ¨å¤šå°‘ä½å‘¢ï¼Ÿå› ä¸ºæ­¤æ—¶å·²ç»åŒ¹é…çš„å­—ç¬¦æ•°ä¸º6ä¸ªï¼ˆABCDABï¼‰ï¼Œç„¶åæ ¹æ®ã€Šå‰ç¼€è¡¨ã€‹å¯å¾—å¤±é…å­—ç¬¦Dçš„ä¸Šä¸€ä½å­—ç¬¦Bå¯¹åº”çš„é•¿åº¦å€¼ä¸º2ï¼Œæ‰€ä»¥æ ¹æ®ä¹‹å‰çš„ç»“è®ºï¼Œå¯çŸ¥éœ€è¦å‘å³ç§»åŠ¨6 - 2 = 4 ä½ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171152957.png" alt="img" /></p>
<p>â‘£æ¨¡å¼ä¸²å‘å³ç§»åŠ¨4ä½åï¼Œå‘ç°Cå¤„å†åº¦å¤±é…ï¼Œå› ä¸ºæ­¤æ—¶å·²ç»åŒ¹é…äº†2ä¸ªå­—ç¬¦ï¼ˆABï¼‰ï¼Œä¸”ä¸Šä¸€ä½å­—ç¬¦Bå¯¹åº”çš„æœ€å¤§é•¿åº¦å€¼ä¸º0ï¼Œæ‰€ä»¥å‘å³ç§»åŠ¨ï¼š2 - 0 =2 ä½ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171153610.png" alt="img" /></p>
<p>â‘¤Aä¸ç©ºæ ¼ä¸åŒ¹é…ï¼Œå‘å³ç§»åŠ¨1ä½</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171154064.png" alt="img" /></p>
<p>â‘¥ç»§ç»­æ¯”è¾ƒï¼Œå‘ç°Dä¸C å¤±é…ï¼Œæ•…å‘å³ç§»åŠ¨çš„ä½æ•°ä¸ºï¼šå·²åŒ¹é…çš„å­—ç¬¦æ•°6å‡å»ä¸Šä¸€ä½å­—ç¬¦Bå¯¹åº”çš„æœ€å¤§é•¿åº¦2ï¼Œå³å‘å³ç§»åŠ¨6 - 2 = 4 ä½ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171154305.png" alt="img" /></p>
<p>â‘¦ç»å†ç¬¬5æ­¥åï¼Œå‘ç°åŒ¹é…æˆåŠŸï¼Œè¿‡ç¨‹ç»“æŸã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110171155335.png" alt="img" /></p>
<p>è‡³æ­¤è¿™å°±æ˜¯KMPç®—æ³•çš„å¤§è‡´åŸç†ã€‚</p>
<h3 id="kmp-suan-fa-dai-ma-shi-xian" id="KMPç®—æ³•ä»£ç å®ç°">KMPç®—æ³•ä»£ç å®ç°</h3>
<p>ç”±ä¸Šæ–‡ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå­—ç¬¦ä¸²â€œABCDABDâ€å„ä¸ªå‰ç¼€åç¼€çš„æœ€å¤§å…¬å…±å…ƒç´ é•¿åº¦åˆ†åˆ«ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>A</th>
<th>B</th>
<th>D</th>
</tr>
</thead>
<tbody>
<tr>
<td>æœ€å¤§å‰ç¼€åç¼€å…¬å…±å…ƒç´ é•¿åº¦</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>è€Œä¸”ï¼Œæ ¹æ®è¿™ä¸ªè¡¨å¯ä»¥å¾—å‡ºä¸‹è¿°ç»“è®º</p>
<p>å½“å¤±é…æ—¶ï¼Œæ¨¡å¼ä¸²å‘å³ç§»åŠ¨çš„ä½æ•°ä¸ºï¼šå·²åŒ¹é…å­—ç¬¦æ•°-å¤±é…å­—ç¬¦çš„ä¸Šä¸€ä½å­—ç¬¦æ‰€å¯¹åº”çš„æœ€å¤§é•¿åº¦å€¼</p>
<p>æ–‡åˆ©ç”¨è¿™ä¸ªè¡¨å’Œç»“è®ºè¿›è¡ŒåŒ¹é…æ—¶ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå½“åŒ¹é…åˆ°ä¸€ä¸ªå­—ç¬¦å¤±é…æ—¶ï¼Œå…¶å®æ²¡å¿…è¦è€ƒè™‘å½“å‰å¤±é…çš„å­—ç¬¦ï¼Œæ›´ä½•å†µæˆ‘ä»¬æ¯æ¬¡å¤±é…æ—¶ï¼Œéƒ½æ˜¯çœ‹çš„å¤±é…å­—ç¬¦çš„ä¸Šä¸€ä½å­—ç¬¦å¯¹åº”çš„æœ€å¤§é•¿åº¦å€¼ã€‚å¦‚æ­¤ï¼Œä¾¿å¼•å‡ºäº†next æ•°ç»„ã€‚</p>
<p>ç»™å®šå­—ç¬¦ä¸²â€œABCDABDâ€ï¼Œå¯æ±‚å¾—å®ƒçš„next æ•°ç»„å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>A</th>
<th>B</th>
<th>D</th>
</tr>
</thead>
<tbody>
<tr>
<td>next</td>
<td>-1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="next-shu-zu-qiu-fa" id="Nextæ•°ç»„æ±‚æ³•">Nextæ•°ç»„æ±‚æ³•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">GetNext</span><span class="params">(<span class="type">char</span>* p,<span class="type">int</span> next[])</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="type">int</span> <span class="variable">pLen</span> <span class="operator">=</span> strlen(p);  </span><br><span class="line">    next[<span class="number">0</span>] = -<span class="number">1</span>;  </span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> -<span class="number">1</span>;  </span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">while</span> (j &lt; pLen - <span class="number">1</span>)  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="comment">//p[k]è¡¨ç¤ºå‰ç¼€ï¼Œp[j]è¡¨ç¤ºåç¼€  </span></span><br><span class="line">        <span class="keyword">if</span> (k == -<span class="number">1</span> || p[j] == p[k])   </span><br><span class="line">        &#123;  </span><br><span class="line">            ++k;  </span><br><span class="line">            ++j;  </span><br><span class="line">            next[j] = k;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">else</span>   </span><br><span class="line">        &#123;  </span><br><span class="line">            k = next[k];  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>KMPç®—æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">KmpSearch</span><span class="params">(<span class="type">char</span>* s, <span class="type">char</span>* p)</span>  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="type">int</span> <span class="variable">sLen</span> <span class="operator">=</span> strlen(s);  </span><br><span class="line">    <span class="type">int</span> <span class="variable">pLen</span> <span class="operator">=</span> strlen(p);  </span><br><span class="line">    <span class="keyword">while</span> (i &lt; sLen &amp;&amp; j &lt; pLen)  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="comment">//â‘ å¦‚æœj = -1ï¼Œæˆ–è€…å½“å‰å­—ç¬¦åŒ¹é…æˆåŠŸï¼ˆå³S[i] == P[j]ï¼‰ï¼Œéƒ½ä»¤i++ï¼Œj++      </span></span><br><span class="line">        <span class="keyword">if</span> (j == -<span class="number">1</span> || s[i] == p[j])  </span><br><span class="line">        &#123;  </span><br><span class="line">            i++;  </span><br><span class="line">            j++;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">else</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="comment">//â‘¡å¦‚æœj != -1ï¼Œä¸”å½“å‰å­—ç¬¦åŒ¹é…å¤±è´¥ï¼ˆå³S[i] != P[j]ï¼‰ï¼Œåˆ™ä»¤ i ä¸å˜ï¼Œj = next[j]      </span></span><br><span class="line">            <span class="comment">//next[j]å³ä¸ºjæ‰€å¯¹åº”çš„nextå€¼        </span></span><br><span class="line">            j = next[j];  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (j == pLen)  </span><br><span class="line">        <span class="keyword">return</span> i - j;  </span><br><span class="line">    <span class="keyword">else</span>  </span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
  </entry>
  <entry>
    <title>nginxé…ç½®ä¹‹location</title>
    <url>/posts/35269.html</url>
    <content><![CDATA[<p>nginxå­¦ä¹ locationçš„ä½¿ç”¨</p>
<span id="more"></span>
<h3 id="1-location-jie-shao" id="1ã€locationä»‹ç»">1ã€locationä»‹ç»</h3>
<p>locationæ˜¯Nginxä¸­çš„å—çº§æŒ‡ä»¤(block directive),locationæŒ‡ä»¤çš„åŠŸèƒ½æ˜¯ç”¨æ¥åŒ¹é…ä¸åŒçš„urlè¯·æ±‚ï¼Œè¿›è€Œå¯¹è¯·æ±‚åšä¸åŒçš„å¤„ç†å’Œå“åº”ï¼Œè¿™å…¶ä¸­è¾ƒéš¾ç†è§£çš„æ˜¯å¤šä¸ªlocationçš„åŒ¹é…é¡ºåºã€‚</p>
<p>å¼€å§‹ä¹‹å‰å…ˆæ˜ç¡®ä¸€äº›çº¦å®šï¼Œæˆ‘ä»¬è¾“å…¥çš„ç½‘å€å«åšè¯·æ±‚URIï¼Œnginxç”¨è¯·æ±‚URIä¸locationä¸­é…ç½®çš„URIåšåŒ¹é…ã€‚</p>
<h3 id="2-location-yu-fa" id="2ã€location-è¯­æ³•">2ã€location è¯­æ³•</h3>
<p>locationæœ‰ä¸¤ç§åŒ¹é…è§„åˆ™ï¼š</p>
<ul>
<li>åŒ¹é…URLç±»å‹ï¼Œæœ‰å››ç§å‚æ•°å¯é€‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸å¸¦å‚æ•°ã€‚ location [ = | ~ | ~* | ^~ ] uri { â€¦ }</li>
<li>å‘½ålocationï¼Œç”¨@æ ‡è¯†ï¼Œç±»ä¼¼äºå®šäºgotoè¯­å¥å—ã€‚ location @name { â€¦ }</li>
</ul>
<p>locationåŒ¹é…å‚æ•°è§£é‡Šï¼š</p>
<p>ï¼ˆ1ï¼‰ â€œ=â€ ï¼Œç²¾ç¡®åŒ¹é…</p>
<ul>
<li>å†…å®¹è¦åŒè¡¨è¾¾å¼å®Œå…¨ä¸€è‡´æ‰åŒ¹é…æˆåŠŸ</li>
</ul>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> =/abc&#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://www.baidu.com/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#è®¿é—® http://117.50.162.61:88/abc-&gt;http://www.baidu.com</span></span><br></pre></td></tr></table></figure>
<p>ï¼ˆ2ï¼‰ â€œ~â€ï¼Œæ‰§è¡Œæ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ /Abc</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://www.baidu.com;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#è®¿é—®http://117.50.162.61:88/Abc-&gt;</span></span><br><span class="line">http://www.baidu.com/Abc</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ3ï¼‰â€œ~*â€ï¼Œæ‰§è¡Œæ­£åˆ™åŒ¹é…ï¼Œå¿½ç•¥å¤§å°å†™</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> ~*/Def&#123;</span><br><span class="line">     <span class="attribute">proxy_pass</span> http://www.baidu.com;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#è®¿é—®http://117.50.162.61:88/def|Def-&gt;</span></span><br><span class="line">http://www.baidu.com/def|Def</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ4ï¼‰â€œ^~â€ï¼Œè¡¨ç¤ºæ™®é€šå­—ç¬¦ä¸²åŒ¹é…ä¸Šä»¥åä¸å†è¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /index &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://www.baidu.com/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#è®¿é—®http://117.50.162.61:88/index-&gt;</span></span><br><span class="line">http://www.baidu.com</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ5ï¼‰ä¸åŠ ä»»ä½•è§„åˆ™æ—¶ï¼Œé»˜è®¤æ˜¯å¤§å°å†™æ•æ„Ÿï¼Œå‰ç¼€åŒ¹é…ï¼Œç›¸å½“äºåŠ äº†â€œ<sub>â€ä¸â€œ^</sub>â€</p>
<p>ï¼ˆ6ï¼‰â€œ@â€ï¼Œnginxå†…éƒ¨è·³è½¬</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> /index/ &#123;</span><br><span class="line">  <span class="attribute">error_page</span> <span class="number">404</span> <span class="variable">@index_error</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">location</span> <span class="variable">@index_error</span> &#123;</span><br><span class="line">  .....</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#ä»¥ /index/ å¼€å¤´çš„è¯·æ±‚ï¼Œå¦‚æœé“¾æ¥çš„çŠ¶æ€ä¸º 404ã€‚åˆ™ä¼šåŒ¹é…åˆ° @index_error è¿™æ¡è§„åˆ™ä¸Šã€‚</span></span><br></pre></td></tr></table></figure>
<h3 id="3-location-uri-jie-wei-dai-bu-dai" id="3ã€location-URIç»“å°¾å¸¦ä¸å¸¦">3ã€location URIç»“å°¾å¸¦ä¸å¸¦ /</h3>
<p>(1)ç»“å°¾ä¸å¸¦/</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> /test &#123;</span><br><span class="line">    <span class="attribute">proxy_proxy</span> http://www.baidu.com;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#è®¿é—®ï¼šhttp://117.50.162.61:88/test-&gt;</span></span><br><span class="line">http://www.baidu.com/<span class="attribute">test</span></span><br><span class="line">å³æ­¤ç§æƒ…å†µä¼šæŠŠæ‰€æœ‰çš„è·¯å¾„åŠ uriä¸­</span><br></pre></td></tr></table></figure>
<p>(1)ç»“å°¾å¸¦/</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> /test &#123;</span><br><span class="line">    <span class="attribute">proxy_proxy</span> http://www.baidu.com/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#è®¿é—®ï¼šhttp://117.50.162.61:88/test/index-&gt;</span></span><br><span class="line">http://www.baidu.com/<span class="attribute">index</span></span><br><span class="line">å³æ­¤ç§æƒ…å†µä¼šæŠŠé™¤äº†åŒ¹é…è·¯å¾„ä¹‹å¤–çš„åœ°å€åŠ åˆ°uriä¸­</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªç®€å•çš„æ¥å£ç›‘æ§åŠé‚®ä»¶æé†’å®ç°</title>
    <url>/posts/11529.html</url>
    <content><![CDATA[<h3 id="qian-yan" id="å‰è¨€">å‰è¨€</h3>
<p>æœ€è¿‘å› ä¸ºç–«æƒ…ï¼Œä¸å¾—ä¸åœ¨å®¶åŠå…¬ï¼Œè€Œä¸”ä¹Ÿèµ¶ä¸Šäº†é¡¹ç›®å¤„äºå†…æµ‹é˜¶æ®µï¼Œæµ‹è¯•æœŸé—´å¦‚æœæœ‰é—®é¢˜ï¼Œä¸èƒ½åŠæ—¶æŠŠé—®é¢˜å¤ç°å‡ºæ¥ã€‚äºæ˜¯æˆ‘åœ¨ç½‘ä¸Šæœç´¢æœ‰æ²¡æœ‰ä¸€äº›å·¥å…·èƒ½å¯¹æ¥å£è¿›è¡Œä¸€ä¸ªå®æ—¶çš„ç›‘æ§ï¼Œå‡ºç°é—®é¢˜ï¼Œç«‹é©¬é€šçŸ¥ç›¸å…³äººå‘˜ã€‚é¡¹ç›®è™½ç„¶æœ‰æ—¥å¿—ä¿¡æ¯ï¼Œä½†æ˜¯å› ä¸ºé¡¹ç›®æ˜¯åœ¨é›†ç¾¤ä¸­éƒ¨ç½²ï¼Œæ—¥å¿—ä¿¡æ¯ï¼Œéœ€è¦è¿›å…¥æœåŠ¡å™¨çš„æ§åˆ¶å°ä¸­æŸ¥çœ‹ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p>å¿™æ´»äº†ä¸€å¤©ï¼Œè£…äº†ä¸å°‘ç”¨æ¥æµ‹è¯•æ¥å£çš„æ¡†æ¶ï¼Œä»–ä»¬åœ¨ä»‹ç»çš„æ—¶å€™ï¼Œè¯´çš„æ˜¯å¯¹æ¥å£ç›‘æ§ï¼Œå…¶å®æ˜¯åœ¨ä¸æ–­çš„è°ƒç”¨æ¥å£ï¼Œæ¥è¾¾åˆ°ç›‘æ§çš„æ•ˆæœï¼Œè€Œä¸”ç”¨çš„æ—¶å€™ï¼Œéœ€è¦å‡†å¤‡å¾ˆå¤šå·¥ä½œï¼Œåˆ›å»ºé¡¹ç›®ï¼Œåˆ›å»ºæµ‹è¯•ç”¨ä¾‹ç­‰ã€‚</p>
<p>å°±åœ¨æˆ‘æ²¡æœ‰æ€è·¯çš„æ—¶å€™ï¼Œçœ‹åˆ°ä¸€ç¯‡åšå®¢ï¼Œè®²çš„æ˜¯ï¼Œæ¥å£ç›‘æ§çš„åŸç†éƒ½æ˜¯åœ¨å¼‚å¸¸å¤„ç†ä¸­è¿›è¡Œçš„ã€‚</p>
<span id="more"></span>
<h3 id="shi-xian" id="å®ç°">å®ç°</h3>
<p>æ³¨è§£+å¼‚å¸¸ä¿¡æ¯çš„å¤„ç†+å‘é€é‚®ä»¶</p>
<h4 id="zhu-jie" id="æ³¨è§£">æ³¨è§£</h4>
<p>è¯¥æ³¨è§£åªæ˜¯ä¸ºäº†è·å–æ¥å£çš„åˆ›å»ºè€…æˆ–è€…ç»´æŠ¤è€…çš„é‚®ç®±</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line">public <span class="variable">@interface</span> Notice &#123;</span><br><span class="line">	<span class="selector-tag">String</span> <span class="selector-tag">value</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ï¼šåˆ›å»ºæ³¨è§£ä¹‹åï¼Œåªéœ€è¦åœ¨æ¥å£æ–¹æ³•ä¸Šæ·»åŠ @Noticeå³å¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸ºé‚®ç®±</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@ApiOperation</span>(value = <span class="string">&quot;è·å–ä¸Šä¼ å‡­è¯&quot;</span>, notes = <span class="string">&quot; \n authorï¼šZhuGuangLiang&quot;</span>)</span><br><span class="line">	<span class="variable">@AnonymousGetMapping</span>(<span class="string">&quot;/upload&quot;</span>)</span><br><span class="line">	<span class="variable">@Notice</span>(<span class="string">&quot;786945363@qq.com&quot;</span>)</span><br><span class="line">	public Result&lt;Object&gt; upload(Integer type) &#123;</span><br><span class="line">		<span class="selector-tag">if</span> (type == null) &#123;</span><br><span class="line">			<span class="selector-tag">throw</span> <span class="selector-tag">new</span> <span class="selector-tag">BadRequestException</span>(<span class="string">&quot;æ–‡ä»¶ç§ç±»ä¸ºç©º&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="selector-tag">return</span> <span class="selector-tag">Result</span><span class="selector-class">.success</span>(fileUtils.upload(type));</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="yi-chang-chu-li" id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.ObjectUtil;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> marchsoft.annotation.Notice;</span><br><span class="line"><span class="keyword">import</span> marchsoft.modules.spiritdeerpush.common.utils.email.EmailUtils;</span><br><span class="line"><span class="keyword">import</span> marchsoft.utils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> MyException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> ZhuGuangLiang &lt;786945363@qq.com&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2022/01/09 16:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyException</span> &#123;</span><br><span class="line">    <span class="comment">//è‡ªå·±å°è£…çš„å‘é€é‚®ç®±çš„å·¥å…·ç±»ï¼Œå¯ä»¥æ³¨å…¥è‡ªå·±çš„</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmailUtils emailUtils;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç®¡ç†å‘˜é‚®ç®±ä½œä¸ºé»˜è®¤é‚®ç®±</span></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;notice.admin&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String adminEmail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‚®ä»¶æé†’çš„å¼€å…³</span></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;notice.open&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> on;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//è¿™é‡Œä»£è¡¨æ¥å£ç›‘æ§çš„èŒƒå›´ï¼Œå¯ä»¥é€šè¿‡ä½ çš„é¡¹ç›®åŒ…åè¿›è¡Œé…ç½®</span></span><br><span class="line">	<span class="meta">@Around(&quot;execution(* com.modules.xxxx.*.controller..*.*(..))&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pj)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">		<span class="type">long</span> <span class="variable">starttime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//			log.info(&quot;---------------------APIè¯·æ±‚å‚æ•°ï¼šã€&quot; + getMessage(pj, null) + &quot;ã€‘&quot;);</span></span><br><span class="line">			<span class="keyword">return</span> pj.proceed();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">if</span> (on == <span class="number">1</span>) &#123;</span><br><span class="line">				concatError(starttime, getMessage(pj, e), pj);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">throw</span> e;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">concatError</span><span class="params">(<span class="type">long</span> starttime, String message, ProceedingJoinPoint pj)</span> &#123;</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;&lt;h3&gt;æ¥å£è€—æ—¶:&lt;/h3&gt;&quot;</span>);</span><br><span class="line">		stringBuilder.append(<span class="string">&quot;æ¥å£èŠ±è´¹æ—¶é—´ï¼š&quot;</span>).append(System.currentTimeMillis() - starttime).append(<span class="string">&quot;ms&lt;br/&gt;&quot;</span>);</span><br><span class="line">		stringBuilder.append(message);</span><br><span class="line">		<span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) pj.getSignature();</span><br><span class="line">		<span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> signature.getMethod();</span><br><span class="line">		<span class="type">Notice</span> <span class="variable">toNotice</span> <span class="operator">=</span> method.getAnnotation(Notice.class);</span><br><span class="line">		<span class="type">String</span> <span class="variable">to</span> <span class="operator">=</span> adminEmail;</span><br><span class="line">		<span class="keyword">if</span> (ObjectUtil.isNotNull(toNotice) &amp;&amp; StringUtils.isNotBlank(toNotice.value())) &#123;</span><br><span class="line">			to = toNotice.value();</span><br><span class="line">		&#125;</span><br><span class="line">		sendErrorNotice(stringBuilder.toString(), to);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String <span class="title function_">getMessage</span><span class="params">(ProceedingJoinPoint pj, Exception e)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">			log.error(e.getMessage(), e);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">RequestAttributes</span> <span class="variable">ra</span> <span class="operator">=</span> RequestContextHolder.getRequestAttributes();</span><br><span class="line">		<span class="type">ServletRequestAttributes</span> <span class="variable">sra</span> <span class="operator">=</span> (ServletRequestAttributes) ra;</span><br><span class="line">		<span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> sra.getRequest();</span><br><span class="line">		<span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) pj.getSignature();</span><br><span class="line">		<span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> signature.getMethod();</span><br><span class="line">		<span class="type">ApiOperation</span> <span class="variable">toNotice</span> <span class="operator">=</span> method.getAnnotation(ApiOperation.class);</span><br><span class="line">        <span class="comment">//è¿™ä¸€éƒ¨åˆ†æ˜¯ä¸ºäº†ï¼Œæ·»åŠ è´Ÿè´£äººï¼Œè´Ÿè´£äººä¿¡æ¯æˆ‘æ˜¯ä»swaggerçš„ApiOperationæ³¨è§£ä¸­è·å–çš„ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±é¡¹ç›®çš„é…ç½®è°ƒæ•´</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">charger</span> <span class="operator">=</span> <span class="string">&quot;æ— &quot;</span>;</span><br><span class="line">		<span class="keyword">if</span> (ObjectUtil.isNotNull(toNotice) &amp;&amp; StringUtils.isNotBlank(toNotice.notes())) &#123;</span><br><span class="line">			charger = toNotice.notes().trim();</span><br><span class="line">			charger = charger.replace(<span class="string">&quot;\\n&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">joiner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;&lt;h3&gt;è´Ÿè´£äººï¼š&lt;/h3&gt;&quot;</span>)</span><br><span class="line">				.append(charger)</span><br><span class="line">				.append(<span class="string">&quot;;&lt;br/&gt;&lt;h3&gt;æ¥å£åœ°å€ï¼š&lt;/h3&gt;&quot;</span>)</span><br><span class="line">				.append(request.getRequestURI())</span><br><span class="line">				.append(<span class="string">&quot;;&lt;br/&gt;&lt;h3&gt;ç±»åï¼š&lt;/h3&gt;&quot;</span>)</span><br><span class="line">				.append(pj.getTarget().getClass().getSimpleName())</span><br><span class="line">				.append(<span class="string">&quot;;&lt;br/&gt;&lt;h3&gt;æ–¹æ³•ï¼š&lt;/h3&gt;&quot;</span>)</span><br><span class="line">				.append(pj.getSignature().getName());</span><br><span class="line">		Object[] args = pj.getArgs();</span><br><span class="line">		List&lt;Object&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span> (Object object : args) &#123;</span><br><span class="line">			<span class="keyword">if</span> (object <span class="keyword">instanceof</span> MultipartFile || object <span class="keyword">instanceof</span> File) &#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			objects.add(object);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (ObjectUtil.isNotNull(objects) &amp;&amp; !objects.isEmpty()) &#123;</span><br><span class="line">			joiner.append(Arrays.toString(objects.toArray()));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (Objects.nonNull(e)) &#123;</span><br><span class="line">			joiner.append(<span class="string">&quot;;&lt;br/&gt;&lt;h3&gt;messageï¼š&lt;/h3&gt;&quot;</span>)</span><br><span class="line">					.append(e.getMessage())</span><br><span class="line">					.append(<span class="string">&quot;;&lt;br/&gt;&lt;h3&gt;å¼‚å¸¸ï¼š&lt;/h3&gt;&quot;</span>)</span><br><span class="line">					.append(e.fillInStackTrace());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> joiner.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendErrorNotice</span><span class="params">(String content, String to)</span> &#123;</span><br><span class="line">		<span class="comment">//å‘é€å¼‚å¸¸æé†’é‚®ä»¶ç»™æ¥å—äºº</span></span><br><span class="line">		emailUtils.sendException(to, content);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="fa-song-you-jian" id="å‘é€é‚®ä»¶">å‘é€é‚®ä»¶</h4>
<p>å¯ä»¥è‡ªè¡Œç™¾åº¦å…³äºå‘é€çš„é‚®ä»¶çš„é…ç½®ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€é™ˆè¿°äº†ã€‚</p>
<h3 id="zui-hou" id="æœ€å">æœ€å</h3>
<p>è¿™ä¸ªåŠŸèƒ½å…¶å®è¿˜æ˜¯å¾ˆç®€å•ï¼Œä¹Ÿæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œæ¯”å¦‚æ²¡æœ‰åŒ…å«å…·ä½“æŠ¥é”™çš„è¡Œæ•°ï¼ŒåªåŒ…å«çš„æ–¹æ³•å’Œå‚æ•°çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿å¤ç°é—®é¢˜å§ã€‚åœ¨æ¥å£ç›‘æ§æ–¹é¢å…¶å®ä¹Ÿæœ‰ä¸€äº›ç°æˆçš„æ¡†æ¶ï¼Œå¯ä»¥å®ç°æ›´åŠ è¯¦ç»†çš„æŠ¥å‘Šï¼Œæˆ‘è¿˜æ˜¯ä¸ªèœé¸Ÿï¼Œç»§ç»­åŠ æ²¹å­¦ä¹ â†–(<sup>Ï‰</sup>)â†—ã€‚</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ›æ‰£å¥èº«_56:åˆå¹¶åŒºé—´</title>
    <url>/posts/28381.html</url>
    <content><![CDATA[<h3 id="ti-mu-miao-shu" id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h3>
<p>ä»¥æ•°ç»„ intervals è¡¨ç¤ºè‹¥å¹²ä¸ªåŒºé—´çš„é›†åˆï¼Œå…¶ä¸­å•ä¸ªåŒºé—´ä¸º intervals[i] = [starti, endi] ã€‚è¯·ä½ åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ï¼Œå¹¶è¿”å›ä¸€ä¸ªä¸é‡å çš„åŒºé—´æ•°ç»„ï¼Œè¯¥æ•°ç»„éœ€æ°å¥½è¦†ç›–è¾“å…¥ä¸­çš„æ‰€æœ‰åŒºé—´ã€‚</p>
<span id="more"></span>
<h3 id="shi-li" id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<p>1ã€</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šintervals = [[<span class="number">1</span>,<span class="number">3</span>],[<span class="number">2</span>,<span class="number">6</span>],[<span class="number">8</span>,<span class="number">10</span>],[<span class="number">15</span>,<span class="number">18</span>]]</span><br><span class="line">è¾“å‡ºï¼š[[<span class="number">1</span>,<span class="number">6</span>],[<span class="number">8</span>,<span class="number">10</span>],[<span class="number">15</span>,<span class="number">18</span>]]</span><br><span class="line">è§£é‡Šï¼šåŒºé—´ [<span class="number">1</span>,<span class="number">3</span>] å’Œ [<span class="number">2</span>,<span class="number">6</span>] é‡å , å°†å®ƒä»¬åˆå¹¶ä¸º [<span class="number">1</span>,<span class="number">6</span>].</span><br></pre></td></tr></table></figure>
<p>2ã€</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šintervals = [[<span class="number">1</span>,<span class="number">4</span>],[<span class="number">4</span>,<span class="number">5</span>]]</span><br><span class="line">è¾“å‡ºï¼š[[<span class="number">1</span>,<span class="number">5</span>]]</span><br><span class="line">è§£é‡Šï¼šåŒºé—´ [<span class="number">1</span>,<span class="number">4</span>] å’Œ [<span class="number">4</span>,<span class="number">5</span>] å¯è¢«è§†ä¸ºé‡å åŒºé—´ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="jie-ti-si-lu" id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h3>
<p>ä»é¢˜ç›®æè¿°ï¼Œè¿™ä¸ªé¢˜å°±æ˜¯æŠŠç»™å®šçš„æ•°ç»„ï¼Œå¦‚æœ‰é‡å å°±ç»„åˆåˆ°ä¸€èµ·ï¼Œç›´åˆ°æ‰€æœ‰çš„æ•°ç»„éƒ½æ— æ³•é‡å ï¼Œç„¶åè¾“å‡ºæ‰€æœ‰çš„æ•°ç»„ã€‚è¿™ä¸ªé¢˜ï¼Œå¸¸è§„çš„åšæ³•å°±æ˜¯å°†æ¯ä¸ªæ•°ç»„å…ˆæŒ‰ç¬¬ä¸€ä¸ªå…ƒç´ æ’åºï¼Œç„¶åå°†æ ¹æ®æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ æ‹¿å‡ºæ¥å’Œåä¸€ä¸ªæ•°ç»„è¿›è¡Œæ¯”è¾ƒï¼Œæ ¹æ®ç»“æœæ¥è¿›è¡Œæ˜¯å¦åˆå¹¶æˆ–è€…ä¿ç•™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] merge(<span class="type">int</span>[][] intervals) &#123;</span><br><span class="line">        <span class="keyword">if</span> (intervals.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>][<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">   		<span class="comment">//å…ˆå¯¹äºŒç»´æ•°ç»„ä¸­çš„ä¸€ç»´æ•°ç»„è¿›è¡Œæ’åº</span></span><br><span class="line">        Arrays.sort(intervals, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] interval1, <span class="type">int</span>[] interval2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> interval1[<span class="number">0</span>] - interval2[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//åœ¨åˆ¤æ–­mergedä¸­çš„æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ å’Œå½“å‰éå†åˆ°çš„æ•°ç»„çš„ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åå†åˆ¤æ–­å¦‚ä½•æ·»åŠ </span></span><br><span class="line">        List&lt;<span class="type">int</span>[]&gt; merged = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;<span class="type">int</span>[]&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; intervals.length; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">L</span> <span class="operator">=</span> intervals[i][<span class="number">0</span>], R = intervals[i][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (merged.size() == <span class="number">0</span> || merged.get(merged.size() - <span class="number">1</span>)[<span class="number">1</span>] &lt; L) &#123;</span><br><span class="line">                merged.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;L, R&#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                merged.get(merged.size() - <span class="number">1</span>)[<span class="number">1</span>] = Math.max(merged.get(merged.size() - <span class="number">1</span>)[<span class="number">1</span>], R);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> merged.toArray(<span class="keyword">new</span> <span class="title class_">int</span>[merged.size()][]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202112122059641.png" alt="image-20211212205935591" /></p>
<p>æˆ‘çš„æ€è·¯æ˜¯ï¼š</p>
<p>1ã€åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„boxï¼Œnçš„å€¼ä¸ºç»™å®šçš„äºŒç»´æ•°ç»„çš„æ•°å­—çš„æœ€å¤§å€¼ã€‚</p>
<p>2ã€ç„¶åéå†ç»™å®šçš„æ•°ç»„ï¼Œæ ¹æ®æ¯ä¸€ä¸ªä¸€ç»´æ•°ç»„å…ƒç´ ï¼Œå°†å…¶è®¾ä¸ºéå†boxçš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œå¹¶ä¸”æŠŠä¸­é—´å€¼è®¾ä¸º1ï¼Œèµ·ç‚¹è®¾ä¸º1ï¼Œç»ˆç‚¹è®¾ä¸º2ã€‚ï¼ˆä¹Ÿå¯ä»¥è®¾ä¸ºå…¶ä»–å€¼ï¼‰</p>
<p>3ã€éå†æ‰€æœ‰çš„ä¸€ç»´æ•°ç»„åï¼Œæ­¤æ—¶çš„boxæ•°ç»„ï¼Œå°†ç›¸å½“äºï¼ŒæŠŠæ‰€æœ‰è¦†ç›–çš„åŒºé—´éƒ½è®¾å®šäº†å€¼ã€‚</p>
<p>4ã€å†æ¬¡éå†ä¸€ç»´æ•°ç»„ï¼ŒæŠŠboxä¸­æ‰€æœ‰å·²ç»è®¾å®šçš„å€¼å¾—åŒºé—´çš„èµ·ç‚¹å’Œç»ˆç‚¹è®°å½•ä¸‹æ¥å³å¯ã€‚</p>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] merge1(<span class="type">int</span>[][] intervals) &#123;</span><br><span class="line">		<span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line">   </span><br><span class="line">    	<span class="comment">//è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span>[] interval:intervals)&#123;</span><br><span class="line">			max= Math.max(max, interval[<span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span>[] ints=<span class="keyword">new</span> <span class="title class_">int</span>[max+<span class="number">1</span>];</span><br><span class="line">    	<span class="comment">//éå†ç»™å®šæ•°ç»„ï¼Œç›¸å½“äºæŠŠæ‰€æœ‰åŒºé—´æ•°åœ¨intsæ•°ç»„è¿›è¡Œæ ‡è®°</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span>[] interval:intervals)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=interval[<span class="number">0</span>];i&lt;interval[<span class="number">1</span>];i++)&#123;</span><br><span class="line">				ints[i]=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			ints[interval[<span class="number">1</span>]]=ints[interval[<span class="number">1</span>]]==<span class="number">1</span>?<span class="number">1</span>:<span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">    	<span class="comment">//ç”¨ä¸¤ä¸ªæ ˆæ¥å­˜ç»“æœçš„ä¸€ç»´æ•°ç»„çš„å·¦å…ƒç´ å’Œå³å…ƒç´ </span></span><br><span class="line">		Stack&lt;Integer&gt; left=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">		Stack&lt;Integer&gt; right=<span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;ints.length;i++)&#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line">			<span class="keyword">if</span>(i==<span class="number">0</span>&amp;&amp;ints[i]==<span class="number">2</span>)&#123;</span><br><span class="line">				left.push(i);</span><br><span class="line">				right.push(i);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(i==<span class="number">0</span>&amp;&amp;ints[i]==<span class="number">1</span>)&#123;</span><br><span class="line">				left.push(i);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(ints[i]==<span class="number">1</span>&amp;&amp;ints[i-<span class="number">1</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">				left.push(i);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(ints[i]==<span class="number">1</span>&amp;&amp;ints[i-<span class="number">1</span>]==<span class="number">2</span>)&#123;</span><br><span class="line">				left.push(i);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ints[i]==<span class="number">2</span>&amp;&amp;ints[i-<span class="number">1</span>]==<span class="number">0</span>)&#123;</span><br><span class="line">				left.push(i);</span><br><span class="line">				right.push(i);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(ints[i]==<span class="number">2</span>&amp;&amp;ints[i-<span class="number">1</span>]==<span class="number">2</span>)&#123;</span><br><span class="line">				left.push(i);</span><br><span class="line">				right.push(i);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(ints[i]==<span class="number">2</span>&amp;&amp;ints[i-<span class="number">1</span>]==<span class="number">1</span>)&#123;</span><br><span class="line">				right.push(i);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(i==ints.length-<span class="number">1</span>&amp;&amp;ints[i]==<span class="number">2</span>)&#123;</span><br><span class="line">				right.push(i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> leng=right.size();</span><br><span class="line">		<span class="type">int</span>[][] result=<span class="keyword">new</span> <span class="title class_">int</span>[leng][<span class="number">2</span>];</span><br><span class="line">    	<span class="comment">//å¤„ç†è¿”å›ç»“æœï¼Œä»å·¦æ ˆå’Œå³æ ˆåˆ†åˆ«å–å‡ºå·¦å…ƒç´ å’Œå³å…ƒç´ åˆ†åˆ«ä½œä¸ºä¸€ç»´æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å’Œç¬¬äºŒä¸ªå…ƒç´ </span></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;result.length;i++)&#123;</span><br><span class="line">            <span class="comment">//popå…ƒç´ å¯ä»¥ä»æ ˆé¡¶æ‹¿é™¤å…ƒç´ ï¼Œå¹¶åˆ é™¤æ ˆä¸­çš„å…ƒç´ </span></span><br><span class="line">			result[i][<span class="number">0</span>]=left.pop();</span><br><span class="line">			result[i][<span class="number">1</span>]=right.pop();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202112122057242.png" alt="image-20211212205705100" /></p>
<p>çœ‹è¿™ä¸¤ç§æ€è·¯çš„æ—¶é—´å¯èƒ½ç¬¬äºŒç§çš„æ—¶é—´æ›´çŸ­ï¼ˆç¬¬ä¸€ç§çš„æ–¹æ³•ä¸»è¦æµªè´¹åœ¨æ’åºä¸Šäº†ï¼‰ï¼Œä½†ç¬¬äºŒç§æ€è·¯ä¸å¤ªå¥½æƒ³ï¼Œè€Œä¸”ç‰¹æ®Šæƒ…å†µéœ€è¦è€ƒè™‘å®Œå…¨ï¼Œæ‰èƒ½é€šè¿‡ï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ¥é€‰æ‹©åˆé€‚çš„æ–¹æ³•è§£é¢˜ã€‚</p>
<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br />
é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/merge-intervals">https://leetcode-cn.com/problems/merge-intervals</a></p>
]]></content>
      <categories>
        <category>åŠ›æ‰£</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>å“ˆå¤«æ›¼æ ‘</title>
    <url>/posts/29203.html</url>
    <content><![CDATA[<h3 id="what" id="what">what</h3>
<p>å“ˆå¤«æ›¼æ ‘æ˜¯ä¸€é¢—æœ€ä¼˜äºŒå‰æ ‘ï¼Œå¸¦æƒè·¯å¾„é•¿åº¦æœ€å°çš„äºŒå‰æ ‘ï¼Œç»å¸¸æ¥ç”¨æ¥è¿›è¡Œæ•°æ®å‹ç¼©ã€‚</p>
<h3 id="why" id="why">why</h3>
<h4 id="wei-shi-yao-zhe-ke-shu-shi-zui-you-de" id="ä¸ºä»€ä¹ˆè¿™æ£µæ ‘æ˜¯æœ€ä¼˜çš„ï¼Ÿ">ä¸ºä»€ä¹ˆè¿™æ£µæ ‘æ˜¯æœ€ä¼˜çš„ï¼Ÿ</h4>
<p>ä¸€ä¸ªæ£µæ ‘æ˜¯ä¸æ˜¯æœ€ä¼˜çš„ï¼Œè¦çœ‹å®ƒæ˜¯å¦æ»¡è¶³æ„å»ºçš„è¿™æ£µæ ‘çš„å¸¦æƒè·¯å¾„é•¿åº¦æœ€å°ã€‚</p>
<span id="more"></span>
<p>åœ¨è¯æ˜å“ˆå¤«æ›¼æ ‘æ˜¯ä¸€é¢—æœ€ä¼˜äºŒå‰æ ‘ä¹‹å‰ï¼Œè¦å…ˆçŸ¥é“è¿™å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>è·¯å¾„ï¼šä»æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„åˆ†æ”¯æ„æˆè¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„ã€‚</li>
<li>è·¯å¾„é•¿åº¦ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹è®¡æ•°åˆ°è¯¥èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸Šçš„åˆ†æ”¯æ•°ç›®ç§°ä½œè·¯å¾„é•¿åº¦ã€‚</li>
<li>æƒï¼šä¹Ÿç§°ä¸ºæƒå€¼ï¼ŒæŒ‡çš„æ˜¯èŠ‚ç‚¹çš„å±æ€§æ•°å€¼ã€‚</li>
<li>æ ‘çš„å¸¦æƒè·¯å¾„é•¿åº¦ï¼šæ ‘ä¸­æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„å¸¦æƒè·¯å¾„é•¿åº¦ä¹‹å’Œï¼Œä¸€èˆ¬ç”¨WPLè¡¨ç¤ºã€‚</li>
</ul>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202109221714863.png" alt="avatar" /></p>
<p>å¦‚ä¸Šå›¾ä¸­ï¼Œaçš„æƒå€¼ä¸º7ï¼Œè·¯å¾„é•¿åº¦ä¸º1ï¼›bçš„æƒå€¼ä¸º5ï¼Œè·¯å¾„é•¿åº¦ä¸º2ã€‚</p>
<p>æ ‘çš„å¸¦æƒè·¯å¾„é•¿åº¦WPL=7x1+5x2+2x3+4x3=35</p>
<p>çŸ¥é“äº†è¿™äº›ï¼Œé‚£ä¸ºä»€ä¹ˆæ˜¯æœ€ä¼˜çš„ï¼ŒçŸ¥é“æ„å»ºçš„å“ˆå¤«æ›¼æ ‘ï¼Œä½ å°±çŸ¥é“ä¸ºä»€ä¹ˆäº†ã€‚</p>
<p>å¯¹äºç»™å®šçš„æœ‰å„è‡ªæƒå€¼çš„ n ä¸ªç»“ç‚¹ï¼Œæ„å»ºå“ˆå¤«æ›¼æ ‘æœ‰ä¸€ä¸ªè¡Œä¹‹æœ‰æ•ˆçš„åŠæ³•ï¼š</p>
<ol>
<li>åœ¨ n ä¸ªæƒå€¼ä¸­é€‰å‡ºä¸¤ä¸ªæœ€å°çš„æƒå€¼ï¼Œå¯¹åº”çš„ä¸¤ä¸ªç»“ç‚¹ç»„æˆä¸€ä¸ªæ–°çš„äºŒå‰æ ‘ï¼Œä¸”æ–°äºŒå‰æ ‘çš„æ ¹ç»“ç‚¹çš„æƒå€¼ä¸ºå·¦å³å­©å­æƒå€¼çš„å’Œï¼›</li>
<li>åœ¨åŸæœ‰çš„ n ä¸ªæƒå€¼ä¸­åˆ é™¤é‚£ä¸¤ä¸ªæœ€å°çš„æƒå€¼ï¼ŒåŒæ—¶å°†æ–°çš„æƒå€¼åŠ å…¥åˆ° nâ€“2 ä¸ªæƒå€¼çš„è¡Œåˆ—ä¸­ï¼Œä»¥æ­¤ç±»æ¨ï¼›</li>
<li>é‡å¤ 1 å’Œ 2 ï¼Œç›´åˆ°æ‰€ä»¥çš„ç»“ç‚¹æ„å»ºæˆäº†ä¸€æ£µäºŒå‰æ ‘ä¸ºæ­¢ï¼Œè¿™æ£µæ ‘å°±æ˜¯å“ˆå¤«æ›¼æ ‘ã€‚</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202109221713874.png" alt="img" /></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼ˆAï¼‰ç»™å®šäº†å››ä¸ªç»“ç‚¹aï¼Œbï¼Œcï¼Œdï¼Œæƒå€¼åˆ†åˆ«ä¸º7ï¼Œ5ï¼Œ2ï¼Œ4ï¼›ç¬¬ä¸€æ­¥å¦‚ï¼ˆBï¼‰æ‰€ç¤ºï¼Œæ‰¾å‡ºç°æœ‰æƒå€¼ä¸­æœ€å°çš„ä¸¤ä¸ªï¼Œ2 å’Œ 4 ï¼Œç›¸åº”çš„ç»“ç‚¹ c å’Œ d æ„å»ºä¸€ä¸ªæ–°çš„äºŒå‰æ ‘ï¼Œæ ‘æ ¹çš„æƒå€¼ä¸º 2 + 4 = 6ï¼ŒåŒæ—¶å°†åŸæœ‰æƒå€¼ä¸­çš„ 2 å’Œ 4 åˆ æ‰ï¼Œå°†æ–°çš„æƒå€¼ 6 åŠ å…¥ï¼›è¿›å…¥ï¼ˆCï¼‰ï¼Œé‡å¤ä¹‹å‰çš„æ­¥éª¤ã€‚ç›´åˆ°ï¼ˆDï¼‰ä¸­ï¼Œæ‰€æœ‰çš„ç»“ç‚¹æ„å»ºæˆäº†ä¸€ä¸ªå…¨æ–°çš„äºŒå‰æ ‘ï¼Œè¿™å°±æ˜¯å“ˆå¤«æ›¼æ ‘ã€‚</p>
<p>å“ˆå¤«æ›¼æ ‘åœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­ï¼Œå°†æœ€çŸ­çš„è·¯å¾„ï¼Œå·§å¦™çš„ç»™äº†æƒå€¼æœ€å¤§çš„ï¼Œæœ€é•¿çš„è·¯å¾„ç»™äº†æƒå€¼æœ€å°çš„ï¼Œæ‰€ä»¥å¯ä½¿WPLæœ€å°ã€‚</p>
<h4 id="wei-shi-yao-ke-yi-yong-lai-jin-xing-shu-ju-ya-suo-wu-sun-ya-suo" id="ä¸ºä»€ä¹ˆå¯ä»¥ç”¨æ¥è¿›è¡Œæ•°æ®å‹ç¼©ï¼ˆæ— æŸå‹ç¼©ï¼‰ï¼Ÿ">ä¸ºä»€ä¹ˆå¯ä»¥ç”¨æ¥è¿›è¡Œæ•°æ®å‹ç¼©ï¼ˆæ— æŸå‹ç¼©ï¼‰ï¼Ÿ</h4>
<p>å‹ç¼©ä¸å¤–ä¹å°±æ˜¯å¯¹æ•°æ®çš„ç¼–ç å¤„ç†ï¼Œä½¿å…¶å ç”¨çš„å†…å­˜æ›´å°ã€‚</p>
<p>åœ¨æ•°æ®å‹ç¼©ä¸­ï¼Œæœ‰ä¸€ç§å«åšæ— æŸå‹ç¼©ï¼Œå®ƒå…¶ä¸­çš„åŸç†åˆ©ç”¨äº†å“ˆå¤«æ›¼ç¼–ç ï¼Œå“ˆå¤«æ›¼ç¼–ç ç›¸å½“äºå“ˆå¤«æ›¼æ ‘ç†è®ºçš„å®è·µã€‚</p>
<p>å“ˆå¤«æ›¼ç¼–ç ï¼Œæ˜¯ä¸€ç§éå¸¸å·§å¦™çš„ç¼–ç æ–¹å¼ï¼Œè€Œä¸”ä¹Ÿæ˜¯å¯å˜çš„ï¼Œä¾æ®å­—ç¬¦å‡ºç°çš„æ¦‚ç‡æ¥å†³å®šå­—ç¬¦ç¼–ç é•¿åº¦ã€‚</p>
<p>åœ¨ç¼–ç æ—¶ï¼Œé¦–å…ˆæ ¹æ®å¾…ç¼–ç çš„æ–‡æœ¬ç»Ÿè®¡å‡ºæ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¦‚ç‡ï¼Œç»„æˆåˆå§‹çš„èŠ‚ç‚¹ã€‚ç„¶åæ¯æ¬¡å–å‡ºæ¦‚ç‡æœ€å°çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½¿å¾—æ–°å»ºèŠ‚ç‚¹çš„å·¦å³å„¿å­ä¸ºé€‰å–çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å…¶æ¦‚ç‡æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹æ¦‚ç‡ä¹‹å’Œï¼ŒæŠŠæ–°å»ºçš„èŠ‚ç‚¹å†æ”¾è¿›æ‰€æœ‰èŠ‚ç‚¹ä¸­é‡æ–°é€‰æ‹©æœ€å°çš„ä¸¤ä¸ªèŠ‚ç‚¹ã€‚é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°åªå‰©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªå°±æ˜¯å“ˆå¤«æ›¼æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p>
<p>ä»¥ä¸‹ä»¥å­—ç¬¦ä¸²&quot;aaaaaabbbbccddd&quot;ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œä»¥å­—ç¬¦å‡ºç°çš„é¢‘æ•°æ¥ä»£æ›¿é¢‘ç‡ï¼ˆå®é™…ä¸­é€šå¸¸ä½¿ç”¨çš„æ˜¯é¢‘ç‡ï¼ŒäºŒè€…æ•ˆæœä¸Šæ˜¯ä¸€æ ·çš„ï¼‰ï¼Œç»è¿‡ç»Ÿè®¡ï¼Œå¯ä»¥çŸ¥é“æ¯ä¸ªå­—ç¬¦å‡ºç°çš„é¢‘æ•°ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
<th>c</th>
<th>d</th>
</tr>
</thead>
<tbody>
<tr>
<td>6</td>
<td>4</td>
<td>2</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>å…·ä½“å»ºæ ‘è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>é¦–å…ˆèŠ‚ç‚¹æƒå€¼ä¸º6ã€4ã€2ã€3ï¼Œé€‰æ‹©æœ€å°çš„2å’Œ3ï¼Œç»„æˆä¸€ä¸ªæ ¹èŠ‚ç‚¹ä¸º5çš„ç»„åˆèŠ‚ç‚¹ã€‚</li>
<li>å½“å‰èŠ‚ç‚¹æƒå€¼ä¸º6ã€4ã€5ï¼Œé€‰æ‹©æœ€å°çš„4å’Œ5ï¼Œç»„æˆä¸€ä¸ªæ ¹èŠ‚ç‚¹ä¸º9çš„ç»„åˆèŠ‚ç‚¹ã€‚</li>
<li>å½“å‰èŠ‚ç‚¹æƒå€¼ä¸º6ã€9ï¼Œé€‰æ‹©æœ€å°çš„6å’Œ9ï¼Œç»„æˆä¸€ä¸ªæ ¹èŠ‚ç‚¹ä¸º15çš„ç»„åˆèŠ‚ç‚¹ã€‚</li>
<li>å½“å‰èŠ‚ç‚¹æƒå€¼ä¸º15ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå“ˆå¤«æ›¼æ ‘å»ºç«‹å®Œæˆã€‚<img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202109221715998.png" alt="avatar" /></li>
</ol>
<p>è¦ä»å“ˆå¤«æ›¼æ ‘å¾—åˆ°æ¯ä¸ªå­—ç¬¦çš„ç¼–ç ï¼Œåªè¦åœ¨å“ˆå¤«æ›¼æ ‘ä¸­ä»æ ¹èŠ‚ç‚¹éå†åˆ°è¯¥å­—ç¬¦èŠ‚ç‚¹ï¼Œæ¯æ¬¡å‘å·¦èµ°æ—¶åŠ ä¸€ä¸ª0ï¼Œå‘å³èµ°æ—¶åŠ ä¸€ä¸ª1ï¼Œæœ€ç»ˆå¾—åˆ°çš„å­—ç¬¦ä¸²å³ä¸ºè¯¥å­—ç¬¦çš„ç¼–ç å­—ç¬¦ä¸²ã€‚</p>
<p>å¦‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œaçš„ç¼–ç ä¸º0ï¼Œbçš„ç¼–ç ä¸º10ï¼Œcçš„ç¼–ç ä¸º110ï¼Œdçš„ç¼–ç ä¸º111ã€‚</p>
<p>å“ˆå¤«æ›¼ç¼–ç ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·è§£ç ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ç§å‰ç¼€ç¼–ç ï¼Œä»»ä½•ä¸€ä¸ªå­—ç¬¦çš„ç¼–ç éƒ½ä¸ä¼šæ˜¯å¦ä¸€ä¸ªå­—ç¬¦ç¼–ç çš„å‰ç¼€ã€‚äºæ˜¯ç»™å®šä¸€ä¸ªç¼–ç åçš„ä¸²ï¼Œå…¶è§£ç çš„ç»“æœæ˜¯å”¯ä¸€çš„ã€‚</p>
<p>æœ€ç»ˆç»è¿‡å“ˆå¤«æ›¼ç¼–ç åä¸ºï¼š  0 0 0 0 0 0 10 10 10 10 110 110 111 111 111 ä¸€å…±ä¸º31ä½ï¼Œåœ¨åŸå§‹çš„æ•°æ®ä¸­ï¼Œä¸€ä¸ªå­—ç¬¦å ç”¨3bit, ä¸€å…±éœ€è¦45bit</p>
<p>ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œç»è¿‡å“ˆå¤«æ›¼ç¼–ç ä»45bitå‹ç¼©åˆ°äº†31bitã€‚å› ä¸ºåœ¨è¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰æ•°æ®çš„ä¸¢å¤±ï¼Œæ‰€ä»¥æ˜¯æ— æŸå‹ç¼©ã€‚</p>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åºæç°åŠŸèƒ½å®ç°</title>
    <url>/posts/4359.html</url>
    <content><![CDATA[<h2 id="xu-qiu" id="éœ€æ±‚">éœ€æ±‚</h2>
<p>åœ¨å¾®ä¿¡å°ç¨‹åºä¸­å®ç°ä¸€ä¸ªæç°åŠŸèƒ½ ï¼Œæç°çš„é’±å…¶å®æ¥è‡ªç³»ç»Ÿä¸­çš„å…¶ä»–åŠŸèƒ½ã€‚</p>
<p>å½“ç„¶è¿™ä¸ªåŠŸèƒ½ï¼Œéœ€è¦ä¸€ä¸ªå¾®ä¿¡æ”¯ä»˜çš„å•†æˆ·å·ï¼Œå¹¶ä¸”è´¦æˆ·ä¸­éœ€è¦æœ‰å……è¶³çš„ä½™é¢ã€‚</p>
<span id="more"></span>
<h2 id="qian-qi-zhun-bei" id="å‰æœŸå‡†å¤‡">å‰æœŸå‡†å¤‡</h2>
<h3 id="1-deng-lu-wei-xin-shang-hu-ping-tai-guan-wang-a-href-https-pay-weixin-qq-com-index-php-core-home-login-return-url-2-f-wei-xin-zhi-fu-zhong-guo-ling-xian-de-di-san-fang-zhi-fu-ping-tai-wei-xin-zhi-fu-ti-gong-an-quan-kuai-jie-de-zhi-fu-fang-shi-qq-com-a" id="1ã€ç™»å½•å¾®ä¿¡å•†æˆ·å¹³å°å®˜ç½‘ï¼šå¾®ä¿¡æ”¯ä»˜-ä¸­å›½é¢†å…ˆçš„ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°-ï½œ-å¾®ä¿¡æ”¯ä»˜æä¾›å®‰å…¨å¿«æ·çš„æ”¯ä»˜æ–¹å¼-qq-com">1ã€ç™»å½•å¾®ä¿¡å•†æˆ·å¹³å°å®˜ç½‘ï¼š<a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F">å¾®ä¿¡æ”¯ä»˜ - ä¸­å›½é¢†å…ˆçš„ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å° ï½œ å¾®ä¿¡æ”¯ä»˜æä¾›å®‰å…¨å¿«æ·çš„æ”¯ä»˜æ–¹å¼ (qq.com)</a></h3>
<h3 id="2-zhao-dao-chan-pin-zhong-xin-de-qi-ye-fu-kuan-dao-ling-qian-bing-kai-tong-qi-ye-fu-kuan-dao-ling-qian-gong-neng" id="2ã€æ‰¾åˆ°äº§å“ä¸­å¿ƒçš„ä¼ä¸šä»˜æ¬¾åˆ°é›¶é’±ï¼Œå¹¶å¼€é€šä¼ä¸šä»˜æ¬¾åˆ°é›¶é’±åŠŸèƒ½">2ã€æ‰¾åˆ°äº§å“ä¸­å¿ƒçš„ä¼ä¸šä»˜æ¬¾åˆ°é›¶é’±ï¼Œå¹¶å¼€é€šä¼ä¸šä»˜æ¬¾åˆ°é›¶é’±åŠŸèƒ½</h3>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202202122047375.png" alt="image-20220212204704151" /></p>
<h3 id="3-zhao-dao-app-id-zhang-hao-guan-li-tian-jia-guan-lian-app-id" id="3ã€æ‰¾åˆ°AppIDè´¦å·ç®¡ç†ï¼Œæ·»åŠ å…³è”AppID">3ã€æ‰¾åˆ°AppIDè´¦å·ç®¡ç†ï¼Œæ·»åŠ å…³è”AppID</h3>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202202122049879.png" alt="image-20220212204950779" /></p>
<h3 id="4-jiang-wei-xin-shang-hu-hao-he-xiao-cheng-xu-jin-xing-bang-ding" id="4ã€å°†å¾®ä¿¡å•†æˆ·å·å’Œå°ç¨‹åºè¿›è¡Œç»‘å®š">4ã€å°†å¾®ä¿¡å•†æˆ·å·å’Œå°ç¨‹åºè¿›è¡Œç»‘å®š</h3>
<h3 id="5-shen-qing-api-zheng-shu-he-ap-iv-2-mi-yao-tuo-shan-bao-cun-hou-mian-hui-shi-yong" id="5ã€ç”³è¯·APIè¯ä¹¦å’ŒAPIv2å¯†é’¥ï¼Œå¦¥å–„ä¿å­˜ï¼Œåé¢ä¼šä½¿ç”¨">5ã€ç”³è¯·APIè¯ä¹¦å’ŒAPIv2å¯†é’¥ï¼Œå¦¥å–„ä¿å­˜ï¼Œåé¢ä¼šä½¿ç”¨</h3>
<p>æ³¨ï¼šAPIè¯ä¹¦æ–‡ä»¶çš„åç¼€æ˜¯.p12</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202202122101758.png" alt="image-20220212210121591" /></p>
<h3 id="6-huo-qu-shang-hu-hao" id="6ã€è·å–å•†æˆ·å·">6ã€è·å–å•†æˆ·å·</h3>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202202122106554.png" alt="image-20220212210613468" /></p>
<h2 id="dai-ma-shi-xian-spring-boot" id="ä»£ç å®ç°ï¼ˆSpringBootï¼‰">ä»£ç å®ç°ï¼ˆSpringBootï¼‰</h2>
<h3 id="1-yin-ru-xiang-guan-guan-fang-yi-lai" id="1ã€å¼•å…¥ç›¸å…³å®˜æ–¹ä¾èµ–">1ã€å¼•å…¥ç›¸å…³å®˜æ–¹ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.wxpay<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>wxpay-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-zai-yaml-wen-jian-tian-jia-pei-zhi" id="2ã€åœ¨yamlæ–‡ä»¶æ·»åŠ é…ç½®">2ã€åœ¨yamlæ–‡ä»¶æ·»åŠ é…ç½®</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">withDraw:</span><br><span class="line">	apiKey: xxxxxxxx</span><br><span class="line">     mchid: xxxxxx</span><br><span class="line">     mch_appid: xxxxxxxxx</span><br><span class="line">     <span class="comment">//æ­¤è·¯å¾„ä»£è¡¨æ˜¯åœ¨é¡¹ç›®çš„resouceæ ¹ç›®å½•</span></span><br><span class="line">     certPath: /xxxxxxxx.p12</span><br><span class="line">     count: <span class="number">10</span></span><br><span class="line">     quota: <span class="number">200</span></span><br></pre></td></tr></table></figure>
<h3 id="3-bian-xie-pei-zhi-lei" id="3ã€ç¼–å†™é…ç½®ç±»">3ã€ç¼–å†™é…ç½®ç±»</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WithDrawConfig</span> <span class="keyword">implements</span> <span class="title class_">WXPayConfig</span> &#123;</span><br><span class="line">    <span class="comment">//ä»yamlæ³¨å…¥é…ç½®</span></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;withDraw.mch_appid&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String mch_appid;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;withDraw.apiKey&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String apiKey;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;withDraw.mchid&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String mchid;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;withDraw.certPath&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String certPath;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getAppID</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> mch_appid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getMchID</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> mchid;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getKey</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> apiKey;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> InputStream <span class="title function_">getCertStream</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//è·å–è¯ä¹¦,è¯ä¹¦å»ºè®®æ”¾åˆ°resourceç›®å½•ä¸‹</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">this</span>.getClass().getResourceAsStream(certPath);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHttpConnectTimeoutMs</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">8000</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHttpReadTimeoutMs</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">10000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="4-bian-xie-ti-xian-gong-ju-lei" id="4ã€ç¼–å†™æç°å·¥å…·ç±»">4ã€ç¼–å†™æç°å·¥å…·ç±»</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WithDrawUtils</span> &#123;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;withDraw.mch_appid&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String mch_appid;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;withDraw.mchid&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String mchid;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;withDraw.apiKey&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String apiKey;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> WithDrawConfig withDrawConfig;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”Ÿæˆè®¢å•å·æ—¥æœŸæ—¶é—´+éšæœºå­—ç¬¦</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getOrderNumber</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">SimpleDateFormat</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMddHHmmss&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> date.format(<span class="keyword">new</span> <span class="title class_">Date</span>()) + RandomStringUtils.randomNumeric(<span class="number">4</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">fillRequest</span><span class="params">(Map&lt;String, String&gt; reqData)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		reqData.put(<span class="string">&quot;mch_appid&quot;</span>, mch_appid);</span><br><span class="line">		reqData.put(<span class="string">&quot;mchid&quot;</span>, mchid);</span><br><span class="line">		reqData.put(<span class="string">&quot;nonce_str&quot;</span>, WXPayUtil.generateNonceStr().toUpperCase());</span><br><span class="line">		reqData.put(<span class="string">&quot;sign&quot;</span>, WXPayUtil.generateSignature(reqData, apiKey, WXPayConstants.SignType.MD5));</span><br><span class="line">		<span class="keyword">return</span> reqData;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getMd5ByString</span><span class="params">(String str)</span> &#123;</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">hexString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">MessageDigest</span> <span class="variable">mdTemp</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">			mdTemp.update(str.getBytes());</span><br><span class="line">			<span class="type">byte</span>[] hash = mdTemp.digest();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">byte</span> b : hash) &#123;</span><br><span class="line">				<span class="keyword">if</span> ((<span class="number">0xff</span> &amp; b) &lt; <span class="number">0x10</span>) &#123;</span><br><span class="line">					hexString.append(<span class="string">&quot;0&quot;</span>).append(Integer.toHexString((<span class="number">0xFF</span> &amp; b)));</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					hexString.append(Integer.toHexString(<span class="number">0xFF</span> &amp; b));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> hexString.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å°†å¯¹è±¡ç›´æ¥è½¬æ¢æˆStringç±»å‹çš„ XMLè¾“å‡º</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">convertToXml</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">		<span class="comment">// åˆ›å»ºè¾“å‡ºæµ</span></span><br><span class="line">		<span class="type">StringWriter</span> <span class="variable">sw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// åˆ©ç”¨jdkä¸­è‡ªå¸¦çš„è½¬æ¢ç±»å®ç°</span></span><br><span class="line">			<span class="type">JAXBContext</span> <span class="variable">context</span> <span class="operator">=</span> JAXBContext.newInstance(obj.getClass());</span><br><span class="line"></span><br><span class="line">			<span class="type">Marshaller</span> <span class="variable">marshaller</span> <span class="operator">=</span> context.createMarshaller();</span><br><span class="line">			<span class="comment">// æ ¼å¼åŒ–xmlè¾“å‡ºçš„æ ¼å¼</span></span><br><span class="line">			marshaller.setProperty(Marshaller.JAXB_FRAGMENT,</span><br><span class="line">					Boolean.TRUE);</span><br><span class="line">			<span class="comment">// å°†å¯¹è±¡è½¬æ¢æˆè¾“å‡ºæµå½¢å¼çš„xml</span></span><br><span class="line">			marshaller.marshal(obj, sw);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JAXBException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sw.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getRestInstance</span><span class="params">(String url, String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">UTF8</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">		<span class="type">URL</span> <span class="variable">httpUrl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">		<span class="type">char</span>[] password = mchid.toCharArray();<span class="comment">//è¯ä¹¦å¯†ç </span></span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">certStream</span> <span class="operator">=</span> withDrawConfig.getCertStream();<span class="comment">//è·å–è¯ä¹¦çš„æµ</span></span><br><span class="line">		<span class="type">KeyStore</span> <span class="variable">ks</span> <span class="operator">=</span> KeyStore.getInstance(<span class="string">&quot;PKCS12&quot;</span>);</span><br><span class="line">		ks.load(certStream, password);</span><br><span class="line">		<span class="comment">// å®ä¾‹åŒ–å¯†é’¥åº“ &amp; åˆå§‹åŒ–å¯†é’¥å·¥å‚</span></span><br><span class="line">		<span class="type">KeyManagerFactory</span> <span class="variable">kmf</span> <span class="operator">=</span> KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());</span><br><span class="line">		kmf.init(ks, password);</span><br><span class="line">		<span class="type">SSLContext</span> <span class="variable">sslContext</span> <span class="operator">=</span> SSLContext.getInstance(<span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">		sslContext.init(kmf.getKeyManagers(), (TrustManager[]) <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">		HttpsURLConnection.setDefaultSSLSocketFactory(sslContext.getSocketFactory());</span><br><span class="line">		<span class="type">HttpURLConnection</span> <span class="variable">httpURLConnection</span> <span class="operator">=</span> (HttpURLConnection) httpUrl.openConnection();</span><br><span class="line">		httpURLConnection.setDoOutput(<span class="literal">true</span>);</span><br><span class="line">		httpURLConnection.setRequestMethod(<span class="string">&quot;POST&quot;</span>);</span><br><span class="line">		httpURLConnection.setConnectTimeout(withDrawConfig.getHttpConnectTimeoutMs());</span><br><span class="line">		httpURLConnection.setReadTimeout(withDrawConfig.getHttpReadTimeoutMs());</span><br><span class="line">		httpURLConnection.connect();</span><br><span class="line">		<span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> httpURLConnection.getOutputStream();</span><br><span class="line">		outputStream.write(data.getBytes(UTF8));</span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> httpURLConnection.getInputStream();</span><br><span class="line">		<span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, UTF8));</span><br><span class="line">		<span class="type">StringBuilder</span> <span class="variable">stringBuffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">		String line;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">			stringBuffer.append(line);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="type">String</span> <span class="variable">resp</span> <span class="operator">=</span> stringBuffer.toString();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			bufferedReader.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException ignored) &#123;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			inputStream.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException ignored) &#123;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			outputStream.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException ignored) &#123;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (certStream != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				certStream.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException ignored) &#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> resp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-ti-xian-de-ye-wu-shi-xian" id="5ã€æç°çš„ä¸šåŠ¡å®ç°">5ã€æç°çš„ä¸šåŠ¡å®ç°</h3>
<p>å®˜æ–¹æ¥å£æ–‡æ¡£ï¼š<a href="https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_2">ã€å¾®ä¿¡æ”¯ä»˜ã€‘ä»˜æ¬¾å¼€å‘è€…æ–‡æ¡£ (qq.com)</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¼€å§‹æç°ï¼Œç”Ÿæˆè®¢å•å·</span></span><br><span class="line"><span class="type">String</span> <span class="variable">orderNumber</span> <span class="operator">=</span> withDrawUtils.getOrderNumber();</span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰çš„å°†æç°æ‰€éœ€è¦çš„å‚æ•°å°è£…çš„å®ä½“ç±»</span></span><br><span class="line"><span class="type">WithDrawDTO</span> <span class="variable">withDrawDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WithDrawDTO</span>();</span><br><span class="line">withDrawDTO.setPartner_trade_no(orderNumber);</span><br><span class="line">withDrawDTO.setDesc(<span class="string">&quot;xxxxx&quot;</span>);</span><br><span class="line">withDrawDTO.setAmount(appletWithDrawDTO.getAmount());</span><br><span class="line"><span class="comment">//æ­¤å‚æ•°ä»£è¡¨ï¼Œå¼€å¯çœŸå®å§“åæ ¡éªŒï¼Œä¹Ÿå¯ä»¥å…³é—­ï¼Œè¯¦çœ‹å®˜æ–¹æ–‡æ¡£çš„å‚æ•°è¯´æ˜</span></span><br><span class="line">withDrawDTO.setCheck_name(<span class="string">&quot;FORCE_CHECK&quot;</span>);</span><br><span class="line">withDrawDTO.setRe_user_name(appletWithDrawDTO.getName());</span><br><span class="line"><span class="comment">//å¾®ä¿¡å°ç¨‹åºç”¨æˆ·çš„openid</span></span><br><span class="line">withDrawDTO.setOpenid(wxUser.getOpenid());</span><br><span class="line">Map&lt;String, String&gt; params = JSON.parseObject(JSON.toJSONString(withDrawDTO), <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;Map&lt;String, String&gt;&gt;() &#123;</span><br><span class="line">&#125;);</span><br><span class="line">params = withDrawUtils.fillRequest(params);</span><br><span class="line">withDrawDTO.setNonce_str(params.get(<span class="string">&quot;nonce_str&quot;</span>));</span><br><span class="line">withDrawDTO.setMchid(params.get(<span class="string">&quot;mchid&quot;</span>));</span><br><span class="line">withDrawDTO.setMch_appid(params.get(<span class="string">&quot;mch_appid&quot;</span>));</span><br><span class="line">withDrawDTO.setSign(params.get(<span class="string">&quot;sign&quot;</span>));</span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">post</span> <span class="operator">=</span> withDrawUtils.getRestInstance(url, withDrawUtils.convertToXml(withDrawDTO));</span><br><span class="line">Map&lt;String, String&gt; result = WXPayUtil.xmlToMap(post);</span><br><span class="line"><span class="comment">//resultä¸ºè°ƒç”¨æ¥å£ä¹‹åçš„è¿”å›å‚æ•°ï¼Œå¯ä»¥æ ¹æ®è¿”å›å‚æ•°åˆ¤æ–­æ˜¯å¦æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line">WithDrawEnum resultEnum;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;SUCCESS&quot;</span>.equals(result.get(<span class="string">&quot;result_code&quot;</span>))) &#123;</span><br><span class="line">    <span class="comment">//æç°æˆåŠŸ</span></span><br><span class="line">    resultEnum = WithDrawEnum.fromText(<span class="string">&quot;SUCCESS&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> resultEnum;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//æç°å¤±è´¥</span></span><br><span class="line">    resultEnum = WithDrawEnum.fromText(result.get(<span class="string">&quot;err_code&quot;</span>));</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(resultEnum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-ti-xian-fan-hui-cuo-wu-dai-ma-de-mei-ju-lei" id="6ã€æç°è¿”å›é”™è¯¯ä»£ç çš„æšä¸¾ç±»">6ã€æç°è¿”å›é”™è¯¯ä»£ç çš„æšä¸¾ç±»</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">WithDrawEnum</span> &#123;</span><br><span class="line">	SUCCESS(<span class="number">0</span>, <span class="string">&quot;æç°æˆåŠŸ&quot;</span>),</span><br><span class="line">	FAIL(<span class="number">400</span>, <span class="string">&quot;æç°å¤±è´¥ï¼Œä½™é¢å°äºæç°é‡‘é¢&quot;</span>),</span><br><span class="line">	HANDLE_FRE(<span class="number">5000</span>, <span class="string">&quot;æ“ä½œå¤ªé¢‘ç¹&quot;</span>),</span><br><span class="line">	NO_AUTH(<span class="number">5001</span>, <span class="string">&quot;æ²¡æœ‰è¯¥æ¥å£æƒé™&quot;</span>),</span><br><span class="line">	AMOUNT_LIMIT(<span class="number">5002</span>, <span class="string">&quot;é‡‘é¢è¶…é™&quot;</span>),</span><br><span class="line">	PARAM_ERROR(<span class="number">5003</span>, <span class="string">&quot;å‚æ•°é”™è¯¯&quot;</span>),</span><br><span class="line">	OPENID_ERROR(<span class="number">5004</span>, <span class="string">&quot;Openidé”™è¯¯&quot;</span>),</span><br><span class="line">	SEND_FAILED(<span class="number">5005</span>, <span class="string">&quot;ä»˜æ¬¾é”™è¯¯&quot;</span>),</span><br><span class="line">	NOTENOUGH(<span class="number">5006</span>, <span class="string">&quot;ä½™é¢ä¸è¶³&quot;</span>),</span><br><span class="line">	SYSTEMERROR(<span class="number">5007</span>, <span class="string">&quot;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•ã€‚&quot;</span>),</span><br><span class="line">	NAME_MISMATCH(<span class="number">5008</span>, <span class="string">&quot;å§“åæ ¡éªŒå‡ºé”™&quot;</span>),</span><br><span class="line">	SIGN_ERROR(<span class="number">5009</span>, <span class="string">&quot;ç­¾åé”™è¯¯&quot;</span>),</span><br><span class="line">	XML_ERROR(<span class="number">5010</span>, <span class="string">&quot;å‘é€å†…å®¹å‡ºé”™&quot;</span>),</span><br><span class="line">	FATAL_ERROR(<span class="number">5011</span>, <span class="string">&quot;ä¸¤æ¬¡å‘é€å‚æ•°ä¸ä¸€è‡´&quot;</span>),</span><br><span class="line">	FREQ_LIMIT(<span class="number">5012</span>, <span class="string">&quot;è¶…è¿‡é¢‘ç‡é™åˆ¶ï¼Œè¯·ç¨åå†è¯•ã€‚&quot;</span>),</span><br><span class="line">	MONEY_LIMIT(<span class="number">5013</span>, <span class="string">&quot;å·²ç»è¾¾åˆ°ä»Šæ—¥ä»˜æ¬¾æ€»é¢ä¸Šé™/å·²è¾¾åˆ°ä»˜æ¬¾ç»™æ­¤ç”¨æˆ·é¢åº¦ä¸Šé™&quot;</span>),</span><br><span class="line">	CA_ERROR(<span class="number">5014</span>, <span class="string">&quot;å•†æˆ·è¯ä¹¦æ ¡éªŒå‡ºé”™&quot;</span>),</span><br><span class="line">	V2_ACCOUNT_SIMPLE_BAN(<span class="number">5015</span>, <span class="string">&quot;æ— æ³•ç»™æœªå®åç”¨æˆ·ä»˜æ¬¾&quot;</span>),</span><br><span class="line">	PARAM_IS_NOT_UTF8(<span class="number">5016</span>, <span class="string">&quot;å‘é€å‚æ•°ä¸­åŒ…å«ä¸è§„èŒƒå­—ç¬¦&quot;</span>),</span><br><span class="line">	SENDNUM_LIMIT(<span class="number">5017</span>, <span class="string">&quot;è¯¥ç”¨æˆ·ä»Šæ—¥ä»˜æ¬¾æ¬¡æ•°è¶…è¿‡é™åˆ¶, å¦‚æœ‰éœ€è¦è¯·è¿›å…¥ã€å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°-äº§å“ä¸­å¿ƒ-ä»˜æ¬¾åˆ°é›¶é’±-äº§å“è®¾ç½®ã€‘è¿›è¡Œä¿®æ”¹&quot;</span>),</span><br><span class="line">	RECV_ACCOUNT_NOT_ALLOWED(<span class="number">5018</span>, <span class="string">&quot;æ”¶æ¬¾è´¦æˆ·ä¸åœ¨æ”¶æ¬¾è´¦æˆ·åˆ—è¡¨&quot;</span>),</span><br><span class="line">	PAY_CHANNEL_NOT_ALLOWED(<span class="number">5019</span>, <span class="string">&quot;æœ¬å•†æˆ·å·æœªé…ç½®æ­¤åŠŸèƒ½&quot;</span>),</span><br><span class="line">	SEND_MONEY_LIMIT(<span class="number">5020</span>, <span class="string">&quot;å·²è¾¾åˆ°ä»Šæ—¥å•†æˆ·ä»˜æ¬¾é¢åº¦ä¸Šé™&quot;</span>),</span><br><span class="line">	RECEIVED_MONEY_LIMIT(<span class="number">5021</span>, <span class="string">&quot;å·²è¾¾åˆ°ä»Šæ—¥ä»˜æ¬¾ç»™æ­¤ç”¨æˆ·é¢åº¦ä¸Šé™&quot;</span>);</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">	<span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> WithDrawEnum <span class="title function_">fromText</span><span class="params">(String text)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (text != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (WithDrawEnum b : WithDrawEnum.values()) &#123;</span><br><span class="line">				<span class="keyword">if</span> (text.equalsIgnoreCase(b.name())) &#123;</span><br><span class="line">					<span class="keyword">return</span> b;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="zui-hou" id="æœ€å-2">æœ€å</h2>
<p>å¾®ä¿¡ç›¸å…³æ¥å£çš„è°ƒç”¨ï¼Œä¸»è¦è¿˜æ˜¯è¦è€å¿ƒçœ‹æ–‡æ¡£çš„è¯´æ˜ï¼Œæ‰èƒ½å®ç°ä¸šåŠ¡éœ€æ±‚ã€‚</p>
]]></content>
      <categories>
        <category>å¾®ä¿¡å¼€å‘</category>
      </categories>
      <tags>
        <tag>ä¼ä¸šä»˜æ¬¾åˆ°é›¶é’±</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ä¿¡æ‰«ç ç™»å½•å®ç°</title>
    <url>/posts/18301.html</url>
    <content><![CDATA[<h2 id="xu-qiu" id="éœ€æ±‚-2">éœ€æ±‚</h2>
<p>ä½¿ç”¨å¾®ä¿¡æ‰«ç ç™»å½•çš„æˆæƒæ–¹å¼ç™»å½•ç³»ç»Ÿ</p>
<span id="more"></span>
<h2 id="shi-xian" id="å®ç°-2">å®ç°</h2>
<p>æ­¤æ‰«ç ç™»é™†è¿‡ç¨‹ä¸­ä½¿ç”¨äº†ï¼Œå¾®ä¿¡å¼€æ”¾å¹³å°ï¼ˆéœ€æ”¯ä»˜300å¼€é€šå¼€å‘è€…è®¤è¯ï¼‰çš„ç½‘ç«™åº”ç”¨å®ç°çš„ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html">https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html</a></p>
<h3 id="liu-cheng" id="æµç¨‹ï¼š">æµç¨‹ï¼š</h3>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202202052041625.png" alt="image-20220205204119502" /></p>
<p>å¤§æ¦‚å°±æ˜¯ï¼šå‰ç«¯è°ƒæ¥å£è·å–åç«¯ç”Ÿæˆçš„stateï¼ˆå¯ä»¥ç”¨éªŒè¯ç™»å½•æˆæƒçš„æœ‰æ•ˆæ€§ï¼‰â€”â€”&gt;ç”¨æˆ·æ‰«ç åç¡®è®¤æˆæƒâ€”â€”&gt;å‰ç«¯å¼€å§‹è°ƒç”¨å¾®ä¿¡å¼€æ”¾å¹³å°çš„æ¥å£ä¹‹åå›è°ƒæœåŠ¡ç«¯æ¥å£â€”â€”&gt;å›è°ƒæ—¶ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œcodeå’Œstateâ€”â€”&gt;æ ¹æ®codeï¼Œappidå’ŒappSecretè°ƒç”¨æ¥å£è·å–access_tokenâ€”â€”æ ¹æ®access_tokenè·å–å¾®ä¿¡ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯</p>
<h3 id="dai-ma" id="ä»£ç ï¼š">ä»£ç ï¼š</h3>
<h4 id="qian-duan-vue" id="å‰ç«¯vueï¼š">å‰ç«¯vueï¼š</h4>
<h5 id="an-zhuang-yi-ge-cha-jian" id="å®‰è£…ä¸€ä¸ªæ’ä»¶ï¼š">å®‰è£…ä¸€ä¸ªæ’ä»¶ï¼š</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install vue-wxlogin --save-dev</span><br></pre></td></tr></table></figure>
<h5 id="yin-ru-zu-jian" id="å¼•å…¥ç»„ä»¶ï¼š">å¼•å…¥ç»„ä»¶ï¼š</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;wxlogin</span><br><span class="line">         appid=&quot;xxxxxx&quot;</span><br><span class="line">         :scope=&quot;&#x27;snsapi_login&#x27;&quot;</span><br><span class="line">         theme=&quot;black&quot;</span><br><span class="line">         redirect_uri=&quot;redirectUrl&quot;</span><br><span class="line">         :state=&quot;xxxxxx&quot;</span><br><span class="line">         :self_redirect=&quot;&#x27;true&#x27;&quot;</span><br><span class="line">         rel=&quot;external nofollow&quot;</span><br><span class="line">         /&gt;</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šé‡å®šå‘åœ°å€éœ€è¦ä½¿ç”¨urlEncodeå¯¹é“¾æ¥è¿›è¡Œå¤„ç†</p>
<h4 id="hou-duan-spring-boot" id="åç«¯SpringBootï¼š">åç«¯SpringBootï¼š</h4>
<h5 id="hou-duan-sheng-cheng-state-jie-kou" id="åç«¯ç”Ÿæˆstateæ¥å£">åç«¯ç”Ÿæˆstateæ¥å£</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;ä¼ä¸šç«¯ï¼šè·å–æ‰«ç ç™»å½•çš„state&quot;, notes = &quot; \n authorï¼šZhuGuangLiang&quot;)</span></span><br><span class="line"><span class="meta">@AnonymousGetMapping(&quot;/wx/qrcode&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Object&gt; <span class="title function_">getQrCode</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//ç”Ÿæˆç¥¨æ®</span></span><br><span class="line">    String state= IdUtil.simpleUUID();</span><br><span class="line">    <span class="comment">//å¯ä»¥å°†stateå‚æ•°ä½œä¸ºå­˜æ”¾åœ¨redisä¸­çš„æˆæƒç”¨æˆ·ä¿¡æ¯keyé”®</span></span><br><span class="line">    redisUtils.set(state, JSON.toJSON(<span class="keyword">new</span> <span class="title class_">CompanyWxDTO</span>()), <span class="number">5</span> * <span class="number">60</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.success(state);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="hui-diao-jie-kou-bing-xi-dai-state-he-code-can-shu" id="å›è°ƒæ¥å£ï¼Œå¹¶æºå¸¦stateå’Œcodeå‚æ•°">å›è°ƒæ¥å£ï¼Œå¹¶æºå¸¦stateå’Œcodeå‚æ•°</h5>
<p>æ³¨ï¼šå›è°ƒæ¥å£ï¼Œå°½é‡ä¸è¦æŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸å¯ä»¥åœ¨ç™»å½•æ¥å£æŠ›å‡º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;ä¼ä¸šç«¯ï¼šå¾®ä¿¡ç”¨æˆ·æˆæƒåï¼Œå›è°ƒåœ°å€&quot;, notes = &quot; \n authorï¼šZhuGuangLiang&quot;)</span></span><br><span class="line"><span class="meta">@AnonymousGetMapping(&quot;/wx/callback&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callback</span><span class="params">(String code, String state)</span> &#123;</span><br><span class="line">    companyAuthService.callback(code, state);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ–¹æ³•ä¸­æ‰€æœ‰ç¬¬ä¸‰æ–¹æ¥å£éƒ½å¯åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callback</span><span class="params">(String code, String state)</span> &#123;</span><br><span class="line">    <span class="comment">//authurlè·å–access_tokençš„æ¥å£ï¼Œå¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ä¸­çš„ç¬¬äºŒæ­¥</span></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">resultAuthUrl</span> <span class="operator">=</span> JSONObject.parseObject(HttpUtil.get(String.format(authUrl, appid, secret, code)));</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (resultAuthUrl.containsKey(<span class="string">&quot;errcode&quot;</span>)) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;æˆæƒå¤±è´¥&quot;</span>);</span><br><span class="line">        isSuccess = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//			throw new BadRequestException(ResultEnum.USER_NO_AUTH);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">openid</span> <span class="operator">=</span> resultAuthUrl.getString(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">accessToken</span> <span class="operator">=</span> resultAuthUrl.getString(<span class="string">&quot;access_token&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">refreshToken</span> <span class="operator">=</span> resultAuthUrl.getString(<span class="string">&quot;refresh_token&quot;</span>);</span><br><span class="line">    <span class="comment">//æ ¹æ®codeè·å–access_toke</span></span><br><span class="line">    LambdaQueryWrapper&lt;SpiritCompanyUser&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(SpiritCompanyUser::getOpenid, openid);</span><br><span class="line">    <span class="type">CompanyWxDTO</span> <span class="variable">companyWxDTO</span> <span class="operator">=</span> loginUtils.noExceptinCheckCompanyUser(queryWrapper);</span><br><span class="line">    <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> companyWxDTO.getType();</span><br><span class="line">    <span class="keyword">if</span> (!isSuccess) &#123;</span><br><span class="line">        <span class="comment">//ç™»å½•å¤±è´¥ï¼Œæ­¤æ—¶æˆ‘ä½¿ç”¨typeç±»å‹å»è®°å½•æ¯ä¸€ç§å¼‚å¸¸</span></span><br><span class="line">        companyWxDTO.setType(<span class="number">7</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="number">1</span> &amp;&amp; isSuccess) &#123;</span><br><span class="line">        <span class="comment">//æ ¡éªŒæˆæƒå‡­è¯</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">resultCheckToken</span> <span class="operator">=</span> JSONObject.parseObject(HttpUtil.get(String.format(checkTokenUrl, accessToken, openid)));</span><br><span class="line">        <span class="keyword">if</span> (resultCheckToken.getInteger(<span class="string">&quot;errcode&quot;</span>) == <span class="number">40003</span>) &#123;</span><br><span class="line">            <span class="comment">//åˆ·æ–°tokenï¼Œé˜²æ­¢å‡ºç°tokenå¤±æ•ˆ</span></span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">resultRefreshToken</span> <span class="operator">=</span> JSONObject.parseObject(HttpUtil.get(String.format(refreshTokenUrl, appid, refreshToken)));</span><br><span class="line">            accessToken = resultRefreshToken.getString(<span class="string">&quot;access_token&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">resultUserInfoUrl</span> <span class="operator">=</span> JSONObject.parseObject(HttpUtil.get(String.format(userInfoUrl, accessToken, openid)));</span><br><span class="line">        log.info(<span class="string">&quot;resultUserInfoUrl:&quot;</span> + resultUserInfoUrl.toString());</span><br><span class="line">        <span class="keyword">if</span> (resultUserInfoUrl.containsKey(<span class="string">&quot;errcode&quot;</span>)) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥&quot;</span>);</span><br><span class="line">            <span class="comment">//åŒä¸Š</span></span><br><span class="line">            companyWxDTO.setType(<span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        companyWxDTO.setAvatarUrl(resultUserInfoUrl.getString(<span class="string">&quot;headimgurl&quot;</span>));</span><br><span class="line">        companyWxDTO.setNickName(resultUserInfoUrl.getString(<span class="string">&quot;nickname&quot;</span>));</span><br><span class="line">        companyWxDTO.setOpenid(openid);</span><br><span class="line">        companyWxDTO.setUnionid(resultUserInfoUrl.getString(<span class="string">&quot;unionid&quot;</span>));</span><br><span class="line">        log.info(<span class="string">&quot;å¾®ä¿¡ç”¨æˆ·æˆæƒæˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    companyWxDTO.setTicket(state);</span><br><span class="line">    redisUtils.set(state, JSON.toJSON(companyWxDTO), <span class="number">5</span> * <span class="number">60</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¾®ä¿¡å¼€å‘</category>
      </categories>
      <tags>
        <tag>æ‰«ç ç™»å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„ä¹‹å¾ªç¯é˜Ÿåˆ—</title>
    <url>/posts/33202.html</url>
    <content><![CDATA[<p>ä¸ºå……åˆ†åˆ©ç”¨å‘é‡ç©ºé—´ï¼Œå…‹æœ&quot;<a href="https://baike.baidu.com/item/%E5%81%87%E6%BA%A2%E5%87%BA/11050937">å‡æº¢å‡º</a>&quot;ç°è±¡çš„æ–¹æ³•æ˜¯ï¼šå°†å‘é‡ç©ºé—´æƒ³è±¡ä¸ºä¸€ä¸ªé¦–å°¾ç›¸æ¥çš„åœ†ç¯ï¼Œå¹¶ç§°è¿™ç§å‘é‡ä¸ºå¾ªç¯å‘é‡ã€‚å­˜å‚¨åœ¨å…¶ä¸­çš„é˜Ÿåˆ—ç§°ä¸ºå¾ªç¯é˜Ÿåˆ—ï¼ˆCircular Queueï¼‰ã€‚å¾ªç¯é˜Ÿåˆ—æ˜¯æŠŠ<a href="https://baike.baidu.com/item/%E9%A1%BA%E5%BA%8F%E9%98%9F%E5%88%97/20832734">é¡ºåºé˜Ÿåˆ—</a>é¦–å°¾ç›¸è¿ï¼ŒæŠŠå­˜å‚¨é˜Ÿåˆ—å…ƒç´ çš„è¡¨ä»é€»è¾‘ä¸Šçœ‹æˆä¸€ä¸ªç¯ï¼Œæˆä¸ºå¾ªç¯é˜Ÿåˆ—ã€‚</p>
<span id="more"></span>
<h3 id="xun-huan-dui-lie-san-chong-qing-kuang" id="å¾ªç¯é˜Ÿåˆ—ä¸‰ç§æƒ…å†µ">å¾ªç¯é˜Ÿåˆ—ä¸‰ç§æƒ…å†µ</h3>
<h4 id="1" id="1ã€">1ã€</h4>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110061150819.png" alt="image-20211006115040686" /></p>
<ul>
<li>
<p>frontæŒ‡å‘å¤´å…ƒç´ çš„å‰ä¸€ä¸ªå…ƒç´ </p>
</li>
<li>
<p>rearæŒ‡å‘é˜Ÿå°¾å…ƒç´ </p>
</li>
<li>
<p>å¯¹ç©ºã€å…¥é˜Ÿå’Œé˜Ÿæ»¡æƒ…å†µåˆ¤æ–­ï¼š</p>
<ul>
<li>é˜Ÿç©ºï¼šfront=rear</li>
<li>å…¥é˜Ÿï¼šrear=ï¼ˆrear+1ï¼‰%maxsizeï¼Œæ¯æ¬¡å…ƒç´ è¿›å…¥é˜Ÿåˆ—ï¼Œé˜Ÿå°¾æŒ‡é’ˆrearå‘åç§»åŠ¨ ä¸€ä½ã€‚
<ul>
<li>queueã€rearã€‘=x</li>
</ul>
</li>
<li>é˜Ÿæ»¡ï¼šfront==(rear+1)%maxsize</li>
</ul>
</li>
<li>
<p>æ ¹æ®rearå’Œfrontè®¡ç®—é˜Ÿåˆ—é•¿åº¦ï¼š</p>
<ul>
<li>å½“rear&gt;front
<ul>
<li><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110061424940.png" alt="image-20211006142409854" /></li>
<li>å¾ˆå®¹æ˜“å¾—åˆ°é˜Ÿåˆ—é•¿åº¦ä¸ºï¼šrear-front</li>
</ul>
</li>
<li>å½“rear&lt;front
<ul>
<li><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110061440374.png" alt="image-20211006144049313" />
<ul>
<li>å› ä¸ºæ˜¯å¾ªç¯é˜Ÿåˆ—ï¼Œrearçš„ä½ç½®å¯ä»¥åœ¨frontçš„å‰é¢ï¼Œæ­¤æ—¶é˜Ÿåˆ—é•¿åº¦ä¸ºï¼šrear+1+maxsize-front-1=rear-front+maxsize
<ul>
<li>rear+ 1ä¸ºå…¶ä¸­ä¸€æ®µçš„é•¿åº¦</li>
<li>maxsize-front-1ä¸ºå¦ä¸€æ®µçš„é•¿åº¦</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2" id="2ã€">2ã€</h4>
<h4 id="img-src-https-cdn-jsdelivr-net-gh-zglgithubx-picture-img-202110061514889-png-alt-image-20211006151401822" id=""><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202110061514889.png" alt="image-20211006151401822" /></h4>
<ul>
<li>frontæŒ‡å‘å¤´å…ƒç´ </li>
<li>rearæŒ‡å‘é˜Ÿå°¾çš„åä¸€ä¸ªå…ƒç´ </li>
<li>é˜Ÿæ»¡ï¼šfront=(rear+1)%maxsize</li>
<li>é˜Ÿåˆ—é•¿åº¦ï¼š(rear-front+max)%maxsize</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>é˜Ÿåˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—ä¹‹RabbitMQå­¦ä¹ ç¬”è®°</title>
    <url>/posts/49673.html</url>
    <content><![CDATA[<h3 id="shi-yao-shi-xiao-xi-dui-lie" id="ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—">ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—</h3>
<p>æ¶ˆæ¯æ˜¯ä¸¤ä¸ªåº”ç”¨é—´ä¼ é€’çš„æ•°æ®ã€‚æ¶ˆæ¯é˜Ÿåˆ—ç®€å•çš„æ¥è®²æ˜¯å°†æ¶ˆæ¯åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­ç”¨æ¥å­˜å‚¨æ¶ˆæ¯çš„å®¹å™¨ã€‚</p>
<p>åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œé€šå¸¸ä¼šæœ‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ä»ä¸­å–å‡ºæ¶ˆæ¯ã€‚</p>
<h3 id="wei-shi-yao-yao-shi-yong-xiao-xi-dui-lie" id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h3>
<ul>
<li>è§£è—•ï¼š
<ul>
<li>å‡å¦‚æ¶ˆæ¯çš„æ¥æ”¶æ–¹æœ‰å¤šä¸ªï¼Œéœ€è¦å•ç‹¬ç»™æ¯ä¸ªæ¥æ”¶æ–¹éƒ½è¦å‘é€æ¶ˆæ¯ï¼Œå¦‚æœåˆæ–°å¢ä¸€ä¸ªæ¥æ”¶æ–¹ï¼Œåˆ™éœ€è¦å¢åŠ æ–°ä»£ç æ‰èƒ½å®ç°ã€‚ä¸ºäº†é™ä½è¿™ç§è€¦åˆï¼Œä½¿ç”¨MQï¼Œå‘é€æ–¹åªéœ€è¦æŠŠæ¶ˆæ¯æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œæ¥å—æ–¹åªéœ€è¦åœ¨é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯ï¼Œè¿™æ ·å°±é¿å…äº†æ¯æ¬¡æ–°å¢æ¥æ”¶æ–¹è€Œå»å¢åŠ æ–°ä»£ç ï¼Œä»è€Œå®ç°è§£è—•ã€‚</li>
</ul>
</li>
<li>å¼‚æ­¥ï¼š
<ul>
<li>ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å‘é€è¿›æ¥ï¼Œç³»ç»ŸAä¼šè°ƒç”¨ç³»ç»ŸBã€Cã€Dä¸‰ä¸ªç³»ç»Ÿï¼ŒåŒæ­¥è¯·æ±‚çš„è¯ï¼Œå“åº”æ—¶é—´å°±æ˜¯ç³»ç»ŸAã€Bã€Cã€Dçš„æ€»å’Œï¼Œä¹Ÿå°±æ˜¯800msã€‚å¦‚æœä½¿ç”¨MQï¼Œç³»ç»ŸAå‘é€æ•°æ®åˆ°MQï¼Œç„¶åå°±å¯ä»¥è¿”å›å“åº”ç»™å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦å†ç­‰å¾…ç³»ç»ŸBã€Cã€Dçš„å“åº”ï¼Œå¯ä»¥å¤§å¤§åœ°æé«˜æ€§èƒ½ã€‚å¯¹äºä¸€äº›éå¿…è¦çš„ä¸šåŠ¡ï¼Œæ¯”å¦‚å‘é€çŸ­ä¿¡ï¼Œå‘é€é‚®ä»¶ç­‰ç­‰ï¼Œå°±å¯ä»¥é‡‡ç”¨MQã€‚</li>
</ul>
</li>
<li>å‰Šå³°ï¼š
<ul>
<li>å‡è®¾ç³»ç»ŸAåœ¨æŸä¸€æ®µæ—¶é—´è¯·æ±‚æ•°æš´å¢ï¼Œæœ‰5000ä¸ªè¯·æ±‚å‘é€è¿‡æ¥ï¼Œç³»ç»ŸAè¿™æ—¶å°±ä¼šå‘é€5000æ¡SQLè¿›å…¥MySQLè¿›è¡Œæ‰§è¡Œï¼ŒMySQLå¯¹äºå¦‚æ­¤åºå¤§çš„è¯·æ±‚å½“ç„¶å¤„ç†ä¸è¿‡æ¥ï¼ŒMySQLå°±ä¼šå´©æºƒï¼Œå¯¼è‡´ç³»ç»Ÿç˜«ç—ªã€‚å¦‚æœä½¿ç”¨MQï¼Œç³»ç»ŸAä¸å†æ˜¯ç›´æ¥å‘é€SQLåˆ°æ•°æ®åº“ï¼Œè€Œæ˜¯æŠŠæ•°æ®å‘é€åˆ°MQï¼ŒMQçŸ­æ—¶é—´ç§¯å‹æ•°æ®æ˜¯å¯ä»¥æ¥å—çš„ï¼Œç„¶åç”±æ¶ˆè´¹è€…æ¯æ¬¡æ‹‰å–2000æ¡è¿›è¡Œå¤„ç†ï¼Œé˜²æ­¢åœ¨è¯·æ±‚å³°å€¼æ—¶æœŸå¤§é‡çš„è¯·æ±‚ç›´æ¥å‘é€åˆ°MySQLå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</li>
</ul>
</li>
</ul>
<span id="more"></span>
<h3 id="rabbit-mq-jie-shao" id="RabbitMQä»‹ç»">RabbitMQä»‹ç»</h3>
<p>abbitMQ æ˜¯å®ç° AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰çš„æ¶ˆæ¯ä¸­é—´ä»¶çš„ä¸€ç§ï¼Œæœ€åˆèµ·æºäºé‡‘èç³»ç»Ÿï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ï¼Œåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§ç­‰æ–¹é¢è¡¨ç°ä¸ä¿—ã€‚ RabbitMQ ä¸»è¦æ˜¯ä¸ºäº†å®ç°ç³»ç»Ÿä¹‹é—´çš„åŒå‘è§£è€¦è€Œå®ç°çš„ã€‚å½“ç”Ÿäº§è€…å¤§é‡äº§ç”Ÿæ•°æ®æ—¶ï¼Œæ¶ˆè´¹è€…æ— æ³•å¿«é€Ÿæ¶ˆè´¹ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªä¸­é—´å±‚ã€‚ä¿å­˜è¿™ä¸ªæ•°æ®ã€‚</p>
<p>AMQPï¼Œå³ Advanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ã€‚æ¶ˆæ¯ä¸­é—´ä»¶ä¸»è¦ç”¨äºç»„ä»¶ä¹‹é—´çš„è§£è€¦ï¼Œæ¶ˆæ¯çš„å‘é€è€…æ— éœ€çŸ¥é“æ¶ˆæ¯ä½¿ç”¨è€…çš„å­˜åœ¨ï¼Œåä¹‹äº¦ç„¶ã€‚AMQP çš„ä¸»è¦ç‰¹å¾æ˜¯é¢å‘æ¶ˆæ¯ã€é˜Ÿåˆ—ã€è·¯ç”±ï¼ˆåŒ…æ‹¬ç‚¹å¯¹ç‚¹å’Œå‘å¸ƒ/è®¢é˜…ï¼‰ã€å¯é æ€§ã€å®‰å…¨ã€‚</p>
<p>RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„ AMQP å®ç°ï¼ŒæœåŠ¡å™¨ç«¯ç”¨Erlangè¯­è¨€ç¼–å†™ï¼Œæ”¯æŒå¤šç§å®¢æˆ·ç«¯ï¼Œå¦‚ï¼šPythonã€Rubyã€.NETã€Javaã€JMSã€Cã€PHPã€ActionScriptã€XMPPã€STOMP ç­‰ï¼Œæ”¯æŒ AJAXã€‚ç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ï¼Œåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§ç­‰æ–¹é¢è¡¨ç°ä¸ä¿—ã€‚</p>
<h3 id="an-zhuang" id="å®‰è£…">å®‰è£…</h3>
<h4 id="1-an-zhuang-er-lang-yu-yan-pei-zhi-huan-jing-bian-liang" id="1ã€å®‰è£…ERLangè¯­è¨€ï¼Œé…ç½®ç¯å¢ƒå˜é‡">1ã€å®‰è£…ERLangè¯­è¨€ï¼Œé…ç½®ç¯å¢ƒå˜é‡</h4>
<p>ERlang<a href="https://www.erlang.org/downloads?spm=a2c6h.12873639.0.0.433733dfToixYZ">å®˜ç½‘</a>ä¸‹è½½windowç‰ˆå®‰è£…åŒ…</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071152710.png" alt="img" /></p>
<p>å®‰è£…ä¸­ï¼Œä¸€ç›´ç‚¹nextï¼Œå®Œæˆåé…ç½®ç¯å¢ƒå˜é‡</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071153051.png" alt="img" /></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071154226.png" alt="img" /></p>
<p>å®Œæˆåï¼Œæ‰“å¼€cmd,è¾“å…¥éªŒè¯æ˜¯å¦æˆåŠŸ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">erl -version</span><br></pre></td></tr></table></figure>
<h4 id="2-an-zhuang-rabbit-mq-fu-wu-duan" id="2ã€å®‰è£…RabbitMQæœåŠ¡ç«¯">2ã€å®‰è£…RabbitMQæœåŠ¡ç«¯</h4>
<p>åœ¨RabbitMQçš„<a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.7.3?spm=a2c6h.12873639.0.0.433733dfvzkoi7&amp;file=v3.7.3">GitHubé¡¹ç›®</a>ä¸­ï¼Œä¸‹è½½windowç‰ˆæœ¬çš„æœåŠ¡ç«¯å®‰è£…åŒ…</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071157091.png" alt="img" /></p>
<p>å®‰è£…åï¼Œæ‰¾åˆ°å®‰è£…ç›®å½•ï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071158360.png" alt="img" /></p>
<p>åœ¨æ­¤ç›®å½•æ‰“å¼€cmdå‘½ä»¤ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®‰è£…ç®¡ç†é¡µé¢æ’ä»¶</span></span><br><span class="line">rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>
<p>åœ¨æ­¤ç›®å½•ä¸‹åŒå‡»rabbitmq-server.batå¯åŠ¨è„šæœ¬ï¼Œç„¶åæ‰“å¼€æœåŠ¡ç®¡ç†å¯ä»¥çœ‹åˆ°RabbitMQæ­£åœ¨è¿è¡Œï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071200331.png" alt="img" /></p>
<p>æœ€ååœ¨æµè§ˆå™¨è¾“å…¥:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿›å…¥å®¢æˆ·ç«¯</span></span><br><span class="line">http:<span class="comment">//localhost:15672</span></span><br><span class="line">è´¦å·å¯†ç é»˜è®¤æ˜¯ï¼šguest/guest</span><br></pre></td></tr></table></figure>
<h3 id="rabbit-mq-zhong-de-zu-cheng-bu-fen" id="RabbitMQä¸­çš„ç»„æˆéƒ¨åˆ†">RabbitMQä¸­çš„ç»„æˆéƒ¨åˆ†</h3>
<ul>
<li>Brokerï¼šæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡è¿›ç¨‹ã€‚æ­¤è¿›ç¨‹åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šExchangeå’ŒQueueã€‚</li>
<li>Exchangeï¼šæ¶ˆæ¯é˜Ÿåˆ—äº¤æ¢æœºã€‚<strong>æŒ‰ä¸€å®šçš„è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±è½¬å‘åˆ°æŸä¸ªé˜Ÿåˆ—</strong>ã€‚</li>
<li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚</li>
<li>Producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ã€‚ç”Ÿäº§æ–¹å®¢æˆ·ç«¯å°†æ¶ˆæ¯åŒäº¤æ¢æœºè·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­ã€‚</li>
<li>Consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ã€‚æ¶ˆè´¹é˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ¶ˆæ¯ã€‚</li>
</ul>
<p>è¿™äº›éƒ¨åˆ†ååŒå·¥ä½œå›¾ï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071208178.png" alt="img" /></p>
<ul>
<li>æ¶ˆæ¯ç”Ÿäº§è€…è¿æ¥åˆ°RabbitMQ Brokerï¼Œåˆ›å»ºconnectionï¼Œå¼€å¯channelã€‚</li>
<li>ç”Ÿäº§è€…å£°æ˜äº¤æ¢æœºç±»å‹ã€åç§°ã€æ˜¯å¦æŒä¹…åŒ–ç­‰ã€‚</li>
<li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šæ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ç­‰å±æ€§å’Œrouting keyã€‚</li>
<li>exchangeæ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œ<strong>æ ¹æ®routing keyè·¯ç”±åˆ°è·Ÿå½“å‰äº¤æ¢æœºç»‘å®šçš„ç›¸åŒ¹é…çš„é˜Ÿåˆ—</strong>é‡Œé¢ã€‚</li>
<li>æ¶ˆè´¹è€…ç›‘å¬æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åå¼€å§‹ä¸šåŠ¡å¤„ç†ã€‚</li>
</ul>
<h3 id="you-que-dian" id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3>
<h4 id="you-dian" id="ä¼˜ç‚¹">ä¼˜ç‚¹</h4>
<ul>
<li>å¯é æ€§ã€‚æ”¯æŒæŒä¹…åŒ–ï¼Œä¼ è¾“ç¡®è®¤ï¼Œå‘å¸ƒç¡®è®¤ç­‰ä¿è¯äº†MQçš„å¯é æ€§ã€‚</li>
<li>çµæ´»çš„åˆ†å‘æ¶ˆæ¯ç­–ç•¥ã€‚è¿™åº”è¯¥æ˜¯RabbitMQçš„ä¸€å¤§ç‰¹ç‚¹ã€‚åœ¨æ¶ˆæ¯è¿›å…¥MQå‰ç”±Exchange(äº¤æ¢æœº)è¿›è¡Œè·¯ç”±æ¶ˆæ¯ã€‚åˆ†å‘æ¶ˆæ¯ç­–ç•¥æœ‰ï¼šç®€å•æ¨¡å¼ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ã€å‘å¸ƒè®¢é˜…æ¨¡å¼ã€è·¯ç”±æ¨¡å¼ã€é€šé…ç¬¦æ¨¡å¼ã€‚</li>
<li>æ”¯æŒé›†ç¾¤ã€‚å¤šå°RabbitMQæœåŠ¡å™¨å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œå½¢æˆä¸€ä¸ªé€»è¾‘Brokerã€‚</li>
<li>å¤šç§åè®®ã€‚RabbitMQæ”¯æŒå¤šç§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ¯”å¦‚ STOMPã€MQTT ç­‰ç­‰ã€‚</li>
<li>æ”¯æŒå¤šç§è¯­è¨€å®¢æˆ·ç«¯ã€‚RabbitMQå‡ ä¹æ”¯æŒæ‰€æœ‰å¸¸ç”¨ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Javaã€.NETã€Ruby ç­‰ç­‰ã€‚</li>
<li>å¯è§†åŒ–ç®¡ç†ç•Œé¢ã€‚RabbitMQæä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„ç”¨æˆ·ç•Œé¢ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ç›‘æ§å’Œç®¡ç†æ¶ˆæ¯ Brokerã€‚</li>
<li>æ’ä»¶æœºåˆ¶ã€‚RabbitMQæä¾›äº†è®¸å¤šæ’ä»¶ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‰©å±•ï¼Œä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚</li>
</ul>
<h4 id="que-dian" id="ç¼ºç‚¹">ç¼ºç‚¹</h4>
<ul>
<li>ç³»ç»Ÿå¯ç”¨æ€§é™ä½ï¼šä½ æƒ³å‘€ï¼Œæœ¬æ¥å…¶ä»–ç³»ç»Ÿåªè¦è¿è¡Œå¥½å¥½çš„ï¼Œé‚£ä½ çš„ç³»ç»Ÿå°±æ˜¯æ­£å¸¸çš„ã€‚ç°åœ¨ä½ éè¦åŠ å…¥ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è¿›å»ï¼Œé‚£æ¶ˆæ¯é˜Ÿåˆ—æŒ‚äº†ï¼Œä½ çš„ç³»ç»Ÿä¸æ˜¯å‘µå‘µäº†ã€‚å› æ­¤ï¼Œç³»ç»Ÿå¯ç”¨æ€§ä¼šé™ä½</li>
<li>ç³»ç»Ÿå¤æ‚æ€§å¢åŠ ï¼šåŠ å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¦å¤šè€ƒè™‘å¾ˆå¤šæ–¹é¢çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šä¸€è‡´æ€§é—®é¢˜ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§ä¼ è¾“ç­‰ã€‚å› æ­¤ï¼Œéœ€è¦è€ƒè™‘çš„ä¸œè¥¿æ›´å¤šï¼Œåˆºç—›å¤æ‚æ€§å¢å¤§ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œå­¦ä¹ ç¬”è®°</title>
    <url>/posts/51189.html</url>
    <content><![CDATA[<p>è®¡ç®—æœºç½‘ç»œæ˜¯æŒ‡å°†åœ°ç†ä½ç½®ä¸åŒçš„å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„å¤šå°è®¡ç®—æœºåŠå…¶å¤–éƒ¨è®¾å¤‡ï¼Œé€šè¿‡é€šä¿¡çº¿è·¯è¿æ¥èµ·æ¥ï¼Œåœ¨ç½‘ç»œæ“ä½œç³»ç»Ÿï¼Œç½‘ç»œç®¡ç†è½¯ä»¶åŠç½‘ç»œé€šä¿¡åè®®çš„ç®¡ç†å’Œåè°ƒä¸‹ï¼Œå®ç°èµ„æºå…±äº«å’Œä¿¡æ¯ä¼ é€’çš„è®¡ç®—æœºç³»ç»Ÿã€‚<br />
è®¡ç®—æœºç½‘ç»œä¸»è¦æ˜¯ç”±ä¸€äº›é€šç”¨çš„ã€å¯ç¼–ç¨‹çš„ç¡¬ä»¶äº’è¿è€Œæˆçš„ï¼Œè€Œè¿™äº›ç¡¬ä»¶å¹¶éä¸“é—¨ç”¨æ¥å®ç°æŸä¸€ç‰¹å®šç›®çš„ï¼ˆä¾‹å¦‚ï¼Œä¼ é€æ•°æ®æˆ–è§†é¢‘ä¿¡å·ï¼‰ã€‚è¿™äº›å¯ç¼–ç¨‹çš„ç¡¬ä»¶èƒ½å¤Ÿç”¨æ¥ä¼ é€å¤šç§ä¸åŒç±»å‹çš„æ•°æ®ï¼Œå¹¶èƒ½æ”¯æŒå¹¿æ³›çš„å’Œæ—¥ç›Šå¢é•¿çš„åº”ç”¨ã€‚</p>
<span id="more"></span>
<h2 id="yi-ji-chu-zhi-shi" id="ä¸€ã€åŸºç¡€çŸ¥è¯†">ä¸€ã€åŸºç¡€çŸ¥è¯†</h2>
<h3 id="1-ipv-4-di-zhi" id="1ã€IPV4åœ°å€">1ã€IPV4åœ°å€</h3>
<h4 id="1-1-v-4-xie-yi" id="1-1ã€v4åè®®">1.1ã€v4åè®®</h4>
<p>ç›®å‰çš„å…¨çƒå› ç‰¹ç½‘æ‰€é‡‡ç”¨çš„åè®®æ—æ˜¯TCP/IPåè®®æ—ã€‚IPæ˜¯TCP/IPåè®®æ—ä¸­ç½‘ç»œå±‚çš„åè®®ï¼Œæ˜¯TCP/IPåè®®æ—çš„æ ¸å¿ƒåè®®ã€‚ç›®å‰IPåè®®çš„ç‰ˆæœ¬å·æ˜¯4(ç®€ç§°ä¸ºIPv4)ã€‚</p>
<h4 id="1-2-v-4-di-zhi" id="1-2ã€v4åœ°å€">1.2ã€v4åœ°å€</h4>
<ul>
<li>åœ¨TCP/IPä½“ç³»ä¸­ï¼ŒIPåœ°å€æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¿…é¡»æŠŠå®ƒå¼„æ¸…æ¥šã€‚</li>
<li>IPv4åœ°å€å°±æ˜¯ç»™å› ç‰¹ç½‘ä¸Šçš„æ¯ä¸€å°ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰çš„æ¯ä¸€ä¸ªæ¥å£åˆ†é…ä¸€ä¸ªåœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…æ˜¯å”¯ä¸€çš„32æ¯”ç‰¹çš„æ ‡è¯†ç¬¦ã€‚</li>
<li>IPåœ°å€ç”±å› ç‰¹ç½‘åå­—å’Œæ•°å­—åˆ†é…æœºæ„ICANNè¿›è¡Œåˆ†é…ã€‚
<ul>
<li>æˆ‘å›½ç”¨æˆ·å¯å‘äºšå¤ªç½‘ç»œä¿¡æ¯ä¸­å¿ƒAPNICç”³è¯·ipåœ°å€ï¼Œéœ€è¦ç¼´è´¹ã€‚</li>
<li>2011å¹´2æœˆ3æ—¥ï¼Œäº’è”ç½‘å·ç åˆ†é…ç®¡ç†å±€IANA(ç”±ICANNè¡Œä½¿èŒèƒ½)å®£å¸ƒï¼ŒIPv4åœ°å€å·²ç»åˆ†é…å®Œæ¯•ã€‚</li>
<li>æˆ‘å›½åœ¨2014è‡³2015å¹´ä¹Ÿé€æ­¥åœæ­¢äº†å‘æ–°ç”¨æˆ·å’Œåº”ç”¨åˆ†é…IPv4åœ°å€ã€‚åŒæ—¶å…¨é¢å¼€å±•å•†ç”¨éƒ¨ç½²IPv6 ã€‚</li>
</ul>
</li>
<li>IPv4åœ°å€çš„ç¼–å€æ–¹æ³•ç»å†äº†å¦‚ä¸‹ä¸‰ä¸ªå†å²é˜¶æ®µï¼š
<ul>
<li>1981å¹´åˆ†ç±»ç¼–å€</li>
<li>1985å¹´åˆ’åˆ†å­ç½‘</li>
<li>1993å¹´æ— åˆ†ç±»ç¼–å€</li>
</ul>
</li>
<li>è¡¨ç¤ºæ–¹æ³•ï¼š
<ul>
<li>IPv4çš„åœ°å€ä½æ•°ä¸º32ä½ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šæœ‰2çš„32æ¬¡æ–¹çš„IPv4åœ°å€å¯ä»¥è”åˆ°Internetä¸Šã€‚</li>
<li>é€šå¸¸ï¼ŒIPv4åœ°å€ä»¥ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºã€‚IPV4 å°±æ˜¯æœ‰4 æ®µæ•°å­—ï¼Œæ¯ä¸€æ®µç”±0~255 æ•°å­—ç»„æˆã€‚æ¯ä¸ªéƒ¨åˆ†ä»£è¡¨ä¸€ç»„æ„æˆ8ä½åœ°å€æ–¹æ¡ˆçš„8ä½åœ°å€ã€‚<br />
<img data-src="https://img-blog.csdnimg.cn/90b0d6877b234419ab94669086681089.png" alt="image.png" /><br />
<img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531153426.png" alt="" /></li>
</ul>
</li>
</ul>
<h4 id="1-3-fen-lei-bian-zhi-de-i-pv-4-di-zhi" id="1-3ã€åˆ†ç±»ç¼–å€çš„IPv4åœ°å€">1.3ã€åˆ†ç±»ç¼–å€çš„IPv4åœ°å€</h4>
<ul>
<li>Aç±»ç½‘ç»œï¼Œæœ€é«˜ä½å›ºå®šä¸º0
<ul>
<li>8ä½ç½‘ç»œå·ï¼Œ24ä½ä¸»æœºå·</li>
<li>æœ€å°ç½‘ç»œå·0ï¼Œä¿ç•™ä¸æŒ‡æ´¾</li>
<li>ç¬¬ä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå·ä¸º00000001ï¼Œç½‘ç»œåœ°å€ä¸º1.0.0.0</li>
<li>æœ€å¤§ç½‘ç»œå·äºŒè¿›åˆ¶011111111ï¼ˆ127ï¼‰ï¼Œä½œä¸ºæœ¬åœ°ç¯å›æµ‹è¯•åœ°å€ï¼Œä¸æŒ‡æ´¾ã€‚æœ€å°è¿˜å›æµ‹è¯•åœ°å€ï¼š127.0.0.1ï¼Œæœ€å¤§çš„æœ¬åœ°ç¯å›æµ‹è¯•åœ°å€ä¸º127.255.255.254</li>
<li>æœ€åä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå·ä¸º126ï¼Œç½‘ç»œåœ°å€ä¸º126.0.0.0</li>
<li>å¯æŒ‡æ´¾çš„ç½‘ç»œæ•°é‡ä¸º2^(8-1)-2=126ï¼ˆå‡2çš„åŸå› æ˜¯é™¤å»æœ€å°ç½‘ç»œå·0å’Œæœ€å¤§ç½‘ç»œå·127ï¼‰</li>
<li>æ¯ä¸ªç½‘ç»œä¸­å¯åˆ†é…çš„IPåœ°å€æ•°é‡ä¸º2^24-2=16777214ï¼ˆå‡2çš„åŸå› æ˜¯é™¤å»ä¸»æœºå·ä¸ºå…¨0çš„ç½‘ç»œåœ°å€å’Œå…¨1çš„å¹¿æ’­åœ°å€ï¼‰</li>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531155340.png" alt="" /></li>
</ul>
</li>
<li>Bç±»ç½‘ç»œï¼Œæœ€é«˜ä½å›ºå®šä¸º10
<ul>
<li>æœ€å°ç½‘ç»œå·ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå·128.0ç½‘ç»œåœ°å€ä¸º128.0.0.0</li>
<li>æœ€å¤§ç½‘ç»œå·ä¹Ÿæ˜¯æœ€åä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå·191.255ç½‘ç»œåœ°å€ä¸º191.255.0.0</li>
<li>å¯æŒ‡æ´¾çš„ç½‘ç»œæ•°é‡ä¸º2^(16-2)=16384</li>
<li>æ¯ä¸ªç½‘ç»œä¸­å¯åˆ†é…çš„IPåœ°å€æ•°é‡ä¸º2^16-2=65534ï¼ˆå‡2çš„åŸå› æ˜¯é™¤å»ä¸»æœºå·ä¸ºå…¨0çš„ç½‘ç»œåœ°å€å’Œå…¨1çš„å¹¿æ’­åœ°å€ï¼‰</li>
<li>åœ¨æœ‰äº›èµ„æ–™ä¸­æŒ‡å‡º128.0æ˜¯ä¿ç•™ç½‘ç»œå·ï¼ŒBç±»ç¬¬ä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå¥½ä¸º128.1ã€‚ä½†æ ¹æ®2002å¹´9æœˆå‘è¡¨çš„RFC3330æ–‡æ¡£ï¼Œ128.0ç½‘ç»œå·å·²ç»å¯ä»¥åˆ†é…äº†ã€‚</li>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531160550.png" alt="" /></li>
</ul>
</li>
<li>Cç±»ç½‘ç»œï¼Œæœ€é«˜ä½å›ºå®šä¸º110
<ul>
<li>æœ€å°ç½‘ç»œå·ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå·192.0.0ï¼Œç½‘ç»œåœ°å€ä¸º192.0.0.0</li>
<li>æœ€å¤§ç½‘ç»œå·ä¹Ÿæ˜¯æœ€åä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå·223.255.255ç½‘ç»œåœ°å€ä¸º223.255.255.0</li>
<li>å¯æŒ‡æ´¾çš„ç½‘ç»œæ•°é‡ä¸º2^(24-3)=2097152</li>
<li>æ¯ä¸ªç½‘ç»œä¸­å¯åˆ†é…çš„IPåœ°å€æ•°é‡ä¸º2^8-2=254ï¼ˆå‡2çš„åŸå› æ˜¯é™¤å»ä¸»æœºå·ä¸ºå…¨0çš„ç½‘ç»œåœ°å€å’Œå…¨1çš„å¹¿æ’­åœ°å€ï¼‰</li>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531163924.png" alt="" /></li>
</ul>
</li>
</ul>
<h4 id="1-4-hua-fen-zi-wang-de-i-pv-4-di-zhi" id="1-4ã€åˆ’åˆ†å­ç½‘çš„IPv4åœ°å€">1.4ã€åˆ’åˆ†å­ç½‘çš„IPv4åœ°å€</h4>
<ul>
<li>32æ¯”ç‰¹çš„å­ç½‘æ©ç å¯ä»¥è¡¨æ˜åˆ†ç±»Ipåœ°å€çš„ä¸»æœºå·éƒ¨åˆ†è¢«å€Ÿç”¨äº†å‡ ä¸ªæ¯”ç‰¹ä½œä¸ºå­ç½‘å·</li>
<li>å­ç½‘æ©ç ä½¿ç”¨è¿ç»­çš„æ¯”ç‰¹1æ¥å¯¹åº”ç½‘ç»œå·å’Œå­ç½‘å·</li>
<li>å­ç½‘æ©ç ä½¿ç”¨è¿ç»­çš„æ¯”ç‰¹0æ¥å¯¹åº”ä¸»æœºå·</li>
<li>å°†åˆ’åˆ†å­ç½‘çš„IPv4åœ°å€ä¸å…¶ç›¸åº”çš„å­ç½‘æ©ç è¿›è¡Œé€»è¾‘ä¸è¿ç®—å°±å¯å¾—åˆ°IPv4åœ°å€æ‰€åœ¨å­ç½‘çš„ç½‘ç»œåœ°å€</li>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531173526.png" alt="" /></li>
<li>ä¾‹å­ï¼š
<ul>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531201838.png" alt="" /></li>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531202042.png" alt="" /></li>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531202403.png" alt="" /></li>
</ul>
</li>
<li>é»˜è®¤çš„å­ç½‘æ©ç æ˜¯æŒ‡æœªåˆ’åˆ†å­ç½‘çš„æƒ…å†µä¸‹ä½¿ç”¨çš„å­ç½‘æ©ç 
<ul>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531202751.png" alt="" /></li>
</ul>
</li>
</ul>
<h4 id="1-5-wu-fen-lei-bian-zhi-de-i-pv-4-di-zhi" id="1-5ã€æ— åˆ†ç±»ç¼–å€çš„IPv4åœ°å€">1.5ã€æ— åˆ†ç±»ç¼–å€çš„IPv4åœ°å€</h4>
<ul>
<li>åˆ’åˆ†å­ç½‘åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº†å› ç‰¹ç½‘åœ¨å‘å±•ä¸­é‡åˆ°çš„å›°éš¾ï¼Œä½†æ˜¯æ•°é‡å·¨å¤§çš„Cç±»ç½‘å› ä¸ºå…¶åœ°å€ç©ºé—´å¤§å°å¹¶æ²¡æœ‰å¾—åˆ°å……åˆ†ä½¿ç”¨ï¼Œè€Œå› ç‰¹ç½‘çš„IPåœ°å€ä»åœ¨åŠ é€Ÿæ¶ˆè€—ï¼Œæ•´ä¸ªIPv4åœ°å€ç©ºé—´é¢ä¸´å…¨éƒ¨è€—å°½çš„å¨èƒã€‚</li>
<li>1993å¹´ï¼ŒIETFå‘å¸ƒäº†æ— åˆ†ç±»åŸŸé—´è·¯ç”±é€‰æ‹©CIDR
<ul>
<li>CIDRæ¶ˆé™¤äº†ä¼ ç»Ÿçš„Aç±»ã€Bç±»å’ŒCç±»åœ°å€ï¼Œä»¥åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µï¼›</li>
<li>CIDRå¯ä»¥æ›´åŠ æœ‰æ•ˆåœ°åˆ†é…IPv4çš„åœ°å€ç©ºé—´ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ–°çš„IPv6ä½¿ç”¨ä¹‹å‰ å…è®¸å› ç‰¹ç½‘çš„è§„æ¨¡ç»§ç»­å¢é•¿ã€‚</li>
</ul>
</li>
<li>ä¾‹å­ï¼š
<ul>
<li><img data-src="https://fastly.jsdelivr.net/gh/zglgithubx/picture/img/20220531204506.png" alt="" /></li>
</ul>
</li>
</ul>
<h4 id="1-5-si-kao" id="1-5ã€æ€è€ƒ">1.5ã€æ€è€ƒ</h4>
<h5 id="shi-yao-shi-zi-wang" id="ä»€ä¹ˆæ˜¯å­ç½‘">ä»€ä¹ˆæ˜¯å­ç½‘</h5>
<p>ä¸ºäº†ç¡®å®šç½‘ç»œåŒºåŸŸï¼Œåˆ†å¼€ä¸»æœºå’Œè·¯ç”±å™¨çš„æ¯ä¸ªæ¥å£ï¼Œä»è€Œäº§ç”Ÿäº†è‹¥å¹²ä¸ªåˆ†ç¦»çš„ç½‘ç»œå²›ï¼Œæ¥å£ç«¯è¿æ¥äº†è¿™äº›ç‹¬ç«‹ç½‘ç»œçš„ç«¯ç‚¹ã€‚è¿™äº›ç‹¬ç«‹çš„ç½‘ç»œå²›å«åš<strong>å­ç½‘(subnet)ã€‚</strong></p>
<h5 id="shi-yao-shi-zi-wang-yan-ma" id="ä»€ä¹ˆæ˜¯å­ç½‘æ©ç ">ä»€ä¹ˆæ˜¯å­ç½‘æ©ç </h5>
<ul>
<li>æŒ‡æ˜ä¸€ä¸ª<a href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80">IPåœ°å€</a>çš„å“ªäº›ä½æ ‡è¯†çš„æ˜¯<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA/455151">ä¸»æœº</a>æ‰€åœ¨çš„å­ç½‘ï¼Œä»¥åŠå“ªäº›ä½æ ‡è¯†çš„æ˜¯ä¸»æœºçš„ä½æ©ç </li>
<li>é€šè¿‡å­ç½‘æ©ç ï¼Œå°±å¯ä»¥åˆ¤æ–­ä¸¤ä¸ªIPåœ¨ä¸åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…éƒ¨ã€‚</li>
<li>å­ç½‘æ©ç å¯ä»¥çœ‹å‡ºæœ‰å¤šå°‘ä½æ˜¯ç½‘ç»œå·ï¼Œæœ‰å¤šå°‘ä½æ˜¯ä¸»æœºå·</li>
</ul>
<h5 id="zi-wang-hua-fen-de-yi-yi" id="å­ç½‘åˆ’åˆ†çš„æ„ä¹‰">å­ç½‘åˆ’åˆ†çš„æ„ä¹‰</h5>
<ul>
<li>èŠ‚çœIPåœ°å€èµ„æº</li>
<li>å¤§å¤§å‡å°‘è·¯ç”±è¡¨çš„æ•°ç›®</li>
</ul>
<h2 id="er-mian-shi-ti" id="äºŒã€é¢è¯•é¢˜">äºŒã€é¢è¯•é¢˜</h2>
<h3 id="1-liu-lan-qi-zhong-shu-ru-wang-zhi-qiao-hui-che-fa-sheng-liao-shi-yao" id="1ã€æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€æ•²å›è½¦å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ">1ã€æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€æ•²å›è½¦å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3>
<ul>
<li>URLè§£æ</li>
<li>DNSæŸ¥è¯¢</li>
<li>TCPè¿æ¥</li>
<li>å¤„ç†è¯·æ±‚</li>
<li>æ¥å—å“åº”</li>
<li>æ¸²æŸ“é¡µé¢<br />
å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/80551769">åœ¨æµè§ˆå™¨è¾“å…¥ URL å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼ˆè¶…è¯¦ç»†ç‰ˆï¼‰ - çŸ¥ä¹ (zhihu.com)</a></li>
</ul>
<h3 id="2-fu-wu-qi-ru-he-qu-fen-yong-hu-qing-qiu-de" id="2ã€æœåŠ¡å™¨å¦‚ä½•åŒºåˆ†ç”¨æˆ·è¯·æ±‚çš„ï¼Ÿ">2ã€æœåŠ¡å™¨å¦‚ä½•åŒºåˆ†ç”¨æˆ·è¯·æ±‚çš„ï¼Ÿ</h3>
<ul>
<li>æµè§ˆå™¨é¦–æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç»™å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªä¼šè¯sessionï¼Œå¹¶å“åº”ä¸€ä¸ªä¼šè¯çš„å”¯ä¸€æ ‡è¯†sessionIdã€‚</li>
<li>æµè§ˆå™¨æ”¶åˆ°æ­¤SessionIdåï¼Œç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ä¼šå°†æ­¤sessionIdæ·»åŠ ä¸­è¯·æ±‚å¤´çš„cookieä¸­ã€‚</li>
<li>æœåŠ¡å™¨åˆ¤æ–­cookieä¸­çš„sessionIdæ˜¯å¦æœ‰æ•ˆï¼Œæ¥åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€æµè§ˆå™¨è¿›ç¨‹å‘èµ·çš„è¯·æ±‚ã€‚<br />
å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_17125355/article/details/44621195">ä¸€åˆ†é’Ÿè§£æƒ‘ï¼šä¸Šä¸‡ä¸ªç”¨æˆ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¦‚ä½•åŒºåˆ†_å›å­_ä¸å™¨çš„åšå®¢-CSDNåšå®¢</a></li>
</ul>
<h3 id="3-lu-you-qi-fang-huo-qiang-chu-yu-na-yi-ceng" id="3ã€è·¯ç”±å™¨ã€é˜²ç«å¢™å¤„äºå“ªä¸€å±‚ï¼Ÿ">3ã€è·¯ç”±å™¨ã€é˜²ç«å¢™å¤„äºå“ªä¸€å±‚ï¼Ÿ</h3>
<ul>
<li>è·¯ç”±å™¨ï¼šåˆ™æ˜¯ä¸€ç§å…¸å‹çš„ç½‘ç»œå±‚è®¾å¤‡ï¼Œåœ¨ä¸åŒçš„ç½‘ç»œé—´å­˜å‚¨å¹¶è½¬å‘åˆ†ç»„ã€‚å¯åœ¨å¼‚ç§ç½‘ç»œä¹‹é—´ï¼ˆå³ä¸åŒç±»å‹çš„å±€åŸŸç½‘äº’è¿ï¼Œå±€åŸŸç½‘ä¸å¹¿åŸŸç½‘ï¼Œå¹¿åŸŸç½‘ä¸å¹¿åŸŸç½‘ï¼‰ä¼ è¾“æ•°æ®å¹¶è¿›è¡Œè·¯å¾„é€‰æ‹©ï¼Œä½¿ç”¨ä¸“é—¨çš„è½¯ä»¶åè®®ä»é€»è¾‘ä¸Šå¯¹æ•´ä¸ªç½‘ç»œè¿›è¡Œåˆ’åˆ†ã€‚</li>
<li>é˜²ç«å¢™ï¼šä¼ ç»Ÿçš„åŒ…è¿‡æ»¤é˜²ç«å¢™å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œç”µè·¯ç½‘å…³é˜²ç«å¢™å·¥ä½œåœ¨ä¼ è¾“å±‚ï¼ˆçº¿è·¯çº§é˜²ç«å¢™å·¥ä½œåœ¨ä¼šè¯å±‚ï¼‰ï¼Œåº”ç”¨ç½‘å…³ç±»çš„ä»£ç†é˜²ç«å¢™åˆ™å·¥ä½œåœ¨OSIæœ€é«˜çš„åº”ç”¨å±‚ã€‚</li>
</ul>
<h3 id="4-dns-xie-yi" id="4ã€DNSåè®®">4ã€DNSåè®®</h3>
<ul>
<li>åŸŸåè§£æç³»ç»Ÿï¼Œæ˜¯äº’è”ç½‘ä¸€é¡¹æœåŠ¡ï¼Œå®ŒæˆåŸŸååœ°å€ä¸IPåœ°å€çš„è½¬æ¢</li>
<li>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/351059293">è¶…è¯¦ç»† DNS åè®®è§£æ - çŸ¥ä¹ (zhihu.com)</a><br />
<a href="https://blog.csdn.net/weixin_44475093/article/details/117050871">é¢è¯•å®˜ï¼šDNS åè®®æ˜¯ä»€ä¹ˆï¼Ÿè¯´è¯´ DNS å®Œæ•´çš„æŸ¥è¯¢è¿‡ç¨‹?_åŠ¨æ„Ÿè¶…äººï¼Œçš„åšå®¢-CSDNåšå®¢</a></li>
</ul>
<h3 id="5-http-xie-yi" id="5ã€HTTPåè®®">5ã€HTTPåè®®</h3>
<p><code>HTTP</code>åè®®(è¶…æ–‡æœ¬ä¼ è¾“åè®®HyperText Transfer Protocol)ï¼Œå®ƒæ˜¯åŸºäºTCPåè®®çš„åº”ç”¨å±‚ä¼ è¾“åè®®ï¼Œç®€å•æ¥è¯´å°±æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œæ•°æ®ä¼ è¾“çš„ä¸€ç§è§„åˆ™ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è§’è‰²ä¸æ˜¯å›ºå®šçš„ï¼Œä¸€ç«¯å……å½“å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯èƒ½åœ¨æŸæ¬¡è¯·æ±‚ä¸­å……å½“æœåŠ¡å™¨ã€‚è¿™å–å†³ä¸è¯·æ±‚çš„å‘èµ·ç«¯ã€‚HTTPåè®®å±äºåº”ç”¨å±‚ï¼Œå»ºç«‹åœ¨ä¼ è¾“å±‚åè®®TCPä¹‹ä¸Šã€‚å®¢æˆ·ç«¯é€šè¿‡ä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ï¼Œä¹‹åå‘é€HTTPè¯·æ±‚ä¸æ¥æ”¶HTTPå“åº”éƒ½æ˜¯é€šè¿‡è®¿é—®Socketæ¥å£æ¥è°ƒç”¨TCPåè®®å®ç°ã€‚</p>
</blockquote>
<p><code>HTTP</code>Â æ˜¯ä¸€ç§<strong>æ— çŠ¶æ€</strong>Â (stateless) åè®®,Â <code>HTTP</code>åè®®æœ¬èº«ä¸ä¼šå¯¹å‘é€è¿‡çš„è¯·æ±‚å’Œç›¸åº”çš„é€šä¿¡çŠ¶æ€è¿›è¡ŒæŒä¹…åŒ–å¤„ç†ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¿æŒHTTPåè®®çš„ç®€å•æ€§ï¼Œä»è€Œèƒ½å¤Ÿå¿«é€Ÿå¤„ç†å¤§é‡çš„äº‹åŠ¡, æé«˜æ•ˆç‡ã€‚</p>
<h3 id="6-http-he-tcp-qu-bie-he-lian-xi" id="6ã€HTTPå’ŒTCPåŒºåˆ«å’Œè”ç³»ï¼Ÿ">6ã€HTTPå’ŒTCPåŒºåˆ«å’Œè”ç³»ï¼Ÿ</h3>
<ul>
<li>è”ç³»ï¼šHttpåè®®æ˜¯å»ºç«‹åœ¨TCPåè®®åŸºç¡€ä¹‹ä¸Šçš„ï¼Œå½“æµè§ˆå™¨éœ€è¦ä»æœåŠ¡å™¨è·å–ç½‘é¡µæ•°æ®çš„æ—¶å€™ï¼Œä¼šå‘å‡ºä¸€æ¬¡Httpè¯·æ±‚ã€‚Httpä¼šé€šè¿‡TCPå»ºç«‹èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨çš„è¿æ¥é€šé“ï¼Œå½“æœ¬æ¬¡è¯·æ±‚éœ€è¦çš„æ•°æ®ä¼ è¾“å®Œæ¯•åï¼ŒHttpä¼šç«‹å³å°†TCPè¿æ¥æ–­å¼€ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆçŸ­çš„ã€‚</li>
<li>åŒºåˆ«ï¼šHTTPå’ŒTCPä½äºä¸åŒçš„ç½‘ç»œåˆ†å±‚ã€‚TCPæ˜¯ä¼ è¾“å±‚çš„åè®®ï¼Œå®šä¹‰çš„æ˜¯æ•°æ®ä¼ è¾“å’Œè¿æ¥çš„è§„èŒƒï¼Œè€ŒHTTPæ˜¯åº”ç”¨å±‚çš„ï¼Œå®šä¹‰çš„æ˜¯æ•°æ®çš„å†…å®¹çš„è§„èŒƒã€‚å»ºç«‹ä¸€ä¸ªTCPè¯·æ±‚éœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œç”±äºhttpæ˜¯å»ºç«‹åœ¨tcpè¿æ¥ä¹‹ä¸Šçš„ï¼Œå»ºç«‹ä¸€ä¸ªhttpè¯·æ±‚é€šå¸¸åŒ…å«è¯·æ±‚å’Œå“åº”ä¸¤ä¸ªæ­¥éª¤ã€‚</li>
</ul>
<h3 id="7-http-he-https-de-qu-bie-http-zhong-s-shi-zhi-shi-yao" id="7ã€HTTPå’ŒHTTPSçš„åŒºåˆ«ï¼ŒHTTPä¸­Sæ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ">7ã€HTTPå’ŒHTTPSçš„åŒºåˆ«ï¼ŒHTTPä¸­Sæ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ</h3>
<ul>
<li>åŒºåˆ«ï¼š
<ul>
<li>HTTPæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼ŒHTTPSåˆ™æ˜¯å…·æœ‰å®‰å…¨æ€§çš„SSLåŠ å¯†ä¼ è¾“åè®®ï¼›</li>
<li>HTTPå’ŒHTTPSä½¿ç”¨çš„æ˜¯å®Œå…¨ä¸åŒçš„è¿æ¥æ–¹å¼ï¼Œç”¨çš„ç«¯å£ä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯80ï¼Œåè€…æ˜¯443ï¼›</li>
</ul>
</li>
<li>å­—æ¯S æŒ‡çš„æ˜¯ SSL/TLS åè®®ï¼Œå®ƒä½äº HTTP åè®®ä¸ TCP/IP åè®®ä¸­é—´ã€‚
<ul>
<li>SSL/TLSåè®®ç›®çš„ï¼š
<ul>
<li>æ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯åŠ å¯†ä¼ æ’­ï¼Œé¿å…çªƒå¬é£é™©</li>
<li>å…·æœ‰æ ¡éªŒæœºåˆ¶ï¼Œè¢«ç¯¡æ”¹åï¼Œé€šä¿¡åŒæ–¹å¯ä»¥ç«‹åˆ»å‘ç°</li>
<li>é…è¢«èº«ä»½è¯ä¹¦ï¼Œé˜²æ­¢è¢«å†’å……</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="8-https-yuan-li" id="8ã€HTTPSåŸç†">8ã€HTTPSåŸç†</h3>
<ul>
<li>å»ºç«‹è¿æ¥è¿‡ç¨‹ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰
<ul>
<li>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè¯·æ±‚å†…å®¹ä¸­åŒ…å«ï¼ˆæ”¯æŒçš„TLSç‰ˆæœ¬ï¼Œå®¢æœç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶ï¼Œéšæœºæ•°Aï¼‰
<ul>
<li>æœåŠ¡ç«¯å“åº”ç»™å®¢æˆ·ç«¯ï¼Œå†…å®¹åŒ…æ‹¬ï¼ˆç¡®è®¤æ”¯æŒçš„TLSç‰ˆæœ¬ï¼ŒæœåŠ¡ç«¯é€‰æ‹©çš„åŠ å¯†å¥—ä»¶ï¼Œéšæœºæ•°Bï¼‰</li>
<li>æœåŠ¡ç«¯å†æ¬¡å‘é€å“åº”ï¼Œæ­¤æ¬¡å†…å®¹ä¸ºæœåŠ¡å™¨çš„è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨æŸ¥çœ‹å¯ä¿¡ä»»çš„è¯ä¹¦åˆ—è¡¨ï¼‰éªŒè¯è¯ä¹¦æ˜¯å¦å¯ä¿¡</li>
<li>æœåŠ¡ç«¯å“åº”ç»™å®¢æˆ·ç«¯è¯ä¹¦å…¬é’¥</li>
</ul>
</li>
<li>å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•°Cï¼Œä½¿ç”¨å…¬é’¥åŠ å¯†éšæœºæ•°Cï¼Œå°†åŠ å¯†åçš„éšæœºæ•°Cå‘é€ç»™æœåŠ¡ç«¯
<ul>
<li>æœåŠ¡ç«¯ä½¿ç”¨ç§é’¥è§£å¯†éšæœºæ•°C</li>
</ul>
</li>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨éšæœºAï¼ŒBï¼ŒCï¼Œè®¡ç®—å‡ºä¼šè¯å¯†é’¥ï¼ˆåªåº”ç”¨äºå½“å‰ä¼šè¯ï¼‰</li>
</ul>
</li>
<li>ä¼ è¾“æ•°æ®ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰
<ul>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨ä¼šè¯å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ è§£å¯†</li>
</ul>
</li>
</ul>
<h3 id="9-gong-yao-jia-mi-he-si-yao-jia-mi-you-shi-yao-qu-bie" id="9ã€å…¬é’¥åŠ å¯†å’Œç§é’¥åŠ å¯†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">9ã€å…¬é’¥åŠ å¯†å’Œç§é’¥åŠ å¯†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<ul>
<li>å…¬é’¥åŠ å¯†ç”¨æ¥åŠ å¯†æ•°æ®ã€‚å…¬é’¥åŠ å¯†åï¼Œåªèƒ½ç”¨ç§é’¥è§£å¯†ï¼Œè€Œç§é’¥ä¸æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥ä¿è¯äº†æ•°æ®åªèƒ½ç”±ç§é’¥æŒæœ‰è€…æ‰èƒ½çœ‹åˆ°ã€‚å¦‚æœç”¨ç§é’¥åŠ å¯†ï¼Œå…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æ‰€æœ‰äººéƒ½èƒ½è§£å¯†ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„ç§å¯†æ€§ã€‚</li>
<li>ç§é’¥åŠ å¯†ç”¨æ¥ç­¾åï¼Œå…¬é’¥ç”¨äºéªŒç­¾ã€‚ç­¾åå¹¶ä¸æ˜¯ä¸ºäº†ä¿å¯†ï¼Œè€Œæ˜¯ä¿è¯äº†è¿™ä¸ªç­¾åæ˜¯ç”±ç‰¹å®šçš„äººå‘å‡ºçš„ï¼Œè€Œä¸æ˜¯è¢«å…¶ä»–äººä¼ªé€ çš„ï¼Œæ‰€æœ‰ç§é’¥çš„ç§æœ‰æ€§é€‚åˆç”¨åœ¨ç­¾åçš„ç”¨é€”ä¸Šã€‚</li>
<li>å…¬ç§é’¥ç‰¹æ€§
<ul>
<li>å…¬é’¥ä¸ç§é’¥æ˜¯æˆå¯¹å‡ºç°çš„</li>
<li>ç§é’¥æ–‡ä»¶ä¸­åŒ…å«äº†å…¬é’¥æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥åŸºäºç§é’¥å¯¼å‡ºå…¬é’¥</li>
<li>å¯†é’¥è¶Šé•¿ï¼Œè¶Šéš¾ç ´è§£ï¼Œæ‰€ä»¥2048ä½å¯†é’¥æ¯”1024ä½å¯†é’¥è¦æ›´å®‰å…¨</li>
<li>å…¬é’¥å’Œç§é’¥éƒ½æ˜¯å¯†é’¥ï¼Œè¢«å…¬å¼€çš„é‚£ä¸ªå°±æ˜¯å…¬é’¥ï¼Œæ²¡æœ‰è¢«å…¬å¼€çš„é‚£ä¸ªå°±æ˜¯ç§é’¥</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>è®¡ç®—æœºåŸºç¡€</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaçˆ¬è™«å®è·µ</title>
    <url>/posts/31819.html</url>
    <content><![CDATA[<h3 id="java-xie-pa-chong-fen-wei-liang-bu-di-yi-bu-da-kai-idea-di-er-bu-kai-shi-qiao-dai-ma" id="Javaå†™çˆ¬è™«åˆ†ä¸ºä¸¤æ­¥ï¼šç¬¬ä¸€æ­¥æ‰“å¼€ideaï¼Œç¬¬äºŒæ­¥å¼€å§‹æ•²ä»£ç â€¦">Javaå†™çˆ¬è™«åˆ†ä¸ºä¸¤æ­¥ï¼šç¬¬ä¸€æ­¥æ‰“å¼€ideaï¼Œç¬¬äºŒæ­¥å¼€å§‹æ•²ä»£ç â€¦</h3>
<span id="more"></span>   
<h3 id="1-wo-de-jian-jie" id="1ã€æˆ‘çš„è§è§£">1ã€æˆ‘çš„è§è§£</h3>
<p>çˆ¬è™«ï¼Œæˆ‘çš„ç†è§£å°±æ˜¯ï¼Œé¦–å…ˆè¦å¯ä»¥è·å–å¤§é‡æ•°æ®ï¼Œç„¶ååœ¨å¤§é‡æ•°æ®ä¸­ç­›é€‰å‡ºè‡ªå·±æƒ³è¦çš„æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¯¹æ•°æ®è¿›è¡Œä¿®é¥°ã€‚æ¥ä¸‹æ¥ï¼Œå°†ä¼šç»™å¤§å®¶ä»‹ç»ï¼Œä¸¤ç§çˆ¬å–æ•°æ®çš„æ–¹å¼ï¼šJSoupå’ŒWebClientã€‚</p>
<h3 id="2-j-soup" id="2ã€JSoup">2ã€JSoup</h3>
<h4 id="shi-shi-yao" id="â‘ æ˜¯ä»€ä¹ˆ">â‘ æ˜¯ä»€ä¹ˆ</h4>
<p>Jsoupæ˜¯ç”¨äºè§£æHTMLï¼Œå°±ç±»ä¼¼XMLè§£æå™¨ç”¨äºè§£æXMLã€‚ Jsoupå®ƒè§£æHTMLæˆä¸ºçœŸå®ä¸–ç•Œçš„HTMLã€‚ å®ƒä¸jqueryé€‰æ‹©å™¨çš„è¯­æ³•éå¸¸ç›¸ä¼¼ï¼Œå¹¶ä¸”éå¸¸çµæ´»å®¹æ˜“ä½¿ç”¨ä»¥è·å¾—æ‰€éœ€çš„ç»“æœã€‚ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¾ˆå¤šJsoupçš„ä¾‹å­ã€‚</p>
<h4 id="ta-neng-zuo-shi-yao" id="â‘¡å®ƒèƒ½åšä»€ä¹ˆ">â‘¡å®ƒèƒ½åšä»€ä¹ˆ</h4>
<ul>
<li>ä»URLï¼Œæ–‡ä»¶æˆ–å­—ç¬¦ä¸²ä¸­åˆ®å–å¹¶è§£æHTML</li>
<li>æŸ¥æ‰¾å’Œæå–æ•°æ®ï¼Œä½¿ç”¨DOMéå†æˆ–CSSé€‰æ‹©å™¨</li>
<li>æ“çºµHTMLå…ƒç´ ï¼Œå±æ€§å’Œæ–‡æœ¬</li>
<li>æ ¹æ®å®‰å…¨çš„ç™½åå•æ¸…ç†ç”¨æˆ·æäº¤çš„å†…å®¹ï¼Œä»¥é˜²æ­¢XSSæ”»å‡»</li>
<li>è¾“å‡ºæ•´æ´çš„HTML</li>
</ul>
<h4 id="xia-zai-yi-lai" id="â‘¢ä¸‹è½½ä¾èµ–">â‘¢ä¸‹è½½ä¾èµ–</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;!-- jsoup HTML parser library @ http:<span class="comment">//jsoup.org/ --&gt;</span></span><br><span class="line">  &lt;groupId&gt;org.jsoup&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jsoup&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;<span class="number">1.10</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h4 id="jsoup-yong-fa" id="â‘£Jsoupç”¨æ³•">â‘£Jsoupç”¨æ³•</h4>
<ul>
<li>
<p>ä»URLè·å–HTML</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.connect(<span class="string">&quot;http://www.baidu.com/&quot;</span>).get();</span><br><span class="line"><span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> doc.title();</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>å…¶ä¸­å…¶ä¸­JSoup.connet(â€œ<a href="http://xxx">http://xxx</a>â€)æ–¹æ³•è¿”å›äº†ä¸€ä¸ªConnectionå¯¹è±¡</p>
</li>
<li>
<p>åœ¨Connectionå¯¹è±¡å¯ä»¥è°ƒç”¨get()æˆ–post()æ–¹æ³•æ‰§è¡Œè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥åœ¨Connectionå¯¹è±¡ä¸­è®¾ç½®ä¸€äº›è¯·æ±‚ä¿¡æ¯ã€‚æ¯”å¦‚ï¼šå¤´ä¿¡æ¯ï¼Œcookie ,è¯·æ±‚ç­‰å¾…æ—¶é—´ï¼Œä»£ç†ç­‰ã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.connect(<span class="string">&quot;http://example.com&quot;</span>)</span><br><span class="line">  .data(<span class="string">&quot;query&quot;</span>, <span class="string">&quot;Java&quot;</span>)</span><br><span class="line">  .userAgent(<span class="string">&quot;Mozilla&quot;</span>)</span><br><span class="line">  .cookie(<span class="string">&quot;auth&quot;</span>, <span class="string">&quot;token&quot;</span>)</span><br><span class="line">  .timeout(<span class="number">3000</span>)</span><br><span class="line">  .post();</span><br></pre></td></tr></table></figure>
<ul>
<li>å‘é€è¯·æ±‚åï¼Œå°±ä¼šè·å–ä¸€ä¸ªDocumentæ–‡æ¡£å¯¹è±¡ï¼Œå†…å®¹æ˜¯å½“å‰é“¾æ¥çš„html</li>
</ul>
</li>
<li>
<p>è·å¾—Documentå¯¹è±¡åï¼Œæ¥ä¸‹æ¥å°±æ˜¯è§£æDocumentå¯¹è±¡ï¼Œå¹¶ä»ä¸­è·å–æˆ‘ä»¬æƒ³è¦çš„å…ƒç´ äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//doucmentå¯¹è±¡ä¸­è·å–ç›¸åº”æ ‡ç­¾çš„æ–¹æ³•</span></span><br><span class="line">getElementById(String id)ï¼šé€šè¿‡idæ¥è·å–</span><br><span class="line">getElementsByTag(String tagName)ï¼šé€šè¿‡æ ‡ç­¾åå­—æ¥è·å–</span><br><span class="line">getElementsByClass(String className)ï¼šé€šè¿‡ç±»åæ¥è·å–</span><br><span class="line">getElementsByAttribute(String key)ï¼šé€šè¿‡å±æ€§åå­—æ¥è·å–</span><br><span class="line">getElementsByAttributeValue(String key, String value)ï¼šé€šè¿‡æŒ‡å®šçš„å±æ€§åå­—ï¼Œå±æ€§å€¼æ¥è·å–</span><br><span class="line">getAllElements()ï¼šè·å–æ‰€æœ‰å…ƒç´ </span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>Jsoupçš„å¼ºå¤§åœ¨äºå®ƒå¯¹æ–‡æ¡£å…ƒç´ çš„æ£€ç´¢ï¼ŒSelectæ–¹æ³•å°†è¿”å›ä¸€ä¸ªElementsé›†åˆï¼Œå¹¶æä¾›ä¸€ç»„æ–¹æ³•æ¥æŠ½å–å’Œå¤„ç†ç»“æœï¼Œå³Jsoupçš„é€‰æ‹©å™¨è¯­æ³•ã€‚</p>
<p>1ã€Selectoré€‰æ‹©å™¨åŸºæœ¬è¯­æ³•</p>
<ul>
<li>
<p>tagname: é€šè¿‡æ ‡ç­¾æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ï¼ša</p>
</li>
<li>
<p>ns|tag: é€šè¿‡æ ‡ç­¾åœ¨å‘½åç©ºé—´æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ï¼šå¯ä»¥ç”¨ fb|name è¯­æ³•æ¥æŸ¥æ‰¾ <a href="fb:name">fb:name</a> å…ƒç´ </p>
</li>
<li>
<p>#id: é€šè¿‡IDæŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ï¼š#logo</p>
</li>
<li>
<p>.class: é€šè¿‡classåç§°æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ï¼š.masthead</p>
</li>
<li></li>
<li></li>
<li></li>
<li>
<p>[attr^=value], [attr$=value], [attr*=value]: åˆ©ç”¨åŒ¹é…å±æ€§å€¼å¼€å¤´ã€ç»“å°¾æˆ–åŒ…å«å±æ€§å€¼æ¥æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ï¼š[href*=/path/]</p>
</li>
<li>
<p>[attr~=regex]: åˆ©ç”¨å±æ€§å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æ¥æŸ¥æ‰¾å…ƒç´ ï¼Œæ¯”å¦‚ï¼š img[src~=(?i).(png|jpe?g)]</p>
</li>
<li>
<p>*: è¿™ä¸ªç¬¦å·å°†åŒ¹é…æ‰€æœ‰å…ƒç´ </p>
</li>
</ul>
<p>2ã€Selectoré€‰æ‹©å™¨ç»„åˆä½¿ç”¨è¯­æ³•</p>
<ul>
<li>el#id: å…ƒç´ +IDï¼Œæ¯”å¦‚ï¼š div#logo</li>
<li>el.class: å…ƒç´ +classï¼Œæ¯”å¦‚ï¼š div.masthead</li>
<li>el[attr]: å…ƒç´ +classï¼Œæ¯”å¦‚ï¼š a[href]</li>
<li>ä»»æ„ç»„åˆï¼Œæ¯”å¦‚ï¼ša[href].highlight</li>
<li>ancestor child: æŸ¥æ‰¾æŸä¸ªå…ƒç´ ä¸‹å­å…ƒç´ ï¼Œæ¯”å¦‚ï¼šå¯ä»¥ç”¨.body p æŸ¥æ‰¾åœ¨â€bodyâ€å…ƒç´ ä¸‹çš„æ‰€æœ‰ på…ƒç´ </li>
<li>parent &gt; child: æŸ¥æ‰¾æŸä¸ªçˆ¶å…ƒç´ ä¸‹çš„ç›´æ¥å­å…ƒç´ ï¼Œæ¯”å¦‚ï¼šå¯ä»¥ç”¨div.content &gt; p æŸ¥æ‰¾ p å…ƒç´ ï¼Œä¹Ÿå¯ä»¥ç”¨body &gt; * æŸ¥æ‰¾bodyæ ‡ç­¾ä¸‹æ‰€æœ‰ç›´æ¥å­å…ƒç´ </li>
<li>siblingA + siblingB: æŸ¥æ‰¾åœ¨Aå…ƒç´ ä¹‹å‰ç¬¬ä¸€ä¸ªåŒçº§å…ƒç´ Bï¼Œæ¯”å¦‚ï¼šdiv.head + div</li>
<li>siblingA ~ siblingX: æŸ¥æ‰¾Aå…ƒç´ ä¹‹å‰çš„åŒçº§Xå…ƒç´ ï¼Œæ¯”å¦‚ï¼šh1 ~ p</li>
<li>el, el, el:å¤šä¸ªé€‰æ‹©å™¨ç»„åˆï¼ŒæŸ¥æ‰¾åŒ¹é…ä»»ä¸€é€‰æ‹©å™¨çš„å”¯ä¸€å…ƒç´ ï¼Œä¾‹å¦‚ï¼šdiv.masthead, div.logo</li>
</ul>
<p>3ã€Selectorä¼ªé€‰æ‹©å™¨è¯­æ³•</p>
<ul>
<li>:lt(n): æŸ¥æ‰¾å“ªäº›å…ƒç´ çš„åŒçº§ç´¢å¼•å€¼ï¼ˆå®ƒçš„ä½ç½®åœ¨DOMæ ‘ä¸­æ˜¯ç›¸å¯¹äºå®ƒçš„çˆ¶èŠ‚ç‚¹ï¼‰å°äºnï¼Œæ¯”å¦‚ï¼štd:lt(3) è¡¨ç¤ºå°äºä¸‰åˆ—çš„å…ƒç´ </li>
<li>:gt(n):æŸ¥æ‰¾å“ªäº›å…ƒç´ çš„åŒçº§ç´¢å¼•å€¼å¤§äºnï¼Œæ¯”å¦‚ï¼š div p:gt(2)è¡¨ç¤ºå“ªäº›divä¸­æœ‰åŒ…å«2ä¸ªä»¥ä¸Šçš„på…ƒç´ </li>
<li>:eq(n): æŸ¥æ‰¾å“ªäº›å…ƒç´ çš„åŒçº§ç´¢å¼•å€¼ä¸nç›¸ç­‰ï¼Œæ¯”å¦‚ï¼šform input:eq(1)è¡¨ç¤ºåŒ…å«ä¸€ä¸ªinputæ ‡ç­¾çš„Formå…ƒç´ </li>
<li>:has(seletor): æŸ¥æ‰¾åŒ¹é…é€‰æ‹©å™¨åŒ…å«å…ƒç´ çš„å…ƒç´ ï¼Œæ¯”å¦‚ï¼šdiv:hasÂ§è¡¨ç¤ºå“ªäº›divåŒ…å«äº†på…ƒç´ </li>
<li>:not(selector): æŸ¥æ‰¾ä¸é€‰æ‹©å™¨ä¸åŒ¹é…çš„å…ƒç´ ï¼Œæ¯”å¦‚ï¼š div:not(.logo) è¡¨ç¤ºä¸åŒ…å« class=logo å…ƒç´ çš„æ‰€æœ‰ div åˆ—è¡¨</li>
<li>:contains(text): æŸ¥æ‰¾åŒ…å«ç»™å®šæ–‡æœ¬çš„å…ƒç´ ï¼Œæœç´¢ä¸åŒºåˆ†å¤§ä¸å†™ï¼Œæ¯”å¦‚ï¼š p:contains(jsoup)</li>
<li>:containsOwn(text): æŸ¥æ‰¾ç›´æ¥åŒ…å«ç»™å®šæ–‡æœ¬çš„å…ƒç´ </li>
<li>:matches(regex): æŸ¥æ‰¾å“ªäº›å…ƒç´ çš„æ–‡æœ¬åŒ¹é…æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼šdiv:matches((?i)login)</li>
<li>:matchesOwn(regex): æŸ¥æ‰¾è‡ªèº«åŒ…å«æ–‡æœ¬åŒ¹é…æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼çš„å…ƒç´ </li>
</ul>
<p>æ³¨æ„ï¼šä¸Šè¿°ä¼ªé€‰æ‹©å™¨ç´¢å¼•æ˜¯ä»0å¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€ä¸ªå…ƒç´ ç´¢å¼•å€¼ä¸º0ï¼Œç¬¬äºŒä¸ªå…ƒç´ indexä¸º1ç­‰ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 id="shi-li" id="â‘¤å®ä¾‹">â‘¤å®ä¾‹</h4>
<ul>
<li>
<p>ä½¿ç”¨<code>Jsoup.connect()</code> æ–¹æ³•ä»URLåŠ è½½HTML</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    Document document=Jsoup.connect(<span class="string">&quot;http://www.baidu.com&quot;</span>).get();</span><br><span class="line">    System.out.println(document);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (IOException e) </span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä»æ–‡ä»¶åŠ è½½HTML,ä½¿ç”¨<code>Jsoup.parse()</code> æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse( <span class="keyword">new</span> <span class="title class_">File</span>( <span class="string">&quot;D:/temp/index.html&quot;</span> ) , <span class="string">&quot;utf-8&quot;</span> );</span><br><span class="line">    System.out.println(document.title());</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">catch</span> (IOException e) </span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨<code>Jsoup.parse()</code> æ–¹æ³•ä»å­—ç¬¦ä¸²åŠ è½½HTML</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="string">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;First parse&lt;/title&gt;&lt;/head&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;body&gt;&lt;p&gt;Parsed HTML into a doc.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(html);</span><br><span class="line">    System.out.println(document.title());</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">catch</span> (IOException e) </span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è·å–HTMLé¡µé¢çš„å›¾æ ‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">favImage</span> <span class="operator">=</span> <span class="string">&quot;Not Found&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/temp/index.html&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> document.head().select(<span class="string">&quot;link[href~=.*\\.(ico|png)]&quot;</span>).first();</span><br><span class="line">    <span class="keyword">if</span> (element == <span class="literal">null</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        element = document.head().select(<span class="string">&quot;meta[itemprop=image]&quot;</span>).first();</span><br><span class="line">        <span class="keyword">if</span> (element != <span class="literal">null</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            favImage = element.attr(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        favImage = element.attr(<span class="string">&quot;href&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">catch</span> (IOException e) </span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(favImage);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è·å–HTMLé¡µé¢çš„æ‰€æœ‰é“¾æ¥</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/temp/index.html&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="type">Elements</span> <span class="variable">links</span> <span class="operator">=</span> document.select(<span class="string">&quot;a[href]&quot;</span>);  </span><br><span class="line">    <span class="keyword">for</span> (Element link : links) </span><br><span class="line">    &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;link : &quot;</span> + link.attr(<span class="string">&quot;href&quot;</span>));  </span><br><span class="line">         System.out.println(<span class="string">&quot;text : &quot;</span> + link.text());  </span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">catch</span> (IOException e) </span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è·å–HTMLé¡µé¢ä¸­æ‰€æœ‰çš„å›¾åƒ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/temp/index.html&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="type">Elements</span> <span class="variable">images</span> <span class="operator">=</span> document.select(<span class="string">&quot;img[src~=(?i)\\.(png|jpe?g|gif)]&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Element image : images) </span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;src : &quot;</span> + image.attr(<span class="string">&quot;src&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;height : &quot;</span> + image.attr(<span class="string">&quot;height&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;width : &quot;</span> + image.attr(<span class="string">&quot;width&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;alt : &quot;</span> + image.attr(<span class="string">&quot;alt&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">catch</span> (IOException e) </span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¿®æ”¹è·å–çš„HTMLæ ‡ç­¾</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:/Users/zkpkhua/Desktop/yiibai.com.html&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">//å°†æ‰€æœ‰divæ ‡ç­¾æ›¿æ¢ä¸ºpæ ‡ç­¾</span></span><br><span class="line">    document.select(<span class="string">&quot;div&quot;</span>).tagName(<span class="string">&quot;p&quot;</span>);</span><br><span class="line">    <span class="type">Elements</span> <span class="variable">links</span> <span class="operator">=</span> document.select(<span class="string">&quot;a[href]&quot;</span>);  </span><br><span class="line">    <span class="comment">//ç»™æ‰€æœ‰aæ ‡ç­¾æ·»åŠ å±æ€§rel=&quot;nofollow&quot;</span></span><br><span class="line">    links.attr(<span class="string">&quot;rel&quot;</span>, <span class="string">&quot;nofollow&quot;</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">catch</span> (IOException e) </span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ¶ˆé™¤ä¸ä¿¡ä»»çš„HTMLï¼ˆé˜²æ­¢XSSæ”»å‡»ï¼‰</p>
<ul>
<li>Jsoupåœ¨æä¾›å¼ºå¤§çš„APIçš„åŒæ—¶ï¼Œäººæ€§åŒ–æ–¹é¢ä¹Ÿåšå¾—å¾ˆå¥½ã€‚åœ¨åšç½‘ç«™çš„æ—¶å€™ï¼Œç»å¸¸ä¼šæä¾›ç”¨æˆ·çš„è¯„è®ºçš„åŠŸèƒ½ã€‚æœ‰äº›ç”¨æˆ·æ¯”è¾ƒæ·˜æ°”ï¼Œä¼šæä¸€äº›è„šæœ¬åˆ°è¯„è®ºå†…å®¹ä¸­ï¼Œè€Œè¿™äº›è„šæœ¬å¯èƒ½ä¼šç ´åæ•´ä¸ªé¡µé¢çš„åŠŸèƒ½ï¼Œæ›´ä¸¥é‡çš„æ˜¯è·å–ä¸€äº›æœºè¦ä¿¡æ¯ï¼Œä¾‹å¦‚XSSè·¨ç«™æ”»å‡»ä¹‹ç±»çš„ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">dirtyHTML</span> <span class="operator">=</span> <span class="string">&quot;&lt;p&gt;&lt;a href=&#x27;http://www.yiibai.com/&#x27; onclick=&#x27;sendCookiesToMe()&#x27;&gt;Link&lt;/a&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">cleanHTML</span> <span class="operator">=</span> Jsoup.clean(dirtyHTML, Whitelist.basic());</span><br><span class="line">System.out.println(cleanHTML);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œåè¾“å‡ºç»“æœ</span></span><br><span class="line">&lt;p&gt;&lt;a href=<span class="string">&quot;http://www.yiibai.com/&quot;</span> rel=<span class="string">&quot;nofollow&quot;</span>&gt;Link&lt;/a&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>Jsoupä½¿ç”¨ä¸€ä¸ªWhitelistç±»æ¥å¯¹HTMLæ–‡æ¡£è¿›è¡Œè¿‡æ»¤ï¼Œè¯¥ç±»æä¾›äº†å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•</p>
</li>
<li>
<table>
<thead>
<tr>
<th>æ–¹æ³•å</th>
<th>ç®€ä»‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>none()</td>
<td>åªå…è®¸åŒ…å«æ–‡æœ¬ä¿¡æ¯</td>
</tr>
<tr>
<td>basic()</td>
<td>å…è®¸çš„æ ‡ç­¾åŒ…æ‹¬ï¼ša,b,blockquote,br,cite, code,dd,dl,dt,em,i,li,ol,p.pre,q,small,strong,sub,sujp,u,ul,ä»¥åŠåˆé€‚çš„å±æ€§</td>
</tr>
<tr>
<td>simpel(ï¼‰</td>
<td>åªå…è®¸bï¼Œemï¼Œiï¼Œstrongï¼Œuï¼Œè¿™äº›æ ‡ç­¾</td>
</tr>
<tr>
<td>basicWithImage()</td>
<td>åœ¨basic()åŸºç¡€ä¸Šå¢åŠ äº†å›¾ç‰‡</td>
</tr>
<tr>
<td>relax()</td>
<td>è¿™ä¸ªè¿‡æ»¤å™¨å…è®¸çš„æ ‡ç­¾æœ€å¤šï¼ŒåŒ…æ‹¬ï¼šaï¼Œbï¼Œblockquoteï¼Œbrï¼Œcaptionï¼Œciteï¼Œcodeï¼Œcolï¼Œcolgroupï¼Œddï¼Œdlï¼Œdtï¼Œemï¼Œh1-h6ï¼Œiï¼Œimgï¼Œliï¼Œolï¼Œpï¼Œpreï¼Œqï¼Œsmallï¼Œstrikeï¼Œstrongï¼Œsubï¼Œsupï¼Œ tableï¼Œtbodyï¼Œtdï¼Œtfootï¼Œthï¼Œtheadï¼Œtrï¼Œuï¼Œul</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>å¦‚æœè¿™äº”ä¸ªè¿‡æ»¤å™¨éƒ½æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä¾‹å¦‚ä½ å…è®¸ç”¨æˆ·æ’å…¥flaseåŠ¨ç”»ï¼Œæ²¡å…³ç³»ï¼ŒWhitelistæä¾›æ‰©å±•åŠŸèƒ½ï¼Œä¾‹å¦‚<code>whitelist.addTags(&quot;embed&quot;,&quot;object&quot;,&quot;param&quot;,&quot;span&quot;,&quot;div&quot;)</code>ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨<code>addAttributes</code>ä¸ºæŸäº›å…ƒç´ å¢åŠ å±æ€§</p>
</li>
</ul>
</li>
</ul>
<h3 id="3-web-client" id="3ã€WebClient">3ã€WebClient</h3>
<p>psï¼šå®ƒæ¯”jsoupå¥½åœ¨å“ªï¼Œåœ¨æˆ‘çš„éœ€æ±‚ä¸­ï¼Œå®ƒæ¯”jsoupè·å–æ›´æ·±çš„æ•°æ®ï¼Œæœ‰æ—¶é¡µé¢çš„é“¾æ¥å¹¶ä¸ä¼šç›´æ¥æ˜¾å¼æ”¾åˆ°aæ ‡ç­¾ä¸­çš„hrefå±æ€§ä¸­ï¼Œè€Œæ˜¯æ”¾åˆ°äº†jsæ–‡ä»¶ä¸­ï¼Œåˆ©ç”¨ç”¨æˆ·ç‚¹å‡»äº‹ä»¶è§¦å‘æ‰§è¡Œã€‚webclientç›¸å½“äºä¸€ä¸ªèƒ½æ¨¡æ‹Ÿæµè§ˆå™¨çš„å·¥å…·ï¼Œæ¯”å¦‚ä½ å¯ä»¥ç”¨å®ƒåœ¨é¡µé¢ä¸­æäº¤è¡¨å•ï¼Œå‘èµ·è¯·æ±‚ç­‰ã€‚</p>
<h4 id="shi-shi-yao-1" id="â‘ æ˜¯ä»€ä¹ˆ-2">â‘ æ˜¯ä»€ä¹ˆ</h4>
<p>WebClientæ˜¯ä»Spring WebFlux 5.0ç‰ˆæœ¬å¼€å§‹æä¾›çš„ä¸€ä¸ªéé˜»å¡çš„åŸºäºå“åº”å¼ç¼–ç¨‹çš„è¿›è¡ŒHttpè¯·æ±‚çš„å®¢æˆ·ç«¯å·¥å…·ã€‚å®ƒçš„å“åº”å¼ç¼–ç¨‹çš„åŸºäºReactorçš„ã€‚WebClientä¸­æä¾›äº†æ ‡å‡†Httpè¯·æ±‚æ–¹å¼å¯¹åº”çš„getã€postã€putã€deleteç­‰æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å‘èµ·ç›¸åº”çš„è¯·æ±‚ã€‚</p>
<h4 id="zen-yao-yong" id="â‘¡æ€ä¹ˆç”¨">â‘¡æ€ä¹ˆç”¨</h4>
<ul>
<li>ç”¨mavenå¼•å…¥ä¾èµ–ï¼Œæˆ–è€…ç›´æ¥ä¸‹è½½jaråŒ…</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;	</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸€ä¸ªä¾‹å­</li>
</ul>
<p>é€šè¿‡<code>WebClient.create()</code>åˆ›å»ºä¸€ä¸ªWebClientçš„å®ä¾‹ï¼Œä¹‹åå¯ä»¥é€šè¿‡get()ï¼Œpost() ç­‰é€‰æ‹©è°ƒç”¨æ–¹å¼ï¼Œuri() æŒ‡å®šéœ€è¦è¯·æ±‚çš„è·¯å¾„ï¼Œretrieveï¼ˆï¼‰ ç”¨æ¥å‘èµ·è¯·æ±‚å¹¶è·å¾—å“åº”ï¼Œ<code>bodyToMono(String.class) </code>ç”¨æ¥æŒ‡å®šè¯·æ±‚ç»“æœéœ€è¦å¤„ç†ä¸ºStringï¼Œå¹¶åŒ…è£…ä¸ºReactorçš„Monoå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">WebClient webClient=WebClient.create();</span><br><span class="line">Mono&lt;String&gt; mono=webClient.get().uri(<span class="string">&quot;https://www.baidu.com&quot;</span>).retrieve().bodyToMono(String.class);</span><br><span class="line">System.out.println(mono.block());</span><br></pre></td></tr></table></figure>
<h4 id="shi-li-1" id="â‘¢å®ä¾‹">â‘¢å®ä¾‹</h4>
<ul>
<li>
<p>URLä¸­ä½¿ç”¨è·¯å¾„å˜é‡</p>
<ul>
<li>
<p>URLä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨è·¯å¾„å˜é‡ï¼Œè·¯å¾„å˜é‡çš„å€¼å¯ä»¥é€šè¿‡uriæ–¹æ³•çš„ç¬¬2ä¸ªå‚æ•°æŒ‡å®šã€‚ä¸‹é¢çš„ä»£ç ä¸­å°±å®šä¹‰äº†URLä¸­æ‹¥æœ‰ä¸€ä¸ªè·¯å¾„å˜é‡idï¼Œç„¶åå®é™…è®¿é—®æ—¶è¯¥å˜é‡å°†å–å€¼1ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">webClient.get().uri(<span class="string">&quot;http://localhost:8081/user/&#123;id&#125;&quot;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>URLä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªè·¯å¾„å˜é‡ï¼Œå¤šä¸ªè·¯å¾„å˜é‡çš„èµ‹å€¼å°†ä¾æ¬¡ä½¿ç”¨uriæ–¹æ³•çš„ç¬¬2ä¸ªã€ç¬¬3ä¸ªã€ç¬¬Nä¸ªå‚æ•°ã€‚ä¸‹é¢çš„ä»£ç ä¸­å°±å®šä¹‰äº†URLä¸­æ‹¥æœ‰è·¯å¾„å˜é‡p1å’Œp2ï¼Œå®é™…è®¿é—®çš„æ—¶å€™å°†è¢«æ›¿æ¢ä¸ºvar1å’Œvar2ã€‚æ‰€ä»¥å®é™…è®¿é—®çš„URLæ˜¯<code>http://localhost:8081/user/var1/var2</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">webClient.get().uri(<span class="string">&quot;http://localhost:8081/user/&#123;p1&#125;/&#123;p2&#125;&quot;</span>, <span class="string">&quot;var1&quot;</span>, <span class="string">&quot;var2&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨çš„è·¯å¾„å˜é‡ä¹Ÿå¯ä»¥é€šè¿‡Mapè¿›è¡Œèµ‹å€¼ã€‚é¢çš„ä»£ç ä¸­å°±å®šä¹‰äº†URLä¸­æ‹¥æœ‰è·¯å¾„å˜é‡p1å’Œp2ï¼Œå®é™…è®¿é—®çš„æ—¶å€™ä¼šä»uriVariablesä¸­è·å–å€¼è¿›è¡Œæ›¿æ¢ã€‚æ‰€ä»¥å®é™…è®¿é—®çš„URLæ˜¯<code>http://localhost:8081/user/var1/1</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, Object&gt; uriVariables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">uriVariables.put(<span class="string">&quot;p1&quot;</span>, <span class="string">&quot;var1&quot;</span>);</span><br><span class="line">uriVariables.put(<span class="string">&quot;p2&quot;</span>, <span class="number">1</span>);</span><br><span class="line">webClient.get().uri(<span class="string">&quot;http://localhost:8081/user/&#123;p1&#125;/&#123;p2&#125;&quot;</span>, uriVariables);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨uriBuilderä¼ é€’å‚æ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://192.1681.5.9:8989&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(baseUrl);</span><br><span class="line">WebClient.<span class="type">RequestBodyUriSpec</span> <span class="variable">request</span> <span class="operator">=</span> webClient.method(HttpMethod.POST);</span><br><span class="line">request.uri(uriBuilder -&gt; uriBuilder</span><br><span class="line">            .scheme(<span class="string">&quot;http&quot;</span>)</span><br><span class="line">            .host(<span class="string">&quot;192.168.5.9&quot;</span>)</span><br><span class="line">            .path(<span class="string">&quot;/mxtest4&quot;</span>)</span><br><span class="line">            .port(<span class="number">8989</span>)</span><br><span class="line">            .path(<span class="string">&quot;/mxtest4&quot;</span>)</span><br><span class="line">            .queryParam(<span class="string">&quot;name1&quot;</span>, <span class="string">&quot;å•Š&quot;</span>)</span><br><span class="line">            .queryParam(<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;æ˜¯&quot;</span>)</span><br><span class="line">            .build());</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŒ‡å®šbaseUrl</p>
<ul>
<li>
<p>åœ¨åº”ç”¨ä¸­ä½¿ç”¨WebClientæ—¶ä¹Ÿè®¸ä½ è¦è®¿é—®çš„URLéƒ½æ¥è‡ªåŒä¸€ä¸ªåº”ç”¨ï¼Œåªæ˜¯å¯¹åº”ä¸åŒçš„URLåœ°å€ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æŠŠå…¬ç”¨çš„éƒ¨åˆ†æŠ½å‡ºæ¥å®šä¹‰ä¸ºbaseUrlï¼Œç„¶ååœ¨è¿›è¡ŒWebClientè¯·æ±‚çš„æ—¶å€™åªæŒ‡å®šç›¸å¯¹äºbaseUrlçš„URLéƒ¨åˆ†å³å¯ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ä½ çš„baseUrléœ€è¦å˜æ›´çš„æ—¶å€™å¯ä»¥åªè¦ä¿®æ”¹ä¸€å¤„å³å¯ã€‚ä¸‹é¢çš„ä»£ç åœ¨åˆ›å»ºWebClientæ—¶å®šä¹‰äº†baseUrlä¸º<code>http://localhost:8081</code>ï¼Œåœ¨å‘èµ·Getè¯·æ±‚æ—¶æŒ‡å®šäº†URLä¸º<code>/user/1</code>ï¼Œè€Œå®é™…ä¸Šè®¿é—®çš„URLæ˜¯<code>http://localhost:8081/user/1</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(baseUrl);</span><br><span class="line">Mono&lt;User&gt; mono = webClient.get().uri(<span class="string">&quot;user/&#123;id&#125;&quot;</span>, <span class="number">1</span>).retrieve().bodyToMono(User.class);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>è¡¨å•æäº¤</p>
<ul>
<li>
<p>å½“ä¼ é€’çš„è¯·æ±‚ä½“å¯¹è±¡æ˜¯ä¸€ä¸ªMultiValueMapå¯¹è±¡æ—¶ï¼ŒWebClienté»˜è®¤å‘èµ·çš„æ˜¯Formæäº¤ã€‚ä¸‹é¢çš„ä»£ç ä¸­å°±é€šè¿‡Formæäº¤æ¨¡æ‹Ÿäº†ç”¨æˆ·è¿›è¡Œç™»å½•æ“ä½œï¼Œç»™Formè¡¨å•ä¼ é€’äº†å‚æ•°usernameï¼Œå€¼ä¸ºu123ï¼Œä¼ é€’äº†å‚æ•°passwordï¼Œå€¼ä¸ºp123ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(baseUrl);</span><br><span class="line"></span><br><span class="line">MultiValueMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedMultiValueMap</span>&lt;&gt;();</span><br><span class="line">map.add(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;u123&quot;</span>);</span><br><span class="line">map.add(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;p123&quot;</span>);</span><br><span class="line"></span><br><span class="line">Mono&lt;String&gt; mono = webClient.post().uri(<span class="string">&quot;/login&quot;</span>).syncBody(map).retrieve().bodyToMono(String.class);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>è¯·æ±‚æ—¶æºå¸¦JSONå‚æ•°</p>
<ul>
<li>
<p>å‡è®¾ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªæ–°å¢Userçš„æ¥å£ï¼ŒæŒ‰ç…§æ¥å£å®šä¹‰å®¢æˆ·ç«¯åº”è¯¥ä¼ é€’ä¸€ä¸ªJSONå¯¹è±¡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;å¼ ä¸‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;zhangsan&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®¢æˆ·ç«¯å¯ä»¥å»ºç«‹ä¸€ä¸ªæ»¡è¶³éœ€è¦çš„JSONæ ¼å¼çš„å¯¹è±¡ï¼Œç„¶åç›´æ¥æŠŠè¯¥å¯¹è±¡ä½œä¸ºè¯·æ±‚ä½“ï¼ŒWebClientä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨æŠŠå®ƒè½¬æ¢ä¸ºJSONå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(baseUrl);</span><br><span class="line"></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user.setName(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">user.setUsername(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line">Mono&lt;Void&gt; mono = webClient.post().uri(<span class="string">&quot;/user/add&quot;</span>).syncBody(user).retrieve().bodyToMono(Void.class);</span><br><span class="line">mono.block();</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰å»ºç«‹å¯¹åº”çš„å¯¹è±¡ï¼Œç›´æ¥åŒ…è£…ä¸ºä¸€ä¸ªMapå¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</span></span><br><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(baseUrl);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; user = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">user.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">user.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line">Mono&lt;Void&gt; mono = webClient.post().uri(<span class="string">&quot;/user/add&quot;</span>).syncBody(user).retrieve().bodyToMono(Void.class);</span><br><span class="line">mono.block();</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç›´æ¥ä¼ é€’ä¸€ä¸ªJSONå­—ç¬¦ä¸²ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ­¤æ—¶éœ€è¦æŒ‡å®šcontentTypeä¸º<code>application/json</code>ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šcharsetã€‚é»˜è®¤æƒ…å†µä¸‹WebClientå°†æ ¹æ®ä¼ é€’çš„å¯¹è±¡åœ¨è¿›è¡Œè§£æå¤„ç†åè‡ªåŠ¨é€‰æ‹©ContentTypeã€‚ç›´æ¥ä¼ é€’å­—ç¬¦ä¸²æ—¶é»˜è®¤ä½¿ç”¨çš„ContentTypeä¼šæ˜¯<code>text/plain</code>ã€‚å…¶å®ƒæƒ…å†µä¸‹ä¹Ÿå¯ä»¥ä¸»åŠ¨æŒ‡å®šContentTypeã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(baseUrl);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> </span><br><span class="line">        <span class="string">&quot;&#123;&quot;</span> + </span><br><span class="line">        <span class="string">&quot;    \&quot;name\&quot;:\&quot;å¼ ä¸‰\&quot;,\r\n&quot;</span> + </span><br><span class="line">        <span class="string">&quot;    \&quot;username\&quot;:\&quot;zhangsan\&quot;\r\n&quot;</span> + </span><br><span class="line">        <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">Mono&lt;Void&gt; mono = webClient.post().uri(<span class="string">&quot;/user/add&quot;</span>).contentType(MediaType.APPLICATION_JSON_UTF8).syncBody(userJson).retrieve().bodyToMono(Void.class);</span><br><span class="line">mono.block();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>å¤„ç†WebClienté”™è¯¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">WebClient.<span class="type">ResponseSpec</span> <span class="variable">retrieve</span> <span class="operator">=</span> request.retrieve();</span><br><span class="line"></span><br><span class="line">Mono&lt;String&gt; mono = retrieve</span><br><span class="line">        .onStatus(e -&gt; e.is4xxClientError(), resp -&gt; &#123;</span><br><span class="line">            System.out.println(resp.statusCode().value() + <span class="string">&quot;,&quot;</span> + resp.statusCode().getReasonPhrase());</span><br><span class="line">            <span class="keyword">return</span> Mono.error(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(resp.statusCode().value() + <span class="string">&quot; : &quot;</span> + resp.statusCode().getReasonPhrase()));</span><br><span class="line">        &#125;)</span><br><span class="line">        .bodyToMono(String.class)</span><br><span class="line">        .doOnError(WebClientResponseException.class, err -&gt; &#123;</span><br><span class="line">            System.out.println(err.getRawStatusCode() + <span class="string">&quot;,&quot;</span> + err.getResponseBodyAsString());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(err.getMessage());</span><br><span class="line">        &#125;)</span><br><span class="line">        .onErrorReturn(<span class="string">&quot;fallback&quot;</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;result:&quot;</span> + mono.block());</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸Šä¼ </span></span><br><span class="line"><span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">headers.setContentType(MediaType.IMAGE_PNG);</span><br><span class="line">HttpEntity&lt;ClassPathResource&gt; entity = <span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;parallel.png&quot;</span>), headers);</span><br><span class="line">MultiValueMap&lt;String, Object&gt; parts = <span class="keyword">new</span> <span class="title class_">LinkedMultiValueMap</span>&lt;&gt;();</span><br><span class="line">parts.add(<span class="string">&quot;file&quot;</span>, entity);</span><br><span class="line">Mono&lt;String&gt; resp = WebClient.create().post()</span><br><span class="line">        .uri(<span class="string">&quot;http://localhost:8080/upload&quot;</span>)</span><br><span class="line">        .contentType(MediaType.MULTIPART_FORM_DATA)</span><br><span class="line">        .body(BodyInserters.fromMultipartData(parts))</span><br><span class="line">        .retrieve().bodyToMono(String.class);</span><br><span class="line">LOGGER.info(<span class="string">&quot;result:&#123;&#125;&quot;</span>,resp.block());</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸‹è½½å›¾ç‰‡</span></span><br><span class="line">Mono&lt;Resource&gt; resp = WebClient.create().get()</span><br><span class="line">            .uri(<span class="string">&quot;http://www.toolip.gr/captcha?complexity=99&amp;size=60&amp;length=9&quot;</span>)</span><br><span class="line">            .accept(MediaType.IMAGE_PNG)</span><br><span class="line">            .retrieve().bodyToMono(Resource.class);</span><br><span class="line"><span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> resp.block();</span><br><span class="line"><span class="type">BufferedImage</span> <span class="variable">bufferedImage</span> <span class="operator">=</span> ImageIO.read(resource.getInputStream());</span><br><span class="line">ImageIO.write(bufferedImage, <span class="string">&quot;png&quot;</span>, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;captcha.png&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">Mono&lt;ClientResponse&gt; resp = WebClient.create().get()</span><br><span class="line">        .uri(<span class="string">&quot;http://localhost:8080/file/download&quot;</span>)</span><br><span class="line">        .accept(MediaType.APPLICATION_OCTET_STREAM)</span><br><span class="line">        .exchange();</span><br><span class="line"><span class="type">ClientResponse</span> <span class="variable">response</span> <span class="operator">=</span> resp.block();</span><br><span class="line"><span class="type">String</span> <span class="variable">disposition</span> <span class="operator">=</span> response.headers().asHttpHeaders().getFirst(HttpHeaders.CONTENT_DISPOSITION);</span><br><span class="line"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> disposition.substring(disposition.indexOf(<span class="string">&quot;=&quot;</span>)+<span class="number">1</span>);</span><br><span class="line"><span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> response.bodyToMono(Resource.class).block();</span><br><span class="line"><span class="type">File</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileName);</span><br><span class="line">FileUtils.copyInputStreamToFile(resource.getInputStream(),out);</span><br><span class="line">LOGGER.info(out.getAbsolutePath());</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¼‚æ­¥è°ƒç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux&lt;String&gt; flux = request.retrieve().bodyToFlux(String.class);</span><br><span class="line"><span class="type">Disposable</span> <span class="variable">subscribe</span> <span class="operator">=</span> flux.subscribe(tweet -&gt; &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœjvmç»“æŸäº†ï¼Œå°±ä¸èƒ½æ˜¾ç¤ºäº†</span></span><br><span class="line">    System.out.println(tweet.toString());</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;result:exit&quot;</span>);</span><br><span class="line">Thread.sleep(<span class="number">5000</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è·å–å“åº”å¤´ä¿¡æ¯</p>
<ul>
<li>å‰é¢ä»‹ç»çš„ç¤ºä¾‹éƒ½æ˜¯ç›´æ¥è·å–åˆ°äº†å“åº”çš„å†…å®¹ï¼Œå¯èƒ½ä½ ä¼šæƒ³è·å–åˆ°å“åº”çš„å¤´ä¿¡æ¯ã€Cookieç­‰ã€‚é‚£å°±å¯ä»¥åœ¨é€šè¿‡WebClientè¯·æ±‚æ—¶æŠŠè°ƒç”¨<code>retrieve()</code>æ”¹ä¸ºè°ƒç”¨<code>exchange()</code>ï¼Œè¿™æ ·å¯ä»¥è®¿é—®åˆ°ä»£è¡¨å“åº”ç»“æœçš„<code>org.springframework.web.reactive.function.client.ClientResponse</code>å¯¹è±¡ï¼Œé€šè¿‡å®ƒå¯ä»¥è·å–å“åº”çš„çŠ¶æ€ç ã€Cookieç­‰ã€‚ä¸‹é¢çš„ä»£ç å…ˆæ˜¯æ¨¡æ‹Ÿç”¨æˆ·è¿›è¡Œäº†ä¸€æ¬¡è¡¨å•çš„ç™»å½•æ“ä½œï¼Œé€šè¿‡ClientResponseè·å–åˆ°äº†ç™»å½•æˆåŠŸåçš„å†™å…¥Cookieçš„sessionIdï¼Œç„¶åç»§ç»­è¯·æ±‚äº†ç”¨æˆ·åˆ—è¡¨ã€‚åœ¨è¯·æ±‚è·å–ç”¨æˆ·åˆ—è¡¨æ—¶ä¼ é€’äº†å­˜å‚¨äº†sessionIdçš„Cookieã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.create(baseUrl);</span><br><span class="line"></span><br><span class="line">MultiValueMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedMultiValueMap</span>&lt;&gt;();</span><br><span class="line">map.add(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;u123&quot;</span>);</span><br><span class="line">map.add(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;p123&quot;</span>);</span><br><span class="line"></span><br><span class="line">Mono&lt;ClientResponse&gt; mono = webClient.post().uri(<span class="string">&quot;login&quot;</span>).syncBody(map).exchange();</span><br><span class="line"><span class="type">ClientResponse</span> <span class="variable">response</span> <span class="operator">=</span> mono.block();</span><br><span class="line"><span class="keyword">if</span> (response.statusCode() == HttpStatus.OK) &#123;</span><br><span class="line">    Mono&lt;Result&gt; resultMono = response.bodyToMono(Result.class);</span><br><span class="line">    resultMono.subscribe(result -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (result.isSuccess()) &#123;</span><br><span class="line">            <span class="type">ResponseCookie</span> <span class="variable">sidCookie</span> <span class="operator">=</span> response.cookies().getFirst(<span class="string">&quot;sid&quot;</span>);</span><br><span class="line">            Flux&lt;User&gt; userFlux = webClient.get().uri(<span class="string">&quot;users&quot;</span>).cookie(sidCookie.getName(), sidCookie.getValue()).retrieve().bodyToFlux(User.class);</span><br><span class="line">            userFlux.subscribe(System.out::println);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>WebClient.Builder</p>
<ul>
<li>é™¤äº†å¯ä»¥é€šè¿‡<code>WebClient.create()</code>åˆ›å»ºWebClientå¯¹è±¡å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡<code>WebClient.builder()</code>åˆ›å»ºä¸€ä¸ª<code>WebClient.Builder</code>å¯¹è±¡ï¼Œå†å¯¹Builderå¯¹è±¡è¿›è¡Œä¸€äº›é…ç½®åè°ƒç”¨å…¶<code>build()</code>åˆ›å»ºWebClientå¯¹è±¡ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å…¶ç”¨æ³•ï¼Œé…ç½®äº†baseUrlå’Œé»˜è®¤çš„cookieä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.builder().baseUrl(baseUrl).defaultCookie(<span class="string">&quot;cookieName&quot;</span>, <span class="string">&quot;cookieValue&quot;</span>).build();</span><br><span class="line"><span class="comment">//ä½¿ç”¨WebClientæ„å»ºå™¨ï¼Œå¯ä»¥è‡ªå®šä¹‰é€‰é¡¹ï¼šåŒ…æ‹¬è¿‡æ»¤å™¨ã€é»˜è®¤æ ‡é¢˜ã€cookieã€å®¢æˆ·ç«¯è¿æ¥å™¨ç­‰</span></span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.builder()</span><br><span class="line">        .baseUrl(<span class="string">&quot;https://api.github.com&quot;</span>)</span><br><span class="line">        .defaultHeader(HttpHeaders.CONTENT_TYPE, <span class="string">&quot;application/vnd.github.v3+json&quot;</span>)</span><br><span class="line">        .defaultHeader(HttpHeaders.USER_AGENT, <span class="string">&quot;Spring 5 WebClient&quot;</span>)</span><br><span class="line">        .build()</span><br></pre></td></tr></table></figure>
<ul>
<li>Builderè¿˜å¯ä»¥é€šè¿‡<code>clientConnector()</code>å®šä¹‰éœ€è¦ä½¿ç”¨çš„ClientHttpConnectorï¼Œé»˜è®¤å°†ä½¿ç”¨<code>org.springframework.http.client.reactive.ReactorClientHttpConnector</code>ï¼Œå…¶åº•å±‚æ˜¯åŸºäºnettyçš„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Mavenï¼Œéœ€è¦ç¡®ä¿ä½ çš„pom.xmlä¸­å®šä¹‰äº†å¦‚ä¸‹ä¾èµ–ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.projectreactor.ipc&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;reactor-netty&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.7</span><span class="number">.8</span>.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>å¦‚æœå¯¹é»˜è®¤çš„å‘é€è¯·æ±‚å’Œå¤„ç†å“åº”ç»“æœçš„ç¼–è§£ç ä¸æ»¡æ„ï¼Œè¿˜å¯ä»¥é€šè¿‡exchangeStrategies()å®šä¹‰ä½¿ç”¨çš„ExchangeStrategiesã€‚ExchangeStrategiesä¸­å®šä¹‰äº†ç”¨æ¥ç¼–è§£ç çš„å¯¹è±¡ï¼Œå…¶ä¹Ÿæœ‰å¯¹åº”çš„build()æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬æ¥åˆ›å»ºExchangeStrategieså¯¹è±¡ã€‚</p>
<p><em>WebClientä¹Ÿæä¾›äº†Filterï¼Œå¯¹åº”äºorg.springframework.web.reactive.function.client.ExchangeFilterFunctionæ¥å£ï¼Œå…¶æ¥å£æ–¹æ³•å®šä¹‰å¦‚ä¸‹ã€‚</em></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Mono&lt;ClientResponse&gt; <span class="title function_">filter</span><span class="params">(ClientRequest request, ExchangeFunction next)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨è¿›è¡Œæ‹¦æˆªæ—¶å¯ä»¥æ‹¦æˆªrequestï¼Œä¹Ÿå¯ä»¥æ‹¦æˆªresponseã€‚ä¸‹é¢çš„ä»£ç å®šä¹‰çš„Filterå°±æ‹¦æˆªäº†requestï¼Œç»™æ¯ä¸ªrequestéƒ½æ·»åŠ äº†ä¸€ä¸ªåä¸ºheader1çš„headerï¼Œå€¼ä¸ºvalue1ã€‚å®ƒä¹Ÿæ‹¦æˆªäº†responseï¼Œresponseä¸­ä¹Ÿæ˜¯æ·»åŠ äº†ä¸€ä¸ªæ–°çš„headerä¿¡æ¯ã€‚æ‹¦æˆªresponseæ—¶ï¼Œå¦‚æœæ–°çš„ClientResponseå¯¹è±¡æ˜¯é€šè¿‡<code>ClientResponse.from(response)</code>åˆ›å»ºçš„ï¼Œæ–°çš„responseæ˜¯ä¸ä¼šåŒ…å«æ—§çš„responseçš„bodyçš„ï¼Œå¦‚æœéœ€è¦å¯ä»¥é€šè¿‡<code>ClientResponse.Builder</code>çš„<code>body()</code>æŒ‡å®šï¼Œå…¶å®ƒè¯¸å¦‚headerã€cookieã€çŠ¶æ€ç æ˜¯ä¼šåŒ…å«çš„ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081&quot;</span>;</span><br><span class="line"><span class="type">WebClient</span> <span class="variable">webClient</span> <span class="operator">=</span> WebClient.builder().baseUrl(baseUrl).filter((request, next) -&gt; &#123;</span><br><span class="line">    <span class="type">ClientRequest</span> <span class="variable">newRequest</span> <span class="operator">=</span> ClientRequest.from(request).header(<span class="string">&quot;header1&quot;</span>, <span class="string">&quot;value1&quot;</span>).build();</span><br><span class="line">    Mono&lt;ClientResponse&gt; responseMono = next.exchange(newRequest);</span><br><span class="line">    <span class="keyword">return</span> Mono.fromCallable(() -&gt; &#123;</span><br><span class="line">        <span class="type">ClientResponse</span> <span class="variable">response</span> <span class="operator">=</span> responseMono.block();</span><br><span class="line">        <span class="type">ClientResponse</span> <span class="variable">newResponse</span> <span class="operator">=</span> ClientResponse.from(response).header(<span class="string">&quot;responseHeader1&quot;</span>, <span class="string">&quot;Value1&quot;</span>).build();</span><br><span class="line">        <span class="keyword">return</span> newResponse;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).build();</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœå®šä¹‰çš„FilteråªæœŸæœ›å¯¹æŸä¸ªæˆ–æŸäº›requestèµ·ä½œç”¨ï¼Œå¯ä»¥åœ¨Filterå†…éƒ¨é€šè¿‡requestçš„ç›¸å…³å±æ€§è¿›è¡Œæ‹¦æˆªï¼Œæ¯”å¦‚cookieä¿¡æ¯ã€headerä¿¡æ¯ã€è¯·æ±‚çš„æ–¹å¼æˆ–è¯·æ±‚çš„URLç­‰ã€‚ä¹Ÿå¯ä»¥é€šè¿‡<code>ClientRequest.attribute(attrName)</code>è·å–æŸä¸ªç‰¹å®šçš„å±æ€§ï¼Œè¯¥å±æ€§æ˜¯åœ¨è¯·æ±‚æ—¶é€šè¿‡<code>attribute(&quot;attrName&quot;, &quot;attrValue&quot;)</code>æŒ‡å®šçš„ã€‚è¿™è·Ÿåœ¨HttpServletRequestä¸­æ·»åŠ çš„å±æ€§çš„ä½œç”¨èŒƒå›´æ˜¯ç±»ä¼¼çš„ã€‚</li>
</ul>
</li>
<li>
<p>é…ç½®è¿æ¥æ± ï¼Œè¶…æ—¶æ—¶é—´ç­‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebClientConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ReactorResourceFactory <span class="title function_">resourceFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ReactorResourceFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReactorResourceFactory</span>();</span><br><span class="line">        factory.setUseGlobalResources(<span class="literal">false</span>);</span><br><span class="line">        factory.setConnectionProvider(ConnectionProvider.fixed(<span class="string">&quot;httpClient&quot;</span>, <span class="number">50</span>, <span class="number">10</span>));</span><br><span class="line">        factory.setLoopResources(LoopResources.create(<span class="string">&quot;httpClient&quot;</span>, <span class="number">50</span>, <span class="literal">true</span>));</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    WebClient <span class="title function_">webClient</span><span class="params">()</span> &#123;</span><br><span class="line">        Function&lt;HttpClient, HttpClient&gt; mapper = client -&gt;</span><br><span class="line">                client.tcpConfiguration(c -&gt;</span><br><span class="line">                        c.option(ChannelOption.CONNECT_TIMEOUT_MILLIS, <span class="number">10</span>)</span><br><span class="line">                                .option(TCP_NODELAY, <span class="literal">true</span>)</span><br><span class="line">                                .doOnConnected(conn -&gt; &#123;</span><br><span class="line">                                    conn.addHandlerLast(<span class="keyword">new</span> <span class="title class_">ReadTimeoutHandler</span>(<span class="number">10</span>));</span><br><span class="line">                                    conn.addHandlerLast(<span class="keyword">new</span> <span class="title class_">WriteTimeoutHandler</span>(<span class="number">10</span>));</span><br><span class="line">                                &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="type">ClientHttpConnector</span> <span class="variable">connector</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ReactorClientHttpConnector</span>(resourceFactory(), mapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> WebClient.builder().clientConnector(connector).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-can-kao" id="3ã€å‚è€ƒ">3ã€å‚è€ƒ</h3>
<p><a href="https://www.yiibai.com/jsoup/jsoup-quick-start.html">JSoupå¿«é€Ÿå…¥é—¨ - JSoupæ•™ç¨‹â„¢ (yiibai.com)</a></p>
<p><a href="https://www.cnblogs.com/grasp/p/12179906.html">Springçš„WebClientåŸºæœ¬ä½¿ç”¨ - xuanm - åšå®¢å›­ (cnblogs.com)</a></p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLå­¦ä¹ </title>
    <url>/posts/5303.html</url>
    <content><![CDATA[<p>â€”â€”æ‘˜å½•è‡ªã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ã€‹</p>
<span id="more"></span>
<h3 id="1-zi-fu-ji-he-bi-jiao-gui-ze" id="1ã€å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™">1ã€å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</h3>
<h4 id="1-1-zi-fu-ji-jian-jie" id="1-1ã€å­—ç¬¦é›†ç®€ä»‹">1.1ã€å­—ç¬¦é›†ç®€ä»‹</h4>
<p>å­—ç¬¦é›†æ˜¯äººä»¬æŠ½è±¡å‡ºæ¥ä¸€ä¸ªå­—ç¬¦é›†çš„æ¦‚å¿µæ¥æè¿°æŸä¸ªå­—ç¬¦èŒƒå›´çš„ç¼–ç è§„åˆ™ï¼Œç®€å•çš„æ¥è¯´å°±æ˜¯åœ¨æŸä¸ªèŒƒå›´çš„å­—ç¬¦å»ºç«‹ä¸äºŒè¿›åˆ¶æ•°æ®çš„æ˜ å°„å…³ç³»ï¼ˆç¼–ç è§„åˆ™ï¼‰ã€‚</p>
<h4 id="1-2-bi-jiao-gui-ze-jian-jie" id="1-2ã€æ¯”è¾ƒè§„åˆ™ç®€ä»‹">1.2ã€æ¯”è¾ƒè§„åˆ™ç®€ä»‹</h4>
<p>å¯¹æŸä¸ªå­—ç¬¦é›†ä¸­æ¯”è¾ƒå¤§å°çš„è§„åˆ™ã€‚æ¯”å¦‚å­—ç¬¦â€™aâ€˜çš„ç¼–ç ä¸º0x01,å­—ç¬¦â€™bâ€˜çš„ç¼–ç ä¸º0x02ï¼Œæ‰€ä»¥â€™aâ€™å°äºâ€™bâ€™ã€‚è¿™ç§ç®€å•çš„æ¯”è¾ƒè§„åˆ™ä¹Ÿå¯ä»¥ç§°ä¸ºäºŒè¿›åˆ¶æ¯”è¾ƒè§„åˆ™ã€‚ä½†åœ¨å¾ˆå¤šåœºåˆä¸‹ï¼Œè‹±æ–‡å­—ç¬¦éƒ½æ˜¯ä¸åŒºåˆ†å¤§å°å†™é¢ï¼Œä¹Ÿå°±æ˜¯â€™aâ€™å’Œâ€˜Aâ€™æ˜¯ç›¸ç­‰çš„ã€‚æ­¤æ—¶å°±ä¸å¯ä»¥ç®€å•ç²—æš´åœ°ä½¿ç”¨äºŒè¿›åˆ¶æ¯”è¾ƒè§„åˆ™ï¼Œæ­¤æ—¶å¯ä»¥è¿™æ ·æŒ‡å®šæ¯”è¾ƒè§„åˆ™ï¼š</p>
<ul>
<li>å°†ä¸¤ä¸ªå¤§å°å†™ä¸åŒçš„å­—ç¬¦éƒ½è½¬ä¸ºå¤§å†™æˆ–è€…å°å†™ã€‚</li>
<li>å†æ¯”è¾ƒè¿™ä¸¤ä¸ªå­—ç¬¦å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</li>
</ul>
<h4 id="1-3-chang-jian-de-zi-fu-ji" id="1-3ã€å¸¸è§çš„å­—ç¬¦é›†">1.3ã€å¸¸è§çš„å­—ç¬¦é›†</h4>
<ul>
<li>ASCIIå­—ç¬¦é›†ï¼ˆ1å­—èŠ‚ï¼‰ï¼šå…±æ”¶å½•128ä¸ªå­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ã€æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸€äº›ä¸å¯è§å­—ç¬¦ã€‚ç”±äºè¯¥å­—ç¬¦é›†æ€»å…±æ‰128ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¿›è¡Œç¼–ç ã€‚
<ul>
<li>â€˜Lâ€™ -&gt;01001100(åå…­è¿›åˆ¶0x4Cï¼Œåè¿›åˆ¶76)</li>
<li>â€˜Mâ€™ -&gt;01001101(åå…­è¿›åˆ¶0x4Dï¼Œåè¿›åˆ¶77)</li>
</ul>
</li>
<li>ISO 8859-1å­—ç¬¦é›†ï¼šå…±æ”¶å½•256ä¸ªå­—ç¬¦ï¼Œå®ƒåœ¨ASCIIå­—ç¬¦é›†çš„åŸºç¡€ä¸Šåˆæ‰©å……äº†128ä¸ªè¥¿æ¬§å¸¸ç”¨å­—ç¬¦ï¼ˆåŒ…æ‹¬å¾·æ³•ä¸¤å›½çš„å­—æ¯ï¼‰ã€‚ISO 8859-1å­—ç¬¦é›†ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¿›è¡Œç¼–ç ã€‚</li>
<li>GB2312å­—ç¬¦é›†ï¼ˆ1-2å­—èŠ‚ï¼‰ï¼šå…±æ”¶å½•6763ä¸ªæ±‰å­—ï¼Œå…¶ä¸­ä¸€çº§æ±‰å­—3755ä¸ªï¼ŒäºŒçº§æ±‰å­—3008ä¸ªï¼›åŒæ—¶ï¼ŒGB 2312æ”¶å½•äº†åŒ…æ‹¬æ‹‰ä¸å­—æ¯ã€å¸Œè…Šå­—æ¯ã€æ—¥æ–‡å¹³å‡ååŠç‰‡å‡åå­—æ¯ã€ä¿„è¯­è¥¿é‡Œå°”å­—æ¯åœ¨å†…çš„682ä¸ªå…¨è§’å­—ç¬¦ã€‚æ•´ä¸ªå­—ç¬¦é›†åˆ†æˆ94ä¸ªåŒºï¼Œæ¯åŒºæœ‰94ä¸ªä½ã€‚è¿™ç§å­—ç¬¦é›†å…¼å®¹ASCIIå­—ç¬¦é›†ï¼Œåœ¨ç¼–ç æ–¹å¼æœ‰äº›ç‰¹åˆ«ä¹‹å¤„ï¼šå¦‚æœå­—ç¬¦åœ¨ASCIIå­—ç¬¦é›†ä¸­ï¼Œåˆ™é‡‡ç”¨ä¸€å­—èŠ‚ç¼–ç ï¼›å¦åˆ™é‡‡ç”¨ä¸¤å­—èŠ‚ç¼–ç 
<ul>
<li>GB2312ï¼Œåˆç§°ä¸ºGB0ï¼Œç”±ä¸­å›½å›½å®¶æ ‡å‡†æ€»å±€å‘å¸ƒï¼Œ1981å¹´5æœˆ1æ—¥å®æ–½</li>
<li>GB2312æ ‡å‡†å…±æ”¶å½•6763ä¸ªæ±‰å­—ï¼Œå…¶ä¸­ä¸€çº§æ±‰å­—3755ä¸ªï¼ŒäºŒçº§æ±‰å­—3008ä¸ª</li>
<li>GB2312æ˜¯ä¸€ç§åŒºä½ç ã€‚åˆ†ä¸º94ä¸ªåŒº(01-94)ï¼Œæ¯åŒº94ä¸ªå­—ç¬¦(01-94)</li>
<li>01-09åŒºä¸ºç‰¹æ®Šç¬¦å·</li>
<li>10-15åŒºæ²¡æœ‰ç¼–ç </li>
<li>16-55åŒºä¸ºä¸€çº§æ±‰å­—ï¼ŒæŒ‰æ‹¼éŸ³æ’åºï¼Œå…±3755ä¸ª</li>
<li>56-87åŒºä¸ºäºŒçº§æ±‰å­—ï¼ŒæŒ‰éƒ¨é¦–ï¼ç¬”ç”»æ’åºï¼Œå…±3008ä¸ª</li>
<li>88-94åŒºæ²¡æœ‰ç¼–ç </li>
<li>GB2312åªæ˜¯ç¼–ç è¡¨ï¼Œåœ¨è®¡ç®—æœºä¸­é€šå¸¸éƒ½æ˜¯ç”¨&quot;EUC-CN&quot;è¡¨ç¤ºæ³•ï¼Œå³åœ¨æ¯ä¸ªåŒºä½åŠ ä¸Š0xA0æ¥è¡¨ç¤ºã€‚åŒºå’Œä½åˆ†åˆ«å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚</li>
</ul>
</li>
<li>GBKå­—ç¬¦é›†ï¼šåœ¨æ”¶å½•çš„å­—ç¬¦èŒƒå›´ä¸Šå¯¹GB2312å­—ç¬¦é›†è¿›è¡Œäº†æ‰©å……ï¼Œç¼–ç æ–¹å¼å…¼å®¹GB2312å­—ç¬¦é›†ã€‚</li>
<li>UTF-8å­—ç¬¦é›†ï¼šç¼–ç è§„åˆ™ï¼š
<ul>
<li>ä¸€ä¸ªUS-ASCIlå­—ç¬¦åªéœ€1å­—èŠ‚ç¼–ç ï¼ˆUnicodeèŒƒå›´ç”±U+0000~U+007Fï¼‰ã€‚</li>
<li>å¸¦æœ‰å˜éŸ³ç¬¦å·çš„æ‹‰ä¸æ–‡ã€å¸Œè…Šæ–‡ã€<a href="https://baike.baidu.com/item/%E8%A5%BF%E9%87%8C%E5%B0%94%E5%AD%97%E6%AF%8D/11058406">è¥¿é‡Œå°”å­—æ¯</a>ã€äºšç¾å°¼äºšè¯­ã€å¸Œä¼¯æ¥æ–‡ã€é˜¿æ‹‰ä¼¯æ–‡ã€å™åˆ©äºšæ–‡ç­‰å­—æ¯åˆ™éœ€è¦2å­—èŠ‚ç¼–ç ï¼ˆUnicodeèŒƒå›´ç”±U+0080~U+07FFï¼‰ã€‚</li>
<li>å…¶ä»–è¯­è¨€çš„å­—ç¬¦ï¼ˆåŒ…æ‹¬ä¸­æ—¥éŸ©æ–‡å­—ã€ä¸œå—äºšæ–‡å­—ã€ä¸­ä¸œæ–‡å­—ç­‰ï¼‰åŒ…å«äº†å¤§éƒ¨åˆ†å¸¸ç”¨å­—ï¼Œä½¿ç”¨3å­—èŠ‚ç¼–ç ã€‚</li>
<li>å…¶ä»–æå°‘ä½¿ç”¨çš„è¯­è¨€å­—ç¬¦ä½¿ç”¨4å­—èŠ‚ç¼–ç ã€‚</li>
</ul>
</li>
</ul>
<h4 id="1-4-my-sql-zhong-de-utf-8-he-utf-8-mb-4" id="1-4ã€MySQLä¸­çš„utf8å’Œutf8mb4">1.4ã€MySQLä¸­çš„utf8å’Œutf8mb4</h4>
<ul>
<li>utf8mb3ï¼šâ€œé˜‰å‰²â€è¿‡çš„utf-8å­—ç¬¦é›†ï¼Œä½¿ç”¨1~3å­—èŠ‚è¡¨ç¤ºå­—ç¬¦</li>
<li>utf8mb4ï¼šæ­£å®—çš„utf-8å­—ç¬¦é›†ï¼Œä½¿ç”¨1~4å­—èŠ‚è¡¨ç¤ºå­—ç¬¦</li>
</ul>
<p>åœ¨mysqlä¸­ï¼Œutf8æ˜¯utf8mb3çš„åˆ«åï¼Œå¦‚æœéœ€è¦å­˜å‚¨ç‰¹æ®Šçš„å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨4å­—ç¬¦ç¼–ç çš„utf8mb4</p>
<h4 id="1-5-my-sql-zhong-de-zi-fu-ji-he-bi-jiao-gui-ze" id="1-5ã€MySQLä¸­çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™">1.5ã€MySQLä¸­çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</h4>
<h5 id="cha-kan-dang-qian-mysql-zhi-chi-de-zi-fu-ji" id="æŸ¥çœ‹å½“å‰mysqlæ”¯æŒçš„å­—ç¬¦é›†">æŸ¥çœ‹å½“å‰mysqlæ”¯æŒçš„å­—ç¬¦é›†</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> charset <span class="keyword">like</span> <span class="string">&#x27;utf8%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/image-20220511172235587.png" alt="image-20220511172235587" /></p>
<p>Charset:å­—ç¬¦é›†åç§°<br />
Default_collation:é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™<br />
Maxlen:æœ€å¤§é•¿åº¦,utf8å­—ç¬¦é•¿åº¦ä¸º1-3æ‰€ä»¥MaxLenä¸º3 utf8mb4å­—ç¬¦é•¿åº¦1-4æ‰€ä»¥Maxlenä¸º4</p>
<h5 id="cha-kan-dang-qian-mysql-zhong-zhi-chi-de-bi-jiao-gui-ze" id="æŸ¥çœ‹å½“å‰mysqlä¸­æ”¯æŒçš„æ¯”è¾ƒè§„åˆ™">æŸ¥çœ‹å½“å‰mysqlä¸­æ”¯æŒçš„æ¯”è¾ƒè§„åˆ™</h5>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">collation</span> <span class="keyword">like</span> <span class="string">&#x27;utf8%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/image-20220511172428267.png" alt="image-20220511172428267" /></p>
<p>Default:æ˜¯å¦æ˜¯å½“å‰å­—ç¬¦é›†é»˜è®¤çš„æ¯”è¾ƒè§„åˆ™<br />
Complied:æ˜¯å¦å°†å­—ç¬¦é›†ç¼–è¯‘åˆ°äº†serverä¸­<br />
Sortlen:ä¸æ¯”è¾ƒå­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­éœ€è¦çš„å†…å­˜é‡æœ‰å…³</p>
<p>utf8_str1_str2<br />
str1ä»£è¡¨ç€æ¯”è¾ƒè§„åˆ™æ‰€ä½¿ç”¨çš„çš„è¯­è¨€,æ¯”å¦‚ utf8_polish_xxè¡¨ç¤ºæ³¢å…°è¯­çš„æ¯”è¾ƒè§„åˆ™<br />
str2ä»£è¡¨ç€å¦‚ä½•æ¯”è¾ƒ.<br />
é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šä½¿ç”¨çš„æ˜¯utf8_general_ciä¸utf8_bin,å‰è€…ä»£è¡¨ç€ä¸åŒºåˆ†å¤§å°å†™,åè€…ä»£è¡¨ç€åŒºåˆ†å¤§å°å†™</p>
<h5 id="zi-fu-ji-yu-bi-jiao-gui-ze-de-fen-lei" id="å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™çš„åˆ†ç±»">å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™çš„åˆ†ç±»</h5>
<p>æŒ‰ç…§åº”ç”¨çº§åˆ«å¯ä»¥åˆ†ä¸ºæœåŠ¡å™¨çº§åˆ« æ•°æ®åº“çº§åˆ« è¡¨çº§åˆ« åˆ—çº§åˆ«</p>
<p><strong>æœåŠ¡å™¨çº§åˆ«</strong></p>
<p>å­—ç¬¦é›†</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;character_set_server&#x27;</span>;</span><br><span class="line">é»˜è®¤: utf8</span><br></pre></td></tr></table></figure>
<p>æ¯”è¾ƒè§„åˆ™</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;collation_server&#x27;</span>;</span><br><span class="line">é»˜è®¤: utf8_general_ci</span><br></pre></td></tr></table></figure>
<p><strong>æ•°æ®åº“çº§åˆ«</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;character_set_database&#x27;</span>;</span><br><span class="line">é»˜è®¤: utf8</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;collation_database&#x27;</span>;</span><br><span class="line">é»˜è®¤:utf8_general_ci</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºæ•°æ®åº“æ—¶æŒ‡å®š:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> database xxx [<span class="type">character</span> <span class="keyword">set</span>  <span class="string">&#x27;å­—ç¬¦é›†å&#x27;</span> <span class="keyword">collate</span> <span class="string">&#x27;æ¯”è¾ƒè§„åˆ™åç§°&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p><strong>è¡¨çº§åˆ«</strong></p>
<p>è¡¨çº§åˆ«æ²¡æœ‰ä¸“é—¨å˜é‡è¡¨ç¤º<br />
åˆ›å»ºæ•°æ®è¡¨æ—¶æŒ‡å®š:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> xxx (xxx) [<span class="type">character</span> <span class="keyword">set</span> å­—ç¬¦é›†å <span class="keyword">collate</span> æ¯”è¾ƒè§„åˆ™åç§°]</span><br></pre></td></tr></table></figure>
<p><strong>åˆ—çº§åˆ«</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> xxx (</span><br><span class="line">id <span class="type">int</span> [<span class="type">character</span> <span class="keyword">set</span> å­—ç¬¦é›†åç§°] [<span class="keyword">collate</span> æ¯”è¾ƒè§„åˆ™åç§°]</span><br><span class="line">) [<span class="type">character</span> <span class="keyword">set</span>  å­—ç¬¦é›†å <span class="keyword">collate</span> æ¯”è¾ƒè§„åˆ™åç§°]</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåˆ—çº§åˆ«æ²¡æœ‰è®¾ç½®å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™,åˆ™ä½¿ç”¨è¡¨çš„,å¦‚æœè¡¨æ²¡æœ‰è®¾ç½®,åˆ™ä½¿ç”¨æ•°æ®åº“çš„,å¦‚æœæ•°æ®åº“æ²¡æœ‰è®¾ç½®åˆ™ä½¿ç”¨æœåŠ¡å™¨çš„.</p>
<p><strong>mysqlé€šä¿¡ä¸­çš„å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™</strong></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/image-20220511173659500.png" alt="image-20220511173659500" /><br />
<img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/image-20220511173739019.png" alt="image-20220511173739019" /></p>
<p><strong>character_set_client(æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚)</strong></p>
<p>æ­¤å˜é‡sessionçº§<br />
å½“æˆ‘ä»¬ç”¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡æ—¶,<code>character_set_client</code>æŒ‡çš„æ˜¯,æœåŠ¡ç«¯ä»¥ä»€ä¹ˆå­—ç¬¦é›†å»ç†è§£å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚,é»˜è®¤æ˜¯å½“å‰æ“ä½œç³»ç»Ÿå­—ç¬¦é›†.åœ¨å½“å‰seesionä¸­,æ­¤å˜é‡ä¸º<code>utf8</code>,å¦‚æœè®¾ç½®æˆ<code>gbk</code>,ä¼šå¯¼è‡´<code>select 'æˆ‘'</code>ä¼šä¹±ç ,å› ä¸ºæœåŠ¡ç«¯ä¼šæŠŠä»æœåŠ¡ç«¯æ”¶åˆ°çš„ä»¥utf8ç¼–ç çš„â€™æˆ‘â€™ä½¿ç”¨gbkè§£ç ,æ‰€ä»¥ä¼šä¹±ç ,.</p>
<p><strong>character_set_connection(æœåŠ¡ç«¯å¤„ç†è¯·æ±‚)</strong></p>
<p>æ­¤å˜é‡sessionçº§<br />
å½“æœåŠ¡å™¨å°†â€™æˆ‘â€™é€šè¿‡character_set_clientæ­£ç¡®è§£ç å,ä¼šæŒ‰ç…§character_set_connectionè¿›è¡Œç¼–ç ,ç„¶åæŒ‰ç…§collation_connectionæ¯”è¾ƒè§„åˆ™è¿›è¡Œæ¯”è¾ƒ,ä½†æ˜¯å¦‚æœæŸ¥è¯¢ä¸­æœ‰åˆ—æ¯”å¦‚<code>select 'æˆ‘'=name from aaa</code>æ­¤æ—¶ä¼šä¼˜å…ˆé‡‡ç”¨nameåˆ—çš„å­—ç¬¦é›†ä¸æ¯”è¾ƒè§„åˆ™è¿›è¡Œåˆ¤æ–­</p>
<p><strong>character_set_results(æœåŠ¡ç«¯å“åº”è¯·æ±‚)</strong></p>
<p>æ­¤å˜é‡sessionçº§<br />
æœåŠ¡å™¨å°†è¦å“åº”çš„æ•°æ®ä»¥ä»€ä¹ˆæ ¼å¼è¿›è¡Œç¼–ç ,æ¯”å¦‚<code>select name from aaa</code> nameæ˜¯ä»¥utf8ç¼–ç çš„,character_set_resultsæ˜¯gbkç¼–ç ,é‚£ä¹ˆä¼šæŠŠæŸ¥è¯¢çš„ç»“æœä»¥gbkç¼–ç å¯¹å®¢æˆ·ç«¯å“åº”</p>
<p><strong>å®¢æˆ·ç«¯æ¥æ”¶è¯·æ±‚</strong></p>
<p>å®¢æˆ·ç«¯æ¥æ”¶å“åº”çš„è¯·æ±‚å,ä¼šä»¥ä»€ä¹ˆç¼–ç çš„æ–¹å¼æ˜¾ç¤ºå‡ºæ¥,é»˜è®¤å°±æ˜¯å½“å‰ç³»ç»Ÿçš„å­—ç¬¦é›†</p>
<h3 id="2-inno-db-ji-lu-cun-chu-jie-gou" id="2ã€InnoDBè®°å½•å­˜å‚¨ç»“æ„">2ã€InnoDBè®°å½•å­˜å‚¨ç»“æ„</h3>
<h4 id="2-1-inno-db-ye-jian-jie" id="2-1ã€InnoDBé¡µç®€ä»‹">2.1ã€InnoDBé¡µç®€ä»‹</h4>
<p>é¡µæ˜¯Innodbä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿæ˜¯Innodbç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œé»˜è®¤å¤§å°ä¸º16KBã€‚</p>
<h4 id="2-2-inno-db-xing-ge-shi" id="2-2ã€InnoDBè¡Œæ ¼å¼">2.2ã€InnoDBè¡Œæ ¼å¼</h4>
<p>æˆ‘ä»¬å¹³æ—¶æ˜¯ä»¥è®°å½•ä¸ºå•ä½æ¥å‘è¡¨ä¸­æ’å…¥æ•°æ®çš„ï¼Œè¿™äº›è®°å½•åœ¨ç£ç›˜ä¸Šçš„å­˜æ”¾æ–¹å¼ä¹Ÿè¢«ç§°ä¸ºè¡Œæ ¼å¼æˆ–è€…è®°å½•æ ¼å¼ã€‚InnoDBå­˜å‚¨å¼•æ“è®¾è®¡äº†4ç§ä¸åŒç±»å‹çš„è¡Œæ ¼å¼ï¼Œåˆ†åˆ«æ˜¯Compactã€Redundantã€Dynamicå’ŒCompressedè¡Œæ ¼å¼ã€‚</p>
<h4 id="2-3-xing-ji-lu-ge-shi-de-fen-lei-he-jie-shao" id="2-3ã€è¡Œè®°å½•æ ¼å¼çš„åˆ†ç±»å’Œä»‹ç»">2.3ã€è¡Œè®°å½•æ ¼å¼çš„åˆ†ç±»å’Œä»‹ç»</h4>
<p>åœ¨æ—©æœŸçš„InnoDBç‰ˆæœ¬ä¸­ï¼Œç”±äºæ–‡ä»¶æ ¼å¼åªæœ‰ä¸€ç§ï¼Œå› æ­¤ä¸éœ€è¦ä¸ºæ­¤æ–‡ä»¶æ ¼å¼å‘½åã€‚éšç€InnoDBå¼•æ“çš„å‘å±•ï¼Œå¼€å‘å‡ºäº†ä¸å…¼å®¹æ—©æœŸç‰ˆæœ¬çš„æ–°æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºæ”¯æŒæ–°çš„åŠŸèƒ½ã€‚ä¸ºäº†åœ¨å‡çº§å’Œé™çº§æƒ…å†µä¸‹å¸®åŠ©ç®¡ç†ç³»ç»Ÿçš„å…¼å®¹æ€§ï¼Œä»¥åŠè¿è¡Œä¸åŒçš„MySQLç‰ˆæœ¬ï¼ŒInnoDBå¼€å§‹ä½¿ç”¨å‘½åçš„æ–‡ä»¶æ ¼å¼ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/b2caf96f361aa29ff2cd1bb511c638a0.png" alt="MySQLæ€ä¹ˆä»äºŒè¿›åˆ¶å†…å®¹çœ‹InnoDBè¡Œæ ¼å¼" /></p>
<p>åœ¨msyql 5.7.9åŠä»¥åç‰ˆæœ¬ï¼Œé»˜è®¤è¡Œæ ¼å¼ç”±innodb_default_row_formatå˜é‡å†³å®šï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯dynamic</p>
<h4 id="2-4-xing-ge-shi" id="2-4ã€è¡Œæ ¼å¼">2.4ã€è¡Œæ ¼å¼</h4>
<h5 id="compact" id="COMPACT">COMPACT</h5>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/b93590226e885d956bfd5a96887c3fd7.png" alt="MySQLæ€ä¹ˆä»äºŒè¿›åˆ¶å†…å®¹çœ‹InnoDBè¡Œæ ¼å¼" /></p>
<p><strong>å˜é•¿å­—æ®µåˆ—è¡¨</strong></p>
<p>MySQLæ”¯æŒä¸€äº›å˜é•¿çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚VARCHAR(M)ã€VARBINARY(M)ã€å„ç§TEXTç±»å‹ï¼Œå„ç§BLOBç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæ‹¥æœ‰è¿™äº›æ•°æ®ç±»å‹çš„åˆ—ç§°ä¸ºå˜é•¿å­—æ®µï¼Œå˜é•¿å­—æ®µä¸­å­˜å‚¨å¤šå°‘å­—èŠ‚çš„æ•°æ®æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å­˜å‚¨çœŸå®æ•°æ®çš„æ—¶å€™éœ€è¦é¡ºä¾¿æŠŠè¿™äº›æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¹Ÿå­˜èµ·æ¥ã€‚å¦‚æœè¯¥å¯å˜å­—æ®µå…è®¸å­˜å‚¨çš„æœ€å¤§å­—èŠ‚æ•°ï¼ˆMÃ—Wï¼‰è¶…è¿‡255å­—èŠ‚å¹¶ä¸”çœŸå®å­˜å‚¨çš„å­—èŠ‚æ•°ï¼ˆLï¼‰è¶…è¿‡127å­—èŠ‚ï¼Œåˆ™ä½¿ç”¨2ä¸ªå­—èŠ‚è®°å½•ï¼Œå¦åˆ™ä½¿ç”¨1ä¸ªå­—èŠ‚è®°å½•ã€‚</p>
<p>é—®é¢˜ä¸€ï¼šé‚£ä¹ˆä¸ºä»€ä¹ˆç”¨128ä½œä¸ºåˆ†ç•Œçº¿å‘¢ï¼Ÿ ä¸€ä¸ªå­—èŠ‚å¯ä»¥æœ€å¤šè¡¨ç¤º255ï¼Œä½†æ˜¯MySQLè®¾è®¡é•¿åº¦è¡¨ç¤ºæ—¶ï¼Œä¸ºäº†åŒºåˆ†æ˜¯å¦æ˜¯ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºé•¿åº¦ï¼Œè§„å®šï¼Œå¦‚æœæœ€é«˜ä½ä¸º1ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºé•¿åº¦ï¼Œå¦åˆ™å°±æ˜¯ä¸€ä¸ªå­—èŠ‚ã€‚ä¾‹å¦‚ï¼Œ01111111ï¼Œè¿™ä¸ªå°±ä»£è¡¨é•¿åº¦ä¸º127ï¼Œè€Œå¦‚æœé•¿åº¦æ˜¯128ï¼Œå°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯10000000 10000000ï¼Œé¦–ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ä¸º1ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºé•¿åº¦çš„å¼€å¤´ï¼Œç¬¬äºŒä¸ªå­—èŠ‚å¯ä»¥ç”¨æ‰€æœ‰ä½è¡¨ç¤ºé•¿åº¦ï¼Œå¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQLé‡‡å–Little Endiançš„è®¡æ•°æ–¹å¼ï¼Œä½ä½åœ¨å‰ï¼Œé«˜ä½åœ¨åï¼Œæ‰€ä»¥129å°±æ˜¯10000001 10000000ã€‚åŒæ—¶ï¼Œè¿™ç§æ ‡è¯†æ–¹å¼ï¼Œæœ€å¤§é•¿åº¦å°±æ˜¯ 2^15-1=32767ï¼Œä¹Ÿå°±æ˜¯32KBã€‚</p>
<p>é—®é¢˜äºŒï¼šå¦‚æœä¸¤ä¸ªå­—èŠ‚ä¹Ÿä¸å¤Ÿè¡¨ç¤ºçš„é•¿åº¦ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ innoDBé¡µå¤§å°é»˜è®¤ä¸º16KBï¼Œå¯¹äºä¸€äº›å ç”¨å­—èŠ‚æ•°éå¸¸å¤šçš„å­—æ®µï¼Œæ¯”æ–¹è¯´æŸä¸ªå­—æ®µé•¿åº¦å¤§äºäº†16KBï¼Œé‚£ä¹ˆå¦‚æœè¯¥è®°å½•åœ¨å•ä¸ªé¡µé¢ä¸­æ— æ³•å­˜å‚¨æ—¶ï¼ŒInnoDBä¼šæŠŠä¸€éƒ¨åˆ†æ•°æ®å­˜æ”¾åˆ°æ‰€è°“çš„æº¢å‡ºé¡µä¸­ï¼Œåœ¨å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨å¤„åªå­˜å‚¨ç•™åœ¨æœ¬é¡µé¢ä¸­çš„é•¿åº¦ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚ä¹Ÿå¯ä»¥å­˜æ”¾ä¸‹æ¥ã€‚è¿™ä¸ªæº¢å‡ºé¡µæœºåˆ¶å‚è€ƒåé¢çš„æ•°æ®æº¢å‡ºã€‚</p>
<p><strong>NULLå€¼åˆ—è¡¨</strong></p>
<p>è¡¨ä¸­çš„æŸäº›åˆ—å¯èƒ½å­˜å‚¨NULLå€¼ï¼Œå¦‚æœæŠŠè¿™äº›NULLå€¼éƒ½æ”¾åˆ°è®°å½•çš„çœŸå®æ•°æ®ä¸­å­˜å‚¨ä¼šå¾ˆå åœ°æ–¹ï¼Œæ‰€ä»¥Compactè¡Œæ ¼å¼æŠŠè¿™äº›å€¼ä¸ºNULLçš„åˆ—ç»Ÿä¸€ç®¡ç†èµ·æ¥ï¼Œå­˜å‚¨åˆ°NULLå€¼åˆ—è¡¨ã€‚æ¯ä¸ªå…è®¸å­˜å‚¨NULLçš„åˆ—å¯¹åº”ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼ŒäºŒè¿›åˆ¶ä½çš„å€¼ä¸º1æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ºNULLã€‚äºŒè¿›åˆ¶ä½çš„å€¼ä¸º0æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ä¸ºNULLã€‚</p>
<p><strong>è®°å½•å¤´ä¿¡æ¯</strong></p>
<p>ç”¨äºæè¿°è®°å½•çš„è®°å½•å¤´ä¿¡æ¯ï¼Œå®ƒæ˜¯ç”±å›ºå®šçš„5ä¸ªå­—èŠ‚ç»„æˆã€‚5ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯40ä¸ªäºŒè¿›åˆ¶ä½ï¼Œä¸åŒçš„ä½ä»£è¡¨ä¸åŒçš„æ„æ€ã€‚</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>é•¿åº¦ï¼ˆbitï¼‰</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>é¢„ç•™ä½1</td>
<td>1</td>
<td>æ²¡æœ‰ä½¿ç”¨</td>
</tr>
<tr>
<td>é¢„ç•™ä½2</td>
<td>1</td>
<td>æ²¡æœ‰ä½¿ç”¨</td>
</tr>
<tr>
<td>delete_mask</td>
<td>1</td>
<td>æ ‡è®°è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤</td>
</tr>
<tr>
<td>min_rec_mask</td>
<td>1</td>
<td>B+æ ‘çš„æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°</td>
</tr>
<tr>
<td>n_owned</td>
<td>4</td>
<td>è¡¨ç¤ºå½“å‰è®°å½•æ‹¥æœ‰çš„è®°å½•æ•°</td>
</tr>
<tr>
<td>heap_no</td>
<td>13</td>
<td>è¡¨ç¤ºå½“å‰è®°å½•åœ¨é¡µçš„ä½ç½®ä¿¡æ¯</td>
</tr>
<tr>
<td>record_type</td>
<td>3</td>
<td>è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ0 è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ1 è¡¨ç¤ºB+æ ‘éå¶å­èŠ‚ç‚¹è®°å½•ï¼Œ2 è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ3 è¡¨ç¤ºæœ€å¤§è®°å½•</td>
</tr>
<tr>
<td>next_record</td>
<td>16</td>
<td>è¡¨ç¤ºä¸‹ä¸€æ¡è®°å½•çš„ç›¸å¯¹ä½ç½®</td>
</tr>
</tbody>
</table>
<p><strong>éšè—åˆ—</strong></p>
<p>è®°å½•çš„çœŸå®æ•°æ®é™¤äº†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„åˆ—çš„æ•°æ®ä»¥å¤–ï¼ŒMySQLä¼šä¸ºæ¯ä¸ªè®°å½•é»˜è®¤çš„æ·»åŠ ä¸€äº›åˆ—ï¼ˆä¹Ÿç§°ä¸ºéšè—åˆ—ï¼‰ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>DB_ROW_ID(row_id)ï¼šéå¿…é¡»ï¼Œ6å­—èŠ‚ï¼Œè¡¨ç¤ºè¡ŒIDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•</li>
<li>DB_TRX_IDï¼šå¿…é¡»ï¼Œ6å­—èŠ‚ï¼Œè¡¨ç¤ºäº‹åŠ¡ID</li>
<li>DB_ROLL_PTRï¼šå¿…é¡»ï¼Œ7å­—èŠ‚ï¼Œè¡¨ç¤ºå›æ»šæŒ‡é’ˆ</li>
</ul>
<p>InnoDBè¡¨å¯¹ä¸»é”®çš„ç”Ÿæˆç­–ç•¥æ˜¯ï¼šä¼˜å…ˆä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰ä¸»é”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œåˆ™é€‰å–ä¸€ä¸ªUniqueé”®ä½œä¸ºä¸»é”®ï¼Œå¦‚æœè¡¨ä¸­è¿Unique é”®éƒ½æ²¡æœ‰å®šä¹‰çš„è¯ï¼Œåˆ™InnoDBä¼šä¸ºè¡¨é»˜è®¤æ·»åŠ ä¸€ä¸ªåä¸ºrow_idçš„éšè—åˆ—ä½œä¸ºä¸»é”®ã€‚</p>
<p>DB_TRX_IDï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºtrx_idï¼‰ å’ŒDB_ROLL_PTRï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºroll_ptrï¼‰ è¿™ä¸¤ä¸ªåˆ—æ˜¯å¿…æœ‰çš„ï¼Œä½†æ˜¯row_idæ˜¯å¯é€‰çš„ï¼ˆåœ¨æ²¡æœ‰è‡ªå®šä¹‰ä¸»é”®ä»¥åŠUnique é”®çš„æƒ…å†µä¸‹æ‰ä¼šæ·»åŠ è¯¥åˆ—ï¼‰ã€‚</p>
<p>å…¶ä»–çš„è¡Œæ ¼å¼å’ŒCompactè¡Œæ ¼å¼å·®åˆ«ä¸å¤§ã€‚</p>
<h5 id="redundant-xing-ge-shi" id="Redundantè¡Œæ ¼å¼">Redundantè¡Œæ ¼å¼</h5>
<p>Redundantè¡Œæ ¼å¼æ˜¯MySQL5.0ä¹‹å‰ç”¨çš„ä¸€ç§è¡Œæ ¼å¼ï¼Œä¸äºˆæ·±ç©¶ã€‚</p>
<h5 id="dynamic-xing-ge-shi" id="Dynamicè¡Œæ ¼å¼">Dynamicè¡Œæ ¼å¼</h5>
<p>MySQL5.7çš„é»˜è®¤è¡Œæ ¼å¼å°±æ˜¯Dynamicï¼ŒDynamicè¡Œæ ¼å¼å’ŒCompactè¡Œæ ¼å¼æŒºåƒï¼Œåªä¸è¿‡åœ¨å¤„ç†è¡Œæº¢å‡ºæ•°æ®æ—¶æœ‰æ‰€ä¸åŒã€‚</p>
<h5 id="compressed-xing-ge-shi" id="Compressedè¡Œæ ¼å¼">Compressedè¡Œæ ¼å¼</h5>
<p>Compressedè¡Œæ ¼å¼åœ¨Dynamicè¡Œæ ¼å¼çš„åŸºç¡€ä¸Šä¼šé‡‡ç”¨å‹ç¼©ç®—æ³•å¯¹é¡µé¢è¿›è¡Œå‹ç¼©ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚ä»¥zlibçš„ç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå› æ­¤å¯¹äºBLOBã€TEXTã€VARCHARè¿™ç±»å¤§é•¿åº¦æ•°æ®èƒ½å¤Ÿè¿›è¡Œæœ‰æ•ˆçš„å­˜å‚¨ï¼ˆå‡å°‘40%ï¼Œä½†å¯¹CPUè¦æ±‚æ›´é«˜ï¼‰ã€‚</p>
<h5 id="shu-ju-yi-chu" id="æ•°æ®æº¢å‡º">æ•°æ®æº¢å‡º</h5>
<p>å¦‚æœæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¡¨ï¼Œè¡¨ä¸­åªæœ‰ä¸€ä¸ªVARCHARå­—æ®µï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">CREATE</span> <span class="variable">TABLE</span> <span class="function"><span class="title">test_varchar</span>( <span class="variable">c</span> <span class="title">VARCHAR</span>(<span class="number">60000</span>))</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åå¾€è¿™ä¸ªå­—æ®µæ’å…¥60000ä¸ªå­—ç¬¦ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå‰è¾¹è¯´è¿‡ï¼ŒMySQLä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼Œä¹Ÿå°±æ˜¯è¯´MySQLæ˜¯ä»¥é¡µä¸ºåŸºæœ¬å•ä½æ¥ç®¡ç†å­˜å‚¨ç©ºé—´çš„ï¼Œæˆ‘ä»¬çš„è®°å½•éƒ½ä¼šè¢«åˆ†é…åˆ°æŸä¸ªé¡µä¸­å­˜å‚¨ã€‚è€Œä¸€ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯16KBï¼Œä¹Ÿå°±æ˜¯16384å­—èŠ‚ï¼Œè€Œä¸€ä¸ªVARCHAR(M)ç±»å‹çš„åˆ—å°±æœ€å¤šå¯ä»¥å­˜å‚¨65532ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±å¯èƒ½é€ æˆä¸€ä¸ªé¡µå­˜æ”¾ä¸äº†ä¸€æ¡è®°å½•çš„æƒ…å†µã€‚</p>
<p>åœ¨Compactå’ŒRedundantè¡Œæ ¼å¼ä¸­ï¼Œå¯¹äºå ç”¨å­˜å‚¨ç©ºé—´éå¸¸å¤§çš„åˆ—ï¼Œåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„åªä¼šå­˜å‚¨è¯¥åˆ—çš„è¯¥åˆ—çš„å‰768ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œç„¶åæŠŠå‰©ä½™çš„æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å‡ ä¸ªå…¶ä»–çš„é¡µä¸­ï¼Œè®°å½•çš„çœŸå®æ•°æ®å¤„ç”¨20ä¸ªå­—èŠ‚ï¼ˆ768å­—èŠ‚å20ä¸ªå­—èŠ‚ï¼‰å­˜å‚¨æŒ‡å‘è¿™äº›é¡µçš„åœ°å€ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå«åšè¡Œæº¢å‡ºï¼Œå­˜å‚¨è¶…å‡º768å­—èŠ‚çš„é‚£äº›é¡µé¢ä¹Ÿè¢«ç§°ä¸ºæº¢å‡ºé¡µã€‚</p>
<p>Dynamicå’ŒCompressedè¡Œæ ¼å¼ï¼Œä¸ä¼šåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å­—æ®µçœŸå®æ•°æ®çš„å‰768ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰çš„å­—èŠ‚éƒ½å­˜å‚¨åˆ°å…¶ä»–é¡µé¢ä¸­ï¼Œåªåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„å­˜å‚¨å…¶ä»–é¡µé¢çš„åœ°å€ã€‚</p>
<h3 id="3-inno-db-de-shu-ju-ye" id="3ã€InnoDBçš„æ•°æ®é¡µ">3ã€InnoDBçš„æ•°æ®é¡µ</h3>
<h4 id="3-1-gai-nian-amp-fen-lei" id="3-1-æ¦‚å¿µ-åˆ†ç±»">3.1 æ¦‚å¿µ&amp;åˆ†ç±»</h4>
<h5 id="strong-gai-nian-strong" id="æ¦‚å¿µ"><strong>æ¦‚å¿µ</strong></h5>
<p>InnoDB ä¼šæŠŠå­˜å‚¨çš„æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªã€Œé¡µã€ï¼Œä»¥é¡µä½œä¸ºç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªé¡µçš„é»˜è®¤å¤§å°ä¸º 16KBï¼ŒæŸ¥çœ‹å‘½ä»¤å¦‚ä¸‹ï¼ˆå•ä½æ˜¯å­—èŠ‚ï¼‰ï¼š</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="section">mysql&gt; show status like &#x27;innodb_page_size&#x27;;</span></span><br><span class="line"><span class="section">+------------------+-------+</span></span><br><span class="line"><span class="section">| Variable_name    | Value |</span></span><br><span class="line"><span class="section">+------------------+-------+</span></span><br><span class="line"><span class="section">| Innodb_page_size | 16384 |</span></span><br><span class="line"><span class="section">+------------------+-------+</span></span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥æŠŠã€Œé¡µã€ç†è§£ä¸ºä¸€ä¸ªå®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨æ˜¯ç”¨æ¥å­˜å‚¨ã€Œè®°å½•ã€çš„ã€‚</p>
<h5 id="strong-fen-lei-strong" id="åˆ†ç±»"><strong>åˆ†ç±»</strong></h5>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒInnoDB ä¸­çš„ã€Œé¡µã€å¹¶éåªæœ‰ä¸€ç§ï¼Œæ¯”å¦‚æœ‰å­˜æ”¾ Insert Buffer çš„é¡µã€å­˜æ”¾ undo log çš„é¡µã€å­˜æ”¾æ•°æ®çš„é¡µç­‰ç­‰ã€‚å…¶ä¸­æˆ‘ä»¬æœ€å…³æ³¨çš„è¿˜æ˜¯å­˜æ”¾æˆ‘ä»¬è¡¨æ•°æ®çš„é¡µï¼Œåˆç§°ã€Œç´¢å¼•é¡µã€ï¼Œæˆ–è€…æ•°æ®é¡µã€‚</p>
<p>ä¸‹é¢åˆ†æå’Œä»‹ç»æ•°æ®é¡µã€‚</p>
<h4 id="3-2-shu-ju-ye-jie-gou" id="3-2-æ•°æ®é¡µç»“æ„">3.2 æ•°æ®é¡µç»“æ„</h4>
<h5 id="strong-gai-shu-strong" id="æ¦‚è¿°"><strong>æ¦‚è¿°</strong></h5>
<p>InnoDB æ•°æ®é¡µçš„ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/v2-c5c9a86badc7f63ef4aa8cbf737e18cb_720w.jpg" alt="img" /></p>
<p>å®ƒç”±ä¸ƒéƒ¨åˆ†æ„æˆï¼Œç®€ä»‹å¦‚ä¸‹ï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/v2-62671ca47bbd785000cd4fbdfd5b52e8_720w.jpg" alt="img" /></p>
<h5 id="strong-ji-lu-cha-ru-guo-cheng-strong" id="è®°å½•æ’å…¥è¿‡ç¨‹"><strong>è®°å½•æ’å…¥è¿‡ç¨‹</strong></h5>
<p>åœ¨æ•°æ®é¡µä¸­ï¼Œå½“è®°å½•ä¸ºç©ºæ—¶ï¼ŒUser Records æ˜¯ä¸å­˜åœ¨çš„ã€‚éšç€è®°å½•çš„ä¸€æ¡æ¡æ’å…¥ï¼Œä¼šä¸æ–­ä» Free Space å¼€è¾Ÿç©ºé—´åˆ†é…ç»™è®°å½•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/v2-f0e154fa8e3f1b18d9d7650223735763_720w.jpg" alt="img" /></p>
<h5 id="strong-ye-jie-gou-fen-xi-strong" id="é¡µç»“æ„åˆ†æ"><strong>é¡µç»“æ„åˆ†æ</strong></h5>
<p><strong>è®°å½•å¤´ä¿¡æ¯</strong></p>
<p>ä¸ºä¾¿äºæè¿°è®°å½•æ˜¯å¦‚ä½•åœ¨é¡µä¸­å­˜å‚¨çš„ï¼Œè¿™é‡Œå…ˆè´´ä¸€ä¸‹å‰æ–‡æåˆ°çš„è®°å½•å¤´ä¿¡æ¯ï¼š</p>
<p><img data-src="https://pic2.zhimg.com/80/v2-dab1c35a4ec043e0528b7f965ba58e39_720w.jpg" alt="img" /></p>
<p>å®ƒä»¬çš„å„ä¸ªéƒ¨åˆ†è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>å‰ä¸¤ä¸ªé¢„ç•™ä½ï¼šæš‚æ— ç”¨å¤„ï¼ˆå„å  1 ä½ï¼‰</p>
</li>
<li>
<p>delete_maskï¼š1 ä½ï¼Œæ ‡è®°è¯¥æ¡è®°å½•æ˜¯å¦è¢«åˆ é™¤</p>
</li>
<li>
<p>min_rec_maskï¼š1ä½ï¼ŒB+æ ‘æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°</p>
</li>
<li>
<p>n_ownedï¼š4 ä½ï¼Œå½“å‰è®°å½•æ‹¥æœ‰çš„è®°å½•æ•°</p>
</li>
<li>
<p>heap_noï¼š13 ä½ï¼Œå½“å‰è®°å½•åœ¨è®°å½•å †çš„ä½ç½®</p>
</li>
<li>
<p>record_typeï¼š3 ä½ï¼Œè®°å½•çš„ç±»å‹</p>
</li>
<li>
<p>0ï¼šæ™®é€šè®°å½•â€¢  1ï¼šB+ æ ‘éå¶å­èŠ‚ç‚¹ï¼ˆåæ–‡å†ä»‹ç»ï¼Œæš‚æ—¶ç•¥è¿‡ï¼‰â€¢  2ï¼šæœ€å°è®°å½•â€¢  3ï¼šæœ€å¤§è®°å½•</p>
</li>
<li>
<p>next_recordï¼š16 ä½ï¼Œä¿å­˜ä¸‹ä¸€æ¡è®°å½•çš„ç›¸å¯¹ä½ç½®</p>
</li>
<li>
<p>Infimum + Supremum</p>
</li>
</ul>
<p>è¿™éƒ¨åˆ†å­˜å‚¨çš„æ˜¯å›ºå®šçš„ä¸¤æ¡è®°å½•ï¼Œåˆ†åˆ«ä¸ºæ•°æ®é¡µä¸­çš„ã€Œæœ€å°è®°å½•ã€å’Œã€Œæœ€å¤§è®°å½•ã€ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://pic2.zhimg.com/80/v2-14d15dc7eee612a0c2ade452a443dd99_720w.jpg" alt="img" /></p>
<p>PS: ç”±äºè¿™ä¸¤æ¡è®°å½•ä¸æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ï¼Œå› æ­¤ä¸å­˜å‚¨åœ¨ User Records ç©ºé—´ã€‚</p>
<p><strong>Free Space</strong></p>
<p>ç©ºé—²ç©ºé—´ï¼Œæ•°æ®é¡µä¸­å°šæœªä½¿ç”¨çš„éƒ¨åˆ†ã€‚</p>
<p><strong>User Records</strong></p>
<p>ç”¨æˆ·è®°å½•ï¼Œè¿™é‡Œå°±æ˜¯å­˜å‚¨æˆ‘ä»¬è®°å½•çš„åœ°æ–¹ã€‚</p>
<p>ä¸Šé¢çš„ã€Œæœ€å°è®°å½•ã€å’Œã€Œæœ€å¤§è®°å½•ã€æ˜¯å¦‚ä½•è·Ÿæˆ‘ä»¬çš„è®°å½•å…³è”èµ·æ¥çš„å‘¢ï¼Ÿ</p>
<p>è¿™æ—¶å€™ next_record çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº†ã€‚è¿™ä¸¤æ¡è®°å½•å’Œæˆ‘ä»¬è‡ªå®šä¹‰çš„è®°å½•ä¹‹é—´æ˜¯é€šè¿‡ next_record å…³è”èµ·æ¥çš„ï¼Œè‡ªå®šä¹‰çš„è®°å½•ä¹‹é—´ä¹Ÿæ˜¯é€šè¿‡ next_record å…³è”èµ·æ¥çš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/v2-4ab3fd1b95109efb9b32f838e3570b26_720w.jpg" alt="img" /></p>
<p>å³ï¼Œã€Œæœ€å°è®°å½•ã€çš„ next_record æŒ‡å‘ç¬¬ä¸€æ¡æ•°æ®è®°å½•ï¼Œæœ€åä¸€æ¡æ•°æ®è®°å½•çš„ next_record æŒ‡å‘ã€Œæœ€å¤§è®°å½•ã€ã€‚æ•°æ®è®°å½•ä¹‹é—´æ˜¯æŒ‰ç…§ä¸»é”®çš„é¡ºåºä»å°åˆ°å¤§æ’åºçš„ã€‚</p>
<p>PS: æ­¤å¤„çš„ (1,100,â€˜aaaaâ€™), (2,200,â€˜bbbbâ€™) ç­‰å‡ æ¡å†…å®¹æ˜¯è‡ªå®šä¹‰çš„æ•°æ®ã€‚<br />
è®°å½•ä¸­çš„è“è‰²éƒ¨åˆ†ä¸ºé¢å¤–ä¿¡æ¯ï¼Œæ©™è‰²éƒ¨åˆ†ä¸ºè®°å½•æ•°æ®ã€‚</p>
<p><strong>Page Directory</strong></p>
<p>ä¸Šé¢æ˜¯ä»¥ 4 æ¡è®°å½•ä¸¾ä¾‹çš„ï¼Œå¦‚æœè¦æŸ¥æ‰¾å…¶ä¸­ä¸€æ¡ï¼Œå³ä½¿éå†ä¹Ÿä¸ä¼šå¾ˆè€—æ—¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœè®°å½•æ•°é‡ä¸€ç›´å¢åŠ ï¼Œæ¯”å¦‚åˆ°ä¸€åƒæ¡ã€ä¸€ä¸‡æ¡ç”šè‡³æ›´å¤šï¼ˆå‡è®¾ä¸€ä¸ªæ•°æ®é¡µèƒ½å­˜çš„ä¸‹ï¼‰ï¼Œæˆ‘ä»¬å¦‚ä½•å»æŸ¥æ‰¾å…¶ä¸­çš„ä¸€æ¡è®°å½•å‘¢ï¼Ÿè¿™æ ·å†å»éå†å²‚ä¸æ˜¯å¾ˆç¬¨ï¼Ÿ</p>
<p>å°±åƒæˆ‘ä»¬ä»ä¸€æœ¬ä¹¦é‡Œæ‰¾æŸäº›å†…å®¹ï¼Œå½“åªæœ‰å‡ é¡µçš„æ—¶å€™å¾ˆå®¹æ˜“å°±èƒ½æ‰¾åˆ°ï¼›ä½†å¦‚æœæœ‰å¥½å‡ ç™¾é¡µï¼Œæ€»ä¸èƒ½ä¸€é¡µä¸€é¡µå»ç¿»å§ï¼Ÿ</p>
<p>æˆ‘ä»¬é€šå¸¸æ˜¯å…ˆæŸ¥æ‰¾ç›®å½•ï¼Œæ‰¾åˆ°åœ¨å“ªä¸€é¡µï¼Œç„¶åç›´æ¥ç¿»åˆ°é‚£ä¸€é¡µã€‚é¡µç›®å½•çš„ä½œç”¨è·Ÿä¹¦çš„ç›®å½•å·®ä¸å¤šã€‚</p>
<p>ç”±äºè®°å½•ä¹‹é—´æ˜¯æŒ‰ä¸»é”®æ’åºçš„ï¼Œå¯ä»¥æŠŠå®ƒä»¬ä»å°åˆ°å¤§åˆ†æˆä¸€ä¸ªä¸ªçš„ã€Œç»„ã€ï¼Œæ¯ç»„åŒ…å«å¾ˆå°‘çš„å‡ æ¡è®°å½•ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/v2-5c5f873aa349954a66f580866d184b40_720w.jpg" alt="img" /></p>
<p>åˆ†ç»„è§„åˆ™å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ul>
<li>ã€Œæœ€å°è®°å½•ã€è‡ªæˆä¸€ç»„</li>
<li>åŒ…å«ã€Œæœ€å¤§è®°å½•ã€çš„ç»„ä¸€èˆ¬ä¸º 1~8 æ¡è®°å½•</li>
<li>å…¶å®ƒè®°å½•ä¸€èˆ¬æ˜¯ 4~8 æ¡åˆ†ä¸ºä¸€ç»„</li>
</ul>
<p>åˆ†ç»„ä¹‹åï¼ŒæŠŠæ¯ç»„ä¸­æœ€å¤§çš„é‚£æ¡è®°å½•çš„åœ°å€åç§»é‡æå‡ºæ¥ï¼ŒæŒ‰é¡ºåºå­˜å‚¨èµ·æ¥ï¼Œè¿™äº›åœ°å€åç§»é‡ç§°ä¸ºæ§½ï¼ˆSlotï¼‰ï¼Œè€Œè¿™äº›æ§½å°±ç»„æˆäº†é¡µç›®å½•ï¼ˆPage Directoryï¼‰ã€‚å°±åƒæ˜¯ç»™ä¸€æœ¬ä¹¦åšäº†ç›®å½•ã€‚</p>
<p>ç›®å½•æœ‰äº†ï¼Œæ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ</p>
<p>æ­¤æ—¶å¦‚æœè¦æŸ¥æ‰¾ä¸€æ¡è®°å½•ï¼Œæ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š</p>
<p>1ã€ç”±äºé¡µç›®å½•ä¸­çš„æ§½æ˜¯æœ‰åºçš„ï¼Œå› æ­¤å¯ä»¥ç”¨ã€ŒäºŒåˆ†æ³•ã€å¿«é€Ÿå®šä½åˆ°ä¸€ä¸ªæ§½ï¼›</p>
<p>2ã€æ‰¾åˆ°è¯¥æ§½æ‰€åœ¨åˆ†ç»„ä¸­ä¸»é”®å€¼æœ€å°çš„è®°å½•ï¼›</p>
<p>3ã€é€šè¿‡ next_record éå†ç»„ä¸­çš„è®°å½•ã€‚</p>
<p>è¿™æ ·å°±æ¯”éå†æ‰€æœ‰çš„è®°å½•å¿«å¾—å¤šäº†å§ï¼</p>
<p><strong>Page Header</strong></p>
<p>é¡µå¤´éƒ¨ï¼Œä¸»è¦è®°å½•æ•°æ®é¡µçš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬é¡µå­˜äº†å¤šå°‘æ¡è®°å½•ã€é¡µç›®å½•ä¸­æœ‰å¤šå°‘ä¸ªæ§½ç­‰ç­‰ã€‚</p>
<p><strong>File Header</strong></p>
<p>é¡µå¤´éƒ¨å­˜çš„æ˜¯ä¸€ä¸ªæ•°æ®é¡µçš„æ¦‚è¦ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªé¡µä¸“æœ‰çš„ï¼Œè€Œæ–‡ä»¶å¤´å­˜çš„æ˜¯å„ç§é¡µé€šç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚é¡µçš„ç±»å‹æ˜¯ä»€ä¹ˆã€é¡µçš„ç¼–å·æ˜¯å¤šå°‘ã€ä¸Šä¸€é¡µçš„é¡µå·æ˜¯å¤šå°‘ã€ä¸‹ä¸€é¡µçš„é¡µå·æ˜¯å¤šå°‘ç­‰ç­‰ã€‚</p>
<p>æ—¢ç„¶æœ‰ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µçš„å®šä¹‰ï¼Œè¯´æ˜é¡µä¸é¡µä¹‹é—´å…¶å®æ˜¯äº’ç›¸è¿æ¥çš„ï¼Œå®ƒä»¬ä¹‹é—´å°±åƒä¸€ä¸ªåŒå‘é“¾è¡¨ï¼ˆæ¯”å¦‚ Java çš„ LinkedListï¼‰é‚£æ ·ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/v2-983d6442b506e0c37e397115158071c6_720w.jpg" alt="img" /></p>
<p><strong>File Trailer</strong></p>
<p>æ–‡ä»¶å°¾ï¼Œä¸»è¦ç”¨äºæ ¡éªŒä¸€ä¸ªé¡µæ˜¯ä¸æ˜¯å®Œæ•´çš„ã€‚</p>
<h3 id="4-b-shu-suo-yin" id="4ã€B-æ ‘ç´¢å¼•">4ã€B+æ ‘ç´¢å¼•</h3>
<p>InnoDBå­˜å‚¨å¼•æ“çš„æ˜¯ä¸€é¢—B+æ ‘ï¼Œå®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜å‚¨åœ¨B+æ ‘ç¬¬0å±‚çš„å¶å­èŠ‚ç‚¹ï¼›å…¶ä»–å±‚æ¬¡çš„ èŠ‚ç‚¹éƒ½å±äºå†…èŠ‚ç‚¹ï¼Œå†…èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ˜¯ç›®å½•é¡¹è®°å½•ã€‚</p>
<p>InnoDBçš„ç´¢å¼•åˆ†ä¸ºä¸¤ç§ã€‚</p>
<ul>
<li>èšç°‡ç´¢å¼•ï¼šä»¥ä¸»é”®å€¼çš„å¤§å°ä½œä¸ºé¡µå’Œè®°å½•çš„æ’åºè§„åˆ™ï¼Œåœ¨å¶å­èŠ‚ç‚¹å¤„å­˜å‚¨çš„è®°å½•åŒ…å«äº†è¡¨ä¸­æ‰€æœ‰çš„åˆ—ã€‚</li>
<li>äºŒçº§ç´¢å¼•ï¼šä»¥ç´¢å¼•åˆ—çš„å¤§å°ä½œä¸ºé¡µå’Œè®°å½•çš„æ’åºè§„åˆ™ï¼Œåœ¨å¶å­èŠ‚ç‚¹å¤„å­˜å‚¨çš„è®°å½•å†…å®¹æ˜¯ç´¢å¼•åˆ—+ä¸»é”®ã€‚</li>
</ul>
<p>InnoDBå­˜å‚¨å¼•æ“çš„B+æ ‘æ ¹èŠ‚ç‚¹è‡ªåˆ›å»ºä¹‹æ—¥å°±ä¸å†ç§»åŠ¨ã€‚</p>
<p>åœ¨äºŒçº§ç´¢å¼•çš„B+æ ‘å†…èŠ‚ç‚¹ä¸­ï¼Œç›®å½•é¡¹è®°å½•ç”±ç´¢å¼•åˆ—çš„å€¼ï¼Œä¸»é”®å€¼å’Œé¡µå·ç»„æˆã€‚</p>
<p>ä¸€ä¸ªæ•°æ®é¡µè‡³å°‘å¯ä»¥å®¹çº³2æ¡è®°å½•ã€‚</p>
<p>MyISAMå­˜å‚¨å¼•æ“çš„æ•°æ®å’Œç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œè¿™ç§å­˜å‚¨å¼•æ“çš„ç´¢å¼•å…¨éƒ¨éƒ½æ˜¯äºŒçº§ç´¢å¼•ï¼Œåœ¨å¶å­èŠ‚ç‚¹å¤„å­˜å‚¨çš„æ˜¯åˆ—+è¡Œå·ã€‚</p>
<h3 id="5-b-shu-suo-yin-de-shi-yong" id="5ã€B-æ ‘ç´¢å¼•çš„ä½¿ç”¨">5ã€B+æ ‘ç´¢å¼•çš„ä½¿ç”¨</h3>
<p><a href='http://t.csdn.cn/VkLnf '>MySQLä¸­B+æ ‘ç´¢å¼•çš„åº”ç”¨åœºæ™¯å¤§å…¨</a></p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ–‡æå®šå‰åç«¯é¡¹ç›®éƒ¨ç½²</title>
    <url>/posts/30975.html</url>
    <content><![CDATA[<h3 id="linux-chang-yong-ming-ling" id="Linuxå¸¸ç”¨å‘½ä»¤ï¼š">Linuxå¸¸ç”¨å‘½ä»¤ï¼š</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">lsof -i:<span class="number">8090</span> <span class="comment">//æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨</span></span><br><span class="line">kill -s <span class="number">9</span> pid <span class="comment">//æ€æ­»è¿›ç¨‹</span></span><br><span class="line">jps <span class="comment">//æŸ¥çœ‹å¯åŠ¨çš„javaåº”ç”¨è¿›ç¨‹</span></span><br><span class="line">scp -P <span class="number">22</span>ï¼ˆæœåŠ¡å™¨ç«¯å£å·ï¼‰ smpe-system-<span class="number">1.0</span><span class="number">.0</span>-RELEASE.jar  root<span class="meta">@ip</span>åœ°å€:/data/nginx/www/cloudsafe/cloudsafe_serverï¼ˆæœåŠ¡å™¨ä¸­æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ï¼‰ </span><br><span class="line"><span class="comment">//è¿œç¨‹å¤åˆ¶ï¼Œå°†æœ¬åœ°çš„xx.jarï¼Œ ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„xxxx/cloudsafe_serveræ–‡ä»¶å¤¹ï¼Œæ³¨ï¼šï¼ˆï¼‰ä¸ºè§£é‡Šï¼Œæ‰§è¡Œæ—¶è‡ªè¡Œåˆ é™¤ï¼Œæ­¤å‘½ä»¤æ˜¯åœ¨jarçš„æ‰€åœ¨ç›®å½•ä¸‹æ‰§è¡Œçš„ã€‚</span></span><br><span class="line"></span><br><span class="line">docker exec -it a4f598cc4268ï¼ˆå®¹å™¨idï¼‰ mysqldump -uroot -p*********ï¼ˆæ•°æ®åº“å¯†ç ï¼‰ --opt research_keyuanï¼ˆæ•°æ®åº“åç§°ï¼‰ &gt; /root/mysql_file_backup/mysqlbakup_research_keyuan.sql  ï¼ˆç”¨æ¥ä¿å­˜sqlæ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶åï¼‰</span><br><span class="line"><span class="comment">//æ­¤å‘½ä»¤ç”¨æ¥å¤‡ä»½dockerä¸­çš„mysqlæ•°æ®åº“sqlæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">docker exec -i a4f598cc4268ï¼ˆå®¹å™¨idï¼‰ mysql -uroot -p*****ï¼ˆæ•°æ®åº“å¯†ç ï¼‰ research_keyuan &lt; /root/mysql_file_backup/xxxx.sql</span><br><span class="line"><span class="comment">//æ­¤å‘½ä»¤æ˜¯ç”¨æ¥å°†sqlæ–‡ä»¶å¯¼å…¥åˆ°dockerä¸­çš„mysqlå®¹å™¨çš„mysqlçš„æŒ‡å®šæ•°æ®åº“</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h3 id="huan-jing-zhun-bei" id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h3>
<p>ä¸‹é¢çš„ç¯å¢ƒåªé€‚ç”¨äºCentos 7.x</p>
<h4 id="docker" id="Docker">Docker</h4>
<p>æ·»åŠ yumæº</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">yum update <span class="comment">//æ£€æŸ¥æ›´æ–°</span></span><br></pre></td></tr></table></figure>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">yum install epel-release -y <span class="comment">//æ·»åŠ yumçš„è½¯ä»¶ä»“åº“</span></span><br></pre></td></tr></table></figure>
<p>å®‰è£…docker</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> docker-io -y</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œdocker</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> docker</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥å®‰è£…ç»“æœ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure>
<p>åœæ­¢docker</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>
<p>é‡å¯docker</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">systemctl restart docker</span></span><br></pre></td></tr></table></figure>
<p>dockerçš„å¸¸ç”¨å‘½ä»¤</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker pull xxx <span class="comment">//æ‹‰å–åº”ç”¨é•œ,å¦‚æ‹‰å–nginxé•œåƒï¼šdocker pull nginx</span></span><br><span class="line">docker images <span class="comment">//æŸ¥çœ‹å·²æœ‰é•œåƒ</span></span><br><span class="line">docker rmi é•œåƒid <span class="comment">//åˆ é™¤é•œåƒ</span></span><br><span class="line">docker ps <span class="comment">//æŸ¥çœ‹å¯åŠ¨çš„å®¹å™¨</span></span><br><span class="line">docker ps -a <span class="comment">//æŸ¥çœ‹å®¹å™¨ï¼ŒåŒ…å«äº†æœªå¯åŠ¨çš„å®¹å™¨</span></span><br><span class="line">docker stop å®¹å™¨id <span class="comment">//åœæ­¢å®¹å™¨</span></span><br><span class="line">docker rm å®¹å™¨id <span class="comment">//åˆ é™¤å®¹å™¨ï¼Œéœ€è¦åœæ­¢å®¹å™¨</span></span><br><span class="line">docker exec -it å®¹å™¨id/åç§° bash <span class="comment">//è¿›å…¥å®¹å™¨å†…éƒ¨</span></span><br><span class="line">docker inspect å®¹å™¨id/åç§° | grep Mounts -A <span class="number">20</span> <span class="comment">//æŸ¥çœ‹å®¹å™¨ä¸æœåŠ¡å™¨çš„æ˜ å°„ç›®å½•</span></span><br><span class="line">docker inspect å®¹å™¨id/åç§° | grep IPAddress <span class="comment">//æŸ¥çœ‹å®¹å™¨çš„ipåœ°å€</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢éœ€è¦å®‰è£…ä¸€äº›å…¬å…±æœåŠ¡å¦‚ï¼šmysql ,redis, nginx</p>
<p>ä¸¤ç§æ–¹æ¡ˆï¼šåœ¨dockerä¸­å®‰è£…ï¼Œåœ¨æœåŠ¡å™¨ä¸­ç›´æ¥å®‰è£…ï¼Œä¸¤ç§æ–¹å¼éƒ½å¯ï¼Œå»ºè®®é€‰æ‹©ä¸€ç§ï¼Œä»è€…è§ä»å§ï¼Œæ ¹æ®æ–¹å¼ä¸ä¸€æ ·ï¼Œåç«¯çš„éƒ¨ç½²ä¹Ÿä¼šæœ‰äº›ç»†å¾®å˜åŠ¨ã€‚</p>
<h4 id="yi-docker-an-zhuang-ge-chong-fu-wu" id="ä¸€ã€Dockerå®‰è£…å„ç§æœåŠ¡">ä¸€ã€Dockerå®‰è£…å„ç§æœåŠ¡</h4>
<h5 id="docker-an-zhuang-mysql" id="Docker-å®‰è£…mysql">Docker å®‰è£…mysql</h5>
<p>å®‰è£…</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">docker pull mysql <span class="regexp">//</span>åé¢ä¸åŠ ç‰ˆæœ¬å·ï¼Œé»˜è®¤æœ€é«˜ç‰ˆæœ¬</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker run -itd --name mysql-test -p <span class="number">3307</span>:<span class="number">3306</span> -e MYSQL_ROOT_PASSWORD=<span class="number">123456</span> mysql</span><br></pre></td></tr></table></figure>
<ul>
<li>å‚æ•°è¯´æ˜ï¼š
<ul>
<li>*<em>-p 3306:3307</em> ï¼šæ˜ å°„å®¹å™¨çš„ 3306ç«¯å£åˆ°å®¿ä¸»æœºçš„ 3307 ç«¯å£ï¼Œå¤–éƒ¨ä¸»æœºå¯ä»¥ç›´æ¥é€šè¿‡ <strong>å®¿ä¸»æœºip:3307</strong> è®¿é—®åˆ° MySQL çš„æœåŠ¡ã€‚</li>
<li><strong>MYSQL_ROOT_PASSWORD=123456</strong>ï¼šè®¾ç½® MySQL æœåŠ¡ root ç”¨æˆ·çš„å¯†ç ã€‚</li>
<li>æ³¨ï¼šå¯åŠ¨åï¼Œå¦‚æœéœ€è¦è¿œç¨‹è®¿é—®ï¼Œéœ€è¦å¼€å¯æœåŠ¡å™¨çš„ç›¸åº”ç«¯å£å·</li>
</ul>
</li>
</ul>
<p>æ£€æŸ¥</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker ps <span class="comment">//æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br></pre></td></tr></table></figure>
<h5 id="docker-an-zhuang-redis" id="Docker-å®‰è£…Redis">Docker å®‰è£…Redis</h5>
<p>å®‰è£…</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docker run --name redis -p <span class="number">6379</span>:<span class="number">6379</span> -d --restart=always redis redis-server --appendonly yes --requirepass <span class="string">&quot;è¿™æ˜¯å¯†ç &quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å‚æ•°è¯´æ˜
<ul>
<li>-p 6379:6379 ç«¯å£æ˜ å°„ï¼šå‰è¡¨ç¤ºæœåŠ¡å™¨çš„ç«¯å£ï¼Œï¼šåè¡¨ç¤ºå®¹å™¨çš„ç«¯å£ã€‚</li>
<li>â€“name myredis  æŒ‡å®šè¯¥å®¹å™¨åç§°ï¼ŒæŸ¥çœ‹å’Œè¿›è¡Œæ“ä½œéƒ½æ¯”è¾ƒæ–¹ä¾¿ã€‚</li>
<li>-d redis è¡¨ç¤ºåå°å¯åŠ¨redis</li>
<li>appendonly yes å¼€å¯redis æŒä¹…åŒ–</li>
</ul>
</li>
</ul>
<h5 id="docker-an-zhuang-nginx" id="Docker-å®‰è£…nginx">Docker å®‰è£…nginx</h5>
<p>ç”±äºå†…å®¹æœ‰ç‚¹å¤šï¼Œéƒ½è®°å½•åˆ°æ­¤ç¯‡åšå®¢ä¸­<a href="https://blog.csdn.net/weixin_44932487/article/details/117193191?ops_request_misc=%7B%22request%5Fid%22%3A%22163628310816780265462295%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&amp;request_id=163628310816780265462295&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-1-117193191.pc_v2_rank_blog_default&amp;utm_term=docker&amp;spm=1018.2226.3001.4450">åŸºäºDockerä½¿ç”¨Nginx</a></p>
<h4 id="er-fu-wu-qi-an-zhuang-ge-chong-fu-wu" id="äºŒã€æœåŠ¡å™¨å®‰è£…å„ç§æœåŠ¡">äºŒã€æœåŠ¡å™¨å®‰è£…å„ç§æœåŠ¡</h4>
<p>æœåŠ¡å™¨ä¸­ï¼Œæˆ‘æ˜¯é‡‡ç”¨yumæºæ¥å®‰è£…å„ç§æœåŠ¡ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼ˆå¼ºçƒˆæ¨èï¼‰</p>
<h5 id="yum-an-zhuang-mysql" id="yumå®‰è£…Mysql">yumå®‰è£…Mysql</h5>
<p>1ã€æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å®‰è£…æœ‰mysql</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">yum list installed mysql*</span><br><span class="line">rpm -qa | grep mysql*</span><br></pre></td></tr></table></figure>
<p>2ã€å®‰è£…å®¢æˆ·ç«¯</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> mysql</span><br></pre></td></tr></table></figure>
<p>3ã€å®‰è£…æœåŠ¡ç«¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">yum install mysql-server</span><br><span class="line">æ³¨ï¼šå¯èƒ½æç¤ºä¸ºå®‰è£…å¤±è´¥</span><br><span class="line">åŸå› ï¼šCentOS7è‡ªå¸¦æœ‰MariaDBè€Œä¸æ˜¯MySQLï¼ŒMariaDBå’ŒMySQLä¸€æ ·ä¹Ÿæ˜¯å¼€å…ƒçš„æ•°æ®åº“</span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼šå¦‚æœå¿…é¡»è¦å®‰è£…MySQLï¼Œé¦–å…ˆå¿…é¡»æ·»åŠ mysqlç¤¾åŒºrepoé€šè¿‡è¾“å…¥å‘½ä»¤ï¼š</span><br><span class="line">sudo rpm -Uvh http:<span class="comment">//dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</span></span><br><span class="line"><span class="comment">//æ‰§è¡Œåï¼Œ ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">yum install mysql-server</span><br></pre></td></tr></table></figure>
<p>4ã€æ‰§è¡Œ</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> mysql-devel</span><br></pre></td></tr></table></figure>
<p>5ã€é…ç½®æ•°æ®åº“</p>
<p>vim /etc/my.cnf</p>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥é»˜è®¤å­—ç¬¦é›†ï¼š</p>
<p>default-character-set=uft-8</p>
<p>6ã€å¯åŠ¨æˆ–å…³é—­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[root<span class="meta">@localhost</span> ~]#service mysqld start      --å¯åŠ¨mysql[root<span class="meta">@localhost</span> ~]#service mysqld stop       --å…³é—­mysql</span><br><span class="line">[root<span class="meta">@localhost</span> ~]#lsof -i:<span class="number">3306</span>              --æ•°æ®åº“ç«¯å£æ˜¯å¦å¼€å¯</span><br></pre></td></tr></table></figure>
<p>7ã€è®¾ç½®å¼€æœºå¯åŠ¨mysqlæœåŠ¡</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">chkconfig --<span class="built_in">add</span> mysqld</span><br></pre></td></tr></table></figure>
<p>8ã€åˆ›å»ºrootç®¡ç†å‘˜</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">mysqladmin</span> -u root password å¯†ç </span><br></pre></td></tr></table></figure>
<p>9ã€è¿›å…¥mysqlè®¾ç½®è¿œç¨‹è®¿é—®</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line">//ä¾æ¬¡æ‰§è¡Œ</span><br><span class="line">mysql -u root -p</span><br><span class="line">use mysql;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> <span class="symbol">`Host`</span> = <span class="string">&#x27;%&#x27;</span> <span class="keyword">WHERE</span> <span class="symbol">`User`</span> = <span class="string">&#x27;root&#x27;</span> <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>10ã€åœ¨æœåŠ¡å™¨çš„æ§åˆ¶å°ä¸­é˜²ç«å¢™ï¼Œå°†æ•°æ®åº“ç«¯å£æ‰“å¼€ï¼ˆå®‰å…¨ç»„è§„åˆ™ä¸­æ·»åŠ 3306ç«¯å£ï¼‰</p>
<h5 id="yum-an-zhuang-redis" id="yumå®‰è£…redis">yumå®‰è£…redis</h5>
<p>1ã€yum install redis</p>
<p>2ã€yum isntall epel-release</p>
<p>3ã€å¯åŠ¨æœåŠ¡</p>
<p>systemctl start redis</p>
<p>4ã€æŸ¥çœ‹çŠ¶æ€</p>
<p>systemctl status redis</p>
<p>5ã€åœæ­¢æœåŠ¡</p>
<p>systemctl stop redis</p>
<p>6ã€é‡å¯æœåŠ¡</p>
<p>systemctl restart redis</p>
<p>7ã€æŸ¥çœ‹redisè¿›ç¨‹</p>
<p>ps -ef | grep redis</p>
<p>8ã€è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</p>
<p>systemctl enable redis</p>
<p>9ã€è®¾ç½®è¿œç¨‹è¿æ¥</p>
<p>è¿›å…¥é…ç½®æ–‡ä»¶</p>
<p>vi /etc/redis.conf</p>
<p>æ³¨é‡Šbind 127.0.0.1</p>
<p>è®¾ç½®protected-mode no</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071933559.png" alt="img" /></p>
<p>ä¿®æ”¹å¯†ç ä¸º111111</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111071934861.png" alt="img" /></p>
<p>10ã€ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘é‡å¯redis</p>
<p>systemctl restart redis</p>
<p>11ã€åœ¨æœåŠ¡å™¨çš„æ§åˆ¶å°çš„å®‰å…¨ç»„è§„åˆ™ï¼Œå¼€æ”¾redisç«¯å£å·6379</p>
<h5 id="yum-an-zhuang-git" id="yum-å®‰è£…git">yum å®‰è£…git</h5>
<p>1ã€å®‰è£…</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> git</span><br></pre></td></tr></table></figure>
<p>2ã€é…ç½®</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®ç”¨æˆ·åç§°å’Œç™»å½•é‚®ç®±</span></span><br><span class="line">git config <span class="attr">--global</span> user<span class="selector-class">.name</span> <span class="string">&#x27;ç”¨æˆ·å&#x27;</span></span><br><span class="line">git config <span class="attr">--global</span> user<span class="selector-class">.email</span> <span class="string">&#x27;é‚®ç®±&#x27;</span></span><br></pre></td></tr></table></figure>
<p>3ã€ç”Ÿæˆå¯†é’¥ï¼Œæ–¹ä¾¿æ‹‰å–è¿œç¨‹ä»“åº“ä»£ç </p>
<p>å»ºè®®åœ¨æœåŠ¡å™¨æ ¹ç›®å½•æ‰§è¡Œï¼Œ**cd / **  å¯ä»¥åˆ‡æ¢åˆ°æ ¹ç›®å½•</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &#x27;ç™»å½•é‚®ç®±&#x27;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¹‹åï¼Œä¸å»ºè®®è¾“å…¥å¯†ç ï¼Œç›´æ¥ä¸€ç›´Enterè·³è¿‡</p>
<p>å®Œæˆåï¼Œä¸€èˆ¬ä¼šåœ¨**/root/.ssh/<strong>æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œå¤§å®¶</strong>id-rsa.pub**æ–‡ä»¶çš„å†…å®¹ï¼Œå…¨éƒ¨å¤åˆ¶ï¼Œæ‰¾åˆ°githubä¸ªäººè´¦æˆ·è®¾ç½®ï¼Œåœ¨ssh key ä¸­çš„èœå•ä¸­æ–°å¢ssh key,å°†å†…å®¹ç²˜è´´è¿›å»å³å¯ã€‚</p>
<h3 id="pei-zhi-nginx-dai-li" id="é…ç½®Nginxä»£ç†">é…ç½®Nginxä»£ç†</h3>
<p>æ­¤æ–¹æ¡ˆåŸºäºDockerå®¹å™¨ä¸­çš„Nginx</p>
<p>1ã€æŸ¥çœ‹NginxæŒ‚è½½ç›®å½•</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">docker <span class="keyword">inspect</span> nginx | <span class="keyword">grep</span> Mounts -A <span class="number">40</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111081611709.png" alt="image-20211108161137330" /></p>
<p>Sourceå¯¹åº”æœåŠ¡å™¨çš„æ–‡ä»¶å¤¹ï¼ŒDestinationå¯¹åº”nginx_configæ–‡ä»¶å¤¹</p>
<p>æ³¨ï¼šå¦‚æœä½ çœ‹çš„æˆ‘åšå®¢è¿›è¡Œé…ç½®çš„ï¼Œä¼šçœ‹åˆ°æœ‰äº”ä¸ªæŒ‚è½½ç›®å½•ï¼Œæœ‰ä¸¤ä¸ªç›®å½•ï¼Œå¾ˆé‡è¦ï¼Œå…¶ä»–æ˜¯é…ç½®æ–‡ä»¶å’Œæ—¥å¿—çš„ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111081628511.png" alt="image-20211108162847392" /></p>
<p>2ã€åœ¨conf.dæ–‡ä»¶å¤¹åŠ å…¥é¡¹ç›®çš„nginxé…ç½®</p>
<p>æ–‡ä»¶åï¼šxxx.confï¼ˆxxxè‡ªå·±éšæ„å‘½åï¼‰</p>
<p>è¯¦ç»†çš„è§£é‡Šï¼Œè¯·ä»”ç»†çœ‹æ³¨é‡Š</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> myserver&#123;</span><br><span class="line">    <span class="comment">#172.17.0.6æ˜¯é¡¹ç›®æ‰€åœ¨å®¹å™¨çš„ipåœ°å€ï¼Œ8000ä¸ºé¡¹ç›®çš„ç«¯å£ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼›å¦‚æœé¡¹ç›®æ˜¯åœ¨æœåŠ¡å™¨è£¸å¥”çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨127.0.0.1:ç«¯å£</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">172.17.0.6:8000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">    <span class="comment">#ç›‘å¬çš„ç«¯å£</span></span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="comment">#åŸŸåï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼Œï¼ˆæ²¡åŸŸåï¼Œå¯ä»¥ç›´æ¥å†™æˆipåœ°å€ï¼‰</span></span><br><span class="line">    <span class="attribute">server_name</span> kygl.ruanzhuinfo.com;</span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">500m</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/host.access.log main;</span><br><span class="line">	<span class="comment">#åå°</span></span><br><span class="line">    <span class="section">location</span> /admin &#123;</span><br><span class="line">        <span class="comment">#root åé¢è·¯å¾„åœ¨æœåŠ¡å™¨çš„è·¯å¾„ä¸ºï¼š/data/nginx/www/kygl_v2/dist_web</span></span><br><span class="line">        <span class="comment">#å› ä¸ºnginxéœ€è¦ä»£æ›¿(ä»£ç†)ä½ è®¿é—®æ–‡ä»¶ï¼Œnginxæ˜¯åœ¨ä¸€ä¸ªdockerå®¹å™¨ä¸­å’ŒæœåŠ¡å™¨ä¸æ˜¯åœ¨ä¸€ä¸ªç¯å¢ƒä¸‹ï¼Œ</span></span><br><span class="line">        <span class="comment">#æ‰€ä»¥éœ€è¦è·¯å¾„æ”¹æˆåœ¨å®¹å™¨ä¸­çš„è·¯å¾„ï¼Œdist_webä¸ºå‰ç«¯çš„æ‰“åŒ…çš„æ–‡ä»¶å¤¹ï¼Œè¦ä¿è¯dist_webä¸­æœ‰index.html</span></span><br><span class="line">        <span class="attribute">root</span>   /nginx_config/www/kygl_v2/dist_web/;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html?s=<span class="variable">$uri</span>&amp;<span class="variable">$args</span>;</span><br><span class="line">        <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#å‰å°ï¼Œå¦‚æœæœ‰å‰å°ï¼Œå¯ä»¥é…ç½®ï¼ŒåŒä¸Šï¼Œå› ä¸ºrootåªèƒ½å­˜åœ¨ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸‹é¢ç”¨çš„aliasæ¥é…ç½®å¦ä¸€ä¸ªè™šæ‹Ÿç›®å½•</span></span><br><span class="line">    <span class="comment">#location /front &#123;</span></span><br><span class="line">    <span class="comment">#   alias   /nginx_config/www/kygl_v2/dist_front/;</span></span><br><span class="line">    <span class="comment">#   try_files $uri $uri/ /index.html?s=$uri&amp;$args;</span></span><br><span class="line">    <span class="comment">#   index index.html index.htm index.php;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#åç«¯</span></span><br><span class="line">    <span class="section">location</span> /api &#123;</span><br><span class="line">       <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">       <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">location</span> /auth &#123;</span><br><span class="line">       <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">       <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#ä¸‹é¢æ˜¯é…ç½®è®¿é—®swagger</span></span><br><span class="line">    <span class="section">location</span> /swagger-ui.html &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /webjars &#123;</span><br><span class="line">	   <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /swagger-resources &#123;</span><br><span class="line">      <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">      <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /v2 &#123;</span><br><span class="line">      <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">      <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€è®°å¾—æ¯æ¬¡ä¿®æ”¹nginxçš„ç›¸å…³é…ç½®ï¼Œéƒ½éœ€è¦é‡æ–°åŠ è½½ä¸‹</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span>è¿›å…¥nginxå®¹å™¨</span><br><span class="line">docker exec -it nginx bash</span><br><span class="line"><span class="regexp">//</span>æµ‹è¯•ï¼Œçœ‹ä¸‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é—®é¢˜</span><br><span class="line">nginx -t</span><br><span class="line"><span class="regexp">//</span>é‡æ–°åŠ è½½</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111081722262.png" alt="image-20211108172223927" /></p>
<p>å¦‚æœé‡åˆ°ä¿®æ”¹é…ç½®åï¼Œæ²¡æœ‰ç”Ÿæ•ˆï¼Œè¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line">nginx -s reopen</span><br><span class="line">nginx -s <span class="built_in">stop</span> <span class="comment">//æ­¤å‘½ä»¤æ‰§è¡Œåï¼Œä¼šé€€å‡ºå®¹å™¨ï¼Œé‡æ–°è¿›å…¥å³å¯</span></span><br><span class="line">nginx -<span class="built_in">reload</span></span><br></pre></td></tr></table></figure>
<h3 id="bu-shu-hou-duan-spring-boot-xiang-mu" id="éƒ¨ç½²åç«¯ï¼ˆSpringBooté¡¹ç›®ï¼‰">éƒ¨ç½²åç«¯ï¼ˆSpringBooté¡¹ç›®ï¼‰</h3>
<p>å¦‚æœä½ æ˜¯æŠŠå„ç§æœåŠ¡æ”¾åˆ°äº†dockerä¸­ï¼Œè¯·é€‰æ‹©<strong>æ–¹æ¡ˆä¸€</strong>ï¼›å¦‚æœä½ æŠŠå„ç§æœåŠ¡å®‰è£…åˆ°äº†æœåŠ¡å™¨ä¸­ï¼Œè¯·é€‰æ‹©<strong>æ–¹æ¡ˆäºŒ</strong>ï¼›</p>
<p>ä¸‹é¢çš„æ‰€æœ‰æ­¥éª¤å°†ä»¥æˆ‘çš„<a href="https://github.com/zglgithubx/ourchat.git">githubé¡¹ç›®</a>ä¸ºä¾‹</p>
<p>å…‹éš†é¡¹ç›®</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/zglgithubx/</span>ourchat.git</span><br></pre></td></tr></table></figure>
<p>åˆ‡æ¢åˆ°åˆ†æ”¯develop</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git checkout develop</span></span><br></pre></td></tr></table></figure>
<h4 id="fang-an-yi" id="æ–¹æ¡ˆä¸€">æ–¹æ¡ˆä¸€</h4>
<p><a href="http://xn--demo-k84ftib84es5a59uer1d9qa14mqveu07dc71bln2c.sh">è¿™ä¸ªæ–¹æ¡ˆç”¨åˆ°äº†ä¸€ä¸ªè„šæœ¬æ–‡ä»¶demo.sh</a>ï¼Œä¸€ä¸ªDockerfileæ–‡ä»¶ï¼Œè¯´ä¸‹demo.shè„šæœ¬éƒ½åšäº†å“ªäº›å·¥ä½œï¼šæ‰§è¡ŒDockerfileæ–‡ä»¶æ„å»ºCentoSé•œåƒï¼Œåœ¨é•œåƒä¸­å®‰è£…äº†vim ã€gitã€jdk ã€mavenâ€”&gt;æ ¹æ®centosé•œåƒå¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨----&gt;åœ¨centoså®¹å™¨ä¸­æ‹‰å–é¡¹ç›®â€”&gt;å°†é¡¹ç›®æ‰“åŒ…æˆjaråŒ…â€”&gt;å¯åŠ¨é¡¹ç›®jaråŒ…</p>
<p>1ã€å‡†å¤‡æ–‡ä»¶</p>
<p>ä¸‹é¢æ˜¯è„šæœ¬æ–‡ä»¶demo.shå’ŒDockerfileï¼Œéƒ¨ç½²æ—¶è¯·å°†è¿™ä¸¤æ–‡ä»¶æ”¾åˆ°åç«¯çš„æ ¹ç›®å½•ä¸‹</p>
<p>æ³¨ï¼šå¦‚æœéƒ¨ç½²è‡ªå·±çš„é¡¹ç›®éœ€å°†<strong>SERVER_NAME ã€JAR_PATHã€Root_File_Name</strong>å‚æ•°ä¿®æ”¹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒåå­—</span></span><br><span class="line">IMAGE_NAME=centos7_mvn_git_java8</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker å®¹å™¨åå­—æˆ–è€…jaråå­—ï¼Œè¿™é‡Œéƒ½å‘½åä¸ºè¿™ä¸ªï¼ˆ*å¿…å¡«ï¼‰</span></span><br><span class="line">SERVER_NAME=ourchat</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™é‡Œçš„JAR_PATHä¸ºjaråŒ…æ‰€åœ¨ä½ç½®ï¼Œè¿™è·¯å¾„æ˜¯jarç›¸å¯¹äºè„šæœ¬æ–‡ä»¶çš„è·¯å¾„ã€‚ï¼ˆ*å¿…å¡«ï¼‰</span></span><br><span class="line">JAR_PATH=./target/demo-0.0.1-RELEASE.jar</span><br><span class="line"></span><br><span class="line"><span class="comment">#é¡¹ç›®æ ¹ç›®å½•æ–‡ä»¶å¤¹åç§°ï¼ˆ*å¿…å¡«ï¼‰</span></span><br><span class="line">Root_File_Name=ourchat</span><br><span class="line"></span><br><span class="line">profile=<span class="variable">$2</span></span><br><span class="line">port=<span class="variable">$3</span></span><br><span class="line"><span class="comment">#Xms=$4</span></span><br><span class="line"><span class="comment">#Xmx=$5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨è¯´æ˜ï¼Œç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span></span><br><span class="line"><span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [init|start|stop|restart|status|pull] [profile] [port]&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆå§‹åŒ–â€”â€”æ„å»ºé•œåƒå’Œå®¹å™¨(åœ¨å®¿ä¸»æœºæ‰§è¡Œ)</span></span><br><span class="line"><span class="function"><span class="title">init</span></span>()&#123;</span><br><span class="line">  <span class="comment">#å®¹å™¨id</span></span><br><span class="line">  CID=$(docker ps | grep <span class="string">&quot;<span class="variable">$SERVER_NAME</span>&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">  <span class="comment">#é•œåƒid</span></span><br><span class="line">  IID=$(docker images | grep <span class="string">&quot;<span class="variable">$IMAGE_NAME</span>&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">	<span class="comment"># æ„å»ºdockeré•œåƒ</span></span><br><span class="line">	<span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$IID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Exit <span class="variable">$SERVER_NAME</span> imageï¼ŒIID=<span class="variable">$IID</span>&quot;</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;NOT exit <span class="variable">$SERVER_NAME</span> imageï¼Œstart build image...&quot;</span></span><br><span class="line">		<span class="comment"># æ ¹æ®é¡¹ç›®ä¸ªè·¯å¾„ä¸‹çš„Dockerfileæ–‡ä»¶ï¼Œæ„å»ºé•œåƒ</span></span><br><span class="line">		docker build -t <span class="variable">$IMAGE_NAME</span> .</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$SERVER_NAME</span> image has been builded&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$CID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;Exit <span class="variable">$SERVER_NAME</span> containerï¼ŒCID=<span class="variable">$CID</span>.   ---Remove container&quot;</span></span><br><span class="line">			docker stop <span class="variable">$SERVER_NAME</span>   <span class="comment"># åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨</span></span><br><span class="line">			docker <span class="built_in">rm</span> <span class="variable">$SERVER_NAME</span>     <span class="comment">##åˆ é™¤åŸæ¥çš„å®¹å™¨</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># æ„å»ºå®¹å™¨</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$SERVER_NAME</span> container,start build...&quot;</span></span><br><span class="line">	<span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line">	 <span class="comment"># --name å®¹å™¨çš„åå­—</span></span><br><span class="line">	 <span class="comment">#   -d   å®¹å™¨åå°è¿è¡Œ</span></span><br><span class="line">	 <span class="comment">#   -p   æŒ‡å®šå®¹å™¨æ˜ å°„çš„ç«¯å£å’Œä¸»æœºå¯¹åº”çš„ç«¯å£</span></span><br><span class="line">	 <span class="comment">#   -v   å°†ä¸»æœºçš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•ä¸­ï¼ˆä¸å¯å°‘ï¼‰</span></span><br><span class="line">	docker run -e TZ=<span class="string">&quot;Asia/Shanghai&quot;</span> -<span class="built_in">id</span> -m 512M --memory-swap=1G --name <span class="variable">$SERVER_NAME</span> -v <span class="variable">$PWD</span>/../:/project/<span class="variable">$Root_File_Name</span> <span class="variable">$IMAGE_NAME</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$SERVER_NAME</span> container build end&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span></span><br><span class="line"><span class="function"><span class="title">is_exist</span></span>()&#123;</span><br><span class="line">  pid=`ps -ef|grep <span class="variable">$JAR_PATH</span>|grep -v grep|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> `</span><br><span class="line">  <span class="comment">#å¦‚æœä¸å­˜åœ¨è¿”å›1ï¼Œå­˜åœ¨è¿”å›0</span></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;pid&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">return</span> 1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="title">start</span></span>()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;SERVER_NAME&#125;</span> is already running. pid=<span class="variable">$&#123;pid&#125;</span> .&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> --------Starting application --------</span><br><span class="line">    <span class="built_in">nohup</span> java -server -XX:-DisableExplicitGC -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -jar <span class="variable">$JAR_PATH</span> --spring.profiles.active=<span class="variable">$&#123;profile:-dev&#125;</span> --server.port=<span class="variable">$&#123;port:-8000&#125;</span> &gt; start.log 2&gt;&amp;1 &amp;</span><br><span class="line">    <span class="built_in">echo</span> --------------Started!---------------</span><br><span class="line"></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">kill</span> -9 <span class="variable">$pid</span></span><br><span class="line">    <span class="built_in">echo</span> -----------Application Stopped------------</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;JAR_PATH&#125;</span> is not running&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºè¿è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="title">status</span></span>()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;JAR_PATH&#125;</span> is running. Pid is <span class="variable">$&#123;pid&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;JAR_PATH&#125;</span> is NOT running.&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯</span></span><br><span class="line"><span class="function"><span class="title">restart</span></span>()&#123;</span><br><span class="line">  stop</span><br><span class="line">  start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#mvn</span></span><br><span class="line"><span class="function"><span class="title">pull</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------gitï¼šfind status---------&quot;</span></span><br><span class="line">  git status</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------gitï¼špull new coads---------&quot;</span></span><br><span class="line">  git pull origin develop</span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------mvn clean package -Dmaven.test.skip=true---------&quot;</span></span><br><span class="line">  mvn clean package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------Preparing start application ---------&quot;</span></span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    restart</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    start</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ¹æ®è¾“å…¥å‚æ•°ï¼Œé€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•ï¼Œä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">  <span class="string">&quot;init&quot;</span>)</span><br><span class="line">    init</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>)</span><br><span class="line">    start</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;stop&quot;</span>)</span><br><span class="line">    stop</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;status&quot;</span>)</span><br><span class="line">    status</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;restart&quot;</span>)</span><br><span class="line">    restart</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;pull&quot;</span>)</span><br><span class="line">    pull</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    usage</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<p>Dockerfile</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">FROM centos:latest</span><br><span class="line">RUN yum -y update \</span><br><span class="line">    &amp;&amp; yum -y install vim \</span><br><span class="line">    &amp;&amp; yum -y install git \</span><br><span class="line">    &amp;&amp; yum -y install java-1.8.0-openjdk-devel.x86_64 \</span><br><span class="line">    &amp;&amp; yum install -y maven \</span><br><span class="line">    &amp;&amp; mkdir ~/.m2</span><br><span class="line">RUN echo &#x27;<span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span><span class="tag">&lt;<span class="name">mirror</span>&gt;</span><span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span><span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/repositories/central/<span class="tag">&lt;/<span class="name">url</span>&gt;</span><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span><span class="tag">&lt;/<span class="name">settings</span>&gt;</span>&#x27; &gt; ~/.m2/settings.xml</span><br></pre></td></tr></table></figure>
<p>2ã€åˆå§‹åŒ–ã€æ„å»ºé•œåƒ</p>
<p>åˆ‡æ¢åˆ°åç«¯é¡¹ç›®æ ¹ç›®å½•</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd xxxx<span class="regexp">/ourchat_api/</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">sh </span>demo.<span class="keyword">sh </span>init</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111081113533.png" alt="image-20211108111350473" /></p>
<p>å®Œæˆåï¼Œä¼šæœ‰æˆåŠŸçš„æç¤º</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111081111622.png" alt="image-20211108111147161" /></p>
<p>3ã€æŸ¥çœ‹å®¹å™¨æ˜¯å¦å¯åŠ¨</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker ps</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111081115646.png" alt="image-20211108111526577" /></p>
<p>statusä¸ºup å³ä¸ºå¯åŠ¨æˆåŠŸ</p>
<p>4ã€è¿›å…¥å®¹å™¨</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">docker exec -<span class="keyword">it</span> ourchat bash</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111081116779.png" alt="image-20211108111634691" /></p>
<p>5ã€åˆ‡æ¢åˆ°å®¹å™¨ä¸­çš„é¡¹ç›®åç«¯ç›®å½•</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">cd <span class="keyword">project</span><span class="regexp">/ourchat/</span>ourchat_api/</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202111081118447.png" alt="image-20211108111846333" /></p>
<p>6ã€è„šæœ¬å‘½ä»¤ä»‹ç»</p>
<p>åˆ°è¿™ä¸€æ­¥éª¤ï¼Œç¯å¢ƒåŸºæœ¬éƒ½æ­å»ºå®Œæ¯•äº†ï¼Œä¸‹é¢ä»‹ç»è„šæœ¬çš„å‘½ä»¤</p>
<p>ä¸Šé¢çš„åˆå§‹åŒ–å‘½ä»¤åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åä»£ç æ›´æ–°ï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">æ³¨ï¼šä¸‹é¢çš„å‘½ä»¤éœ€è¦ç”¨sshçš„æ–¹å¼å’Œè¿œç¨‹ä»“åº“å»ºç«‹è¿æ¥ï¼Œå³é…ç½®centoså®¹å™¨ä¸­git,ç”Ÿæˆssh keyï¼Œå°†id.res_pubæ–‡ä»¶å†…å®¹çš„keyæ·»åŠ åˆ°githubæˆ–codingæœåŠ¡å™¨çš„ä¸ªäººè´¦æˆ·ä¸­</span><br><span class="line"><span class="comment">#æ‹‰å–æ–°ä»£ç ï¼Œé‡æ–°æ‰“åŒ…é¡¹ç›®ï¼Œå¹¶é‡æ–°å¯åŠ¨</span></span><br><span class="line">sh demo.sh pull</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„å‘½ä»¤æ˜¯è„šæœ¬çš„å…¶ä»–å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹é¡¹ç›®å¯åŠ¨çŠ¶æ€</span></span><br><span class="line">sh demo.sh status</span><br><span class="line"><span class="comment">#å¯åŠ¨é¡¹ç›®ï¼Œåé¢çš„å‚æ•°æ˜¯é€‰å¡«çš„,devï¼šç¯å¢ƒï¼Œ8000ï¼šé¡¹ç›®ç«¯å£å·</span></span><br><span class="line">sh demo.sh start dev 8000</span><br><span class="line"><span class="comment">#åœæ­¢é¡¹ç›®</span></span><br><span class="line">sh demo.sh stop</span><br><span class="line"><span class="comment">#é‡æ–°å¯åŠ¨é¡¹ç›®</span></span><br><span class="line">sh demo.sh restart</span><br></pre></td></tr></table></figure>
<h4 id="fang-an-er" id="æ–¹æ¡ˆäºŒ">æ–¹æ¡ˆäºŒ</h4>
<p>æ–¹æ¡ˆä¸€çš„å¥½å¤„æœ‰å¾ˆå¤šï¼Œé¡¹ç›®äº¤ä»˜æ—¶ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå‘ç”Ÿè¿ç§»ï¼Œæ–°æœåŠ¡å™¨ä¸ç”¨å†æ‰‹åŠ¨å®‰è£…ä¸€äº›ç¯å¢ƒï¼Œåªéœ€è¦å®‰è£…docker ,å‰©ä¸‹çš„ç¯å¢ƒï¼Œæ‰§è¡ŒDockerfileå°±å¯ä»¥äº†ã€‚</p>
<p>æ–¹æ¡ˆäºŒé€‚åˆåœ¨ä¸ªäººæœåŠ¡å™¨éƒ¨ç½²ä¸ªäººé¡¹ç›®ï¼Œä¸éœ€è¦è€ƒè™‘æœåŠ¡å™¨çš„è¿ç§»ï¼Œå¯ä»¥æŠŠæ‰€æœ‰ç¯å¢ƒéƒ½è£…åˆ°æœåŠ¡å™¨ï¼ŒèŠ‚çœç©ºé—´</p>
<p>ä½ å¦‚æœé€‰æ‹©äº†æ–¹æ¡ˆäºŒï¼Œé»˜è®¤ä½ å·²ç»æŠŠmysqlã€redisã€åŠgitéƒ½å·²ç»å®‰è£…å®Œæ¯•</p>
<p>ä¸ºäº†èƒ½å¤Ÿå¯åŠ¨åç«¯é¡¹ç›®ï¼Œè¿˜éœ€è¦å®‰è£…mavenã€jdk</p>
<p>1ã€å®‰è£…maven</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">yum <span class="keyword">install</span> maven</span><br></pre></td></tr></table></figure>
<p>2ã€å®‰è£…jdk1.8</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">yum</span> install java-<span class="number">1</span>.<span class="number">8</span>.<span class="number">0</span>-openjdk-devel.x86_64</span><br></pre></td></tr></table></figure>
<p>3ã€å‡†å¤‡è„šæœ¬æ–‡ä»¶</p>
<p>å…¶å®è¿™æ–‡ä»¶æ˜¯æ ¹æ®demo.shä¿®æ”¹çš„ï¼Œä¹Ÿæ˜¯åªéœ€è¦æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åˆ°åç«¯é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¦‚æœè‡ªå·±ä½¿ç”¨åªéœ€è¦æ›´æ”¹<strong>SERVER_NAMEã€JAR_PATH</strong>è¿™ä¸¤ä¸ªå‚æ•°</p>
<p><a href="http://ourchat.sh">ourchat.sh</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker å®¹å™¨åå­—æˆ–è€…jaråå­—ï¼Œè¿™é‡Œéƒ½å‘½åä¸ºè¿™ä¸ª</span></span><br><span class="line">SERVER_NAME=ourchat</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™é‡Œçš„JAR_PATHä¸ºjaråŒ…æ‰€åœ¨ä½ç½®</span></span><br><span class="line">JAR_PATH=./target/demo-0.0.1-RELEASE.jar</span><br><span class="line"></span><br><span class="line">profile=<span class="variable">$2</span></span><br><span class="line">port=<span class="variable">$3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨è¯´æ˜ï¼Œç”¨æ¥æç¤ºè¾“å…¥å‚æ•°</span></span><br><span class="line"><span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: sh æ‰§è¡Œè„šæœ¬.sh [build|start|stop|restart|status|pull] [profile] [port]&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">build</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------mvn clean package -Dmaven.test.skip=true---------&quot;</span></span><br><span class="line">  mvn clean package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------Preparing start application ---------&quot;</span></span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    restart</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    start</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æŸ¥ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ</span></span><br><span class="line"><span class="function"><span class="title">is_exist</span></span>()&#123;</span><br><span class="line">  pid=`ps -ef|grep <span class="variable">$JAR_PATH</span>|grep -v grep|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> `</span><br><span class="line">  <span class="comment">#å¦‚æœä¸å­˜åœ¨è¿”å›1ï¼Œå­˜åœ¨è¿”å›0</span></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;pid&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">return</span> 1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="title">start</span></span>()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;SERVER_NAME&#125;</span> is already running. pid=<span class="variable">$&#123;pid&#125;</span> .&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> --------Starting application --------</span><br><span class="line">    <span class="built_in">nohup</span> java -server -Xms512m -Xmx512m -XX:SurvivorRatio=4 -Xss256k -XX:PermSize=256m -XX:MaxPermSize=512m -XX:-DisableExplicitGC -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -jar <span class="variable">$JAR_PATH</span> --spring.profiles.active=<span class="variable">$&#123;profile:-prod&#125;</span> --server.port=<span class="variable">$&#123;port:-8000&#125;</span>&gt; start.log 2&gt;&amp;1 &amp;</span><br><span class="line">    <span class="built_in">echo</span> --------------Started!---------------</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">kill</span> -9 <span class="variable">$pid</span></span><br><span class="line">    <span class="built_in">echo</span> -----------Application Stopped------------</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;JAR_PATH&#125;</span> is not running&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºè¿è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="function"><span class="title">status</span></span>()&#123;</span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;JAR_PATH&#125;</span> is running. Pid is <span class="variable">$&#123;pid&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;JAR_PATH&#125;</span> is NOT running.&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯</span></span><br><span class="line"><span class="function"><span class="title">restart</span></span>()&#123;</span><br><span class="line">  stop</span><br><span class="line">  start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#mvn</span></span><br><span class="line"><span class="function"><span class="title">pull</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------gitï¼šfind status---------&quot;</span></span><br><span class="line">  git status</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------gitï¼špull new coads---------&quot;</span></span><br><span class="line">  git pull origin develop</span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------mvn clean package -Dmaven.test.skip=true---------&quot;</span></span><br><span class="line">  mvn clean package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;----------Preparing start application ---------&quot;</span></span><br><span class="line">  is_exist</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq <span class="string">&quot;0&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    restart</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    start</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ¹æ®è¾“å…¥å‚æ•°ï¼Œé€‰æ‹©æ‰§è¡Œå¯¹åº”æ–¹æ³•ï¼Œä¸è¾“å…¥åˆ™æ‰§è¡Œä½¿ç”¨è¯´æ˜</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">  <span class="string">&quot;build&quot;</span>)</span><br><span class="line">    build</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>)</span><br><span class="line">    start</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;stop&quot;</span>)</span><br><span class="line">    stop</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;status&quot;</span>)</span><br><span class="line">    status</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;restart&quot;</span>)</span><br><span class="line">    restart</span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;pull&quot;</span>)</span><br><span class="line">    pull</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    usage</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<p>4ã€åœ¨é¡¹ç›®åç«¯æ ¹ç›®å½•æ‰§è¡Œbuildå‘½ä»¤</p>
<p>è¿™ä¸ªå‘½ä»¤ä¼šå°†é¡¹ç›®æ‰“åŒ…å¹¶è¿è¡Œ</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">sh </span>ourchat.<span class="keyword">sh </span><span class="keyword">build</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä»–å‘½ä»¤åŒæ–¹æ¡ˆä¸€ä¸­ä»‹ç»çš„å‘½ä»¤ä¸€æ ·</p>
<p>é¡¹ç›®ä»£ç æ›´æ–°åï¼Œé‡æ–°éƒ¨ç½²æ—¶ï¼Œåªéœ€è¦æ‰§è¡Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sh ourchat.sh pull</span><br></pre></td></tr></table></figure>
<h3 id="bu-shu-qian-duan-vue-xiang-mu" id="éƒ¨ç½²å‰ç«¯ï¼ˆVueé¡¹ç›®ï¼‰">éƒ¨ç½²å‰ç«¯ï¼ˆVueé¡¹ç›®ï¼‰</h3>
<p>å‰ç«¯çš„éƒ¨ç½²ï¼Œä¸å¤–ä¹å°†æ‰“åŒ…å¥½çš„distæ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå¯èƒ½æœ‰çš„äººç›´æ¥åœ¨æœåŠ¡å™¨å®‰è£…webpack,ç„¶åå†å®‰è£…ä¸€ç³»åˆ—çš„å‰ç«¯éœ€è¦çš„é…ç½®ï¼Œä½¿ç”¨gitå°†é¡¹ç›®æ‹‰å–åˆ°æœåŠ¡å™¨ï¼Œç„¶ååœ¨æœåŠ¡å™¨è¿è¡Œæ‰“åŒ…å‘½ä»¤ã€‚æˆ‘æ„Ÿè§‰å‰ç«¯çš„éƒ¨ç½²ä¸åº”è¯¥é‚£ä¹ˆå¤æ‚ï¼Œæœ‰äººå¯èƒ½è¦è¯´äº†ï¼Œç›´æ¥æŠŠdiståŒ…æ¯æ¬¡åœ¨æœ¬åœ°æ‰“åŒ…ï¼Œç„¶åå¤åˆ¶åˆ°æœåŠ¡å™¨çš„æŒ‡å®šç›®å½•ä¸å°±å¥½äº†ï¼Œè¿™éƒ½2021å¹´äº†ï¼Œå…¶å®ä¹Ÿä¸éœ€è¦é‚£ä¹ˆæ­¥éª¤ã€‚ä¸‹é¢æˆ‘ä»‹ç»ä¸€æ¬¾å‰ç«¯éƒ¨ç½²æ’ä»¶ï¼Œå¯ä»¥ç”¨æ¥ç®€åŒ–è¿™äº›æ­¥éª¤ã€‚</p>
<h4 id="an-zhuang-fe-deploy-cli" id="å®‰è£…fe-deploy-cli">å®‰è£…fe-deploy-cli</h4>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span>æ­¤ä¸ºå…¨å±€å®‰è£…ï¼Œä¸€æ¬¡å®‰è£…å—ç›Šç»ˆèº«</span><br><span class="line">npm i fe-deloy-cli -g</span><br></pre></td></tr></table></figure>
<p>å®‰è£…ä¹‹åï¼Œåœ¨å‰ç«¯é¡¹ç›®æ ¹ç›®å½•æ‰“å¼€å‘½ä»¤è¡Œ</p>
<p>æ‰§è¡Œï¼š</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">deploy <span class="keyword">init</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œå®Œä¹‹åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¼šç”Ÿæˆï¼šdeployæ–‡ä»¶å¤¹</p>
<p>æ–‡ä»¶deploy.config.jså¤§æ¦‚æ˜¯è¿™æ ·</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">privateKey</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">//ï¼ˆé€‰å¡«ï¼‰ æœ¬åœ°ç§é’¥åœ°å€ï¼Œä½ç½®ä¸€èˆ¬åœ¨C:/Users/xxx/.ssh/id_rsaï¼Œéå¿…å¡«ï¼Œæœ‰ç§é’¥åˆ™é…ç½®</span></span><br><span class="line">  <span class="attr">passphrase</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ï¼ˆé€‰å¡«ï¼‰æœ¬åœ°ç§é’¥å¯†ç ï¼Œéå¿…å¡«ï¼Œæœ‰ç§é’¥åˆ™é…ç½®</span></span><br><span class="line">  <span class="attr">projectName</span>: <span class="string">&#x27;xxxx&#x27;</span>, <span class="comment">// é¡¹ç›®åç§°</span></span><br><span class="line">  <span class="comment">// æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®ï¼Œå¦‚åªéœ€éƒ¨ç½²prodçº¿ä¸Šç¯å¢ƒï¼Œè¯·åˆ é™¤devæµ‹è¯•ç¯å¢ƒé…ç½®ï¼Œåä¹‹äº¦ç„¶ï¼Œæ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²</span></span><br><span class="line">  <span class="attr">dev</span>: &#123; <span class="comment">// å¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;å¼€å‘ç¯å¢ƒ&#x27;</span>,</span><br><span class="line">    <span class="attr">script</span>: <span class="string">&quot;npm run build&quot;</span>, <span class="comment">// æµ‹è¯•ç¯å¢ƒæ‰“åŒ…è„šæœ¬</span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;xxxx&#x27;</span>, <span class="comment">// æµ‹è¯•æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    <span class="attr">port</span>: xx, <span class="comment">// ssh portï¼Œä¸€èˆ¬é»˜è®¤22</span></span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;xxxx&#x27;</span>, <span class="comment">// ç™»å½•æœåŠ¡å™¨ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;xxxxx&#x27;</span>, <span class="comment">// ç™»å½•æœåŠ¡å™¨å¯†ç </span></span><br><span class="line">    <span class="attr">distPath</span>: <span class="string">&#x27;dist&#x27;</span>,  <span class="comment">// æœ¬åœ°æ‰“åŒ…distç›®å½•</span></span><br><span class="line">    <span class="attr">webDir</span>: <span class="string">&#x27;/MyProject/docker/nginx/html&#x27;</span>,  <span class="comment">// // æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">prod</span>: &#123;  <span class="comment">// çº¿ä¸Šç¯å¢ƒ</span></span><br><span class="line">    åŒä¸Š</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å†è¿˜æœ‰å¤šä½™çš„ç¯å¢ƒæŒ‰ç…§è¿™ä¸ªæ ¼å¼å†™å³å¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å˜é‡éƒ½æœ‰æ³¨é‡Šï¼Œå¯ä»¥åªé…ç½®ä¸€ä¸ªç¯å¢ƒï¼Œåªéœ€è¦æŠŠprodçš„å†…å®¹åˆ é™¤ï¼Œå¦‚æœprodç¯å¢ƒä½ æ²¡æœ‰é…æ‰§è¡Œæ—¶ä¼šæœ‰æŠ¥é”™ã€‚</p>
<p>é…ç½®å®Œï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">deploy dev <span class="comment">//è¿™ä»£è¡¨æ‰“åŒ…å¼€å‘ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¹‹åï¼Œéœ€è¦ä½ ç¡®è®¤ä¸‹ï¼Œè¾“å…¥yeså°±è¡Œï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸ºï¼šæ‰“åŒ…å‰ç«¯é¡¹ç›®â€“&gt;å‹ç¼©æ‰“åŒ…æ–‡ä»¶â€“&gt;å‹ç¼©åŒ…ä¸Šä¼ åˆ°æŒ‡å®šæœåŠ¡å™¨çš„æ–‡ä»¶å¤¹â€“&gt;è§£å‹â€”&gt;éƒ¨ç½²æˆåŠŸ</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
  </entry>
  <entry>
    <title>å¾®ä¿¡æœåŠ¡å¹³å°å¿«é€Ÿå¼€å‘å°ç¨‹åº</title>
    <url>/posts/29622.html</url>
    <content><![CDATA[<h2 id="xu-qiu" id="éœ€æ±‚-3">éœ€æ±‚</h2>
<p>æ ¹æ®ä¸€ä¸ªå°ç¨‹åºï¼Œå‘å¸ƒä¸€ä¸ªå’Œå…¶ä¸€æ¨¡ä¸€æ ·çš„å°ç¨‹åºã€‚ï¼ˆå¯èƒ½ä¸åªä¸€ä¸ªï¼‰</p>
<p>å¦‚æœæŒ‰å¸¸è§„çš„åšæ³•æ¯ä¸ªå°ç¨‹åºéƒ½éœ€è¦ç»å†è¿™æ ·çš„æ­¥éª¤ï¼šåœ¨å…¬ä¼—å¹³å°ç”³è¯·appidâ€”â€”&gt;æ‹‰ä»£ç åˆ°è‡ªå·±çš„ä»“åº“â€”â€”&gt;æ‰“å¼€ç¼–è¯‘å™¨ç»‘å®šè‡ªå·±çš„appIdâ€”â€”&gt;ä¸Šä¼ ä»£ç åˆ°å…¬ä¼—å¹³å°â€”â€”&gt;å†æäº¤å®¡æ ¸â€”â€”&gt;åœ¨å…¬ä¼—å¹³å°è°ƒæ•´å¼€å‘è®¾ç½®ã€‚</p>
<p>å¦‚æœç”¨å¾®ä¿¡å¼€æ”¾å¹³å°çš„æœåŠ¡å¹³å°å¼€å‘çš„æ­¥éª¤ï¼šåœ¨å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·ç¬¬ä¸‰æ–¹æœåŠ¡å¹³å°â€”â€”&gt;ä¸Šä¼ å°ç¨‹åºæ¨¡æ¿ï¼ˆåªæœ‰ç¬¬ä¸€æ¬¡æœ‰ï¼‰â€”â€”&gt;è°ƒæ¥å£ä¸Šä¼ å°ç¨‹åºä»£ç </p>
<p>â€”â€”&gt;è°ƒæ¥å£æäº¤å®¡æ ¸â€”â€”&gt;è°ƒæ¥å£å‘å¸ƒå°ç¨‹åºã€‚</p>
<p>ä¸Šä¼ å°ç¨‹åºæ¨¡æ¿çš„æ­¥éª¤ï¼šåœ¨å…¬ä¼—å¹³å°ç”³è¯·appidâ€”â€”&gt;åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°çš„ç¬¬ä¸‰æ–¹æœåŠ¡å¹³å°ä¸­æ·»åŠ å¼€å‘å°ç¨‹åºâ€”â€”&gt;ä¸Šä¼ å°ç¨‹åºä»£ç ï¼ˆæ­¤æ—¶ä¼šç›´æ¥ä¸Šä¼ åˆ°äº†å¼€æ”¾å¹³å°çš„è‰ç¨¿ç®±ï¼‰â€”â€”&gt;å°†è‰ç¨¿ç®±çš„ä»£ç ä½œä¸ºæ™®é€šæ¨¡æ¿</p>
<p>è¿™å°±æ˜¯æœåŠ¡å¹³å°å¼€å‘å¹³å°çš„ä¾¿æ·ï¼Œåªéœ€ä¸Šä¼ ä¸€æ¬¡å°ç¨‹åºä»£ç ï¼Œå°±å¯ä»¥å¿«é€Ÿçš„å‘å¸ƒå°ç¨‹åºã€‚</p>
<span id="more"></span>
<h2 id="shi-xian" id="å®ç°-3">å®ç°</h2>
<h3 id="bu-zou-huo-qu-component-verify-ticket-gt-huo-qu-component-access-token-gt-huo-qu-authorizer-access-token-gt-diao-jie-kou-fa-bu-xiao-cheng-xu" id="æ­¥éª¤ï¼šè·å–component-verify-ticketâ€”â€”-è·å–component-access-tokenâ€”â€”-è·å–authorizer-access-tokenâ€”â€”-è°ƒæ¥å£å‘å¸ƒå°ç¨‹åº">æ­¥éª¤ï¼šè·å–component_verify_ticketâ€”â€”&gt;è·å–component_access_tokenâ€”â€”&gt;è·å–authorizer_access_tokenâ€”â€”&gt;è°ƒæ¥å£å‘å¸ƒå°ç¨‹åº</h3>
<h3 id="1-huo-qu-component-verify-ticket" id="1ã€è·å–component-verify-ticket">1ã€è·å–component_verify_ticket</h3>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/component_verify_ticket.html">éªŒè¯ç¥¨æ® | å¾®ä¿¡å¼€æ”¾æ–‡æ¡£ (qq.com)</a></p>
<h3 id="" id="-2"></h3>
<p>å› ä¸ºè¿™ä¸ªéªŒè¯ç¥¨æ®æ˜¯å¾®ä¿¡å®˜æ–¹ä¸»åŠ¨æ¨é€çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç¬¬ä¸‰æ–¹å¹³å°é…ç½®ä¸€æ³¢</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/202201271429448.png" alt="image-20220127142943253" /></p>
<h4 id="controller" id="controller">controller</h4>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@ApiOperation</span>(value = <span class="string">&quot;å¾®ä¿¡å¼€æ”¾å¹³å°ï¼šæˆæƒäº‹ä»¶æ¥æ”¶URL,éªŒè¯ç¥¨æ®&quot;</span>, notes = <span class="string">&quot;zhuguangliang&quot;</span>)</span><br><span class="line"><span class="variable">@AnonymousPostMapping</span>(<span class="string">&quot;/pushTicket&quot;</span>)</span><br><span class="line">public String wechatPlatformEvent(<span class="variable">@RequestParam</span>(<span class="string">&quot;timestamp&quot;</span>) String timestamp,</span><br><span class="line">                          <span class="variable">@RequestParam</span>(<span class="string">&quot;nonce&quot;</span>) String nonce,</span><br><span class="line">                          <span class="variable">@RequestParam</span>(<span class="string">&quot;msg_signature&quot;</span>) String msgSignature,</span><br><span class="line">                          <span class="variable">@RequestBody</span> String postData) &#123;</span><br><span class="line">   <span class="selector-tag">return</span> <span class="selector-tag">openPlatformUtil</span><span class="selector-class">.parseRequest</span>(timestamp, nonce, msgSignature, postData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="shi-xian-lei" id="å®ç°ç±»">å®ç°ç±»</h4>
<p>å…³äºå­˜å‚¨component_verify_ticketæ–¹æ¡ˆï¼Œæˆ‘è¿™é‡Œæ˜¯mysqlå’Œrediså„å­˜ä¸€ä»½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">parseRequest</span><span class="params">(String timeStamp, String nonce, String msgSignature, String postData)</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (redisUtils.hasKey(CacheKey.OPEN_PLATFORM_TICKET)) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">            <span class="comment">//è¿™ä¸ªç±»æ˜¯å¾®ä¿¡å®˜ç½‘æä¾›çš„è§£å¯†ç±»,éœ€è¦ç”¨åˆ°æ¶ˆæ¯æ ¡éªŒToken æ¶ˆæ¯åŠ å¯†Keyå’ŒæœåŠ¡å¹³å°appid</span></span><br><span class="line">			<span class="type">WXBizMsgCrypt</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WXBizMsgCrypt</span>(Token, Key, APPID);</span><br><span class="line">			<span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> pc.decryptMsg(msgSignature, timeStamp, nonce, postData);</span><br><span class="line">			Map&lt;String, String&gt; result = WXXmlToMapUtil.xmlToMap(xml);<span class="comment">// å°†xmlè½¬ä¸ºmap</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">componentVerifyTicket</span> <span class="operator">=</span> result.get(<span class="string">&quot;ComponentVerifyTicket&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (StringUtils.isNotEmpty(componentVerifyTicket)) &#123;</span><br><span class="line">				<span class="comment">// å­˜å‚¨å¹³å°æˆæƒç¥¨æ®,ä¿å­˜ticket</span></span><br><span class="line">				<span class="type">SpiritOpenPlatform</span> <span class="variable">spiritOpenPlatform</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpiritOpenPlatform</span>();</span><br><span class="line">				<span class="keyword">if</span> (platformMapper.selectByAppId(APPID) == <span class="number">0</span>) &#123;</span><br><span class="line">					spiritOpenPlatform.setAppid(APPID);</span><br><span class="line">					spiritOpenPlatform.setAppSecret(AppSecret);</span><br><span class="line">					spiritOpenPlatform.setPlatformKey(Key);</span><br><span class="line">					spiritOpenPlatform.setToken(Token);</span><br><span class="line">					spiritOpenPlatform.setComponentVerifyTicket(componentVerifyTicket);</span><br><span class="line">					platformMapper.insert(spiritOpenPlatform);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					spiritOpenPlatform.setComponentVerifyTicket(componentVerifyTicket);</span><br><span class="line">					LambdaUpdateWrapper&lt;SpiritOpenPlatform&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">					updateWrapper.eq(SpiritOpenPlatform::getAppid, APPID);</span><br><span class="line">					platformMapper.update(spiritOpenPlatform, updateWrapper);</span><br><span class="line">				&#125;</span><br><span class="line">				redisUtils.set(CacheKey.OPEN_PLATFORM_TICKET, componentVerifyTicket, <span class="number">60</span> * <span class="number">60</span> * <span class="number">12</span>);</span><br><span class="line">				log.info(<span class="string">&quot;å¾®ä¿¡å¼€æ”¾å¹³å°ï¼Œç¬¬ä¸‰æ–¹å¹³å°è·å–ã€éªŒè¯ç¥¨æ®ã€‘æˆåŠŸ&quot;</span>);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				log.error(<span class="string">&quot;å¾®ä¿¡å¼€æ”¾å¹³å°ï¼Œç¬¬ä¸‰æ–¹å¹³å°è·å–ã€éªŒè¯ç¥¨æ®ã€‘å¤±è´¥&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (AesException e) &#123;</span><br><span class="line">			log.error(<span class="string">&quot;å¾®ä¿¡å¼€æ”¾å¹³å°ï¼Œç¬¬ä¸‰æ–¹å¹³å°è·å–ã€éªŒè¯ç¥¨æ®ã€‘å¤±è´¥,å¼‚å¸¸ä¿¡æ¯ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>å®˜æ–¹æä¾›çš„è§£å¯†ç±»ï¼šWXBizMsgCrypt.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Document;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.NodeList;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.InputSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æä¾›æ¥æ”¶å’Œæ¨é€ç»™å…¬ä¼—å¹³å°æ¶ˆæ¯çš„åŠ è§£å¯†æ¥å£(UTF8ç¼–ç çš„å­—ç¬¦ä¸²).</span></span><br><span class="line"><span class="comment"> * &lt;ol&gt;  * &lt;li&gt;ç¬¬ä¸‰æ–¹å›å¤åŠ å¯†æ¶ˆæ¯ç»™å…¬ä¼—å¹³å°&lt;/li&gt;  * &lt;li&gt;ç¬¬ä¸‰æ–¹æ”¶åˆ°å…¬ä¼—å¹³å°å‘é€çš„æ¶ˆæ¯ï¼ŒéªŒè¯æ¶ˆæ¯çš„å®‰å…¨æ€§ï¼Œå¹¶å¯¹æ¶ˆæ¯è¿›è¡Œè§£å¯†ã€‚&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼šå¼‚å¸¸java.security.InvalidKeyException:illegal Key Sizeçš„è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line"><span class="comment"> * &lt;ol&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;åœ¨å®˜æ–¹ç½‘ç«™ä¸‹è½½JCEæ— é™åˆ¶æƒé™ç­–ç•¥æ–‡ä»¶ï¼ˆJDK7çš„ä¸‹è½½åœ°å€ï¼š  *</span></span><br><span class="line"><span class="comment"> * http://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;ä¸‹è½½åè§£å‹ï¼Œå¯ä»¥çœ‹åˆ°local_policy.jarå’ŒUS_export_policy.jarä»¥åŠreadme.txt&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;å¦‚æœå®‰è£…äº†JREï¼Œå°†ä¸¤ä¸ªjaræ–‡ä»¶æ”¾åˆ°%JRE_HOME%\lib\securityç›®å½•ä¸‹è¦†ç›–åŸæ¥çš„æ–‡ä»¶&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;å¦‚æœå®‰è£…äº†JDKï¼Œå°†ä¸¤ä¸ªjaræ–‡ä»¶æ”¾åˆ°%JDK_HOME%\jre\lib\securityç›®å½•ä¸‹è¦†ç›–åŸæ¥æ–‡ä»¶&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WXBizMsgCrypt</span> &#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="type">Charset</span> <span class="variable">CHARSET</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">	<span class="type">Base64</span> <span class="variable">base64</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Base64</span>();</span><br><span class="line">	<span class="type">byte</span>[] aesKey;</span><br><span class="line">	String token;</span><br><span class="line">	String appId;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> token          å…¬ä¼—å¹³å°ä¸Šï¼Œå¼€å‘è€…è®¾ç½®çš„token</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> encodingAesKey å…¬ä¼—å¹³å°ä¸Šï¼Œå¼€å‘è€…è®¾ç½®çš„EncodingAESKey</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> appId          å…¬ä¼—å¹³å°appid</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> AesException æ‰§è¡Œå¤±è´¥ï¼Œè¯·æŸ¥çœ‹è¯¥å¼‚å¸¸çš„é”™è¯¯ç å’Œå…·ä½“çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">WXBizMsgCrypt</span><span class="params">(String token, String encodingAesKey, String appId)</span> <span class="keyword">throws</span> AesException &#123;</span><br><span class="line">		<span class="keyword">if</span> (encodingAesKey.length() != <span class="number">43</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AesException</span>(AesException.IllegalAesKey);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">this</span>.token = token;</span><br><span class="line">		<span class="built_in">this</span>.appId = appId;</span><br><span class="line">		aesKey = Base64.decodeBase64(encodingAesKey + <span class="string">&quot;=&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿˜åŸ4ä¸ªå­—èŠ‚çš„ç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line">	<span class="type">int</span> <span class="title function_">recoverNetworkBytesOrder</span><span class="params">(<span class="type">byte</span>[] orderBytes)</span> &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">sourceNumber</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			sourceNumber &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">			sourceNumber |= orderBytes[i] &amp; <span class="number">0xff</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sourceNumber;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> text éœ€è¦è§£å¯†çš„å¯†æ–‡</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> è§£å¯†å¾—åˆ°çš„æ˜æ–‡</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> AesException aesè§£å¯†å¤±è´¥</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String <span class="title function_">decrypt</span><span class="params">(String text)</span> <span class="keyword">throws</span> AesException &#123;</span><br><span class="line">		<span class="type">byte</span>[] original;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// è®¾ç½®è§£å¯†æ¨¡å¼ä¸ºAESçš„CBCæ¨¡å¼</span></span><br><span class="line">			<span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/CBC/NoPadding&quot;</span>);</span><br><span class="line">			<span class="type">SecretKeySpec</span> <span class="variable">key_spec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(aesKey, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">			<span class="type">IvParameterSpec</span> <span class="variable">iv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(Arrays.copyOfRange(aesKey, <span class="number">0</span>, <span class="number">16</span>));</span><br><span class="line">			cipher.init(Cipher.DECRYPT_MODE, key_spec, iv);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// ä½¿ç”¨BASE64å¯¹å¯†æ–‡è¿›è¡Œè§£ç </span></span><br><span class="line">			<span class="type">byte</span>[] encrypted = Base64.decodeBase64(text);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// è§£å¯†</span></span><br><span class="line">			original = cipher.doFinal(encrypted);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AesException</span>(AesException.DecryptAESError);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		String xmlContent, from_appid;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// å»é™¤è¡¥ä½å­—ç¬¦</span></span><br><span class="line">			<span class="type">byte</span>[] bytes = PKCS7Encoder.decode(original);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// åˆ†ç¦»16ä½éšæœºå­—ç¬¦ä¸²,ç½‘ç»œå­—èŠ‚åºå’ŒAppId</span></span><br><span class="line">			<span class="type">byte</span>[] networkOrder = Arrays.copyOfRange(bytes, <span class="number">16</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">			<span class="type">int</span> <span class="variable">xmlLength</span> <span class="operator">=</span> recoverNetworkBytesOrder(networkOrder);</span><br><span class="line"></span><br><span class="line">			xmlContent = <span class="keyword">new</span> <span class="title class_">String</span>(Arrays.copyOfRange(bytes, <span class="number">20</span>, <span class="number">20</span> + xmlLength), CHARSET);</span><br><span class="line">			from_appid =</span><br><span class="line">					<span class="keyword">new</span> <span class="title class_">String</span>(Arrays.copyOfRange(bytes, <span class="number">20</span> + xmlLength, bytes.length), CHARSET);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AesException</span>(AesException.IllegalBuffer);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// appidä¸ç›¸åŒçš„æƒ…å†µ</span></span><br><span class="line">		<span class="keyword">if</span> (!from_appid.equals(appId)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AesException</span>(AesException.ValidateSignatureError);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> xmlContent;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * * æ£€éªŒæ¶ˆæ¯çš„çœŸå®æ€§ï¼Œå¹¶ä¸”è·å–è§£å¯†åçš„æ˜æ–‡.</span></span><br><span class="line"><span class="comment">	 * &lt;ol&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;li&gt;åˆ©ç”¨æ”¶åˆ°çš„å¯†æ–‡ç”Ÿæˆå®‰å…¨ç­¾åï¼Œè¿›è¡Œç­¾åéªŒè¯&lt;/li&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;li&gt;è‹¥éªŒè¯é€šè¿‡ï¼Œåˆ™æå–xmlä¸­çš„åŠ å¯†æ¶ˆæ¯&lt;/li&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;li&gt;å¯¹æ¶ˆæ¯è¿›è¡Œè§£å¯†&lt;/li&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> msgSignature ç­¾åä¸²ï¼Œå¯¹åº”URLå‚æ•°çš„msg_signature</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> timeStamp    æ—¶é—´æˆ³ï¼Œå¯¹åº”URLå‚æ•°çš„timestamp</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> nonce        éšæœºä¸²ï¼Œå¯¹åº”URLå‚æ•°çš„nonce</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> postData     å¯†æ–‡ï¼Œå¯¹åº”POSTè¯·æ±‚çš„æ•°æ®</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> è§£å¯†åçš„åŸæ–‡</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> AesException æ‰§è¡Œå¤±è´¥ï¼Œè¯·æŸ¥çœ‹è¯¥å¼‚å¸¸çš„é”™è¯¯ç å’Œå…·ä½“çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">decryptMsg</span><span class="params">(String msgSignature, String timeStamp, String nonce, String postData)</span></span><br><span class="line">			<span class="keyword">throws</span> AesException &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¯†é’¥ï¼Œå…¬ä¼—è´¦å·çš„app secret</span></span><br><span class="line">		<span class="comment">// æå–å¯†æ–‡</span></span><br><span class="line">		Object[] encrypt = extract(postData);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// éªŒè¯å®‰å…¨ç­¾å</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">signature</span> <span class="operator">=</span> getSHA1(token, timeStamp, nonce, encrypt[<span class="number">1</span>].toString());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å’ŒURLä¸­çš„ç­¾åæ¯”è¾ƒæ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">		<span class="comment">// System.out.println(&quot;ç¬¬ä¸‰æ–¹æ”¶åˆ°URLä¸­çš„ç­¾åï¼š&quot; + msg_sign);</span></span><br><span class="line">		<span class="comment">// System.out.println(&quot;ç¬¬ä¸‰æ–¹æ ¡éªŒç­¾åï¼š&quot; + signature);</span></span><br><span class="line">		<span class="keyword">if</span> (!signature.equals(msgSignature)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AesException</span>(AesException.ValidateSignatureError);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// è§£å¯†</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> decrypt(encrypt[<span class="number">1</span>].toString());</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æå–å‡ºxmlæ•°æ®åŒ…ä¸­çš„åŠ å¯†æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> xmltext å¾…æå–çš„xmlå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> æå–å‡ºçš„åŠ å¯†æ¶ˆæ¯å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> AesException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Object[] extract(String xmltext) <span class="keyword">throws</span> AesException &#123;</span><br><span class="line">		Object[] result = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">3</span>];</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">			dbf.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">			dbf.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">			dbf.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">			dbf.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">			dbf.setXIncludeAware(<span class="literal">false</span>);</span><br><span class="line">			dbf.setExpandEntityReferences(<span class="literal">false</span>);</span><br><span class="line">			<span class="type">DocumentBuilder</span> <span class="variable">db</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line">			<span class="type">StringReader</span> <span class="variable">sr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringReader</span>(xmltext);</span><br><span class="line">			<span class="type">InputSource</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(sr);</span><br><span class="line">			<span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> db.parse(is);</span><br><span class="line"></span><br><span class="line">			<span class="type">Element</span> <span class="variable">root</span> <span class="operator">=</span> document.getDocumentElement();</span><br><span class="line">			<span class="type">NodeList</span> <span class="variable">nodelist1</span> <span class="operator">=</span> root.getElementsByTagName(<span class="string">&quot;Encrypt&quot;</span>);</span><br><span class="line">			<span class="type">NodeList</span> <span class="variable">nodelist2</span> <span class="operator">=</span> root.getElementsByTagName(<span class="string">&quot;ToUserName&quot;</span>);</span><br><span class="line">			result[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">			result[<span class="number">1</span>] = nodelist1.item(<span class="number">0</span>).getTextContent();</span><br><span class="line"></span><br><span class="line">			<span class="comment">//æ³¨æ„è¿™é‡Œ,è·å–ticketä¸­çš„xmlé‡Œé¢æ²¡æœ‰ToUserNameè¿™ä¸ªå…ƒç´ ,å®˜ç½‘åŸç¤ºä¾‹ä»£ç åœ¨è¿™é‡Œä¼šæŠ¥ç©º</span></span><br><span class="line">			<span class="comment">//ç©ºæŒ‡é’ˆ,æ‰€ä»¥éœ€è¦å¤„ç†ä¸€ä¸‹</span></span><br><span class="line">			<span class="keyword">if</span> (nodelist2 != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (nodelist2.item(<span class="number">0</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">					result[<span class="number">2</span>] = nodelist2.item(<span class="number">0</span>).getTextContent();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AesException</span>(AesException.ParseXmlError);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç”¨SHA1ç®—æ³•ç”Ÿæˆå®‰å…¨ç­¾å</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> token     ç¥¨æ®</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> timestamp æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> nonce     éšæœºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> encrypt   å¯†æ–‡</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> å®‰å…¨ç­¾å</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> AesException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getSHA1</span><span class="params">(String token, String timestamp, String nonce, String encrypt)</span></span><br><span class="line">			<span class="keyword">throws</span> AesException &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			String[] array = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;token, timestamp, nonce, encrypt&#125;;</span><br><span class="line">			<span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">			<span class="comment">// å­—ç¬¦ä¸²æ’åº</span></span><br><span class="line">			Arrays.sort(array);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">				sb.append(array[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">			<span class="comment">// SHA1ç­¾åç”Ÿæˆ</span></span><br><span class="line">			<span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>);</span><br><span class="line">			md.update(str.getBytes());</span><br><span class="line">			<span class="type">byte</span>[] digest = md.digest();</span><br><span class="line"></span><br><span class="line">			<span class="type">StringBuffer</span> <span class="variable">hexstr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">			<span class="type">String</span> <span class="variable">shaHex</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; digest.length; i++) &#123;</span><br><span class="line">				shaHex = Integer.toHexString(digest[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">				<span class="keyword">if</span> (shaHex.length() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">					hexstr.append(<span class="number">0</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				hexstr.append(shaHex);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> hexstr.toString();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AesException</span>(AesException.ComputeSignatureError);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PKCS7Encode.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æä¾›åŸºäºPKCS7ç®—æ³•çš„åŠ è§£å¯†æ¥å£.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PKCS7Encoder</span> &#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="type">Charset</span> <span class="variable">CHARSET</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">	<span class="keyword">static</span> <span class="type">int</span> <span class="variable">BLOCK_SIZE</span> <span class="operator">=</span> <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * è·å¾—å¯¹æ˜æ–‡è¿›è¡Œè¡¥ä½å¡«å……çš„å­—èŠ‚.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> count éœ€è¦è¿›è¡Œå¡«å……è¡¥ä½æ“ä½œçš„æ˜æ–‡å­—èŠ‚ä¸ªæ•°</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> è¡¥é½ç”¨çš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="type">byte</span>[] encode(<span class="type">int</span> count) &#123;</span><br><span class="line">		<span class="comment">// è®¡ç®—éœ€è¦å¡«å……çš„ä½æ•°</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">amountToPad</span> <span class="operator">=</span> BLOCK_SIZE - (count % BLOCK_SIZE);</span><br><span class="line">		<span class="keyword">if</span> (amountToPad == <span class="number">0</span>) &#123;</span><br><span class="line">			amountToPad = BLOCK_SIZE;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// è·å¾—è¡¥ä½æ‰€ç”¨çš„å­—ç¬¦</span></span><br><span class="line">		<span class="type">char</span> <span class="variable">padChr</span> <span class="operator">=</span> chr(amountToPad);</span><br><span class="line">		<span class="type">String</span> <span class="variable">tmp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; amountToPad; index++) &#123;</span><br><span class="line">			tmp += padChr;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tmp.getBytes(CHARSET);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * åˆ é™¤è§£å¯†åæ˜æ–‡çš„è¡¥ä½å­—ç¬¦</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> decrypted è§£å¯†åçš„æ˜æ–‡</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> åˆ é™¤è¡¥ä½å­—ç¬¦åçš„æ˜æ–‡</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="type">byte</span>[] decode(<span class="type">byte</span>[] decrypted) &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">pad</span> <span class="operator">=</span> (<span class="type">int</span>) decrypted[decrypted.length - <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">if</span> (pad &lt; <span class="number">1</span> || pad &gt; <span class="number">32</span>) &#123;</span><br><span class="line">			pad = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Arrays.copyOfRange(decrypted, <span class="number">0</span>, decrypted.length - pad);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å°†æ•°å­—è½¬åŒ–æˆASCIIç å¯¹åº”çš„å­—ç¬¦ï¼Œç”¨äºå¯¹æ˜æ–‡è¿›è¡Œè¡¥ç </span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> a éœ€è¦è½¬åŒ–çš„æ•°å­—</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> è½¬åŒ–å¾—åˆ°çš„å­—ç¬¦</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="type">char</span> <span class="title function_">chr</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">		<span class="type">byte</span> <span class="variable">target</span> <span class="operator">=</span> (<span class="type">byte</span>) (a &amp; <span class="number">0xFF</span>);</span><br><span class="line">		<span class="keyword">return</span> (<span class="type">char</span>) target;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WXXmlToMapUtil.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.dom4j.Document;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.DocumentException;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.DocumentHelper;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Element;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.OutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.XMLWriter;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Node;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.NodeList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.OutputKeys;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Transformer;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.dom.DOMSource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.stream.StreamResult;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringReader;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WXXmlToMapUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(WXXmlToMapUtil.class);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * XMLæ ¼å¼å­—ç¬¦ä¸²è½¬æ¢ä¸ºMap</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> xml XMLå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> XMLæ•°æ®è½¬æ¢åçš„Map</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">xmlToMap</span><span class="params">(String xml)</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Map&lt;String, String&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">			<span class="type">DocumentBuilderFactory</span> <span class="variable">documentBuilderFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">			<span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> documentBuilderFactory.newDocumentBuilder();</span><br><span class="line">			<span class="type">InputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(xml.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">			org.w3c.dom.<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> documentBuilder.parse(stream);</span><br><span class="line">			doc.getDocumentElement().normalize();</span><br><span class="line">			<span class="type">NodeList</span> <span class="variable">nodeList</span> <span class="operator">=</span> doc.getDocumentElement().getChildNodes();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>; idx &lt; nodeList.getLength(); ++idx) &#123;</span><br><span class="line">				<span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> nodeList.item(idx);</span><br><span class="line">				<span class="keyword">if</span> (node.getNodeType() == Node.ELEMENT_NODE) &#123;</span><br><span class="line">					org.w3c.dom.<span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> (org.w3c.dom.Element) node;</span><br><span class="line">					data.put(element.getNodeName(), element.getTextContent());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			stream.close();</span><br><span class="line">			<span class="keyword">return</span> data;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å°†Mapè½¬æ¢ä¸ºXMLæ ¼å¼çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> data Mapç±»å‹æ•°æ®</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> XMLæ ¼å¼çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">mapToXml</span><span class="params">(Map&lt;String, String&gt; data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DocumentBuilderFactory</span> <span class="variable">documentBuilderFactory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">			<span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> documentBuilderFactory.newDocumentBuilder();</span><br><span class="line">			org.w3c.dom.<span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> documentBuilder.newDocument();</span><br><span class="line">			org.w3c.dom.<span class="type">Element</span> <span class="variable">root</span> <span class="operator">=</span> document.createElement(<span class="string">&quot;xml&quot;</span>);</span><br><span class="line">			document.appendChild(root);</span><br><span class="line">			<span class="keyword">for</span> (String key : data.keySet()) &#123;</span><br><span class="line">				<span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> data.get(key);</span><br><span class="line">				<span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">					value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				value = value.trim();</span><br><span class="line">				org.w3c.dom.<span class="type">Element</span> <span class="variable">filed</span> <span class="operator">=</span> document.createElement(key);</span><br><span class="line">				filed.appendChild(document.createTextNode(value));</span><br><span class="line">				root.appendChild(filed);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="type">TransformerFactory</span> <span class="variable">tf</span> <span class="operator">=</span> TransformerFactory.newInstance();</span><br><span class="line">			<span class="type">Transformer</span> <span class="variable">transformer</span> <span class="operator">=</span> tf.newTransformer();</span><br><span class="line">			<span class="type">DOMSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DOMSource</span>(document);</span><br><span class="line">			transformer.setOutputProperty(OutputKeys.ENCODING, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			transformer.setOutputProperty(OutputKeys.INDENT, <span class="string">&quot;yes&quot;</span>);</span><br><span class="line">			<span class="type">StringWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();</span><br><span class="line">			<span class="type">StreamResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StreamResult</span>(writer);</span><br><span class="line">			transformer.transform(source, result);</span><br><span class="line">			<span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> writer.getBuffer().toString(); <span class="comment">//.replaceAll(&quot;\n|\r&quot;, &quot;&quot;);</span></span><br><span class="line">			writer.close();</span><br><span class="line">			<span class="keyword">return</span> output;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * (å¤šå±‚)xmlæ ¼å¼å­—ç¬¦ä¸²è½¬æ¢ä¸ºmap</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> xml xmlå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> ç¬¬ä¸€ä¸ªä¸ºRootèŠ‚ç‚¹ï¼ŒRootèŠ‚ç‚¹ä¹‹åä¸ºRootçš„å…ƒç´ ï¼Œå¦‚æœä¸ºå¤šå±‚ï¼Œå¯ä»¥é€šè¿‡keyè·å–ä¸‹ä¸€å±‚Map</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title function_">multilayerXmlToMap</span><span class="params">(String xml)</span> &#123;</span><br><span class="line">		<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			doc = DocumentHelper.parseText(xml);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (DocumentException e) &#123;</span><br><span class="line">			logger.error(<span class="string">&quot;xmlå­—ç¬¦ä¸²è§£æï¼Œå¤±è´¥ --&gt; &#123;&#125;&quot;</span>, e);</span><br><span class="line">		&#125;</span><br><span class="line">		Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == doc) &#123;</span><br><span class="line">			<span class="keyword">return</span> map;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// è·å–æ ¹å…ƒç´ </span></span><br><span class="line">		<span class="type">Element</span> <span class="variable">rootElement</span> <span class="operator">=</span> doc.getRootElement();</span><br><span class="line">		recursionXmlToMap(rootElement, map);</span><br><span class="line">		<span class="keyword">return</span> map;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * multilayerXmlToMapæ ¸å¿ƒæ–¹æ³•ï¼Œé€’å½’è°ƒç”¨</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> element èŠ‚ç‚¹å…ƒç´ </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> outmap  ç”¨äºå­˜å‚¨xmlæ•°æ®çš„map</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">recursionXmlToMap</span><span class="params">(Element element, Map&lt;String, Object&gt; outmap)</span> &#123;</span><br><span class="line">		<span class="comment">// å¾—åˆ°æ ¹å…ƒç´ ä¸‹çš„å­å…ƒç´ åˆ—è¡¨</span></span><br><span class="line">		List&lt;Element&gt; list = element.elements();</span><br><span class="line">		<span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> list.size();</span><br><span class="line">		<span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">// å¦‚æœæ²¡æœ‰å­å…ƒç´ ,åˆ™å°†å…¶å­˜å‚¨è¿›mapä¸­</span></span><br><span class="line">			outmap.put(element.getName(), element.getTextTrim());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// innermapç”¨äºå­˜å‚¨å­å…ƒç´ çš„å±æ€§åå’Œå±æ€§å€¼</span></span><br><span class="line">			Map&lt;String, Object&gt; innermap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">			<span class="comment">// éå†å­å…ƒç´ </span></span><br><span class="line">			list.forEach(childElement -&gt; recursionXmlToMap(childElement, innermap));</span><br><span class="line">			outmap.put(element.getName(), innermap);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * (å¤šå±‚)mapè½¬æ¢ä¸ºxmlæ ¼å¼å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> map     éœ€è¦è½¬æ¢ä¸ºxmlçš„map</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> isCDATA æ˜¯å¦åŠ å…¥CDATAæ ‡è¯†ç¬¦ true:åŠ å…¥ false:ä¸åŠ å…¥</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> xmlå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">multilayerMapToXml</span><span class="params">(Map&lt;String, Object&gt; map, <span class="type">boolean</span> isCDATA)</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">parentName</span> <span class="operator">=</span> <span class="string">&quot;xml&quot;</span>;</span><br><span class="line">		<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> DocumentHelper.createDocument();</span><br><span class="line">		doc.addElement(parentName);</span><br><span class="line">		<span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> recursionMapToXml(doc.getRootElement(), parentName, map, isCDATA);</span><br><span class="line">		<span class="keyword">return</span> formatXML(xml);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * multilayerMapToXmlæ ¸å¿ƒæ–¹æ³•ï¼Œé€’å½’è°ƒç”¨</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> element    èŠ‚ç‚¹å…ƒç´ </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> parentName æ ¹å…ƒç´ å±æ€§å</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> map        éœ€è¦è½¬æ¢ä¸ºxmlçš„map</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> isCDATA    æ˜¯å¦åŠ å…¥CDATAæ ‡è¯†ç¬¦ true:åŠ å…¥ false:ä¸åŠ å…¥</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> xmlå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">recursionMapToXml</span><span class="params">(Element element, String parentName, Map&lt;String, Object&gt; map, <span class="type">boolean</span> isCDATA)</span> &#123;</span><br><span class="line">		<span class="type">Element</span> <span class="variable">xmlElement</span> <span class="operator">=</span> element.addElement(parentName);</span><br><span class="line">		map.keySet().forEach(key -&gt; &#123;</span><br><span class="line">			<span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">			<span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Map) &#123;</span><br><span class="line">				recursionMapToXml(xmlElement, key, (Map&lt;String, Object&gt;) obj, isCDATA);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> obj == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : obj.toString();</span><br><span class="line">				<span class="keyword">if</span> (isCDATA) &#123;</span><br><span class="line">					xmlElement.addElement(key).addCDATA(value);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					xmlElement.addElement(key).addText(value);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="keyword">return</span> xmlElement.asXML();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * æ ¼å¼åŒ–xml,æ˜¾ç¤ºä¸ºå®¹æ˜“çœ‹çš„XMLæ ¼å¼</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> xml éœ€è¦æ ¼å¼åŒ–çš„xmlå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">formatXML</span><span class="params">(String xml)</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">requestXML</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// æ‹¿å–è§£æå™¨</span></span><br><span class="line">			<span class="type">SAXReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">			<span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> reader.read(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xml));</span><br><span class="line">			<span class="keyword">if</span> (<span class="literal">null</span> != document) &#123;</span><br><span class="line">				<span class="type">StringWriter</span> <span class="variable">stringWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();</span><br><span class="line">				<span class="comment">// æ ¼å¼åŒ–,æ¯ä¸€çº§å‰çš„ç©ºæ ¼</span></span><br><span class="line">				<span class="type">OutputFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputFormat</span>(<span class="string">&quot;    &quot;</span>, <span class="literal">true</span>);</span><br><span class="line">				<span class="comment">// xmlå£°æ˜ä¸å†…å®¹æ˜¯å¦æ·»åŠ ç©ºè¡Œ</span></span><br><span class="line">				format.setNewLineAfterDeclaration(<span class="literal">false</span>);</span><br><span class="line">				<span class="comment">// æ˜¯å¦è®¾ç½®xmlå£°æ˜å¤´éƒ¨</span></span><br><span class="line">				format.setSuppressDeclaration(<span class="literal">false</span>);</span><br><span class="line">				<span class="comment">// æ˜¯å¦åˆ†è¡Œ</span></span><br><span class="line">				format.setNewlines(<span class="literal">true</span>);</span><br><span class="line">				<span class="type">XMLWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XMLWriter</span>(stringWriter, format);</span><br><span class="line">				writer.write(document);</span><br><span class="line">				writer.flush();</span><br><span class="line">				writer.close();</span><br><span class="line">				requestXML = stringWriter.getBuffer().toString();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> requestXML;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			logger.error(<span class="string">&quot;æ ¼å¼åŒ–xmlï¼Œå¤±è´¥ --&gt; &#123;&#125;&quot;</span>, e);</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AesException.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AesException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">OK</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">ValidateSignatureError</span> <span class="operator">=</span> -<span class="number">40001</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">ParseXmlError</span> <span class="operator">=</span> -<span class="number">40002</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">ComputeSignatureError</span> <span class="operator">=</span> -<span class="number">40003</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">IllegalAesKey</span> <span class="operator">=</span> -<span class="number">40004</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">ValidateCorpidError</span> <span class="operator">=</span> -<span class="number">40005</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">EncryptAESError</span> <span class="operator">=</span> -<span class="number">40006</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">DecryptAESError</span> <span class="operator">=</span> -<span class="number">40007</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">IllegalBuffer</span> <span class="operator">=</span> -<span class="number">40008</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getMessage</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">		<span class="keyword">switch</span> (code) &#123;</span><br><span class="line">			<span class="keyword">case</span> ValidateSignatureError:</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;ç­¾åéªŒè¯é”™è¯¯&quot;</span>;</span><br><span class="line">			<span class="keyword">case</span> ParseXmlError:</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;xmlè§£æå¤±è´¥&quot;</span>;</span><br><span class="line">			<span class="keyword">case</span> ComputeSignatureError:</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;shaåŠ å¯†ç”Ÿæˆç­¾åå¤±è´¥&quot;</span>;</span><br><span class="line">			<span class="keyword">case</span> IllegalAesKey:</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;SymmetricKeyéæ³•&quot;</span>;</span><br><span class="line">			<span class="keyword">case</span> ValidateCorpidError:</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;corpidæ ¡éªŒå¤±è´¥&quot;</span>;</span><br><span class="line">			<span class="keyword">case</span> EncryptAESError:</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;aesåŠ å¯†å¤±è´¥&quot;</span>;</span><br><span class="line">			<span class="keyword">case</span> DecryptAESError:</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;aesè§£å¯†å¤±è´¥&quot;</span>;</span><br><span class="line">			<span class="keyword">case</span> IllegalBuffer:</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&quot;è§£å¯†åå¾—åˆ°çš„bufferéæ³•&quot;</span>;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// cannot be</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	AesException(<span class="type">int</span> code) &#123;</span><br><span class="line">		<span class="built_in">super</span>(getMessage(code));</span><br><span class="line">		<span class="built_in">this</span>.code = code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-huo-qu-component-access-token" id="2ã€è·å–component-access-token">2ã€è·å–component_access_token</h3>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/component_access_token.html">ä»¤ç‰Œ | å¾®ä¿¡å¼€æ”¾æ–‡æ¡£ (qq.com)</a></p>
<h4 id="shi-xian-lei-1" id="å®ç°ç±»-2">å®ç°ç±»</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getComponentAccessToken</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">componentAccessTokenUrl</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/component/api_component_token&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (redisUtils.hasKey(CacheKey.COMPONENT_ACCESS_TOKEN)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (redisUtils.getExpire(CacheKey.COMPONENT_ACCESS_TOKEN) &gt; <span class="number">10</span> * <span class="number">60</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    <span class="comment">//ç¬¬ä¸‰æ–¹å¹³å°çš„appidã€appsecret</span></span><br><span class="line">    params.put(<span class="string">&quot;component_appid&quot;</span>, APPID);</span><br><span class="line">    params.put(<span class="string">&quot;component_appsecret&quot;</span>, AppSecret);</span><br><span class="line">    String component_verify_ticket;</span><br><span class="line">    <span class="keyword">if</span> (redisUtils.hasKey(CacheKey.OPEN_PLATFORM_TICKET)) &#123;</span><br><span class="line">        component_verify_ticket = (String) redisUtils.get(CacheKey.OPEN_PLATFORM_TICKET);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æŸ¥è¯¢æ•°æ®åº“ä¸­çš„component_verify_ticket</span></span><br><span class="line">        component_verify_ticket = platformMapper.selectTicket();</span><br><span class="line">        redisUtils.set(CacheKey.OPEN_PLATFORM_TICKET, component_verify_ticket, <span class="number">60</span> * <span class="number">60</span> * <span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(component_verify_ticket)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(<span class="string">&quot;å¾®ä¿¡å¼€æ”¾å¹³å°ï¼Œç¬¬ä¸‰æ–¹å¹³å°è·å–ã€éªŒè¯ç¥¨æ®ã€‘å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    params.put(<span class="string">&quot;component_verify_ticket&quot;</span>, component_verify_ticket);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">data</span> <span class="operator">=</span> JSONObject.parseObject(HttpUtil.post(componentAccessTokenUrl, JSON.toJSONString(params)));</span><br><span class="line">    <span class="keyword">if</span> (data.containsKey(<span class="string">&quot;component_access_token&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">componentAccessToken</span> <span class="operator">=</span> data.getString(<span class="string">&quot;component_access_token&quot;</span>);</span><br><span class="line">        <span class="comment">//å°†component_access_tokenå­˜å…¥redisä¸­ï¼Œå¹¶è®¾ç½®2ä¸ªå°æ—¶çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        redisUtils.set(CacheKey.COMPONENT_ACCESS_TOKEN, componentAccessToken, <span class="number">60</span> * <span class="number">60</span> * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    redisUtils.del(CacheKey.COMPONENT_ACCESS_TOKEN);</span><br><span class="line">    redisUtils.del(CacheKey.OPEN_PLATFORM_TICKET);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(<span class="string">&quot;è·å–component_access_tokenå¤±è´¥,è¯·é‡è¯•,æ¥å£è¿”å›ä¿¡æ¯ï¼š&quot;</span> + data.toJSONString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-huo-qu-authorizer-access-token" id="3ã€è·å–authorizer-access-token">3ã€è·å–authorizer_access_token</h3>
<h4 id="bu-zou" id="æ­¥éª¤ï¼š">æ­¥éª¤ï¼š</h4>
<h4 id="huo-qu-yu-shou-quan-ma-pre-auth-code-gt-wei-xin-gong-zhong-ping-tai-guan-li-yuan-shou-quan-gt-huo-qu-authorizer-access-token-amp-authorizer-refresh-token" id="è·å–é¢„æˆæƒç pre-auth-codeâ€”â€”-å¾®ä¿¡å…¬ä¼—å¹³å°ç®¡ç†å‘˜æˆæƒâ€”â€”-è·å–authorizer-access-token-authorizer-refresh-token">è·å–é¢„æˆæƒç pre_auth_codeâ€”â€”&gt;å¾®ä¿¡å…¬ä¼—å¹³å°ç®¡ç†å‘˜æˆæƒâ€”â€”&gt;è·å–authorizer_access_token&amp;authorizer_refresh_token</h4>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/Authorization_Process_Technical_Description.html">https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/Before_Develop/Authorization_Process_Technical_Description.html</a></p>
<h4 id="huo-qu-yu-shou-quan-ma-pre-auth-code" id="â‘ è·å–é¢„æˆæƒç pre-auth-code">â‘ è·å–é¢„æˆæƒç pre_auth_code</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getPreAuthCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//å…ˆåˆ¤æ–­component_access_tokenæ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸé‡æ–°è·å–</span></span><br><span class="line">    getComponentAccessToken();</span><br><span class="line">    <span class="type">String</span> <span class="variable">preAuthCodeUrl</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/component/api_create_preauthcode?component_access_token=&quot;</span> + redisUtils.get(CacheKey.COMPONENT_ACCESS_TOKEN);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    params.put(<span class="string">&quot;component_appid&quot;</span>, APPID);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">data</span> <span class="operator">=</span> JSONObject.parseObject(HttpUtil.post(preAuthCodeUrl, JSON.toJSONString(params)));</span><br><span class="line">    <span class="keyword">if</span> (data.containsKey(<span class="string">&quot;pre_auth_code&quot;</span>)) &#123;</span><br><span class="line">    	<span class="keyword">return</span> data.getString(<span class="string">&quot;pre_auth_code&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(<span class="string">&quot;è·å–é¢„æˆæƒå¤±è´¥,æ¥å£è¿”å›ä¿¡æ¯ï¼š&quot;</span> + data.toJSONString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="wei-xin-gong-zhong-ping-tai-guan-li-yuan-shou-quan" id="â‘¡å¾®ä¿¡å…¬ä¼—å¹³å°ç®¡ç†å‘˜æˆæƒ">â‘¡å¾®ä¿¡å…¬ä¼—å¹³å°ç®¡ç†å‘˜æˆæƒ</h4>
<p>ç”Ÿæˆæˆæƒé“¾æ¥ï¼Œå¯ä»¥åœ¨å‰ç«¯ç”¨aæ ‡ç­¾å¡«å…¥è¿™ä¸ªæ¥å£åœ°å€ï¼Œç‚¹å‡»aæ ‡ç­¾æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼Œç®¡ç†å‘˜è¿›è¡Œæ‰«ç æˆæƒ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">toAuthorization</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">authUrl</span> <span class="operator">=</span> <span class="string">&quot;https://mp.weixin.qq.com/cgi-bin/componentloginpagecomponent_appid=%s&amp;pre_auth_code=%s&amp;redirect_uri=%s&amp;auth_type=1&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> <span class="string">&quot;https://æœåŠ¡ç«¯åœ°å€/callback&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">preAuthCode</span> <span class="operator">=</span> getPreAuthCode();</span><br><span class="line">    response.setStatus(<span class="number">301</span>);</span><br><span class="line">    response.sendRedirect(String.format(authUrl, APPID, preAuthCode, redirectUrl));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆæƒä¹‹åï¼Œä¼šå›è°ƒï¼šâ€œ<a href="https://xn--zfry9hnb732hgox/callback">https://æœåŠ¡ç«¯åœ°å€/callback</a>â€ï¼Œå¹¶å°†æˆæƒç auth_codeæºå¸¦åˆ°è¿™ä¸ªæ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;å¾®ä¿¡å¼€æ”¾å¹³å°ï¼šç”¨æˆ·æˆæƒåï¼Œå›è°ƒåœ°å€&quot;, notes = &quot;zhuguangliang&quot;)</span></span><br><span class="line">	<span class="meta">@AnonymousGetMapping(&quot;/callback&quot;)</span></span><br><span class="line">	<span class="meta">@Notice(&quot;2393194918@qq.com&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callback</span><span class="params">(String auth_code)</span> &#123;</span><br><span class="line"><span class="comment">//		openPlatformService.getAuthorizationInfo(auth_code);</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="huo-qu-authorizer-access-token-amp-authorizer-refresh-token" id="â‘¢è·å–authorizer-access-token-authorizer-refresh-token">â‘¢è·å–authorizer_access_token&amp;authorizer_refresh_token</h4>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/authorization_info.html">https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/authorization_info.html</a></p>
<p>è¯´æ˜ï¼šauthorization_codeå°±æ˜¯æˆæƒä¹‹åï¼Œè¿”å›çš„æˆæƒç </p>
<p>å¦‚æœä½ ä½¿ç”¨å¾®ä¿¡çš„ç¬¬ä¸‰æ–¹å¹³å°ç®¡ç†å·¥å…·ï¼Œå¯ä»¥åœ¨æ•°æ®åº“ä¸­ç›´æ¥è·å–authorizer_refresh_tokenï¼Œç„¶åæ ¹æ®ï¼š</p>
<p><a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/ThirdParty/token/api_authorizer_token.html">è·å–/åˆ·æ–°æ¥å£è°ƒç”¨ä»¤ç‰Œ | å¾®ä¿¡å¼€æ”¾æ–‡æ¡£ (qq.com)</a>è¿™ä¸ªæ¥å£è¿›è¡Œåˆ·æ–°authorizer_access_tokenï¼Œä¸‹é¢æ˜¯å®ç°ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span><span class="comment">//authorizerAppIdä¸ºæˆæƒçš„appid</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getAuthorizationInfo</span><span class="params">(String authorizerAppId)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CacheKey.AUTH_ACCESS_TOKEN + authorizerAppId;</span><br><span class="line">    <span class="comment">//è¿™ä¸€æ­¥æ˜¯ä¸ºå¦‚æœå‘ç°è¿™ä¸ªtokenå¿«è¿‡æœŸï¼Œåˆ™åˆ·æ–°</span></span><br><span class="line">    <span class="keyword">if</span> (redisUtils.hasKey(key) &amp;&amp; redisUtils.getExpire(key) &gt; <span class="number">5</span> * <span class="number">60</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    getComponentAccessToken();</span><br><span class="line">    <span class="type">String</span> <span class="variable">refreshTokenUrl</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/component/api_authorizer_token?component_access_token=&quot;</span> + redisUtils.get(CacheKey.COMPONENT_ACCESS_TOKEN);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">param</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    param.put(<span class="string">&quot;component_appid&quot;</span>, APPID);</span><br><span class="line">    param.put(<span class="string">&quot;authorizer_appid&quot;</span>, authorizerAppId);</span><br><span class="line">    String refreshToken;</span><br><span class="line">    <span class="keyword">if</span> (redisUtils.hasKey(CacheKey.AUTH_REFRESH_TOKEN + authorizerAppId)) &#123;</span><br><span class="line">        refreshToken = (String) redisUtils.get(CacheKey.AUTH_REFRESH_TOKEN + authorizerAppId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//ä»å¾®ä¿¡ç¬¬ä¸‰æ–¹ç®¡ç†å·¥å…·çš„æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºauthorizer_refresh_token</span></span><br><span class="line">        refreshToken = platformMapper.selectRefreshTokenByAppId(authorizerAppId);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(refreshToken)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(<span class="string">&quot;å°ç¨‹åºç®¡ç†å‘˜æœªæˆæƒï¼Œè¯·è®©å°ç¨‹åºç®¡ç†å‘˜é‡æ–°æˆæƒ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è®¡ç®—åˆ·æ–°ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">         <span class="comment">//ä»å¾®ä¿¡ç¬¬ä¸‰æ–¹ç®¡ç†å·¥å…·çš„æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºauthorizer_refresh_tokençš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">authTime</span> <span class="operator">=</span> platformMapper.selectAuthTimeByAppId(authorizerAppId).toLocalDateTime();</span><br><span class="line">        <span class="type">Duration</span> <span class="variable">duration</span> <span class="operator">=</span> Duration.between(authTime, LocalDateTime.now());</span><br><span class="line">        redisUtils.set(CacheKey.AUTH_REFRESH_TOKEN + authorizerAppId, refreshToken, <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> - (duration.toMillis() / <span class="number">1000</span> + <span class="number">60</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    param.put(<span class="string">&quot;authorizer_refresh_token&quot;</span>, refreshToken);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">tokenData</span> <span class="operator">=</span> JSONObject.parseObject(HttpUtil.post(refreshTokenUrl, JSON.toJSONString(param)));</span><br><span class="line">    <span class="keyword">if</span> (tokenData.containsKey(<span class="string">&quot;authorizer_access_token&quot;</span>)) &#123;</span><br><span class="line">        redisUtils.set(CacheKey.AUTH_ACCESS_TOKEN + authorizerAppId, tokenData.getString(<span class="string">&quot;authorizer_access_token&quot;</span>), <span class="number">2</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">        LambdaUpdateWrapper&lt;SpiritOpenPlatform&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        updateWrapper.eq(SpiritOpenPlatform::getAppid, authorizerAppId);</span><br><span class="line">        <span class="type">SpiritOpenPlatform</span> <span class="variable">openPlatform</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpiritOpenPlatform</span>();</span><br><span class="line">        openPlatform.setAuthorizerRefreshToken(refreshToken);</span><br><span class="line">        openPlatform.setAuthorizerAccessToken(tokenData.getString(<span class="string">&quot;authorizer_access_token&quot;</span>));</span><br><span class="line">        platformMapper.update(openPlatform, updateWrapper);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadRequestException</span>(<span class="string">&quot;è·å–authorizer_access_tokenå¤±è´¥,æ¥å£è¿”å›ä¿¡æ¯ï¼š&quot;</span> + tokenData.toJSONString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ°æ­¤ï¼Œå¾®ä¿¡ç¬¬ä¸‰æ–¹å¹³å°å¼€å‘ä¸­çš„å…³é”®tokenï¼Œauthorizer_access_tokenå·²ç»æˆåŠŸè·å–</p>
<h3 id="4-diao-jie-kou-fa-bu-xiao-cheng-xu" id="4ã€è°ƒæ¥å£å‘å¸ƒå°ç¨‹åº">4ã€è°ƒæ¥å£å‘å¸ƒå°ç¨‹åº</h3>
<h4 id="ti-jiao-dai-ma-jie-kou-a-href-https-developers-weixin-qq-com-doc-oplatform-third-party-platforms-2-0-api-code-commit-html-shang-chuan-xiao-cheng-xu-dai-ma-bing-sheng-cheng-ti-yan-ban-wei-xin-kai-fang-wen-dang-qq-com-a" id="æäº¤ä»£ç æ¥å£ï¼šä¸Šä¼ å°ç¨‹åºä»£ç å¹¶ç”Ÿæˆä½“éªŒç‰ˆ-å¾®ä¿¡å¼€æ”¾æ–‡æ¡£-qq-com">æäº¤ä»£ç æ¥å£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/code/commit.html">ä¸Šä¼ å°ç¨‹åºä»£ç å¹¶ç”Ÿæˆä½“éªŒç‰ˆ | å¾®ä¿¡å¼€æ”¾æ–‡æ¡£ (qq.com)</a></h4>
<h4 id="she-zhi-yong-hu-yin-si-jie-kou-a-href-https-developers-weixin-qq-com-doc-oplatform-third-party-platforms-2-0-api-privacy-config-set-privacy-setting-html-pei-zhi-xiao-cheng-xu-yong-hu-yin-si-bao-hu-zhi-yin-wei-xin-kai-fang-wen-dang-qq-com-a" id="è®¾ç½®ç”¨æˆ·éšç§æ¥å£ï¼šé…ç½®å°ç¨‹åºç”¨æˆ·éšç§ä¿æŠ¤æŒ‡å¼•-å¾®ä¿¡å¼€æ”¾æ–‡æ¡£-qq-com">è®¾ç½®ç”¨æˆ·éšç§æ¥å£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/privacy_config/set_privacy_setting.html">é…ç½®å°ç¨‹åºç”¨æˆ·éšç§ä¿æŠ¤æŒ‡å¼• | å¾®ä¿¡å¼€æ”¾æ–‡æ¡£ (qq.com)</a></h4>
<h4 id="ti-jiao-shen-he-jie-kou-a-href-https-developers-weixin-qq-com-doc-oplatform-third-party-platforms-2-0-api-code-submit-audit-html-ti-jiao-shen-he-wei-xin-kai-fang-wen-dang-qq-com-a" id="æäº¤å®¡æ ¸æ¥å£ï¼šæäº¤å®¡æ ¸-å¾®ä¿¡å¼€æ”¾æ–‡æ¡£-qq-com">æäº¤å®¡æ ¸æ¥å£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/code/submit_audit.html">æäº¤å®¡æ ¸ | å¾®ä¿¡å¼€æ”¾æ–‡æ¡£ (qq.com)</a></h4>
<h4 id="cha-xun-shen-he-jie-guo-jie-kou-a-href-https-developers-weixin-qq-com-doc-oplatform-third-party-platforms-2-0-api-code-get-latest-auditstatus-html-cha-xun-zui-xin-yi-ci-ti-jiao-de-shen-he-zhuang-tai-wei-xin-kai-fang-wen-dang-qq-com-a" id="æŸ¥è¯¢å®¡æ ¸ç»“æœæ¥å£ï¼šæŸ¥è¯¢æœ€æ–°ä¸€æ¬¡æäº¤çš„å®¡æ ¸çŠ¶æ€-å¾®ä¿¡å¼€æ”¾æ–‡æ¡£-qq-com">æŸ¥è¯¢å®¡æ ¸ç»“æœæ¥å£ï¼š<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/2.0/api/code/get_latest_auditstatus.html">æŸ¥è¯¢æœ€æ–°ä¸€æ¬¡æäº¤çš„å®¡æ ¸çŠ¶æ€ | å¾®ä¿¡å¼€æ”¾æ–‡æ¡£ (qq.com)</a></h4>
<ul>
<li>é¡¹ç›®ä¸­å¯ä»¥é‡‡ç”¨å®šæ—¶ä»»åŠ¡çš„ç­–ç•¥è°ƒç”¨è¯¥æ¥å£</li>
</ul>
<h2 id="zui-hou" id="æœ€å-3">æœ€å</h2>
<p>æ€»ç»“ï¼šå¾®ä¿¡ç¬¬ä¸‰æ–¹å¹³å°å¼€å‘çš„æµç¨‹ï¼Œæ¶‰åŠçš„æ¥å£æœ‰ç‚¹å¤šï¼Œå¾®ä¿¡çš„æ–‡æ¡£å…¶å®ä¹Ÿå†™çš„å¾ˆè¯¦ç»†äº†ï¼Œä½†æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå…ä¸äº†é‡è§è«åå…¶å¦™çš„é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åœ¨å¾®ä¿¡å¼€æ”¾ç¤¾åŒºé‡Œæ‰¾æ‰¾æˆ–è€…æœä¸‹åšå®¢ã€‚</p>
]]></content>
      <categories>
        <category>å¾®ä¿¡å¼€å‘</category>
      </categories>
      <tags>
        <tag>ç¬¬ä¸‰æ–¹å¹³å°</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch</title>
    <url>/posts/22654.html</url>
    <content><![CDATA[<p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ï¼Œèƒ½å¤Ÿè§£å†³ä¸æ–­æ¶Œç°å‡ºçš„å„ç§ç”¨ä¾‹ã€‚ ä½œä¸º Elastic Stack çš„æ ¸å¿ƒï¼Œå®ƒé›†ä¸­å­˜å‚¨æ‚¨çš„æ•°æ®ï¼Œå¸®åŠ©æ‚¨å‘ç°æ„æ–™ä¹‹ä¸­ä»¥åŠæ„æ–™ä¹‹å¤–çš„æƒ…å†µã€‚</p>
<span id="more"></span>
<p>[TOC]</p>
<p>å‚è€ƒè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV17a4y1x7zq">https://www.bilibili.com/video/BV17a4y1x7zq</a></p>
<h1 id="elastic-search">ElasticSearch</h1>
<h2 id="liao-liao-doug-cutting" id="èŠèŠDoug-Cutting">èŠèŠDoug Cutting</h2>
<p>1998å¹´9æœˆ4æ—¥ï¼ŒGoogleå…¬å¸åœ¨ç¾å›½ç¡…è°·æˆç«‹ã€‚æ­£å¦‚å¤§å®¶æ‰€çŸ¥ï¼Œå®ƒæ˜¯ä¸€å®¶åšæœç´¢å¼•æ“èµ·å®¶çš„å…¬å¸ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/75c99654de8d40f0934b31e7d811ad10.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>æ— ç‹¬æœ‰å¶ï¼Œä¸€ä½åå«<strong>Dougâ€‚Cutting</strong>çš„ç¾å›½å·¥ç¨‹å¸ˆï¼Œä¹Ÿè¿·ä¸Šäº†æœç´¢å¼•æ“ã€‚ä»–åšäº†ä¸€ä¸ªç”¨äºæ–‡æœ¬æœç´¢çš„å‡½æ•°åº“ï¼ˆå§‘ä¸”ç†è§£ä¸ºè½¯ä»¶çš„åŠŸèƒ½ç»„ä»¶ï¼‰ï¼Œå‘½åä¸º<strong>Lucene</strong>ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/9acb284104e24e8c9129eabb2c641887.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>Luceneæ˜¯ç”¨JAVAå†™æˆçš„ï¼Œç›®æ ‡æ˜¯ä¸ºå„ç§ä¸­å°å‹åº”ç”¨è½¯ä»¶åŠ å…¥å…¨æ–‡æ£€ç´¢åŠŸèƒ½ã€‚å› ä¸ºå¥½ç”¨è€Œä¸”å¼€æºï¼ˆä»£ç å…¬å¼€ï¼‰ï¼Œéå¸¸å—ç¨‹åºå‘˜ä»¬çš„æ¬¢è¿ã€‚</p>
<p>æ—©æœŸçš„æ—¶å€™ï¼Œè¿™ä¸ªé¡¹ç›®è¢«å‘å¸ƒåœ¨Doug Cuttingçš„ä¸ªäººç½‘ç«™å’ŒSourceForgeï¼ˆä¸€ä¸ªå¼€æºè½¯ä»¶ç½‘ç«™ï¼‰ã€‚åæ¥ï¼Œ2001å¹´åº•ï¼ŒLuceneæˆä¸ºApacheè½¯ä»¶åŸºé‡‘ä¼šjakartaé¡¹ç›®çš„ä¸€ä¸ªå­é¡¹ç›®ã€‚</p>
<p><img data-src="https://img-blog.csdnimg.cn/e8b867eb08e04187955eb67500f1cfbb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>2004å¹´ï¼ŒDoug Cuttingå†æ¥å†åŠ±ï¼Œåœ¨Luceneçš„åŸºç¡€ä¸Šï¼Œå’ŒApacheå¼€æºä¼™ä¼´Mike Cafarellaåˆä½œï¼Œå¼€å‘äº†ä¸€æ¬¾å¯ä»¥ä»£æ›¿å½“æ—¶çš„ä¸»æµæœç´¢çš„å¼€æºæœç´¢å¼•æ“ï¼Œå‘½åä¸º<strong>Nutch</strong>ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/78e9603f45ea412e8a7f34d04cbbe143.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>Nutchæ˜¯ä¸€ä¸ªå»ºç«‹åœ¨Luceneæ ¸å¿ƒä¹‹ä¸Šçš„ç½‘é¡µæœç´¢åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä¸‹è½½ä¸‹æ¥ç›´æ¥ä½¿ç”¨ã€‚å®ƒåœ¨Luceneçš„åŸºç¡€ä¸ŠåŠ äº†ç½‘ç»œçˆ¬è™«å’Œä¸€äº›ç½‘é¡µç›¸å…³çš„åŠŸèƒ½ï¼Œç›®çš„å°±æ˜¯ä»ä¸€ä¸ªç®€å•çš„ç«™å†…æ£€ç´¢æ¨å¹¿åˆ°å…¨çƒç½‘ç»œçš„æœç´¢ä¸Šï¼Œå°±åƒGoogleä¸€æ ·ã€‚</p>
<p>Nutchåœ¨ä¸šç•Œçš„å½±å“åŠ›æ¯”Luceneæ›´å¤§ã€‚</p>
<p>å¤§æ‰¹ç½‘ç«™é‡‡ç”¨äº†Nutchå¹³å°ï¼Œå¤§å¤§é™ä½äº†æŠ€æœ¯é—¨æ§›ï¼Œä½¿ä½æˆæœ¬çš„æ™®é€šè®¡ç®—æœºå–ä»£é«˜ä»·çš„WebæœåŠ¡å™¨æˆä¸ºå¯èƒ½ã€‚ç”šè‡³æœ‰ä¸€æ®µæ—¶é—´ï¼Œåœ¨ç¡…è°·æœ‰äº†ä¸€è‚¡ç”¨Nutchä½æˆæœ¬åˆ›ä¸šçš„æ½®æµã€‚ï¼ˆå¤§æ•°æ®ï¼ï¼‰</p>
<p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ— è®ºæ˜¯Googleè¿˜æ˜¯Nutchï¼Œéƒ½é¢ä¸´æœç´¢å¯¹è±¡â€œä½“ç§¯â€ä¸æ–­å¢å¤§çš„é—®é¢˜ã€‚</p>
<p>å°¤å…¶æ˜¯Googleï¼Œä½œä¸ºäº’è”ç½‘æœç´¢å¼•æ“ï¼Œéœ€è¦å­˜å‚¨å¤§é‡çš„ç½‘é¡µï¼Œå¹¶ä¸æ–­ä¼˜åŒ–è‡ªå·±çš„æœç´¢ç®—æ³•ï¼Œæå‡æœç´¢æ•ˆç‡ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/5d6a6fcb993e42c28b9c0731ec316754.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒGoogleç¡®å®æ‰¾åˆ°äº†ä¸å°‘å¥½åŠæ³•ï¼Œå¹¶ä¸”æ— ç§åœ°åˆ†äº«äº†å‡ºæ¥ã€‚å¼€æºï¼</p>
<p>2003å¹´ï¼ŒGoogleå‘è¡¨äº†ä¸€ç¯‡æŠ€æœ¯å­¦æœ¯è®ºæ–‡ï¼Œå…¬å¼€ä»‹ç»äº†è‡ªå·±çš„è°·æ­Œæ–‡ä»¶ç³»ç»Ÿ <strong>GFSï¼ˆGoogleâ€‚Fileâ€‚Systemï¼‰</strong>ã€‚è¿™æ˜¯Googleå…¬å¸ä¸ºäº†å­˜å‚¨æµ·é‡æœç´¢æ•°æ®è€Œè®¾è®¡çš„ä¸“ç”¨æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>ç¬¬äºŒå¹´ï¼Œä¹Ÿå°±æ˜¯2004å¹´ï¼ŒDougâ€‚CuttingåŸºäºGoogleçš„GFSè®ºæ–‡ï¼Œå®ç°äº†<strong>åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ</strong>ï¼Œå¹¶å°†å®ƒå‘½åä¸º<strong>NDFSï¼ˆNutch Distributed Fileâ€‚Systemï¼‰</strong>ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/b4b2bec3cf7d4f5da174e6dcb4989e96.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>è¿˜æ˜¯2004å¹´ï¼ŒGoogleåˆå‘è¡¨äº†ä¸€ç¯‡æŠ€æœ¯å­¦æœ¯è®ºæ–‡ï¼Œä»‹ç»è‡ªå·±çš„<strong>MapReduceç¼–ç¨‹æ¨¡å‹</strong>ã€‚è¿™ä¸ªç¼–ç¨‹æ¨¡å‹ï¼Œç”¨äºå¤§è§„æ¨¡æ•°æ®é›†ï¼ˆå¤§äº1TBï¼‰çš„å¹¶è¡Œåˆ†æè¿ç®—ã€‚</p>
<p>ç¬¬äºŒå¹´ï¼ˆ2005å¹´ï¼‰ï¼ŒDougâ€‚CuttingåˆåŸºäºMapReduceï¼Œåœ¨Nutchæœç´¢å¼•æ“å®ç°äº†è¯¥åŠŸèƒ½ã€‚</p>
<p><img data-src="https://img-blog.csdnimg.cn/e9ef4a81286b420abf38fb4aacd778d6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>2006å¹´ï¼Œå½“æ—¶ä¾ç„¶å¾ˆå‰å®³çš„<strong>Yahooï¼ˆé›…è™ï¼‰å…¬å¸</strong>ï¼Œæ‹›å®‰äº†Dougâ€‚Cuttingã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/09db6bd51dbc4f26b53976bcd4de8204.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>è¿™é‡Œè¦è¡¥å……è¯´æ˜ä¸€ä¸‹é›…è™æ‹›å®‰Dougçš„èƒŒæ™¯ï¼š2004å¹´ä¹‹å‰ï¼Œä½œä¸ºäº’è”ç½‘å¼€æ‹“è€…çš„é›…è™ï¼Œæ˜¯ä½¿ç”¨Googleæœç´¢å¼•æ“ä½œä¸ºè‡ªå®¶æœç´¢æœåŠ¡çš„ã€‚åœ¨2004å¹´å¼€å§‹ï¼Œé›…è™æ”¾å¼ƒäº†Googleï¼Œå¼€å§‹è‡ªå·±ç ”å‘æœç´¢å¼•æ“ã€‚æ‰€ä»¥ã€‚ã€‚ã€‚</p>
<p>åŠ ç›ŸYahooä¹‹åï¼ŒDougâ€‚Cuttingå°†NDFSå’ŒMapReduceè¿›è¡Œäº†å‡çº§æ”¹é€ ï¼Œå¹¶é‡æ–°å‘½åä¸ºHadoopï¼ˆNDFSä¹Ÿæ”¹åä¸ºHDFSï¼ŒHadoop Distributed Fileâ€‚Systemï¼‰ã€‚</p>
<p>è¿™ä¸ªï¼Œå°±æ˜¯åæ¥å¤§åé¼é¼çš„å¤§æ•°æ®æ¡†æ¶ç³»ç»Ÿâ€”â€”Hadoopçš„ç”±æ¥ã€‚è€ŒDougâ€‚Cuttingï¼Œåˆ™è¢«äººä»¬ç§°ä¸ºHadoopä¹‹çˆ¶ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/e5604e49d5664c5c86dfb83f9aea7ee6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>Hadoopè¿™ä¸ªåå­—ï¼Œå®é™…ä¸Šæ˜¯Dougâ€‚Cuttingä»–å„¿å­çš„é»„è‰²ç©å…·å¤§è±¡çš„åå­—ã€‚æ‰€ä»¥ï¼ŒHadoopçš„Logoï¼Œå°±æ˜¯ä¸€åªå¥”è·‘çš„é»„è‰²å¤§è±¡ã€‚</p>
<p><img data-src="https://img-blog.csdnimg.cn/a1dd755b734c4411bb96130a60268369.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹è¯´ã€‚</p>
<p>è¿˜æ˜¯2006å¹´ï¼ŒGoogleåˆå‘è®ºæ–‡äº†ã€‚</p>
<p>è¿™æ¬¡ï¼Œå®ƒä»¬ä»‹ç»äº†è‡ªå·±çš„<strong>BigTable</strong>ã€‚è¿™æ˜¯ä¸€ç§åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œä¸€ç§ç”¨æ¥å¤„ç†æµ·é‡æ•°æ®çš„éå…³ç³»å‹æ•°æ®åº“ã€‚</p>
<p>Dougâ€‚Cuttingå½“ç„¶æ²¡æœ‰æ”¾è¿‡ï¼Œåœ¨è‡ªå·±çš„hadoopç³»ç»Ÿé‡Œé¢ï¼Œå¼•å…¥äº†BigTableï¼Œå¹¶å‘½åä¸º<strong>HBase</strong>ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/6f813d03dca6447eaa987f841934e4e1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>å¥½å§ï¼Œåæ­£å°±æ˜¯ç´§è·ŸGoogleæ—¶ä»£æ­¥ä¼ï¼Œä½ å‡ºä»€ä¹ˆï¼Œæˆ‘å­¦ä»€ä¹ˆã€‚</p>
<p>æ‰€ä»¥ï¼ŒHadoopçš„æ ¸å¿ƒéƒ¨åˆ†ï¼ŒåŸºæœ¬ä¸Šéƒ½æœ‰Googleçš„å½±å­ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/9fca1eefc8b9472ea705582dd7093a7a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>2008å¹´1æœˆï¼ŒHadoopæˆåŠŸä¸Šä½ï¼Œæ­£å¼æˆä¸ºApacheåŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ã€‚</p>
<p>åŒå¹´2æœˆï¼ŒYahooå®£å¸ƒå»ºæˆäº†ä¸€ä¸ªæ‹¥æœ‰1ä¸‡ä¸ªå†…æ ¸çš„Hadoopé›†ç¾¤ï¼Œå¹¶å°†è‡ªå·±çš„æœç´¢å¼•æ“äº§å“éƒ¨ç½²åœ¨ä¸Šé¢ã€‚</p>
<p>7æœˆï¼ŒHadoopæ‰“ç ´ä¸–ç•Œçºªå½•ï¼Œæˆä¸ºæœ€å¿«æ’åº1TBæ•°æ®çš„ç³»ç»Ÿï¼Œç”¨æ—¶209ç§’ã€‚</p>
<p><strong>å›åˆ°ä¸»é¢˜</strong></p>
<p>åœ¨å­¦ä¹ ElasticSearchä¹‹å‰ï¼Œå…ˆç®€å•äº†è§£ä¸€ä¸‹Luceneï¼š</p>
<ul>
<li>
<p>Doug Cuttingå¼€å‘</p>
</li>
<li>
<p>æ˜¯apacheè½¯ä»¶åŸºé‡‘ä¼š4 jakartaé¡¹ç›®ç»„çš„ä¸€ä¸ªå­é¡¹ç›®</p>
</li>
<li>
<p>æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„å…¨æ–‡æ£€ç´¢å¼•æ“å·¥å…·åŒ…</p>
</li>
<li>
<p>ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„å…¨æ–‡æ£€ç´¢å¼•æ“ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å¼•æ“çš„æ¶æ„ï¼Œæä¾›äº†å®Œæ•´çš„æŸ¥è¯¢å¼•æ“å’Œç´¢å¼•å¼•æ“ï¼Œéƒ¨åˆ†æ–‡æœ¬åˆ†æå¼•æ“ï¼ˆè‹±æ–‡ä¸å¾·æ–‡ä¸¤ç§è¥¿æ–¹è¯­è¨€ï¼‰</p>
</li>
<li>
<p>å½“å‰ä»¥åŠæœ€è¿‘å‡ å¹´æœ€å—æ¬¢è¿çš„å…è´¹Javaä¿¡æ¯æ£€ç´¢ç¨‹åºåº“ã€‚</p>
</li>
</ul>
<p><strong>Luceneå’ŒElasticSearchçš„å…³ç³»ï¼š</strong></p>
<ul>
<li>ElasticSearchæ˜¯åŸºäºLucene åšäº†ä¸€ä¸‹å°è£…å’Œå¢å¼º</li>
</ul>
<h2 id="yi-elastic-search-gai-shu" id="ä¸€ã€ElasticSearchæ¦‚è¿°">ä¸€ã€ElasticSearchæ¦‚è¿°</h2>
<p>Elaticsearchï¼Œç®€ç§°ä¸ºesï¼Œesæ˜¯ä¸€ä¸ªå¼€æºçš„é«˜æ‰©å±•çš„<mark>åˆ†å¸ƒå¼å…¨æ–‡æ£€ç´¢å¼•æ“</mark>ï¼Œå®ƒå¯ä»¥è¿‘ä¹<mark>å®æ—¶çš„å­˜å‚¨ã€æ£€ç´¢æ•°æ®</mark>;æœ¬èº«æ‰©å±•æ€§å¾ˆå¥½ï¼Œå¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«(å¤§æ•°æ®æ—¶ä»£ï¼‰çš„æ•°æ®ã€‚esä¹Ÿä½¿ç”¨javaå¼€å‘å¹¶ä½¿ç”¨Luceneä½œä¸ºå…¶æ ¸å¿ƒæ¥å®ç°æ‰€æœ‰ç´¢å¼•å’Œæœç´¢çš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒçš„ç›®çš„æ˜¯ é€šè¿‡ç®€å•çš„<mark>RESTful API</mark>æ¥éšè—Luceneçš„å¤æ‚æ€§ï¼Œä»è€Œè®©å…¨æ–‡æœç´¢å˜å¾—ç®€å• ã€‚</p>
<p>æ®å›½é™…æƒå¨çš„æ•°æ®åº“äº§å“è¯„æµ‹æœºæ„DB Enginesçš„ç»Ÿè®¡ï¼Œåœ¨2016å¹´1æœˆï¼ŒElasticSearchå·²è¶…è¿‡Solrç­‰ï¼Œæˆä¸ºæ’åç¬¬ä¸€çš„æœç´¢å¼•æ“ç±»åº”ç”¨ã€‚</p>
<p><strong>å†å²</strong></p>
<p>å¤šå¹´å‰ï¼Œä¸€ä¸ªå«åšShay Banonçš„åˆšç»“å©šä¸ä¹…çš„å¤±ä¸šå¼€å‘è€…ï¼Œç”±äºå¦»å­è¦å»ä¼¦æ•¦å­¦ä¹ å¨å¸ˆï¼Œä»–ä¾¿è·Ÿç€ä¹Ÿå»äº†ã€‚åœ¨ä»–æ‰¾å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†ç»™å¦»å­æ„å»ºä¸€ä¸ªé£Ÿè°±çš„æœç´¢å¼•æ“ï¼Œä»–å¼€å§‹æ„å»ºä¸€ä¸ªæ—©æœŸç‰ˆæœ¬çš„Luceneã€‚</p>
<p>ç›´æ¥åŸºäºLuceneå·¥ä½œä¼šæ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥Shayå¼€å§‹æŠ½è±¡Luceneä»£ç ä»¥ä¾¿lavaç¨‹åºå‘˜å¯ä»¥åœ¨åº”ç”¨ä¸­æ·»åŠ æœç´¢åŠŸèƒ½ã€‚ä»–å‘å¸ƒäº†ä»–çš„ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå«åšâ€œCompassâ€ã€‚</p>
<p>åæ¥Shayæ‰¾åˆ°ä¸€ä»½å·¥ä½œï¼Œè¿™ä»½å·¥ä½œå¤„åœ¨é«˜æ€§èƒ½å’Œå†…å­˜æ•°æ®ç½‘æ ¼çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå› æ­¤é«˜æ€§èƒ½çš„ã€å®æ—¶çš„ã€åˆ†å¸ƒå¼çš„æœç´¢å¼•æ“ä¹Ÿæ˜¯ç†æ‰€å½“ç„¶éœ€è¦çš„ã€‚ç„¶åä»–å†³å®šé‡å†™Compassåº“ä½¿å…¶æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å«åš<mark>Elasticsearch</mark>ã€‚</p>
<p>ç¬¬ä¸€ä¸ªå…¬å¼€ç‰ˆæœ¬å‡ºç°åœ¨2010å¹´2æœˆï¼Œåœ¨é‚£ä¹‹åElasticsearchå·²ç»æˆä¸ºGithubä¸Šæœ€å—æ¬¢è¿çš„é¡¹ç›®ä¹‹ä¸€ï¼Œä»£ç è´¡çŒ®è€…è¶…è¿‡300äººã€‚ä¸€å®¶ä¸»è¥Elasticsearchçš„å…¬å¸å°±æ­¤æˆç«‹ï¼Œä»–ä»¬ä¸€è¾¹æä¾›å•†ä¸šæ”¯æŒä¸€è¾¹å¼€å‘æ–°åŠŸèƒ½ï¼Œä¸è¿‡Elasticsearchå°†æ°¸è¿œå¼€æºä¸”å¯¹æ‰€æœ‰äººå¯ç”¨ã€‚</p>
<p>Shayçš„å¦»å­ä¾æ—§ç­‰å¾…ç€å¥¹çš„é£Ÿè°±æœç´¢â€¦â€¦</p>
<p><strong>è°åœ¨ä½¿ç”¨ï¼š</strong></p>
<p>1ã€ç»´åŸºç™¾ç§‘ï¼Œç±»ä¼¼ç™¾åº¦ç™¾ç§‘ï¼Œå…¨æ–‡æ£€ç´¢ï¼Œé«˜äº®ï¼Œæœç´¢æ¨è/2ï¼ˆæƒé‡ï¼Œç™¾åº¦ï¼ï¼‰</p>
<p>2ã€The Guardian (å›½å¤–æ–°é—»ç½‘ç«™) ï¼Œç±»ä¼¼æœç‹æ–°é—»ï¼Œç”¨æˆ·è¡Œä¸ºæ—¥å¿—(ç‚¹å‡»ï¼Œæµè§ˆï¼Œæ”¶è—ï¼Œè¯„è®º) +ç¤¾äº¤ç½‘ç»œæ•°æ®(å¯¹æŸæŸæ–°é—»çš„ç›¸å…³çœ‹æ³•) ï¼Œæ•°æ®åˆ†æï¼Œç»™åˆ°æ¯ç¯‡æ–°é—»æ–‡ç« çš„ä½œè€…ï¼Œè®©ä»–çŸ¥é“ä»–çš„æ–‡ç« çš„å…¬ä¼—åé¦ˆ(å¥½ï¼Œåï¼Œçƒ­é—¨ï¼Œåƒåœ¾ï¼Œé„™è§†ï¼Œå´‡æ‹œ)</p>
<p>3ã€Stack Overflow (å›½å¤–çš„ç¨‹åºå¼‚å¸¸è®¨è®ºè®ºå›) ï¼Œï¼ŒITé—®é¢˜ï¼Œç¨‹åºçš„æŠ¥é”™ï¼Œæäº¤ä¸Šå»ï¼Œæœ‰äººä¼šè·Ÿä½ è®¨è®ºå’Œå›ç­”ï¼Œå…¨æ–‡æ£€ç´¢ï¼Œæœç´¢ç›¸å…³é—®é¢˜å’Œç­”æ¡ˆï¼Œç¨‹åºæŠ¥é”™äº†ï¼Œå°±ä¼šå°†æŠ¥é”™ä¿¡æ¯ç²˜è´´åˆ°é‡Œé¢å»ï¼Œæœç´¢æœ‰æ²¡æœ‰å¯¹åº”çš„ç­”æ¡ˆ</p>
<p>4ã€GitHub (å¼€æºä»£ç ç®¡ç†)ï¼Œæœç´¢ ä¸Šåƒäº¿è¡Œä»£ç </p>
<p>5ã€ç”µå•†ç½‘ç«™ï¼Œæ£€ç´¢å•†å“</p>
<p>6ã€æ—¥å¿—æ•°æ®åˆ†æï¼Œlogstashé‡‡é›†æ—¥å¿—ï¼ŒESè¿›è¡Œå¤æ‚çš„æ•°æ®åˆ†æï¼Œ<mark>ELKæŠ€æœ¯ï¼Œelasticsearch+logstash+kibana</mark></p>
<p>7ã€å•†å“ä»·æ ¼ç›‘æ§ç½‘ç«™ï¼Œç”¨æˆ·è®¾å®šæŸå•†å“çš„ä»·æ ¼é˜ˆå€¼ï¼Œå½“ä½äºè¯¥é˜ˆå€¼çš„æ—¶å€™ï¼Œå‘é€é€šçŸ¥æ¶ˆæ¯ç»™ç”¨æˆ·ï¼Œæ¯”å¦‚è¯´è®¢é˜…ç‰™è†çš„ç›‘æ§ï¼Œå¦‚æœé«˜éœ²æ´ç‰™è†çš„å®¶åº­å¥—è£…ä½äº50å—é’±ï¼Œå°±é€šçŸ¥æˆ‘ï¼Œæˆ‘å°±å»ä¹°</p>
<p>8ã€BIç³»ç»Ÿï¼Œå•†ä¸šæ™ºèƒ½ï¼Œ Business Intelligenceã€‚æ¯”å¦‚è¯´æœ‰ä¸ªå¤§å‹å•†åœºé›†å›¢ï¼ŒBI ï¼Œåˆ†æä¸€ä¸‹æŸæŸåŒºåŸŸæœ€è¿‘3å¹´çš„ç”¨æˆ·æ¶ˆè´¹ é‡‘é¢çš„è¶‹åŠ¿ä»¥åŠç”¨æˆ·ç¾¤ä½“çš„ç»„æˆæ„æˆï¼Œäº§å‡ºç›¸å…³çš„æ•°å¼ æŠ¥è¡¨ï¼Œ **åŒºï¼Œæœ€è¿‘3å¹´ï¼Œæ¯å¹´æ¶ˆè´¹é‡‘é¢å‘ˆç°100%çš„å¢é•¿ï¼Œè€Œä¸”ç”¨æˆ·ç¾¤ä½“85%æ˜¯é«˜çº§ç™½é¢†ï¼Œå¼€ä¸€ä¸ªæ–°å•†åœºã€‚ESæ‰§è¡Œæ•°æ®åˆ†æå’ŒæŒ–æ˜ï¼Œ Kibanaè¿›è¡Œæ•°æ®å¯è§†åŒ–</p>
<p>9ã€å›½å†…:ç«™å†…æœç´¢(ç”µå•†ï¼Œæ‹›è˜ï¼Œé—¨æˆ·ï¼Œç­‰ç­‰)ï¼ŒITç³»ç»Ÿæœç´¢(OAï¼ŒCRMï¼ŒERPï¼Œç­‰ç­‰)ï¼Œæ•°æ®åˆ†æ(ESçƒ­é—¨çš„ä¸€ä¸€ä¸ªä½¿ç”¨åœºæ™¯)</p>
<p>ESå’Œ solr çš„å·®åˆ«</p>
<h3 id="1-elastic-search-jian-jie" id="1ã€ElasticSearchç®€ä»‹">1ã€ElasticSearchç®€ä»‹</h3>
<p>Elasticsearchæ˜¯ä¸€ä¸ªå®æ—¶åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚ å®ƒè®©ä½ ä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦å¤„ç†å¤§æ•°æ®æˆä¸ºå¯èƒ½ã€‚</p>
<p>å®ƒç”¨äº <strong>å…¨æ–‡æœç´¢</strong>ã€<strong>ç»“æ„åŒ–æœç´¢</strong>ã€<strong>åˆ†æ</strong>ä»¥åŠå°†è¿™ä¸‰è€…æ··åˆä½¿ç”¨:</p>
<p>ç»´åŸºç™¾ç§‘ä½¿ç”¨Elasticsearchæä¾›å…¨æ–‡æœç´¢å¹¶é«˜äº®å…³é”®å­—ï¼Œä»¥åŠè¾“å…¥å®æ—¶æœç´¢(search-asyou-type)å’Œæœç´¢çº é”™(did-you-mean)ç­‰æœç´¢å»ºè®®åŠŸèƒ½ã€‚</p>
<p>è‹±å›½å«æŠ¥ä½¿ç”¨Elasticsearchç»“åˆç”¨æˆ·æ—¥å¿—å’Œç¤¾äº¤ç½‘ç»œæ•°æ®æä¾›ç»™ä»–ä»¬çš„ç¼–è¾‘ä»¥å®æ—¶çš„åé¦ˆï¼Œä»¥ä¾¿åŠæ—¶äº†è§£å…¬ä¼—å¯¹æ–°å‘è¡¨çš„æ–‡ç« çš„å›åº”ã€‚</p>
<p>StackOverflowç»“åˆå…¨æ–‡æœç´¢ä¸åœ°ç†ä½ç½®æŸ¥è¯¢ï¼Œä»¥åŠmore-like-thisåŠŸèƒ½æ¥æ‰¾åˆ°ç›¸å…³çš„é—®é¢˜å’Œç­”æ¡ˆã€‚</p>
<p>Githubä½¿ç”¨Elasticsearchæ£€ç´¢1300äº¿è¡Œçš„ä»£ç ã€‚</p>
<p>ä½†æ˜¯Elasticsearchä¸ä»…ç”¨äºå¤§å‹ä¼ä¸šï¼Œå®ƒè¿˜è®©åƒDataDogä»¥åŠKloutè¿™æ ·çš„åˆ›ä¸šå…¬å¸å°†æœ€åˆçš„æƒ³æ³•å˜æˆå¯æ‰©å±•çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>Elasticsearchå¯ä»¥åœ¨ä½ çš„ç¬”è®°æœ¬ä¸Šè¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨æ•°ä»¥ç™¾è®¡çš„æœåŠ¡å™¨ä¸Šå¤„ç†PBçº§åˆ«çš„æ•°æ®ã€‚</p>
<p>Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºApache Luceneâ„¢çš„å¼€æºæœç´¢å¼•æ“ã€‚æ— è®ºåœ¨å¼€æºè¿˜æ˜¯ä¸“æœ‰é¢†åŸŸï¼Œ Luceneå¯è¢«è®¤ä¸ºæ˜¯è¿„ä»Šä¸ºæ­¢æœ€å…ˆè¿›ã€æ€§èƒ½æœ€å¥½çš„ã€åŠŸèƒ½æœ€å…¨çš„æœç´¢å¼•æ“åº“ã€‚</p>
<p>ä½†æ˜¯ï¼Œ Luceneåªæ˜¯ä¸€ä¸ªåº“ã€‚ æƒ³è¦ä½¿ç”¨å®ƒï¼Œä½ å¿…é¡»ä½¿ç”¨Javaæ¥ä½œä¸ºå¼€å‘è¯­è¨€å¹¶å°†å…¶ç›´æ¥é›†æˆåˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œ Luceneéå¸¸å¤æ‚ï¼Œä½ éœ€è¦æ·±å…¥äº†è§£æ£€ç´¢çš„ç›¸å…³çŸ¥è¯†æ¥ç†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p>Elasticsearchä¹Ÿä½¿ç”¨Javaå¼€å‘å¹¶ä½¿ç”¨Luceneä½œä¸ºå…¶æ ¸å¿ƒæ¥å®ç°æ‰€æœ‰ç´¢å¼•å’Œæœç´¢çš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒçš„ç›®çš„æ˜¯é€šè¿‡ç®€å•çš„RESTful APIæ¥éšè—Luceneçš„å¤æ‚æ€§ï¼Œä»è€Œè®©å…¨æ–‡æœç´¢å˜å¾—ç®€å•ã€‚</p>
<h3 id="2-solr-jian-jie" id="2ã€Solrç®€ä»‹">2ã€Solrç®€ä»‹</h3>
<p>Solræ˜¯Apacheä¸‹çš„ä¸€ä¸ªé¡¶çº§å¼€æºé¡¹ç›®ï¼Œé‡‡ç”¨Javaå¼€å‘ï¼Œå®ƒæ˜¯åŸºäºLuceneçš„å…¨æ–‡æœç´¢æœåŠ¡å™¨ã€‚Solræä¾›äº†æ¯”Luceneæ›´ä¸ºä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€ï¼ŒåŒæ—¶å®ç°äº†å¯é…ç½®ã€å¯æ‰©å±•ï¼Œå¹¶å¯¹ç´¢å¼•ã€æœç´¢æ€§èƒ½è¿›è¡Œäº†ä¼˜åŒ–</p>
<p>Solrå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œè¿è¡Œåœ¨letty. Tomcatç­‰è¿™äº›Selrvletå®¹å™¨ä¸­ ï¼Œ Solr ç´¢å¼•çš„å®ç°æ–¹æ³•å¾ˆç®€å•ï¼Œ<mark>ç”¨POSTæ–¹æ³•å‘SolræœåŠ¡å™¨å‘é€ä¸€ä¸ªæè¿°FieldåŠå…¶å†…å®¹çš„XMLæ–‡æ¡£ï¼Œ Solræ ¹æ®xmlæ–‡æ¡£æ·»åŠ ã€åˆ é™¤ã€æ›´æ–°ç´¢å¼•</mark>ã€‚Solr æœç´¢åªéœ€è¦å‘é€HTTP GETè¯·æ±‚ï¼Œç„¶åå¯¹Solrè¿”å›xmlã€<mark>json</mark>ç­‰æ ¼å¼çš„æŸ¥è¯¢ç»“æœè¿›è¡Œè§£æï¼Œç»„ç»‡é¡µé¢å¸ƒå±€ã€‚</p>
<p>Solrä¸æä¾›æ„å»ºUIçš„åŠŸèƒ½ï¼Œ Solræä¾›äº†ä¸€ä¸ªç®¡ç†ç•Œé¢ï¼Œé€šè¿‡ç®¡ç†ç•Œé¢å¯ä»¥æŸ¥è¯¢Solrçš„é…ç½®å’Œè¿è¡Œæƒ…å†µã€‚</p>
<p>solræ˜¯åŸºäºluceneå¼€å‘ä¼ä¸šçº§æœç´¢æœåŠ¡å™¨ï¼Œå®é™…ä¸Šå°±æ˜¯å°è£…äº†lucene.</p>
<p>Solræ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¼ä¸šçº§æœç´¢åº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒå¯¹å¤–æä¾›ç±»ä¼¼äºWeb-serviceçš„APIæ¥å£ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡httpè¯·æ±‚ï¼Œå‘æœç´¢å¼•æ“æœåŠ¡å™¨æäº¤-å®šæ ¼å¼çš„æ–‡ä»¶ï¼Œç”Ÿæˆç´¢å¼•;ä¹Ÿå¯ä»¥é€šè¿‡æå‡ºæŸ¥æ‰¾è¯·æ±‚ï¼Œå¹¶å¾—åˆ°è¿”å›ç»“æœã€‚</p>
<h3 id="3-lucene-jian-jie" id="3ã€Luceneç®€ä»‹">3ã€Luceneç®€ä»‹</h3>
<p>Luceneæ˜¯apacheè½¯ä»¶åŸºé‡‘ä¼š4 jakartaé¡¹ç›®ç»„çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„å…¨æ–‡æ£€ç´¢å¼•æ“å·¥å…·åŒ…ï¼Œä½†å®ƒä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„å…¨æ–‡æ£€ç´¢å¼•æ“ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å¼•æ“çš„æ¶æ„ï¼Œæä¾›äº†å®Œæ•´çš„æŸ¥è¯¢å¼•æ“å’Œç´¢å¼•å¼•æ“ï¼Œéƒ¨åˆ†æ–‡æœ¬åˆ†æå¼•æ“ï¼ˆè‹±æ–‡ä¸å¾·æ–‡ä¸¤ç§è¥¿æ–¹è¯­è¨€)ã€‚Luceneçš„ç›®çš„æ˜¯ä¸ºè½¯ä»¶å¼€å‘äººå‘˜æä¾›ä¸€ä¸ªç®€å•æ˜“ç”¨çš„å·¥å…·åŒ…ï¼Œä»¥æ–¹ä¾¿çš„åœ¨ç›®æ ‡ç³»ç»Ÿä¸­å®ç°å…¨æ–‡æ£€ç´¢çš„åŠŸèƒ½ï¼Œæˆ–è€…æ˜¯ä»¥æ­¤ä¸ºåŸºç¡€å»ºç«‹èµ·å®Œæ•´çš„å…¨æ–‡æ£€ç´¢å¼•æ“ã€‚Luceneæ˜¯ä¸€å¥—ç”¨äºå…¨æ–‡æ£€ç´¢å’Œæœå¯»çš„å¼€æºç¨‹å¼åº“ï¼Œç”±Apacheè½¯ä»¶åŸºé‡‘ä¼šæ”¯æŒå’Œæä¾›ã€‚Luceneæä¾›äº†ä¸€ä¸ªç®€å•å´å¼ºå¤§çš„åº”ç”¨ç¨‹å¼æ¥å£ï¼Œèƒ½å¤Ÿåšå…¨æ–‡ç´¢å¼•å’Œæœå¯»ã€‚åœ¨Javaå¼€å‘ç¯å¢ƒé‡ŒLuceneæ˜¯ä¸€ä¸ªæˆç†Ÿçš„å…è´¹å¼€æºå·¥å…·ã€‚å°±å…¶æœ¬èº«è€Œè¨€ï¼ŒLuceneæ˜¯å½“å‰ä»¥åŠæœ€è¿‘å‡ å¹´æœ€å—æ¬¢è¿çš„å…è´¹javaä¿¡æ¯æ£€ç´¢ç¨‹åºåº“ã€‚äººä»¬ç»å¸¸æåˆ°ä¿¡æ¯æ£€ç´¢ç¨‹åºåº“ï¼Œè™½ç„¶ä¸æœç´¢å¼•æ“æœ‰å…³ï¼Œä½†ä¸åº”è¯¥å°†ä¿¡æ¯æ£€ç´¢ç¨‹åºåº“ä¸æœç´¢å¼•æ“ç›¸æ··æ·†ã€‚</p>
<p>Luceneæ˜¯ä¸€ä¸ªå…¨æ–‡æ£€ç´¢å¼•æ“çš„æ¶æ„ã€‚é‚£ä»€ä¹ˆæ˜¯å…¨æ–‡æœç´¢å¼•æ“?</p>
<p>å…¨æ–‡æœç´¢å¼•æ“æ˜¯åå‰¯å…¶å®çš„æœç´¢å¼•æ“ï¼Œå›½å¤–å…·ä»£è¡¨æ€§çš„æœ‰Googleã€Fast/AllTheWebã€AltaVistaã€Inktomiã€Teomaã€WiseNutç­‰ï¼Œå›½å†…è‘—åçš„æœ‰ç™¾åº¦(Baidu )ã€‚å®ƒä»¬éƒ½æ˜¯é€šè¿‡ä»äº’è”ç½‘ä¸Šæå–çš„å„ä¸ªç½‘ç«™çš„ä¿¡æ¯ï¼ˆä»¥ç½‘é¡µæ–‡å­—ä¸ºä¸»)è€Œå»ºç«‹çš„æ•°æ®åº“ä¸­ï¼Œæ£€ç´¢ä¸ç”¨æˆ·æŸ¥è¯¢æ¡ä»¶åŒ¹é…çš„ç›¸å…³è®°å½•ï¼Œç„¶åæŒ‰ä¸€å®šçš„æ’åˆ—é¡ºåºå°†ç»“æœè¿”å›ç»™ç”¨æˆ·ï¼Œå› æ­¤ä»–ä»¬æ˜¯çœŸæ­£çš„æœç´¢å¼•æ“ã€‚</p>
<p>ä»æœç´¢ç»“æœæ¥æºçš„è§’åº¦ï¼Œå…¨æ–‡æœç´¢å¼•æ“åˆå¯ç»†åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æ‹¥æœ‰è‡ªå·±çš„æ£€ç´¢ç¨‹åº( Indexer )ï¼Œä¿—ç§°&quot;èœ˜è››&quot; ( Spider )ç¨‹åºæˆ–&quot;æœºå™¨äºº&quot; ( Robot )ç¨‹åºï¼Œå¹¶è‡ªå»ºç½‘é¡µæ•°æ®åº“ï¼Œæœç´¢ç»“æœç›´æ¥ä»è‡ªèº«çš„æ•°æ®åº“ä¸­è°ƒç”¨ï¼Œå¦‚ä¸Šé¢æåˆ°çš„7å®¶å¼•æ“;å¦ä¸€ç§åˆ™æ˜¯ç§Ÿç”¨å…¶ä»–å¼•æ“çš„æ•°æ®åº“ï¼Œå¹¶æŒ‰è‡ªå®šçš„æ ¼å¼æ’åˆ—æœç´¢ç»“æœï¼Œå¦‚Lycoså¼•æ“ã€‚</p>
<h3 id="4-elastic-search-yu-solr-bi-jiao" id="4ã€ElasticSearchä¸Solræ¯”è¾ƒ">4ã€ElasticSearchä¸Solræ¯”è¾ƒ</h3>
<ol>
<li>å½“å•çº¯çš„å¯¹å·²æœ‰æ•°æ®è¿›è¡Œæœç´¢æ—¶ï¼ŒSolræ›´å¿«</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/4ed7fbf84abc493a953c6aa904b22871.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<ol start="2">
<li>å½“å®æ—¶å»ºç«‹ç´¢å¼•æ—¶ï¼ŒSolrä¼šäº§ç”Ÿioé˜»å¡ï¼ŒæŸ¥è¯¢æ€§èƒ½è¾ƒå·®ï¼ŒElasticSearchå…·æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿</li>
</ol>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/cd3535ed806a455690175d4f8448b70c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<ol start="3">
<li>éšç€æ•°æ®é‡çš„å¢åŠ ï¼ŒSolrçš„æœç´¢æ•ˆç‡ä¼šå˜å¾—æ›´ä½ï¼Œè€ŒElasticSearchå´æ²¡æœ‰æ˜æ˜¾çš„å˜åŒ–</li>
</ol>
<p><img data-src="https://img-blog.csdnimg.cn/a19f9641e2a6465d880c97d87d87428e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<ol start="4">
<li>è½¬å˜æˆ‘ä»¬çš„æœç´¢åŸºç¡€è®¾æ–½åä»Solr ElasticSearchï¼Œæˆ‘ä»¬çœ‹è§ä¸€ä¸ªå³æ—¶~ 50xæé«˜æœç´¢æ€§èƒ½ï¼</li>
</ol>
<p><img data-src="https://img-blog.csdnimg.cn/11f760cafd204a48a4a119014b4fee8a.png" alt="åŠ ç²—æ ·å¼" /></p>
<p><strong>ElasticSearch vs Solr æ€»ç»“</strong></p>
<p>1ã€esåŸºæœ¬æ˜¯å¼€ç®±å³ç”¨(è§£å‹å°±å¯ä»¥ç”¨!) ï¼Œéå¸¸ç®€å•ã€‚Solrå®‰è£…ç•¥å¾®å¤æ‚ä¸€ä¸¢ä¸¢!</p>
<p>2ã€Solr åˆ©ç”¨Zookeeperè¿›è¡Œåˆ†å¸ƒå¼ç®¡ç†ï¼Œè€ŒElasticsearch è‡ªèº«å¸¦æœ‰åˆ†å¸ƒå¼åè°ƒç®¡ç†åŠŸèƒ½ ã€‚</p>
<p>3ã€Solr æ”¯æŒæ›´å¤šæ ¼å¼çš„æ•°æ®ï¼Œæ¯”å¦‚JSONã€XMLã€ CSV ï¼Œè€ŒElasticsearchä»…æ”¯æŒjsonæ–‡ä»¶æ ¼å¼ã€‚</p>
<p>4ã€Solr å®˜æ–¹æä¾›çš„åŠŸèƒ½æ›´å¤šï¼Œè€ŒElasticsearchæœ¬èº«æ›´æ³¨é‡äºæ ¸å¿ƒåŠŸèƒ½ï¼Œé«˜çº§åŠŸèƒ½å¤šæœ‰ç¬¬ä¸‰æ–¹æ’ä»¶æä¾›ï¼Œä¾‹å¦‚å›¾å½¢åŒ–ç•Œé¢éœ€è¦kibanaå‹å¥½æ”¯æ’‘</p>
<p>5ã€ Solr æŸ¥è¯¢å¿«ï¼Œä½†æ›´æ–°ç´¢å¼•æ—¶æ…¢(å³æ’å…¥åˆ é™¤æ…¢) ï¼Œç”¨äºç”µå•†ç­‰æŸ¥è¯¢å¤šçš„åº”ç”¨;</p>
<ul>
<li>
<p>ESå»ºç«‹ç´¢å¼•å¿«(å³æŸ¥è¯¢æ…¢) ï¼Œå³å®æ—¶æ€§æŸ¥è¯¢å¿«ï¼Œç”¨äºfacebookæ–°æµªç­‰æœç´¢ã€‚</p>
</li>
<li>
<p>Solræ˜¯ä¼ ç»Ÿæœç´¢åº”ç”¨çš„æœ‰åŠ›è§£å†³æ–¹æ¡ˆï¼Œä½†Elasticsearchæ›´é€‚ç”¨äºæ–°å…´çš„å®æ—¶æœç´¢åº”ç”¨ã€‚</p>
</li>
</ul>
<p>6ã€Solræ¯”è¾ƒæˆç†Ÿï¼Œæœ‰ä¸€ä¸ªæ›´å¤§ï¼Œæ›´æˆç†Ÿçš„ç”¨æˆ·ã€å¼€å‘å’Œè´¡çŒ®è€…ç¤¾åŒºï¼Œè€ŒElasticsearchç›¸å¯¹å¼€å‘ç»´æŠ¤è€…è¾ƒå°‘ï¼Œæ›´æ–°å¤ªå¿«ï¼Œå­¦ä¹ ä½¿ç”¨æˆæœ¬è¾ƒé«˜ã€‚</p>
<h2 id="er-elastic-search-an-zhuang" id="äºŒã€ElasticSearchå®‰è£…">äºŒã€ElasticSearchå®‰è£…</h2>
<p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/cn/elasticsearch/">https://www.elastic.co/cn/elasticsearch/</a></p>
<p>JDK8ï¼Œæœ€ä½è¦æ±‚</p>
<p>ä½¿ç”¨Javaå¼€å‘ï¼Œå¿…é¡»ä¿è¯ElasticSearchçš„ç‰ˆæœ¬ä¸Javaçš„æ ¸å¿ƒjaråŒ…ç‰ˆæœ¬å¯¹åº”ï¼ï¼ˆJavaç¯å¢ƒä¿è¯æ²¡é”™ï¼‰</p>
<p><img data-src="https://img-blog.csdnimg.cn/5ae25fde652d4503917683b50a1503f3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/f7b41243553a4d47b64c60f1df01e8ad.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p>
<p>å†å²ç‰ˆæœ¬ä¸‹è½½ï¼š<a href="https://www.elastic.co/cn/downloads/past-releases/">https://www.elastic.co/cn/downloads/past-releases/</a></p>
<p>å®˜ç½‘ä¸‹è½½å·¨æ…¢ï¼Œå¯ä»¥ä½¿ç”¨åä¸ºäº‘é•œåƒ</p>
<ul>
<li>ElasticSearch: <a href="https://mirrors.huaweicloud.com/elasticsearch/?C=N&amp;O=D">https://mirrors.huaweicloud.com/elasticsearch/?C=N&amp;O=D</a></li>
<li>logstash: <a href="https://mirrors.huaweicloud.com/logstash/?C=N&amp;O=D">https://mirrors.huaweicloud.com/logstash/?C=N&amp;O=D</a></li>
<li>kibana: <a href="https://mirrors.huaweicloud.com/kibana/?C=N&amp;O=D">https://mirrors.huaweicloud.com/kibana/?C=N&amp;O=D</a></li>
<li>elasticsearch-analysis-ik: <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></li>
<li>cerebro: <a href="https://github.com/lmenezes/cerebro/releases">https://github.com/lmenezes/cerebro/releases</a></li>
</ul>
<h3 id="2-1-windows-xia-an-zhuang" id="2-1ã€Windowsä¸‹å®‰è£…">2.1ã€Windowsä¸‹å®‰è£…</h3>
<p>1ã€è§£å‹å³å¯ï¼ˆå°½é‡å°†ElasticSearchç›¸å…³å·¥å…·æ”¾åœ¨ç»Ÿä¸€ç›®å½•ä¸‹ï¼‰</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/4f4c3861f146402bbd62b4639813ec76.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>2ã€ç†Ÿæ‚‰ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin	å¯åŠ¨æ–‡ä»¶</span><br><span class="line">config é…ç½®æ–‡ä»¶ç›®å½•</span><br><span class="line">	1og4j2 æ—¥å¿—é…ç½®æ–‡ä»¶</span><br><span class="line">	jvm.options javaè™šæ‹Ÿæœºç›¸å…³çš„é…ç½®(é»˜è®¤å¯åŠ¨å 1gå†…å­˜ï¼Œå†…å®¹ä¸å¤Ÿéœ€è¦è‡ªå·±è°ƒæ•´)</span><br><span class="line">	elasticsearch.yml elasticsearchçš„é…ç½®æ–‡ä»¶! é»˜è®¤9200ç«¯å£!è·¨åŸŸ!</span><br><span class="line">1ib  ç›¸å…³jaråŒ…</span><br><span class="line">modules åŠŸèƒ½æ¨¡å—ç›®å½•</span><br><span class="line">plugins æ’ä»¶ç›®å½• ikåˆ†è¯å™¨</span><br></pre></td></tr></table></figure>
<p>3ã€å¯åŠ¨</p>
<blockquote>
<p>ä¸€å®šè¦æ£€æŸ¥è‡ªå·±çš„javaç¯å¢ƒæ˜¯å¦é…ç½®å¥½</p>
</blockquote>
<p><img data-src="https://img-blog.csdnimg.cn/80752baa4aa84e1e83f30409447b8cf1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>åŒå‡»å¯åŠ¨</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœå¯åŠ¨åé—ªé€€ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶ç›®å½•æœ‰ä¸­åˆæˆ–è€…ç©ºæ ¼é€ æˆçš„</p>
</blockquote>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/be1942c768854ec39a36715383d4f6df.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>è®¿é—® <a href="http://127.0.0.1:9200/">http://127.0.0.1:9200/</a></p>
<p><img data-src="https://img-blog.csdnimg.cn/2948347855074b89a0e34be5777f9a04.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_19,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<h3 id="2-2-an-zhuang-ke-shi-hua-jie-mian" id="2-2ã€å®‰è£…å¯è§†åŒ–ç•Œé¢">2.2ã€å®‰è£…å¯è§†åŒ–ç•Œé¢</h3>
<p>elasticsearch-head</p>
<p><strong>ä½¿ç”¨å‰æ</strong>ï¼šéœ€è¦å®‰è£…nodejs</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/b976add50915495a883b201b99596d62.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>å®‰è£…ä¾èµ– <code>npm install</code></p>
<p>è¿è¡Œ <code>npm start</code></p>
<p>è®¿é—® <a href="http://localhost:9100/">http://localhost:9100/</a></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/c73b892a47304fb49ded0d7fa4e5513e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>å‘ç°å­˜åœ¨è·¨åŸŸé—®é¢˜</p>
<p><strong>å¼€å¯è·¨åŸŸï¼ˆåœ¨elasticsearchè§£å‹ç›®å½•configä¸‹elasticsearch.ymlä¸­æ·»åŠ ï¼‰</strong></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯è·¨åŸŸ</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰äººè®¿é—®</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„é…ç½®æ–‡ä»¶ä¸­ä¸è¦å¸¦æ³¨é‡Šï¼Œå¯èƒ½ä¼šé—ªé€€</p>
<p>é‡å¯elasticsearch</p>
<p><img data-src="https://img-blog.csdnimg.cn/31104ac0c70d485fb98563ccf7eef84a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>åˆ›å»ºä¸€ä¸ªç´¢å¼•</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/ce525553a4984849972493e776963f2f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://img-blog.csdnimg.cn/666cb2e8ccfe49cfa6bf20b2c9a0f6b8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://img-blog.csdnimg.cn/8485dda55a73436aabcf62feba27c0c8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://img-blog.csdnimg.cn/9b86f0d4be42419191732c9e768d21ed.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>å¦‚ä½•ç†è§£ï¼š</strong></p>
<ul>
<li>
<p>å¦‚æœä½ æ˜¯åˆå­¦è€…</p>
<ul>
<li>ç´¢å¼• å¯ä»¥çœ‹åš â€œæ•°æ®åº“â€</li>
<li>ç±»å‹ å¯ä»¥çœ‹åš â€œè¡¨â€</li>
<li>æ–‡æ¡£ å¯ä»¥çœ‹åš â€œåº“ä¸­çš„æ•°æ®ï¼ˆè¡¨ä¸­çš„è¡Œï¼‰â€</li>
</ul>
</li>
</ul>
<p>è¿™ä¸ªheadï¼Œæˆ‘ä»¬åªæ˜¯æŠŠå®ƒå½“åšå¯è§†åŒ–æ•°æ®å±•ç¤ºå·¥å…·ï¼Œä¹‹åæ‰€æœ‰çš„æŸ¥è¯¢éƒ½åœ¨kibanaä¸­è¿›è¡Œ</p>
<ul>
<li>å› ä¸ºä¸æ”¯æŒjsonæ ¼å¼åŒ–ï¼Œä¸æ–¹ä¾¿</li>
</ul>
<h3 id="2-3-liao-jie-elk" id="2-3ã€äº†è§£ELK">2.3ã€äº†è§£ELK</h3>
<p>ELKæ˜¯Elasticsearchã€Logstashã€ Kibanaä¸‰å¤§å¼€æºæ¡†æ¶é¦–å­—æ¯å¤§å†™ç®€ç§°ã€‚å¸‚é¢ä¸Šä¹Ÿè¢«æˆä¸ºElastic Stackã€‚</p>
<p>å…¶ä¸­Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneã€åˆ†å¸ƒå¼ã€é€šè¿‡Restfulæ–¹å¼è¿›è¡Œäº¤äº’çš„è¿‘å®æ—¶æœç´¢å¹³å°æ¡†æ¶ã€‚</p>
<p>åƒç±»ä¼¼ç™¾åº¦ã€è°·æ­Œè¿™ç§å¤§æ•°æ®å…¨æ–‡æœç´¢å¼•æ“çš„åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨Elasticsearchä½œä¸ºåº•å±‚æ”¯æŒæ¡†æ¶ï¼Œå¯è§Elasticsearchæä¾›çš„æœç´¢èƒ½åŠ›ç¡®å®å¼ºå¤§ï¼Œå¸‚é¢ä¸Šå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç®€ç§°Elasticsearchä¸ºesã€‚</p>
<p>Logstashæ˜¯ELKçš„ä¸­å¤®æ•°æ®æµå¼•æ“ï¼Œç”¨äºä»ä¸åŒç›®æ ‡(æ–‡ä»¶/æ•°æ®å­˜å‚¨/MQ )æ”¶é›†çš„ä¸åŒæ ¼å¼æ•°æ®ï¼Œç»è¿‡è¿‡æ»¤åæ”¯æŒè¾“å‡ºåˆ°ä¸åŒç›®çš„åœ°(æ–‡ä»¶/MQ/redis/elasticsearch/kafkaç­‰)ã€‚</p>
<p>Kibanaå¯ä»¥å°†elasticsearchçš„æ•°æ®é€šè¿‡å‹å¥½çš„é¡µé¢å±•ç¤ºå‡ºæ¥ ï¼Œæä¾›å®æ—¶åˆ†æçš„åŠŸèƒ½ã€‚</p>
<p>å¸‚é¢ä¸Šå¾ˆå¤šå¼€å‘åªè¦æåˆ°ELKèƒ½å¤Ÿä¸€è‡´è¯´å‡ºå®ƒæ˜¯ä¸€ä¸ªæ—¥å¿—åˆ†ææ¶æ„æŠ€æœ¯æ ˆæ€»ç§° ï¼Œä½†å®é™…ä¸ŠELKä¸ä»…ä»…é€‚ç”¨äºæ—¥å¿—åˆ†æï¼Œå®ƒè¿˜å¯ä»¥æ”¯æŒå…¶å®ƒä»»ä½•æ•°æ®åˆ†æå’Œæ”¶é›†çš„åœºæ™¯ï¼Œæ—¥å¿—åˆ†æå’Œæ”¶é›†åªæ˜¯æ›´å…·æœ‰ä»£è¡¨æ€§ã€‚å¹¶éå”¯ä¸€æ€§ã€‚</p>
<p>æ”¶é›†æ¸…æ´—æ•°æ®(Logstash) ==&gt; æœç´¢ã€å­˜å‚¨(ElasticSearch) ==&gt; å±•ç¤º(Kibana)</p>
<p><img data-src="https://img-blog.csdnimg.cn/c60a6816e5cb4128bce48331063dc414.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<h3 id="2-4-an-zhuang-kibana" id="2-4ã€å®‰è£…kibana">2.4ã€å®‰è£…kibana</h3>
<p>Kibanaæ˜¯ä¸€ä¸ªé’ˆå¯¹ElasticSearchçš„å¼€æºåˆ†æåŠå¯è§†åŒ–å¹³å°ï¼Œç”¨æ¥æœç´¢ã€æŸ¥çœ‹äº¤äº’å­˜å‚¨åœ¨Elasticsearchç´¢å¼•ä¸­çš„æ•°æ®ã€‚ä½¿ç”¨Kibana ï¼Œå¯ä»¥é€šè¿‡å„ç§å›¾è¡¨è¿›è¡Œé«˜çº§æ•°æ®åˆ†æåŠå±•ç¤ºã€‚Kibanaè®©æµ·é‡æ•°æ®æ›´å®¹æ˜“ç†è§£ã€‚å®ƒæ“ä½œç®€å•ï¼ŒåŸºäºæµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢å¯ä»¥å¿«é€Ÿåˆ›å»ºä»ªè¡¨æ¿( dashboard )å®æ—¶æ˜¾ç¤ºElasticsearchæŸ¥è¯¢åŠ¨æ€ã€‚è®¾ç½®Kibanaéå¸¸ç®€å•ã€‚æ— éœ€ç¼–ç æˆ–è€…é¢å¤–çš„åŸºç¡€æ¶æ„ï¼Œå‡ åˆ†é’Ÿå†…å°±å¯ä»¥å®ŒæˆKibanaå®‰è£…å¹¶å¯åŠ¨Elasticsearchç´¢å¼•ç›‘æµ‹ã€‚</p>
<p>å®˜ç½‘ï¼š<a href="https://www.elastic.co/cn/kibana/">https://www.elastic.co/cn/kibana/</a></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/b3a7d05d0bb4448e957947e4c856ca8d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://www.elastic.co/cn/downloads/kibana">https://www.elastic.co/cn/downloads/kibana</a></p>
<p><img data-src="https://img-blog.csdnimg.cn/fd0844bf68a347878b69fe0c1bf9b25c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><mark>ç‰ˆæœ¬éœ€è¦ä¸ElasticSearchç‰ˆæœ¬å¯¹åº”</mark></p>
<p>åä¸ºäº‘é•œåƒï¼š <a href="https://mirrors.huaweicloud.com/kibana/?C=N&amp;O=D">https://mirrors.huaweicloud.com/kibana/?C=N&amp;O=D</a></p>
<p>å®‰è£…</p>
<p>è§£å‹å³å¯ï¼ˆå°½é‡å°†ElasticSearchç›¸å…³å·¥å…·æ”¾åœ¨ç»Ÿä¸€ç›®å½•ä¸‹ï¼‰</p>
<p>è¿›å…¥åˆ° kibana-7.14.0-windows-x86_64\bin ç›®å½•ä¸‹ï¼ŒåŒå‡»å¯åŠ¨</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/0040a6fc2f7b43dca8d70b13ad32f6c7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>è®¿é—® <a href="http://127.0.0.1:5601">http://127.0.0.1:5601</a></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/bd1980a003184f44b3fa2b35395d9e13.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>å¼€å‘å·¥å…·</p>
<p>ï¼ˆPostmanã€curlã€headã€è°·æ­Œæµè§ˆå™¨æ’ä»¶ï¼‰</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/702849eaab964d6c9c2c702610cf0815.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>å¦‚æœè¯´ï¼Œä½ åœ¨è‹±æ–‡æ–¹é¢ä¸å¤ªæ“…é•¿ï¼Œkibanaæ˜¯æ”¯æŒæ±‰åŒ–çš„</p>
<p>kibanaæ±‰åŒ–</p>
<p>ç¼–è¾‘å™¨æ‰“å¼€kibanaè§£å‹ç›®å½•/config/kibana.yml(kibana-7.13.1-windows-x86_64/config/kibana.yml)ï¼Œæ·»åŠ </p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/0393d4d0fc164dc59dcfdbd209354e30.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>é‡å¯kibana</p>
<p>æ±‰åŒ–æˆåŠŸ</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/784bbd78425d4dc78eab349eba69ee4d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<h2 id="san-elastic-search-he-xin-gai-nian" id="ä¸‰ã€ElasticSearchæ ¸å¿ƒæ¦‚å¿µ">ä¸‰ã€ElasticSearchæ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 id="3-1-gai-shu" id="3-1ã€æ¦‚è¿°">3.1ã€æ¦‚è¿°</h3>
<p>é›†ç¾¤ï¼ŒèŠ‚ç‚¹ï¼Œç´¢å¼•ï¼Œç±»å‹ï¼Œæ–‡æ¡£ï¼Œåˆ†ç‰‡ï¼Œæ˜ å°„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>1ã€ç´¢å¼•ï¼ˆElasticSearchï¼‰</p>
<p>åŒ…å¤šä¸ªåˆ†ç‰‡</p>
<p>2ã€å­—æ®µç±»å‹ï¼ˆæ˜ å°„ï¼‰mapping</p>
<p>å­—æ®µç±»å‹æ˜ å°„ï¼ˆå­—æ®µæ˜¯æ•´å‹ï¼Œè¿˜æ˜¯å­—ç¬¦å‹â€¦ï¼‰</p>
<p>3ã€æ–‡æ¡£ï¼ˆdocumentsï¼‰</p>
<p>4ã€åˆ†ç‰‡ï¼ˆLuceneç´¢å¼•ï¼Œå€’æ’ç´¢å¼•ï¼‰</p>
<p><strong>elasticsearchæ˜¯é¢å‘æ–‡æ¡£ï¼Œå…³ç³»å‹æ•°æ®åº“å’Œelasticsearchå®¢è§‚çš„å¯¹æ¯”ï¼ä¸€åˆ‡éƒ½æ˜¯json</strong>!</p>
<table>
<thead>
<tr>
<th>Relational DB</th>
<th>Elasticsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ•°æ®åº“ï¼ˆdatabaseï¼‰</td>
<td>ç´¢å¼•ï¼ˆindicesï¼‰</td>
</tr>
<tr>
<td>è¡¨ï¼ˆtablesï¼‰</td>
<td>types</td>
</tr>
<tr>
<td>è¡Œï¼ˆrowsï¼‰</td>
<td>documents</td>
</tr>
<tr>
<td>å­—æ®µï¼ˆcolumnsï¼‰</td>
<td>fields</td>
</tr>
</tbody>
</table>
<p>elasticsearchï¼ˆé›†ç¾¤ï¼‰ä¸­å¯ä»¥åŒ…å«å¤šä¸ªç´¢å¼•ï¼ˆæ•°æ®åº“ï¼‰ ï¼Œæ¯ä¸ªç´¢å¼•ä¸­å¯ä»¥åŒ…å«å¤šä¸ªç±»å‹ï¼ˆè¡¨ï¼‰ ï¼Œæ¯ä¸ªç±»å‹ä¸‹åˆåŒ…å«å¤šä¸ªæ–‡æ¡£ï¼ˆè¡Œï¼‰ ï¼Œæ¯ä¸ªæ–‡æ¡£ä¸­åˆåŒ…å«å¤šä¸ªå­—æ®µï¼ˆåˆ—ï¼‰ã€‚</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/b4b6d49e705c431680358ecfdf601095.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>ç‰©ç†è®¾è®¡ï¼š</strong></p>
<p>elasticsearchåœ¨åå°æŠŠæ¯ä¸ªç´¢å¼•åˆ’åˆ†æˆå¤šä¸ªåˆ†ç‰‡ã€‚æ¯ä¸ªåˆ†ç‰‡å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä¸åŒæœåŠ¡å™¨é—´è¿ç§»</p>
<p>ä¸€ä¸ªäººå°±æ˜¯ä¸€ä¸ªé›†ç¾¤! ï¼Œå³å¯åŠ¨çš„ElasticSearchæœåŠ¡ï¼Œé»˜è®¤å°±æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œä¸”é»˜è®¤é›†ç¾¤åä¸ºelasticsearch</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/f97a6ef1187f4ec0a7a78822a25f9f66.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>é€»è¾‘è®¾è®¡ï¼š</strong></p>
<p>ä¸€ä¸ªç´¢å¼•ç±»å‹ä¸­ï¼ŒåŒ…å«å¤šä¸ªæ–‡æ¡£ï¼Œæ¯”å¦‚è¯´æ–‡æ¡£1ï¼Œæ–‡æ¡£2ã€‚å½“æˆ‘ä»¬ç´¢å¼•ä¸€ç¯‡æ–‡æ¡£æ—¶ï¼Œå¯ä»¥é€šè¿‡è¿™æ ·çš„ä¸€ä¸ªé¡ºåºæ‰¾åˆ°å®ƒï¼šç´¢å¼•-&gt;ç±»å‹-&gt;æ–‡æ¡£idï¼Œé€šè¿‡è¿™ä¸ªç»„åˆæˆ‘ä»¬å°±èƒ½ç´¢å¼•åˆ°æŸä¸ªå…·ä½“çš„æ–‡æ¡£ã€‚æ³¨æ„ï¼šIDä¸å¿…æ˜¯æ•´æ•°ï¼Œå®é™…ä¸Šå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<h3 id="3-2-wen-dang" id="3-2ã€æ–‡æ¡£">3.2ã€æ–‡æ¡£</h3>
<p>æ–‡æ¡£ï¼ˆâ€è¡Œâ€œï¼‰</p>
<p>å°±æ˜¯æˆ‘ä»¬çš„ä¸€æ¡æ¡çš„è®°å½•</p>
<p>ä¹‹å‰è¯´elasticsearchæ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ç´¢å¼•å’Œæœç´¢æ•°æ®çš„æœ€å°å•ä½æ˜¯æ–‡æ¡£ï¼Œ elasticsearchä¸­ï¼Œæ–‡æ¡£æœ‰å‡ ä¸ªé‡è¦å±æ€§:</p>
<ul>
<li>è‡ªæˆ‘åŒ…å«ï¼Œ ä¸€ç¯‡æ–‡æ¡£åŒæ—¶åŒ…å«å­—æ®µå’Œå¯¹åº”çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶åŒ…å«key:value !</li>
<li>å¯ä»¥æ˜¯å±‚æ¬¡å‹çš„ï¼Œä¸€ä¸ªæ–‡æ¡£ä¸­åŒ…å«è‡ªæ–‡æ¡£ï¼Œå¤æ‚çš„é€»è¾‘å®ä½“å°±æ˜¯è¿™ä¹ˆæ¥çš„! {å°±æ˜¯ä¸€ ä¸ªjsonå¯¹è±¡! fastjsonè¿›è¡Œè‡ªåŠ¨è½¬æ¢ï¼}</li>
<li>çµæ´»çš„ç»“æ„ï¼Œæ–‡æ¡£ä¸ä¾èµ–é¢„å…ˆå®šä¹‰çš„æ¨¡å¼ï¼Œæˆ‘ä»¬çŸ¥é“å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œè¦æå‰å®šä¹‰å­—æ®µæ‰èƒ½ä½¿ç”¨ï¼Œåœ¨elasticsearchä¸­ï¼Œå¯¹äºå­—æ®µæ˜¯éå¸¸çµæ´»çš„ï¼Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥è¯¥å­—æ®µï¼Œæˆ–è€…åŠ¨æ€çš„æ·»åŠ ä¸€ä¸ªæ–°çš„å­—æ®µã€‚</li>
</ul>
<p>å°½ç®¡æˆ‘ä»¬å¯ä»¥éšæ„çš„æ–°å¢æˆ–è€…å¿½ç•¥æŸä¸ªå­—æ®µï¼Œä½†æ˜¯ï¼Œæ¯ä¸ªå­—æ®µçš„ç±»å‹éå¸¸é‡è¦ï¼Œæ¯”å¦‚ä¸€ä¸€ä¸ªå¹´é¾„å­—æ®µç±»å‹ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯æ•´å½¢ã€‚å› ä¸ºelasticsearchä¼šä¿å­˜å­—æ®µå’Œç±»å‹ä¹‹é—´çš„æ˜ å°„åŠå…¶ä»–çš„è®¾ç½®ã€‚è¿™ç§æ˜ å°„å…·ä½“åˆ°æ¯ä¸ªæ˜ å°„çš„æ¯ç§ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨elasticsearchä¸­ï¼Œç±»å‹æœ‰æ—¶å€™ä¹Ÿç§°ä¸ºæ˜ å°„ç±»å‹ã€‚</p>
<h3 id="3-3-lei-xing" id="3-3ã€ç±»å‹">3.3ã€ç±»å‹</h3>
<p>ç±»å‹ï¼ˆâ€œè¡¨â€ï¼‰</p>
<p>ç±»å‹æ˜¯æ–‡æ¡£çš„é€»è¾‘å®¹å™¨ï¼Œå°±åƒå…³ç³»å‹æ•°æ®åº“ä¸€æ ·ï¼Œè¡¨æ ¼æ˜¯è¡Œçš„å®¹å™¨ã€‚ç±»å‹ä¸­å¯¹äºå­—æ®µçš„å®š ä¹‰ç§°ä¸ºæ˜ å°„ï¼Œæ¯”å¦‚nameæ˜ å°„ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚æˆ‘ä»¬è¯´æ–‡æ¡£æ˜¯æ— æ¨¡å¼çš„ ï¼Œå®ƒä»¬ä¸éœ€è¦æ‹¥æœ‰æ˜ å°„ä¸­æ‰€å®šä¹‰çš„æ‰€æœ‰å­—æ®µï¼Œæ¯”å¦‚æ–°å¢ä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆelasticsearchæ˜¯æ€ä¹ˆåšçš„å‘¢?elasticsearchä¼šè‡ªåŠ¨çš„å°†æ–°å­—æ®µåŠ å…¥æ˜ å°„ï¼Œä½†æ˜¯è¿™ä¸ªå­—æ®µçš„ä¸ç¡®å®šå®ƒæ˜¯ä»€ä¹ˆç±»å‹ï¼Œ elasticsearchå°±å¼€å§‹çŒœï¼Œå¦‚æœè¿™ä¸ªå€¼æ˜¯18 ï¼Œé‚£ä¹ˆelasticsearchä¼šè®¤ä¸ºå®ƒæ˜¯æ•´å½¢ã€‚ä½†æ˜¯elasticsearchä¹Ÿå¯èƒ½çŒœä¸å¯¹ ï¼Œæ‰€ä»¥æœ€å®‰å…¨çš„æ–¹å¼å°±æ˜¯æå‰å®šä¹‰å¥½æ‰€éœ€è¦çš„æ˜ å°„ï¼Œè¿™ç‚¹è·Ÿå…³ç³»å‹æ•°æ®åº“æ®Šé€”åŒå½’äº†ï¼Œå…ˆå®šä¹‰å¥½å­—æ®µï¼Œç„¶åå†ä½¿ç”¨ï¼Œåˆ«æ•´ä»€ä¹ˆå¹ºè›¾å­ã€‚</p>
<h3 id="3-4-suo-yin" id="3-4ã€ç´¢å¼•">3.4ã€ç´¢å¼•</h3>
<p>ç´¢å¼•ï¼ˆâ€œåº“â€ï¼‰</p>
<p>å°±æ˜¯æ•°æ®åº“!</p>
<p>ç´¢å¼•æ˜¯æ˜ å°„ç±»å‹çš„å®¹å™¨ï¼Œ elasticsearchä¸­çš„ç´¢å¼•æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ–‡æ¡£é›†åˆã€‚ç´¢|å­˜å‚¨äº†æ˜ å°„ç±»å‹çš„å­—æ®µå’Œå…¶ä»–è®¾ç½®ã€‚ç„¶åå®ƒä»¬è¢«å­˜å‚¨åˆ°äº†å„ä¸ªåˆ†ç‰‡ä¸Šäº†ã€‚æˆ‘ä»¬æ¥ç ”ç©¶ä¸‹åˆ†ç‰‡æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p>ç‰©ç†è®¾è®¡:èŠ‚ç‚¹å’Œåˆ†ç‰‡å¦‚ä½•å·¥ä½œ</p>
<p><img data-src="https://img-blog.csdnimg.cn/eaa177e252e843e792de6e8144596c29.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>ä¸€ä¸ªé›†ç¾¤è‡³å°‘æœ‰ä¸€ ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€-ä¸ªelasricsearchè¿›ç¨‹ ï¼ŒèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•é»˜è®¤çš„ï¼Œå¦‚æœä½ åˆ›å»ºç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•å°†ä¼šæœ‰ä¸ª5ä¸ªåˆ†ç‰‡( primary shard ï¼Œåˆç§°ä¸»åˆ†ç‰‡)æ„æˆçš„ï¼Œæ¯ä¸€ä¸ªä¸»åˆ†ç‰‡ä¼šæœ‰-ä¸€ä¸ªå‰¯æœ¬( replica shard ï¼Œåˆç§°å¤åˆ¶åˆ†ç‰‡ï¼‰</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/ed34371596c344cbada49df3105a9edf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>ä¸Šå›¾æ˜¯ä¸€ä¸ªæœ‰3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œå¯ä»¥çœ‹åˆ°ä¸»åˆ†ç‰‡å’Œå¯¹åº”çš„å¤åˆ¶åˆ†ç‰‡éƒ½ä¸ä¼šåœ¨åŒ-ä¸ªèŠ‚ç‚¹å†…ï¼Œè¿™æ ·æœ‰åˆ©äºæŸä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œæ•°æ®ä¹Ÿä¸è‡³äºä¸¢å¤±ã€‚å®é™…ä¸Šï¼Œ ä¸€ä¸ªåˆ†ç‰‡æ˜¯- -ä¸ªLuceneç´¢å¼•ï¼Œ ä¸€ä¸ªåŒ…å«<mark>å€’æ’ç´¢å¼•</mark>çš„æ–‡ä»¶ç›®å½•ï¼Œå€’æ’ç´¢å¼•çš„ç»“æ„ä½¿å¾—elasticsearchåœ¨ä¸æ‰«æå…¨éƒ¨æ–‡æ¡£çš„æƒ…å†µä¸‹ï¼Œå°±èƒ½å‘Šè¯‰ä½ å“ªäº›æ–‡æ¡£åŒ…å«ç‰¹å®šçš„å…³é”®å­—ã€‚ä¸è¿‡ï¼Œç­‰ç­‰ï¼Œå€’æ’ç´¢å¼•æ˜¯ä»€ä¹ˆé¬¼?</p>
<h3 id="3-5-dao-pai-suo-yin" id="3-5ã€å€’æ’ç´¢å¼•">3.5ã€å€’æ’ç´¢å¼•</h3>
<p>elasticsearchä½¿ç”¨çš„æ˜¯ä¸€ç§ç§°ä¸ºå€’æ’ç´¢å¼• |çš„ç»“æ„ï¼Œé‡‡ç”¨Luceneå€’æ’ç´¢ä½œä¸ºåº•å±‚ã€‚è¿™ç§ç»“æ„é€‚ç”¨äºå¿«é€Ÿçš„å…¨æ–‡æœç´¢ï¼Œä¸€ä¸ªç´¢å¼•ç”±æ–‡æ¡£ä¸­æ‰€æœ‰ä¸é‡å¤çš„åˆ—è¡¨æ„æˆï¼Œå¯¹äºæ¯ä¸€ä¸ªè¯ï¼Œéƒ½æœ‰ä¸€ä¸ªåŒ…å«å®ƒçš„æ–‡æ¡£åˆ—è¡¨ã€‚ ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ä¸¤ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£åŒ…å«å¦‚ä¸‹å†…å®¹:</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">Study <span class="keyword">every</span> <span class="built_in">day</span>ï¼Œ good good up <span class="keyword">to</span> forever  <span class="comment"># æ–‡æ¡£1åŒ…å«çš„å†…å®¹</span></span><br><span class="line">To foreverï¼Œ study <span class="keyword">every</span> <span class="built_in">day</span>ï¼Œgood good up  <span class="comment"># æ–‡æ¡£2åŒ…å«çš„å†…å®¹</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºä¸ºåˆ›å»ºå€’æ’ç´¢å¼•ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å°†æ¯ä¸ªæ–‡æ¡£æ‹†åˆ†æˆç‹¬ç«‹çš„è¯(æˆ–ç§°ä¸ºè¯æ¡æˆ–è€…tokens) ï¼Œç„¶ååˆ›å»ºä¸€ä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¸é‡ å¤çš„è¯æ¡çš„æ’åºåˆ—è¡¨ï¼Œç„¶ååˆ—å‡ºæ¯ä¸ªè¯æ¡å‡ºç°åœ¨å“ªä¸ªæ–‡æ¡£:</p>
<table>
<thead>
<tr>
<th>term</th>
<th>doc_1</th>
<th>doc_2</th>
</tr>
</thead>
<tbody>
<tr>
<td>Study</td>
<td>âˆš</td>
<td>x</td>
</tr>
<tr>
<td>To</td>
<td>x</td>
<td>x</td>
</tr>
<tr>
<td>every</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>forever</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>day</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>study</td>
<td>x</td>
<td>âˆš</td>
</tr>
<tr>
<td>good</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>every</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>to</td>
<td>âˆš</td>
<td>x</td>
</tr>
<tr>
<td>up</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
</tbody>
</table>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¯•å›¾æœç´¢ to foreverï¼Œåªéœ€è¦æŸ¥çœ‹åŒ…å«æ¯ä¸ªè¯æ¡çš„æ–‡æ¡£</p>
<table>
<thead>
<tr>
<th>term</th>
<th>doc_1</th>
<th>doc_2</th>
</tr>
</thead>
<tbody>
<tr>
<td>to</td>
<td>âˆš</td>
<td>x</td>
</tr>
<tr>
<td>forever</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>total</td>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>ä¸¤ä¸ªæ–‡æ¡£éƒ½åŒ¹é…ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªåŒ¹é…ç¨‹åº¦æ›´é«˜ã€‚å¦‚æœæ²¡æœ‰åˆ«çš„æ¡ä»¶ï¼Œç°åœ¨ï¼Œè¿™ä¸¤ä¸ªåŒ…å«å…³é”®å­—çš„æ–‡æ¡£éƒ½å°†è¿”å›ã€‚</p>
<p>å†æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¯”å¦‚æˆ‘ä»¬é€šè¿‡åšå®¢æ ‡ç­¾æ¥æœç´¢åšå®¢æ–‡ç« ã€‚é‚£ä¹ˆå€’æ’ç´¢å¼•åˆ—è¡¨å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªç»“æ„:</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/dd3138e456594fd29935bba97a751325.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>å¦‚æœè¦æœç´¢å«æœ‰pythonæ ‡ç­¾çš„æ–‡ç« ï¼Œé‚£ç›¸å¯¹äºæŸ¥æ‰¾æ‰€æœ‰åŸå§‹æ•°æ®è€Œè¨€ï¼ŒæŸ¥æ‰¾å€’æ’ç´¢å¼•åçš„æ•°æ®å°†ä¼šå¿«çš„å¤šã€‚åªéœ€è¦æŸ¥çœ‹æ ‡ç­¾è¿™ä¸€æ ï¼Œç„¶åè·å–ç›¸å…³çš„æ–‡ç« IDå³å¯ã€‚å®Œå…¨è¿‡æ»¤æ‰æ— å…³çš„æ‰€æœ‰æ•°æ®ï¼Œæé«˜æ•ˆç‡!</p>
<p>elasticsearchçš„ç´¢å¼•å’ŒLuceneçš„ç´¢å¼•å¯¹æ¯”</p>
<p>åœ¨elasticsearchä¸­ï¼Œç´¢å¼•(åº“)è¿™ä¸ªè¯è¢«é¢‘ç¹ä½¿ç”¨ï¼Œè¿™å°±æ˜¯æœ¯è¯­çš„ä½¿ç”¨ã€‚åœ¨elasticsearchä¸­ ï¼Œç´¢å¼•è¢«åˆ†ä¸ºå¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä»½åˆ†ç‰‡æ˜¯-ä¸ªLuceneçš„ç´¢å¼•ã€‚æ‰€ä»¥ä¸€ä¸ªelasticsearchç´¢å¼•æ˜¯ç”±å¤š ä¸ªLuceneç´¢å¼•ç»„æˆçš„ã€‚åˆ«é—®ä¸ºä»€ä¹ˆï¼Œè°è®©elasticsearchä½¿ç”¨Luceneä½œä¸ºåº•å±‚å‘¢!å¦‚æ— ç‰¹æŒ‡ï¼Œè¯´èµ·ç´¢å¼•éƒ½æ˜¯æŒ‡elasticsearchçš„ç´¢å¼•ã€‚</p>
<p>æ¥ä¸‹æ¥çš„ä¸€åˆ‡æ“ä½œéƒ½åœ¨kibanaä¸­Dev Toolsä¸‹çš„Consoleé‡Œå®Œæˆã€‚åŸºç¡€æ“ä½œ!</p>
<h2 id="si-ik-fen-ci-qi-elasticsearch-cha-jian" id="å››ã€IKåˆ†è¯å™¨-elasticsearchæ’ä»¶">å››ã€IKåˆ†è¯å™¨(elasticsearchæ’ä»¶)</h2>
<h3 id="4-1-ik-fen-ci-qi" id="4-1ã€IKåˆ†è¯å™¨">4.1ã€IKåˆ†è¯å™¨</h3>
<p>ä¸­æ–‡åˆ†è¯å™¨</p>
<p>åˆ†è¯ï¼šå³æŠŠä¸€æ®µä¸­æ–‡æˆ–è€…åˆ«çš„åˆ’åˆ†æˆä¸€ä¸ªä¸ªçš„å…³é”®å­—ï¼Œæˆ‘ä»¬åœ¨æœç´¢æ—¶å€™ä¼šæŠŠè‡ªå·±çš„ä¿¡æ¯è¿›è¡Œåˆ†è¯ï¼Œä¼šæŠŠæ•°æ®åº“ä¸­æˆ–è€…ç´¢å¼•åº“ä¸­çš„æ•°æ®è¿›è¡Œåˆ†è¯ï¼Œç„¶åè¿›è¡Œä¸€ä¸€ä¸ªåŒ¹é…æ“ä½œï¼Œé»˜è®¤çš„ä¸­æ–‡åˆ†è¯æ˜¯å°†æ¯ä¸ªå­—çœ‹æˆä¸€ä¸ªè¯ï¼ˆä¸ä½¿ç”¨ç”¨IKåˆ†è¯å™¨çš„æƒ…å†µä¸‹ï¼‰ï¼Œæ¯”å¦‚â€œæˆ‘çˆ±ç‹‚ç¥â€ä¼šè¢«åˆ†ä¸ºâ€æˆ‘â€ï¼Œâ€çˆ±â€ï¼Œâ€ç‹‚â€ï¼Œâ€ç¥â€ ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ç¬¦åˆè¦æ±‚çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…ä¸­æ–‡åˆ†è¯å™¨ikæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>IKæä¾›äº†ä¸¤ä¸ªåˆ†è¯ç®—æ³•: (ik_smartå’Œik_max_word )ï¼Œå…¶ä¸­ik_smartä¸ºæœ€å°‘åˆ‡åˆ†ï¼Œik_max_wordä¸ºæœ€ç»†ç²’åº¦åˆ’åˆ†!</p>
<p>1ã€ä¸‹è½½</p>
<p>ç‰ˆæœ¬è¦ä¸ElasticSearchç‰ˆæœ¬å¯¹åº”</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p>
<p>2ã€å®‰è£…</p>
<p>ikæ–‡ä»¶å¤¹æ˜¯è‡ªå·±åˆ›å»ºçš„</p>
<p>è§£å‹æ”¾å…¥åˆ°eså¯¹åº”çš„pluginsä¸‹å³å¯</p>
<p>3ã€é‡å¯è§‚å¯ŸESï¼Œå‘ç°ikæ’ä»¶è¢«åŠ è½½äº†</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/38b1d63421ab4382b3311fcb0d3895c0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>4ã€elasticsearch-plugin å¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹åŠ è½½è¿›æ¥çš„æ’ä»¶</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/38f19cf2eab64372a275ffabc24f48c7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>5ã€ä½¿ç”¨kibanaæµ‹è¯•</p>
<p>æŸ¥çœ‹ä¸åŒçš„åˆ†è¯æ•ˆæœ</p>
<p>ik_smartï¼šæœ€å°‘åˆ‡åˆ†</p>
<p><img data-src="https://img-blog.csdnimg.cn/3fde229f03a1473cb51f08b432c35fc6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>ik_max_wordï¼šæœ€ç»†ç²’åº¦åˆ’åˆ†ï¼ˆç©·å°½è¯åº“çš„å¯èƒ½ï¼‰</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/4d73848123e84b208b4e40816b571650.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>æˆ‘ä»¬è¾“å…¥ è¶…çº§å–œæ¬¢ç‹‚ç¥è¯´java</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/38aea40d916f438790ab9ca400181243.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>å‘ç°é—®é¢˜ï¼šç‹‚ç¥è¯´è¢«æ‹†å¼€äº†ï¼</p>
<p>è¿™ç§è‡ªå·±éœ€è¦çš„è¯ï¼Œéœ€è¦è‡ªå·±åŠ åˆ°æˆ‘ä»¬çš„åˆ†è¯å™¨çš„å­—å…¸ä¸­ï¼</p>
<p><strong>ik åˆ†è¯å™¨å¢åŠ è‡ªå·±çš„é…ç½®</strong></p>
<p>æ·»åŠ è‡ªå®šä¹‰çš„è¯æ·»åŠ åˆ°æ‰©å±•å­—å…¸ä¸­</p>
<p>elasticsearchç›®å½•/plugins/ik/config/IKAnalyzer.cfg.xml</p>
<p>åˆ›å»º <code>kuang.dic</code> å­—å…¸æ–‡ä»¶ï¼Œæ·»åŠ å­—å…¸å†…å®¹</p>
<p><img data-src="https://img-blog.csdnimg.cn/08b073c0fb7342cb89f71cbaecf73ef9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>æ‰“å¼€ IKAnalyzer.cfg.xml æ–‡ä»¶ï¼Œæ‰©å±•å­—å…¸</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/8a9feed75ad24bb78327a1330655659b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>é‡å¯ElasticSearchï¼Œå†æ¬¡ä½¿ç”¨kibanaæµ‹è¯•</p>
<p><strong>åŠ è½½äº†è‡ªå·±çš„</strong></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/3715bb78330f447885bb4d18e72f7726.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>æµ‹è¯•kibana</strong></p>
<p><img data-src="https://img-blog.csdnimg.cn/ce04eb6b519d4c14a0801e2236985016.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>ä»¥åçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®åˆ†è¯å°±åœ¨è‡ªå·±å®šä¹‰çš„dicæ–‡ä»¶è¿›è¡Œé…ç½®å³å¯ï¼</p>
<h2 id="wu-rest-feng-ge-shuo-ming" id="äº”ã€Resté£æ ¼è¯´æ˜">äº”ã€Resté£æ ¼è¯´æ˜</h2>
<p><strong>ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼</strong>,è€Œä¸æ˜¯æ ‡å‡†,åªæ˜¯æä¾›äº†ä¸€ç»„è®¾è®¡åŸåˆ™å’Œçº¦æŸæ¡ä»¶ã€‚å®ƒä¸»è¦ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤äº’ç±»çš„è½¯ä»¶ã€‚åŸºäºè¿™ä¸ªé£æ ¼è®¾è®¡çš„è½¯ä»¶å¯ä»¥<strong>æ›´ç®€æ´</strong>ï¼Œ<strong>æ›´æœ‰å±‚æ¬¡</strong>ï¼Œ<strong>æ›´æ˜“äºå®ç°ç¼“å­˜</strong>ç­‰æœºåˆ¶ã€‚</p>
<h3 id="5-1-ji-ben-rest-ming-ling-shuo-ming" id="5-1ã€åŸºæœ¬Restå‘½ä»¤è¯´æ˜ï¼š">5.1ã€åŸºæœ¬Restå‘½ä»¤è¯´æ˜ï¼š</h3>
<table>
<thead>
<tr>
<th>method</th>
<th>urlåœ°å€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>PUTï¼ˆåˆ›å»º,ä¿®æ”¹ï¼‰</td>
<td>localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/æ–‡æ¡£id</td>
<td>åˆ›å»ºæ–‡æ¡£ï¼ˆæŒ‡å®šæ–‡æ¡£idï¼‰</td>
</tr>
<tr>
<td>POSTï¼ˆåˆ›å»ºï¼‰</td>
<td>localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°</td>
<td>åˆ›å»ºæ–‡æ¡£ï¼ˆéšæœºæ–‡æ¡£idï¼‰</td>
</tr>
<tr>
<td>POSTï¼ˆä¿®æ”¹ï¼‰</td>
<td>localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/æ–‡æ¡£id/_update</td>
<td>ä¿®æ”¹æ–‡æ¡£</td>
</tr>
<tr>
<td>DELETEï¼ˆåˆ é™¤ï¼‰</td>
<td>localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/æ–‡æ¡£id</td>
<td>åˆ é™¤æ–‡æ¡£</td>
</tr>
<tr>
<td>GETï¼ˆæŸ¥è¯¢ï¼‰</td>
<td>localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/æ–‡æ¡£id</td>
<td>æŸ¥è¯¢æ–‡æ¡£é€šè¿‡æ–‡æ¡£ID</td>
</tr>
<tr>
<td>POSTï¼ˆæŸ¥è¯¢ï¼‰</td>
<td>localhost:9200/ç´¢å¼•åç§°/ç±»å‹åç§°/æ–‡æ¡£id/_search</td>
<td>æŸ¥è¯¢æ‰€æœ‰æ•°æ®</td>
</tr>
</tbody>
</table>
<h3 id="5-2-guan-yu-suo-yin-de-ji-ben-cao-zuo" id="5-2ã€å…³äºç´¢å¼•çš„åŸºæœ¬æ“ä½œ">5.2ã€å…³äºç´¢å¼•çš„åŸºæœ¬æ“ä½œ</h3>
<p>1ã€åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œæ·»åŠ </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /ç´¢å¼•å/~ç±»å‹å~/æ–‡æ¡£id</span><br><span class="line"><span class="punctuation">&#123;</span>è¯·æ±‚ä½“<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /test1/type1/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;æµæŸš&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">18</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># è¿”å›ç»“æœ</span><br><span class="line"># è­¦å‘Šä¿¡æ¯ï¼š ä¸æ”¯æŒåœ¨æ–‡æ¡£ç´¢å¼•è¯·æ±‚ä¸­çš„æŒ‡å®šç±»å‹</span><br><span class="line"># è€Œæ˜¯ä½¿ç”¨æ— ç±»å‹çš„æ–­ç‚¹(/<span class="punctuation">&#123;</span>index<span class="punctuation">&#125;</span>/_doc/<span class="punctuation">&#123;</span>id<span class="punctuation">&#125;</span><span class="punctuation">,</span> /<span class="punctuation">&#123;</span>index<span class="punctuation">&#125;</span>/_doc<span class="punctuation">,</span> or /<span class="punctuation">&#123;</span>index<span class="punctuation">&#125;</span>/_create/<span class="punctuation">&#123;</span>id<span class="punctuation">&#125;</span>).</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;test1&quot;</span><span class="punctuation">,</span>	# ç´¢å¼•</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;type1&quot;</span><span class="punctuation">,</span>	# ç±»å‹ï¼ˆå·²ç»åºŸå¼ƒï¼‰</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span>			# id</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>		# ç‰ˆæœ¬</span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;created&quot;</span><span class="punctuation">,</span>	# æ“ä½œç±»å‹</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>			# åˆ†ç‰‡ä¿¡æ¯</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>å®Œæˆäº†è‡ªåŠ¨å¢åŠ ç´¢å¼•ï¼æ•°æ®ä¹ŸæˆåŠŸçš„æ·»åŠ äº†ï¼Œè¿™å°±æ˜¯æˆ‘è¯´å¤§å®¶åœ¨åˆæœŸå¯ä»¥æŠŠå®ƒå½“åšæ•°æ®åº“å­¦ä¹ çš„åŸå› ï¼</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/a1662e1682294fe8931f6c8f4b687389.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>2ã€å­—æ®µæ•°æ®ç±»å‹</p>
<ul>
<li>
<p>å­—ç¬¦ä¸²ç±»å‹</p>
<p>textã€keyword</p>
<ul>
<li>textï¼šæ”¯æŒåˆ†è¯ï¼Œå…¨æ–‡æ£€ç´¢,æ”¯æŒæ¨¡ç³Šã€ç²¾ç¡®æŸ¥è¯¢,ä¸æ”¯æŒèšåˆ,æ’åºæ“ä½œ;textç±»å‹çš„æœ€å¤§æ”¯æŒçš„å­—ç¬¦é•¿åº¦æ— é™åˆ¶,é€‚åˆå¤§å­—æ®µå­˜å‚¨ï¼›</li>
<li>keywordï¼šä¸è¿›è¡Œåˆ†è¯ï¼Œç›´æ¥ç´¢å¼•ã€æ”¯æŒæ¨¡ç³Šã€æ”¯æŒç²¾ç¡®åŒ¹é…ï¼Œæ”¯æŒèšåˆã€æ’åºæ“ä½œã€‚keywordç±»å‹çš„æœ€å¤§æ”¯æŒçš„é•¿åº¦ä¸ºâ€”â€”32766ä¸ªUTF-8ç±»å‹çš„å­—ç¬¦,å¯ä»¥é€šè¿‡è®¾ç½®ignore_aboveæŒ‡å®šè‡ªæŒå­—ç¬¦é•¿åº¦ï¼Œè¶…è¿‡ç»™å®šé•¿åº¦åçš„æ•°æ®å°†ä¸è¢«ç´¢å¼•ï¼Œæ— æ³•é€šè¿‡termç²¾ç¡®åŒ¹é…æ£€ç´¢è¿”å›ç»“æœã€‚</li>
</ul>
</li>
<li>
<p>æ•°å€¼å‹</p>
<p>longã€Integerã€shortã€byteã€doubleã€floatã€half floatã€scaled float</p>
</li>
<li>
<p>æ—¥æœŸç±»å‹</p>
<p>date</p>
</li>
<li>
<p>teå¸ƒå°”ç±»å‹</p>
<p>boolean</p>
</li>
<li>
<p>äºŒè¿›åˆ¶ç±»å‹</p>
<p>binary</p>
<p>ç­‰ç­‰â€¦</p>
</li>
</ul>
<p>3ã€æŒ‡å®šå­—æ®µçš„ç±»å‹ï¼ˆä½¿ç”¨PUTï¼‰</p>
<p>åˆ›å»ºè§„åˆ™ ç±»ä¼¼äºå»ºåº“ï¼ˆå»ºç«‹ç´¢å¼•å’Œå­—æ®µå¯¹åº”ç±»å‹ï¼‰ï¼Œä¹Ÿå¯çœ‹åšè§„åˆ™çš„å»ºç«‹</p>
<p><img data-src="https://img-blog.csdnimg.cn/970cd3944d8549fe883ce0e12b4c71f4.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>4ã€è·å–è§„åˆ™</p>
<p>å¯ä»¥é€šè¿‡ GET è¯·æ±‚è·å–å…·ä½“çš„ä¿¡æ¯</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/9ce725800ca3465a8c34ffccd7d8bd2b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>5ã€æŸ¥çœ‹é»˜è®¤ä¿¡æ¯</p>
<p><code>_doc</code> é»˜è®¤ç±»å‹ï¼ˆdefault typeï¼‰ï¼Œtype åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ä¼šé€æ¸å¼ƒç”¨ï¼Œå› æ­¤äº§ç”Ÿä¸€ä¸ªé»˜è®¤ç±»å‹è¿›è¡Œä»£æ›¿</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/4da91cb2d5df42bebac4fcb58f8b99f4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/19a9e6e92488420e83d34d77502d0472.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>å¦‚æœè‡ªå·±çš„æ–‡æ¡£å­—æ®µæ²¡æœ‰æŒ‡å®šï¼Œé‚£ä¹ˆeså°±ä¼šç»™æˆ‘ä»¬é»˜è®¤é…ç½®å­—æ®µç±»å‹ï¼</p>
<p>æ‰©å±•ï¼šé€šè¿‡å‘½ä»¤ elasticsearchç´¢å¼•æƒ…å†µï¼é€šè¿‡<code>get _cat/</code> å¯ä»¥è·å–ElasticSearchçš„å½“å‰çš„å¾ˆå¤šä¿¡æ¯ï¼</p>
<p><img data-src="https://img-blog.csdnimg.cn/981f1f82ba0244c8a063cca8ac0c5939.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/c63b3977ea4c4f4999c6582f8c8aba04.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>6ã€ä¿®æ”¹</p>
<p>ä¸¤ç§æ–¹æ¡ˆ</p>
<p>æ—§çš„ï¼ˆä½¿ç”¨putè¦†ç›–åŸæ¥çš„å€¼ï¼‰</p>
<p>ç‰ˆæœ¬+1ï¼ˆ_versionï¼‰</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/a51c87dd6df847a4a1f5d477ddecebc6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>ä½†æ˜¯å¦‚æœæ¼æ‰æŸä¸ªå­—æ®µæ²¡æœ‰å†™ï¼Œé‚£ä¹ˆæ›´æ–°æ˜¯æ²¡æœ‰å†™çš„å­—æ®µ ï¼Œä¼šæ¶ˆå¤±</p>
<p>æ–°çš„ï¼ˆä½¿ç”¨postçš„updateï¼‰</p>
<p><img data-src="https://img-blog.csdnimg.cn/d09be475ac2042079ba2c630ecd8c595.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>versionä¸ä¼šæ”¹å˜</p>
<p>éœ€è¦æ³¨æ„doc</p>
<p>ä¸ä¼šä¸¢å¤±å­—æ®µ</p>
<p>7ã€åˆ é™¤</p>
<p>é€šè¿‡DELETE å‘½ä»¤å®ç°åˆ é™¤ï¼Œæ ¹æ®ä½ çš„è¯·æ±‚æ¥åˆ¤æ–­æ˜¯åˆ é™¤ç´¢å¼•è¿˜æ˜¯åˆ é™¤æ–‡æ¡£è®°å½•ï¼</p>
<p>ä½¿ç”¨RESTFUL é£æ ¼æ˜¯æˆ‘ä»¬ESæ¨èå¤§å®¶ä½¿ç”¨çš„ï¼</p>
<h3 id="5-3-guan-yu-wen-dang-de-ji-ben-cao-zuo-zhong-dian" id="5-3ã€å…³äºæ–‡æ¡£çš„åŸºæœ¬æ“ä½œï¼ˆé‡ç‚¹ï¼‰">5.3ã€å…³äºæ–‡æ¡£çš„åŸºæœ¬æ“ä½œï¼ˆé‡ç‚¹ï¼‰</h3>
<h4 id="ji-ben-cao-zuo" id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h4>
<p>1ã€æ·»åŠ æ•°æ®</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /kuangshen/user/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç‹‚ç¥è¯´&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œä¸€çœ‹å·¥èµ„2500&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿åŠ¨&quot;</span><span class="punctuation">,</span><span class="string">&quot;é˜³å…‰&quot;</span><span class="punctuation">,</span><span class="string">&quot;ç›´ç”·&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://img-blog.csdnimg.cn/8dfa5df40a8b452eb658ed6ea52939ff.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /kuangshen/user/<span class="number">2</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¼ ä¸‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ³•å¤–ç‹‚å¾’&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;è¿åŠ¨&quot;</span><span class="punctuation">,</span><span class="string">&quot;æ—…æ¸¸&quot;</span><span class="punctuation">,</span><span class="string">&quot;æ¸£ç”·&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">PUT /kuangshen/user/<span class="number">3</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æå››&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mmp,ä¸çŸ¥é“ å¦‚ä½•å½¢å®¹&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;é“ä»”&quot;</span><span class="punctuation">,</span><span class="string">&quot;æ—…æ¸¸&quot;</span><span class="punctuation">,</span><span class="string">&quot;å”±æ­Œ&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>2ã€è·å–æ•°æ® GET</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/0e50324e7c9d4073befc3e9c5b839f60.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>3ã€æ›´æ–°æ•°æ® PUT</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /kuangshen/user/<span class="number">3</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æå››233&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mmp,ä¸çŸ¥é“ å¦‚ä½•å½¢å®¹&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;é“ä»”&quot;</span><span class="punctuation">,</span><span class="string">&quot;æ—…æ¸¸&quot;</span><span class="punctuation">,</span><span class="string">&quot;å”±æ­Œ&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/e5007de387844be5bfce42147f181e11.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>4ã€Post  _updateï¼Œæ¨èä½¿ç”¨è¿™ç§æ›´æ–°æ–¹å¼ï¼</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/9e051316013f400891b1ffd5d4473408.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>ç®€å•çš„æœç´¢</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET kuangshen/user/<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>ç®€å•çš„æ¡ä»¶æŸ¥è¯¢ï¼Œå¯ä»¥æ ¹æ®é»˜è®¤çš„æ˜ å°„è§„åˆ™ï¼Œäº§ç”ŸåŸºæœ¬çš„æŸ¥è¯¢ï¼</p>
<p><img data-src="https://img-blog.csdnimg.cn/0b0ea5fffae64c5099fc021f1924b7af.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>è¿™è¾¹nameæ˜¯text æ‰€ä»¥åšäº†åˆ†è¯çš„æŸ¥è¯¢ å¦‚æœæ˜¯keywordå°±ä¸ä¼šåˆ†è¯æœç´¢äº†</p>
<h4 id="fu-za-cao-zuo" id="å¤æ‚æ“ä½œ">å¤æ‚æ“ä½œ</h4>
<p>å¤æ‚æ“ä½œæœç´¢ selectï¼ˆæ’åºï¼Œåˆ†é¡µï¼Œé«˜äº®ï¼Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œç²¾å‡†æŸ¥è¯¢ï¼‰</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/a20e749f1863490d89cd3746c954a9de.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•åªèƒ½ä¸€ä¸ªå­—æ®µæŸ¥è¯¢</span></span><br><span class="line">GET lisen/user/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ææ£®&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼Œä¸æƒ³è¦é‚£ä¹ˆå¤šï¼Œåªå±•ç¤ºåˆ—è¡¨ä¸­æŸäº›å­—æ®µ</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/b7907b445a9a47598675e271890f7263.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>æˆ‘ä»¬ä¹‹åä½¿ç”¨javaæ“ä½œesï¼Œæ‰€æœ‰çš„æ–¹æ³•å’Œå¯¹è±¡å°±æ˜¯è¿™é‡Œé¢çš„key</p>
<p><strong>æ’åº</strong></p>
<p><img data-src="https://img-blog.csdnimg.cn/583539109f444b15a44de8ef0a527751.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>åˆ†é¡µ</strong></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/0ffa8f13a2d04d1c874e4cdf42b1168f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>æ•°æ®ä¸‹æ ‡è¿˜æ˜¯ä»0å¼€å§‹çš„ï¼Œå’Œå­¦çš„æ‰€æœ‰æ•°æ®ç»“æ„æ˜¯ä¸€æ ·çš„ï¼</p>
<p><strong>å¤šæ¡ä»¶æŸ¥è¯¢</strong></p>
<p>å¸ƒå°”å€¼æŸ¥è¯¢</p>
<p>mustï¼ˆandï¼‰ï¼Œæ‰€æœ‰çš„æ¡ä»¶éƒ½è¦ç¬¦åˆ where id=1 and name = xxx</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/3589fc9a7b7b48c79c8493997be7adbe.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>shouldï¼ˆorï¼‰ï¼Œæ‰€æœ‰çš„æ¡ä»¶éƒ½è¦ç¬¦åˆ  where id=1 or name = xxx</p>
<p><img data-src="https://img-blog.csdnimg.cn/721a2b681384440ea87daee668eea7eb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>must_notï¼ˆnotï¼‰</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/4ac6b16f0a7d4b2687e35c2f7cc03fad.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>è¿‡æ»¤å™¨ filter</strong></p>
<p><img data-src="https://img-blog.csdnimg.cn/23a68a449b51445eba3a88e9b30eb97a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<ul>
<li>gt å¤§äº</li>
<li>gte å¤§äºç­‰äº</li>
<li>lte å°äº</li>
<li>lte å°äºç­‰äº</li>
</ul>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/e8bc04cc80a94c1589c21d522fdcae76.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>åŒ¹é…å¤šä¸ªæ¡ä»¶ï¼ˆæ•°ç»„ï¼‰</strong></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/5c36c5aa99f64a5f86839e2982870c30.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>ç²¾ç¡®æŸ¥è¯¢</strong></p>
<p>termæŸ¥è¯¢æ˜¯ç›´æ¥é€šè¿‡å€’æ’ç´¢å¼•æŒ‡å®šçš„è¯æ¡è¿›ç¨‹ç²¾ç¡®æŸ¥æ‰¾çš„</p>
<p>å…³äºåˆ†è¯</p>
<ul>
<li>termï¼Œç›´æ¥æŸ¥è¯¢ç²¾ç¡®çš„</li>
<li>matchï¼Œä¼šä½¿ç”¨åˆ†è¯å™¨è§£æï¼ï¼ˆå…ˆåˆ†ææ–‡æ¡£ï¼Œç„¶åé€šè¿‡åˆ†æçš„æ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢ï¼‰</li>
</ul>
<p>ä¸¤ä¸ªç±»å‹ text  keyword</p>
<p><img data-src="https://img-blog.csdnimg.cn/e30c975c422e4312ba98abfda5987aaa.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://img-blog.csdnimg.cn/8cbfcbf35fb74cedb63a91c05298229f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/3de24b19e77441c39c6b2eaf1df58f6f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>å¤šä¸ªå€¼åŒ¹é…ç²¾ç¡®æŸ¥è¯¢</strong></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/f5fc6c7a9b794c829fa48d56bfd81f96.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><strong>é«˜äº®</strong></p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/6bbe3eee045a44b9ab52097aedd27964.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>è¿˜èƒ½è‡ªå®šä¹‰é«˜äº®çš„æ ·å¼</p>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/1b8f05ec014343a2b6e85a0564dbe4b5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>è¿™äº›mysqlä¹Ÿèƒ½åšï¼Œåªæ˜¯æ•ˆç‡æ¯”è¾ƒä½</p>
<ul>
<li>åŒ¹é…</li>
<li>æŒ‰æ¡ä»¶åŒ¹é…</li>
<li>ç²¾ç¡®åŒ¹é…</li>
<li>åŒºé—´èŒƒå›´åŒ¹é…</li>
<li>åŒ¹é…å­—æ®µè¿‡æ»¤</li>
<li>å¤šæ¡ä»¶æŸ¥è¯¢</li>
<li>é«˜äº®æŸ¥è¯¢</li>
</ul>
<h2 id="liu-springboot-ji-cheng" id="å…­ã€Springbooté›†æˆ">å…­ã€Springbooté›†æˆ</h2>
<p>æ‰¾å®˜æ–¹æ–‡æ¡£</p>
<p><img data-src="https://img-blog.csdnimg.cn/03a46f66dbe7480182fcc45536f8b3e3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://img-blog.csdnimg.cn/19b99197625040c28a2f44f26feaa791.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p><img data-src="https://img-blog.csdnimg.cn/e186b75d68d14b41b62f8fa0e444e333.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<h3 id="6-1-dao-ru-yi-lai" id="6-1ã€å¯¼å…¥ä¾èµ–">6.1ã€å¯¼å…¥ä¾èµ–</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.14.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ä¸‹spring-bootçš„parentåŒ…å†…çš„ä¾èµ–çš„esçš„ç‰ˆæœ¬æ˜¯ä¸æ˜¯ä½ å¯¹åº”çš„ç‰ˆæœ¬</p>
<p>ä¸æ˜¯çš„è¯å°±åœ¨pomæ–‡ä»¶ä¸‹å†™ä¸ªpropertiesçš„ç‰ˆæœ¬</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--è¿™è¾¹é…ç½®ä¸‹è‡ªå·±å¯¹åº”çš„ç‰ˆæœ¬--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.14.0<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-2-zhao-dui-xiang" id="6-2ã€æ‰¾å¯¹è±¡">6.2ã€æ‰¾å¯¹è±¡</h3>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/e3d293ae07494d09a4cec0c2fe18e7db.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<h3 id="6-3-fen-xi-zhe-ge-lei-zhong-de-fang-fa" id="6-3ã€åˆ†æè¿™ä¸ªç±»ä¸­çš„æ–¹æ³•">6.3ã€åˆ†æè¿™ä¸ªç±»ä¸­çš„æ–¹æ³•</h3>
<p>é…ç½®åŸºæœ¬çš„é¡¹ç›®</p>
<p>ä¸€å®šè¦ä¿è¯æˆ‘ä»¬å¯¼å…¥çš„ä¾èµ–å’Œæˆ‘ä»¬æœ¬åœ°çš„esç‰ˆæœ¬ä¸€è‡´</p>
<p><img data-src="https://img-blog.csdnimg.cn/b0876b20083740afa52422eabb14462d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6b6Z5a6HXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>æ–°å»ºé…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1ã€æ‰¾å¯¹è±¡</span></span><br><span class="line"><span class="comment">// 2ã€æ”¾åˆ°springä¸­å¾…ç”¨</span></span><br><span class="line"><span class="comment">// 3ã€å¦‚æœæ˜¯springboot å°±å…ˆåˆ†ææºç </span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticSearchClientConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestHighLevelClient <span class="title function_">restHighLevelClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">            RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://cdn.jsdelivr.net/gh/zglgithubx/picture/img/5ffde15a8f0a4ca0a59a72508654579b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" /></p>
<p>è™½ç„¶è¿™é‡Œå¯¼å…¥äº†3ä¸ªç±»ï¼Œéƒ½æ˜¯é™æ€å†…éƒ¨ç±»ï¼Œæ ¸å¿ƒç±»å°±ä¸€ä¸ª</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure.elasticsearch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.auth.AuthScope;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.auth.Credentials;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.auth.UsernamePasswordCredentials;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig.Builder;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.BasicCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.nio.client.HttpAsyncClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.ObjectProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.PropertyMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;RestHighLevelClient.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123;RestClient.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;ElasticsearchRestClientProperties.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchRestClientAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ElasticsearchRestClientAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PropertiesCredentialsProvider</span> <span class="keyword">extends</span> <span class="title class_">BasicCredentialsProvider</span> &#123;</span><br><span class="line">        PropertiesCredentialsProvider(ElasticsearchRestClientProperties properties) &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(properties.getUsername())) &#123;</span><br><span class="line">                <span class="type">Credentials</span> <span class="variable">credentials</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordCredentials</span>(properties.getUsername(), properties.getPassword());</span><br><span class="line">                <span class="built_in">this</span>.setCredentials(AuthScope.ANY, credentials);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            properties.getUris().stream().map(<span class="built_in">this</span>::toUri).filter(<span class="built_in">this</span>::hasUserInfo).forEach(<span class="built_in">this</span>::addUserInfoCredentials);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> URI <span class="title function_">toUri</span><span class="params">(String uri)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> URI.create(uri);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException var3) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hasUserInfo</span><span class="params">(URI uri)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> uri != <span class="literal">null</span> &amp;&amp; StringUtils.hasLength(uri.getUserInfo());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addUserInfoCredentials</span><span class="params">(URI uri)</span> &#123;</span><br><span class="line">            <span class="type">AuthScope</span> <span class="variable">authScope</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthScope</span>(uri.getHost(), uri.getPort());</span><br><span class="line">            <span class="type">Credentials</span> <span class="variable">credentials</span> <span class="operator">=</span> <span class="built_in">this</span>.createUserInfoCredentials(uri.getUserInfo());</span><br><span class="line">            <span class="built_in">this</span>.setCredentials(authScope, credentials);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Credentials <span class="title function_">createUserInfoCredentials</span><span class="params">(String userInfo)</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">delimiter</span> <span class="operator">=</span> userInfo.indexOf(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (delimiter == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordCredentials</span>(userInfo, (String)<span class="literal">null</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> userInfo.substring(<span class="number">0</span>, delimiter);</span><br><span class="line">                <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> userInfo.substring(delimiter + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordCredentials</span>(username, password);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DefaultRestClientBuilderCustomizer</span> <span class="keyword">implements</span> <span class="title class_">RestClientBuilderCustomizer</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">PropertyMapper</span> <span class="variable">map</span> <span class="operator">=</span> PropertyMapper.get();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ElasticsearchRestClientProperties properties;</span><br><span class="line"></span><br><span class="line">        DefaultRestClientBuilderCustomizer(ElasticsearchRestClientProperties properties) &#123;</span><br><span class="line">            <span class="built_in">this</span>.properties = properties;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(RestClientBuilder builder)</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(HttpAsyncClientBuilder builder)</span> &#123;</span><br><span class="line">            builder.setDefaultCredentialsProvider(<span class="keyword">new</span> <span class="title class_">ElasticsearchRestClientAutoConfiguration</span>.PropertiesCredentialsProvider(<span class="built_in">this</span>.properties));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">            <span class="type">PropertyMapper</span> <span class="variable">var10000</span> <span class="operator">=</span> map;</span><br><span class="line">            <span class="type">ElasticsearchRestClientProperties</span> <span class="variable">var10001</span> <span class="operator">=</span> <span class="built_in">this</span>.properties;</span><br><span class="line">            var10001.getClass();</span><br><span class="line">            var10000.from(var10001::getConnectionTimeout).whenNonNull().asInt(Duration::toMillis).to(builder::setConnectTimeout);</span><br><span class="line">            var10000 = map;</span><br><span class="line">            var10001 = <span class="built_in">this</span>.properties;</span><br><span class="line">            var10001.getClass();</span><br><span class="line">            var10000.from(var10001::getReadTimeout).whenNonNull().asInt(Duration::toMillis).to(builder::setSocketTimeout);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">        proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(&#123;RestHighLevelClient.class&#125;)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RestHighLevelClientConfiguration</span> &#123;</span><br><span class="line">        RestHighLevelClientConfiguration() &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// RestHighLevelClient é«˜çº§å®¢æˆ·ç«¯ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¿™é‡Œè¦è®²ï¼Œåé¢é¡¹ç›®ä¼šç”¨åˆ°å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        RestHighLevelClient <span class="title function_">elasticsearchRestHighLevelClient</span><span class="params">(RestClientBuilder restClientBuilder)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(restClientBuilder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">        proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(&#123;RestClientBuilder.class&#125;)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RestClientBuilderConfiguration</span> &#123;</span><br><span class="line">        RestClientBuilderConfiguration() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        RestClientBuilderCustomizer <span class="title function_">defaultRestClientBuilderCustomizer</span><span class="params">(ElasticsearchRestClientProperties properties)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchRestClientAutoConfiguration</span>.DefaultRestClientBuilderCustomizer(properties);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// RestClientBuilder</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        RestClientBuilder <span class="title function_">elasticsearchRestClientBuilder</span><span class="params">(ElasticsearchRestClientProperties properties, ObjectProvider&lt;RestClientBuilderCustomizer&gt; builderCustomizers)</span> &#123;</span><br><span class="line">            HttpHost[] hosts = (HttpHost[])properties.getUris().stream().map(<span class="built_in">this</span>::createHttpHost).toArray((x$<span class="number">0</span>) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpHost</span>[x$<span class="number">0</span>];</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="type">RestClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> RestClient.builder(hosts);</span><br><span class="line">            builder.setHttpClientConfigCallback((httpClientBuilder) -&gt; &#123;</span><br><span class="line">                builderCustomizers.orderedStream().forEach((customizer) -&gt; &#123;</span><br><span class="line">                    customizer.customize(httpClientBuilder);</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> httpClientBuilder;</span><br><span class="line">            &#125;);</span><br><span class="line">            builder.setRequestConfigCallback((requestConfigBuilder) -&gt; &#123;</span><br><span class="line">                builderCustomizers.orderedStream().forEach((customizer) -&gt; &#123;</span><br><span class="line">                    customizer.customize(requestConfigBuilder);</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> requestConfigBuilder;</span><br><span class="line">            &#125;);</span><br><span class="line">            builderCustomizers.orderedStream().forEach((customizer) -&gt; &#123;</span><br><span class="line">                customizer.customize(builder);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> builder;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> HttpHost <span class="title function_">createHttpHost</span><span class="params">(String uri)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.createHttpHost(URI.create(uri));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException var3) &#123;</span><br><span class="line">                <span class="keyword">return</span> HttpHost.create(uri);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> HttpHost <span class="title function_">createHttpHost</span><span class="params">(URI uri)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.hasLength(uri.getUserInfo())) &#123;</span><br><span class="line">                <span class="keyword">return</span> HttpHost.create(uri.toString());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> HttpHost.create((<span class="keyword">new</span> <span class="title class_">URI</span>(uri.getScheme(), (String)<span class="literal">null</span>, uri.getHost(), uri.getPort(), uri.getPath(), uri.getQuery(), uri.getFragment())).toString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (URISyntaxException var3) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(var3);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-4-suo-yin-de-zeng-shan-shi-fou-cun-zai" id="6-4ã€ç´¢å¼•çš„å¢ã€åˆ ã€æ˜¯å¦å­˜åœ¨">6.4ã€ç´¢å¼•çš„å¢ã€åˆ ã€æ˜¯å¦å­˜åœ¨</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•ç´¢å¼•çš„åˆ›å»º request</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   <span class="comment">// 1ã€åˆ›å»ºç´¢å¼•è¯·æ±‚</span></span><br><span class="line">   <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">   <span class="comment">// 2ã€å®¢æˆ·ç«¯æ‰§è¡Œè¯·æ±‚ indexResponse, è¯·æ±‚åè·å¾—ç›¸åº”</span></span><br><span class="line">   <span class="type">CreateIndexResponse</span> <span class="variable">createIndexResponse</span> <span class="operator">=</span> client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">   System.out.println(createIndexResponse);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•è·å–ç´¢å¼•ï¼Œåªèƒ½åˆ¤æ–­å…¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testExistIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">   System.out.println(exists);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤ç´¢å¼•</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">   <span class="type">AcknowledgedResponse</span> <span class="variable">delete</span> <span class="operator">=</span> client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">   System.out.println(delete.isAcknowledged());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-5-wen-dang-de-cao-zuo" id="6-5ã€æ–‡æ¡£çš„æ“ä½œ">6.5ã€æ–‡æ¡£çš„æ“ä½œ</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•åˆ›å»ºæ–‡æ¡£</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAddDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;ç‹‚ç¥è¯´&quot;</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»ºè¯·æ±‚</span></span><br><span class="line">    <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§„åˆ™ put /kuang_index/_doc/1</span></span><br><span class="line">    request.id(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    request.timeout(TimeValue.timeValueDays(<span class="number">1</span>));</span><br><span class="line">    <span class="comment">//    request.timeout(&quot;1&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æˆ‘ä»¬çš„æ•°æ®æ”¾å…¥è¯·æ±‚ json</span></span><br><span class="line">    request.source(JSON.toJSONString(user), XContentType.JSON);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œè·å–å“åº”ç»“æœ</span></span><br><span class="line">    <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> client.index(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    System.out.println(indexResponse.toString());</span><br><span class="line">    System.out.println(indexResponse.status());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ–‡æ¡£ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ get /index/doc/1</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testIsExists</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;kuang_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="comment">// ä¸è·å–è¿”å›çš„ _source çš„ä¸Šä¸‹æ–‡äº†</span></span><br><span class="line">    request.fetchSourceContext(<span class="keyword">new</span> <span class="title class_">FetchSourceContext</span>(<span class="literal">false</span>));</span><br><span class="line">    request.storedFields(<span class="string">&quot;_none_&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(exists);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ–‡æ¡£ä¿¡æ¯</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;kuang_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="type">GetResponse</span> <span class="variable">getResponse</span> <span class="operator">=</span> client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(getResponse.getSourceAsString()); <span class="comment">// æ‰“å°æ–‡æ¡£çš„å†…å®¹</span></span><br><span class="line">    System.out.println(getResponse);  <span class="comment">// è¿”å›çš„å…¨éƒ¨å†…å®¹å’Œå‘½ä»¤æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°æ–‡æ¡£çš„ä¿¡æ¯</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">UpdateRequest</span> <span class="variable">updateRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;kuang_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    updateRequest.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;ç‹‚ç¥è¯´java&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    updateRequest.doc(JSON.toJSONString(user), XContentType.JSON);</span><br><span class="line"></span><br><span class="line">    <span class="type">UpdateResponse</span> <span class="variable">updateResponse</span> <span class="operator">=</span> client.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(updateResponse.status());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æ–‡æ¡£è®°å½•</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;kuang_index&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">    request.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">DeleteResponse</span> <span class="variable">delete</span> <span class="operator">=</span> client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(delete.status());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¹é‡æ’å…¥</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    bulkRequest.timeout(<span class="string">&quot;10s&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;User&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;kuangshen1&quot;</span>, <span class="number">3</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;kuangshen2&quot;</span>, <span class="number">3</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;kuangshen3&quot;</span>, <span class="number">3</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;qinjiang1&quot;</span>, <span class="number">3</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;qinjiang2&quot;</span>, <span class="number">3</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;qinjiang3&quot;</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¹å¤„ç†è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">        <span class="comment">// æ‰¹é‡æ›´æ–°å’Œæ‰¹é‡åˆ é™¤ï¼Œå°±åœ¨è¿™é‡Œä¿®æ”¹å¯¹åº”çš„è¯·æ±‚å°±å¯ä»¥äº†</span></span><br><span class="line">        bulkRequest.add(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;kuang_index&quot;</span>)</span><br><span class="line">            .id(<span class="string">&quot;&quot;</span> + (i + <span class="number">1</span>))</span><br><span class="line">            .source(JSON.toJSONString(list.get(i)), XContentType.JSON));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">BulkResponse</span> <span class="variable">bulkResponse</span> <span class="operator">=</span> client.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(bulkResponse.hasFailures());  <span class="comment">// æ˜¯å¦å¤±è´¥,è¿”å›falseä»£è¡¨æˆåŠŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">// SearchRequest æœç´¢è¯·æ±‚</span></span><br><span class="line"><span class="comment">// SearchSourceBuilder æ¡ä»¶æ„é€ </span></span><br><span class="line"><span class="comment">// HighLightBuilder æ„å»ºé«˜äº®</span></span><br><span class="line"><span class="comment">// TermQueryBuilder  ç²¾ç¡®æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">// MatchAllQueryBuilder</span></span><br><span class="line"><span class="comment">// xxx QueryBuilder å¯¹åº”æˆ‘ä»¬åˆšæ‰çœ‹åˆ°çš„å‘½ä»¤ï¼</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSearch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">    <span class="comment">// æ„å»ºæœç´¢æ¡ä»¶</span></span><br><span class="line">    <span class="type">SearchSourceBuilder</span> <span class="variable">sourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥è¯¢æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ QueryBuilders å·¥å…·æ¥å®ç°</span></span><br><span class="line">    <span class="comment">// QueryBuilders.termQuery  ç²¾ç¡®</span></span><br><span class="line">    <span class="comment">//QueryBuilders.matchAllQuery åŒ¹é…æ‰€æœ‰</span></span><br><span class="line"></span><br><span class="line">    <span class="type">TermQueryBuilder</span> <span class="variable">termQueryBuilder</span> <span class="operator">=</span> QueryBuilders.termQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;qinjiang1&quot;</span>);</span><br><span class="line">    <span class="comment">//    MatchAllQueryBuilder matchAllQueryBuilder = QueryBuilders.matchAllQuery();</span></span><br><span class="line">    sourceBuilder.query(termQueryBuilder);</span><br><span class="line">    sourceBuilder.timeout(<span class="keyword">new</span> <span class="title class_">TimeValue</span>(<span class="number">60</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">    searchRequest.source(sourceBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(JSON.toJSONString(searchResponse.getHits()));</span><br><span class="line">    System.out.println(<span class="string">&quot;===========================&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (SearchHit documentFields : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">        System.out.println(documentFields.getSourceAsMap());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
</search>
